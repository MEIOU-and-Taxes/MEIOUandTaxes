namespace = war_of_the_roses

### WAR OF THE ROSES ###

country_event = { #Madness of Henry VI
	id = war_of_the_roses.1
	title = war_of_the_roses.1.t
	desc = war_of_the_roses.1.d
	picture = WAR_OF_THE_ROSES_eventPicture
	major = yes
	is_triggered_only = yes
	fire_only_once = yes
	
	immediate = {
		add_ruler_modifier = { name = "mental_illness" }
		add_country_modifier = { name = "bout_of_insanity" duration = 90 }
		set_variable = { which = "number_of_episodes" value = 1 }
		set_global_flag = henry_madness
		hidden_effect = {
			if = {
				limit = {
					adm = 5
				}
				change_adm = -3
			}
			if = {
				limit = {
					adm = 4
				}
				change_adm = -2
			}
			if = {
				limit = {
					adm = 3
				}
				change_adm = -1
			}
			if = {
				limit = {
					dip = 5
				}
				change_dip = -3
			}
			if = {
				limit = {
					dip = 4
				}
				change_dip = -2
			}
			if = {
				limit = {
					dip = 3
				}
				change_dip = -1
			}
			if = {
				limit = {
					mil = 5
				}
				change_mil = -3
			}
			if = {
				limit = {
					mil = 4
				}
				change_mil = -2
			}
			if = {
				limit = {
					mil = 3
				}
				change_mil = -1
			}
		}

		add_country_modifier = {
			name = "disorder"
			duration = 1095
		}
	}
	
	option = {
		name = "war_of_the_roses.1.a" #Name Queen and her right hand man Somerset as regent
		set_country_flag = anjou_somerset
		set_country_flag = great_governance
	}
	
	option = {
		name = "war_of_the_roses.1.b" #Name our heir Duke of York as regent
		ai_chance = { factor = 5 }
		set_country_flag = richard_york
		set_country_flag = poor_governance
	}

	after = {
		hidden_effect = {
			country_event = {
				id = war_of_the_roses.3
				days = 10
			}
		}
	}
}

# New Psychotic Episode
country_event = {
	
	id = war_of_the_roses.2
	title = "war_of_the_roses.2.n"
	desc = "war_of_the_roses.2.t"
	picture = CHARLES_LE_FOL_eventPicture
	
	trigger = {
		has_ruler_modifier = "mental_illness"
		NOT = { has_country_modifier = "bout_of_insanity" }
	}
	
	mean_time_to_happen = {
		months = 24
		
		modifier = {
			check_variable = { which = "number_of_episodes" value = 2 }
			factor = 0.90
		}
		modifier = {
			check_variable = { which = "number_of_episodes" value = 3 }
			factor = 0.90
		}
		modifier = {
			check_variable = { which = "number_of_episodes" value = 4 }
			factor = 0.90
		}
		modifier = {
			check_variable = { which = "number_of_episodes" value = 5 }
			factor = 0.90
		}
		modifier = {
			check_variable = { which = "number_of_episodes" value = 6 }
			factor = 0.90
		}
		modifier = {
			check_variable = { which = "number_of_episodes" value = 7 }
			factor = 0.90
		}
		modifier = {
			check_variable = { which = "number_of_episodes" value = 8 }
			factor = 0.90
		}
		modifier = {
			check_variable = { which = "number_of_episodes" value = 9 }
			factor = 0.90
		}
		modifier = {
			check_variable = { which = "number_of_episodes" value = 10 }
			factor = 0.90
		}
	}
	
	immediate = {
		hidden_effect = {
			change_variable = { which = "number_of_episodes" value = 1 }
		}
	}
	
	option = {
		name = "war_of_the_roses.2.a"
		if = {
			limit = {
				check_variable = { which = "number_of_episodes" value = 2 }
				NOT = { check_variable = { which = "number_of_episodes" value = 3 } }
			}
			add_country_modifier = { name = "bout_of_insanity" duration = 120 }
		}
		if = {
			limit = {
				check_variable = { which = "number_of_episodes" value = 3 }
				NOT = { check_variable = { which = "number_of_episodes" value = 4 } }
			}
			add_country_modifier = { name = "bout_of_insanity" duration = 150 }
		}
		if = {
			limit = {
				check_variable = { which = "number_of_episodes" value = 4 }
				NOT = { check_variable = { which = "number_of_episodes" value = 5 } }
			}
			add_country_modifier = { name = "bout_of_insanity" duration = 180 }
		}
		if = {
			limit = {
				check_variable = { which = "number_of_episodes" value = 5 }
				NOT = { check_variable = { which = "number_of_episodes" value = 6 } }
			}
			add_country_modifier = { name = "bout_of_insanity" duration = 210 }
		}
		if = {
			limit = {
				check_variable = { which = "number_of_episodes" value = 6 }
				NOT = { check_variable = { which = "number_of_episodes" value = 7 } }
			}
			add_country_modifier = { name = "bout_of_insanity" duration = 240 }
		}
		if = {
			limit = {
				check_variable = { which = "number_of_episodes" value = 7 }
				NOT = { check_variable = { which = "number_of_episodes" value = 8 } }
			}
			add_country_modifier = { name = "bout_of_insanity" duration = 270 }
		}
		if = {
			limit = {
				check_variable = { which = "number_of_episodes" value = 8 }
				NOT = { check_variable = { which = "number_of_episodes" value = 9 } }
			}
			add_country_modifier = { name = "bout_of_insanity" duration = 300 }
		}
		if = {
			limit = {
				check_variable = { which = "number_of_episodes" value = 9 }
				NOT = { check_variable = { which = "number_of_episodes" value = 10 } }
			}
			add_country_modifier = { name = "bout_of_insanity" duration = 330 }
		}
		if = {
			limit = {
				check_variable = { which = "number_of_episodes" value = 10 }
			}
			add_country_modifier = { name = "bout_of_insanity" duration = 360 }
		}

		clr_country_flag = recovered_henry
	}

	after = {
		hidden_effect = {
			country_event = {
				id = war_of_the_roses.3
				days = 10
			}
		}
	}
}


country_event = { #Name new regent
	id = war_of_the_roses.3
	title = war_of_the_roses.3.t
	desc = war_of_the_roses.3.d
	picture = WAR_OF_THE_ROSES_eventPicture
	
	is_triggered_only = yes

	immediate = {
		add_country_modifier = {
			name = "disorder"
			duration = 1095
		}
	}

	hidden_effect = {
		change_variable = { which = "number_of_regents" value = 1 }
	}

	option = {
		name = "war_of_the_roses.3.a" #Queen
		set_country_flag = anjou_somerset
	}

	option = {
		name = "war_of_the_roses.3.b" #York
		set_country_flag = richard_york
	}

	after = {
		hidden_effect = {
			random_list = {
				50  = {
					set_country_flag = good_governance
				}
				50 = {
					set_country_flag = poor_governance
				}
			}

			country_event = {
				id = war_of_the_roses.5
				days = 30
			}
		}
	}
}

country_event = { #Henry recovers
	id = war_of_the_roses.4
	title = war_of_the_roses.4.t
	desc = war_of_the_roses.4.d
	picture = WAR_OF_THE_ROSES_eventPicture
	
	trigger = {
		check_variable = { which = "number_of_episodes" value = 1 } #At least mad once
		OR = {
			has_country_flag = richard_york
			has_country_flag = anjou_somerset
		}
		NOT = { has_country_modifier = bout_of_insanity } 
		has_ruler_modifier = "mental_illness"
	}

	mean_time_to_happen = {
		months = 3
	}

	option = {
		name = "war_of_the_roses.4.a" #Queen
		trigger = {
			has_country_flag = anjou_somerset
		}
		clr_country_flag = anjou_somerset
		set_country_flag = recovered_henry

		Public_ChangePowerbrokerLoyaltyTooltipProv = {
			Powerbroker = NO
			Amount = -10
		}
	}

	option = {
		name = "war_of_the_roses.4.b" #York
		trigger = {
			has_country_flag = richard_york
		}
		clr_country_flag = richard_york
		set_country_flag = recovered_henry

		Public_ChangePowerbrokerLoyaltyTooltipProv = {
			Powerbroker = NO
			Amount = -10
		}
	}
}

country_event = { #Good or bad governance?
	id = war_of_the_roses.5
	title = war_of_the_roses.5.t
	desc = war_of_the_roses.5.d
	picture = WAR_OF_THE_ROSES_eventPicture
	
	is_triggered_only = yes

	option = {
		name = "war_of_the_roses.5.a" #Bad
		trigger = {
			has_country_flag = poor_governance
		}
		random_list = {
			15 = {
				Stab_Subtract2 = yes
			}
			20 = {
				Stab_Subtract1 = yes
			}

			65 = {

			}
		}
	}

	option = {
		name = "war_of_the_roses.5.b" #Good
		trigger = {
			has_country_flag = good_governance
		}
		random_list = {
			20 = {
				Stab_Add50Percent = yes
			}
			30 = {
				Stab_Add25Percent = yes
			}

			50 = {

			}
		}
	}
}


country_event = { #Escalation between two parties
	id = war_of_the_roses.6
	title = war_of_the_roses.6.t
	desc = war_of_the_roses.6.d
	picture = WAR_OF_THE_ROSES_eventPicture
	
	fire_only_once = yes

	trigger = {
		check_variable = { which = "number_of_regents" value = 1 } #At least mad once
	}

	mean_time_to_happen = {
		months = 60

		modifier = {
			check_variable = { which = "number_of_regents" value = 2 }
			factor = 0.90
		}

		modifier = {
			check_variable = { which = "number_of_regents" value = 3 }
			factor = 0.90
		}

		modifier = {
			check_variable = { which = "number_of_regents" value = 4 }
			factor = 0.90
		}

		modifier = {
			check_variable = { which = "number_of_regents" value = 5 }
			factor = 0.90
		}

		modifier = {
			check_variable = { which = "number_of_regents" value = 6 }
			factor = 0.90
		}

		modifier = {
			check_variable = { which = "number_of_regents" value = 7 }
			factor = 0.90
		}

		modifier = {
			check_variable = { which = "number_of_regents" value = 8 }
			factor = 0.90
		}

		modifier = {
			check_variable = { which = "number_of_regents" value = 9 }
			factor = 0.90
		}

		modifier = {
			check_variable = { which = "number_of_regents" value = 10 }
			factor = 0.90
		}
	}

	option = {
		name = "war_of_the_roses.6.a" #Heading to civil war
		set_country_flag = WoR_civil_war
		Public_ChangePowerbrokerLoyaltyTooltipProv = {
			Powerbroker = NO
			Amount = -10
		}

		hidden_effect = {
			country_event = {
				id = war_of_the_roses.7
				days = 30
			}
		}
	}
}

country_event = { #St Albans - first battle between those factions
	id = war_of_the_roses.7
	title = war_of_the_roses.7.t
	desc = war_of_the_roses.7.d
	picture = WAR_OF_THE_ROSES_eventPicture
	
	is_triggered_only = yes
	fire_only_once = yes

	option = {
		name = "war_of_the_roses.6.a" #Somerset executed
		Public_ChangePowerbrokerLoyaltyTooltipProv = {
			Powerbroker = NO
			Amount = -15
		}

		kill_advisor = random
		Stab_Subtract1 = yes
		set_country_flag = st_albans

		add_country_modifier = {
			name = "wor_disorder"
			duration = 1825
		}
	}
}


country_event = { #Neville Percy Feud
	id = war_of_the_roses.8
	title = war_of_the_roses.8.t
	desc = war_of_the_roses.8.d
	picture = WAR_OF_THE_ROSES_eventPicture
	
	fire_only_once = yes

	trigger = {
		has_country_flag = st_albans
		NOT = { has_country_modifier = "wor_disorder" }
	}

	mean_time_to_happen = {
		months = 12
	}

	option = {
		name = "war_of_the_roses.8.a" #One more entanglement
		Public_ChangePowerbrokerLoyaltyTooltipProv = {
			Powerbroker = NO
			Amount = -15
		}

		add_country_modifier = {
			name = "wor_disorder"
			duration = 1825
		}
	}
}

country_event = { #Calais piracy England
	id = war_of_the_roses.9
	title = war_of_the_roses.9.t
	desc = war_of_the_roses.9.d
	picture = WAR_OF_THE_ROSES_eventPicture
	
	fire_only_once = yes
	is_triggered_only = yes

	trigger = {
		tag = ENG
		owns = 63
		controls = 63
		NOT = { has_country_flag = wor_piracy }
	}

	mean_time_to_happen = {
        months = 24
    }

	option = {
		name = "war_of_the_roses.9.a" #Annoys Hansatic league and Castile
		if = {
			limit = {
				exists = FRL
			}

			FRL = {
				country_event = {
					id = war_of_the_roses.10
				}
			}
		}

		if = {
			limit = {
				exists = CAS
			}

			CAS = {
				country_event = {
					id = war_of_the_roses.10
				}
			}
		}

		set_country_flag = wor_piracy
	}
}

country_event = { #Calais piracy notification
	id = war_of_the_roses.10
	title = war_of_the_roses.10.t
	desc = war_of_the_roses.10.d
	picture = WAR_OF_THE_ROSES_eventPicture
	
	is_triggered_only = yes

	option = {
		name = "war_of_the_roses.10.a" #Hansatic league and Castile notification
		capital_scope = {
			Public_ChangeClassWealthVal = { class = BG type = value inp = -50 }
		}

		add_opinion = {
			who = ENG
			modifier = pirated_us
		}
		add_trust = {
			who = ENG
			value = -10
		}
		ENG = {
			add_treasury = 50
		}
	}
}

country_event = { #York declares his Plantagenet surname and claims the throne, actual civil war fires
	id = war_of_the_roses.11
	title = war_of_the_roses.11.t
	desc = war_of_the_roses.11.d
	picture = WAR_OF_THE_ROSES_eventPicture
	
	is_triggered_only = yes

	option = {
		name = "war_of_the_roses.11.a" #Notification
		hidden_effect = {
			country_event = {
				id = war_of_the_roses.12
				days = 30
			}
		}
	}
}

#Bastard Feudalism - increasingly Nobility no longer fears monarchy and uses their own levies to pursue their agendas
country_event = {
	id = war_of_the_roses.12
	title = war_of_the_roses.12.t
	desc = war_of_the_roses.12.d
	picture = WAR_OF_THE_ROSES_eventPicture
	
	fire_only_once = yes
	is_triggered_only = yes

	option = {
		name = war_of_the_roses.12.a
		log = "DIS-war_of_the_roses:[GetYear]:[Root.GetName]:Nobility had royal linege and private levies that could match the monarchy:war_of_the_roses.12"
		add_country_modifier = {
			name = bastard_feudalism
			duration = 3650
		}

		hidden_effect = {
			country_event = {
				id = war_of_the_roses.20
				days = 30
			}
		}
	}
}

#For Lancasterian King
country_event = {
	id = war_of_the_roses.20
	title = war_of_the_roses.20.t
	desc = war_of_the_roses.20.d
	picture = WAR_OF_THE_ROSES_eventPicture
	major = yes
	is_triggered_only = yes
	
	immediate = {
	    set_global_flag = had_war_of_the_roses
		set_country_flag = war_of_the_roses
		set_global_flag = war_of_the_roses
		Public_ChangePowerbrokerLoyaltyTooltipProv  = { Powerbroker=NO Amount=-40 }
		Stab_Subtract2 = yes

		hidden_effect = {
			if = {
				limit = {
					owns = 3323
				}
				3323 = {
					add_core = YOR
				}
			}

			if = {
				limit = {
					owns = 241
				}
				241 = {
					add_core = YOR
				}
			}

			if = {
				limit = {
					owns = 1283
				}
				1283 = {
					add_core = YOR
				}
			}

			if = {
				limit = {
					owns = 245
				}
				245 = {
					add_core = YOR
				}
			}

			if = {
				limit = {
					owns = 239
				}
				239 = {
					add_core = YOR
				}
			}

			if = {
				limit = {
					owns = 399
				}
				399 = {
					add_core = YOR
				}
			}

			if = {
				limit = {
					owns = 3859
				}
				3859 = {
					add_core = YOR
				}
			}

			if = {
				limit = {
					owns = 5156
				}
				5156 = {
					add_core = YOR
				}
			}

			if = { #Release York 
				limit = {
					NOT = { exists = YOR }
				}
				release = YOR
				YOR = {
					change_religion = ROOT
					set_country_flag = wor_pretender
					capital_scope = {
						build_to_forcelimit = {
							infantry = 1.6
							cavalry = 0.4
						}
					}
					random_owned_province = {
						limit = {
							has_port = yes
						}
						build_to_forcelimit = {
							heavy_ship = 0.5
							light_ship = 0.5
							transport = 0.5
						}
					}
					add_treasury = 250
					if = {
						limit = {
							has_heir = yes
							heir_age = 15
						}
						define_heir_to_general = {
							fire = 2
							shock = 4
							manuever = 4
							siege = 0
						}
					}
					capital_scope = {
						add_building = fort_15th
					}
					3323 = {
						cede_province = YOR
					}
					241 = {
						cede_province = YOR
					}
					Pol_AdaptFromScope = yes
					add_government_reform = Pol_Privileges1
					if = {
						limit = {
							NOT = { has_country_flag = POP_Init }
						}
						country_event = { id = Init.1 }
					}
					trigger_switch = {
						on_trigger = has_country_flag
						richard_york = {
							if = {
								limit = {
									is_year = 1427
								}
								define_heir = {
									name = "Richard"
									dynasty = "Plantagenet"
									birth_date = 1411.9.22
									adm = 5
									dip = 4
									mil = 4
								}
								kill_ruler = yes
								Stab_Add1 = yes
								if = {
									limit = {
										has_dlc = "Rights of Man" 
									}
									hidden_effect = { add_ruler_personality = tactical_genius_personality }
								}
							}
							else = {
								define_ruler = {
									dynasty = "Plantagenet"
									max_age = 31
								}
							}
							if = {
								limit = {
									is_year = 1456
								}
								define_heir = {
									name = "Edward"
									dynasty = "Plantagenet"
									birth_date = 1442.4.28
									adm = 4
									dip = 3
									mil = 4
								}
								if = {
									limit = {
										has_dlc = "Rights of Man" 
									}
									hidden_effect = { add_ruler_personality = tactical_genius_personality }
								}
							}
							else = {
								define_heir = {
									name = "Edward"
									dynasty = "Plantagenet"
								}
							}
						}
						edward_iv = {
							if = {
								limit = {
									is_year = 1456
								}
								define_ruler = {
									name = "Edward"
									dynasty = "Plantagenet"
									max_random_adm = 4
									max_random_adm = 3
									max_random_mil = 5
									age = 15
								}
								if = {
									limit = {
										has_dlc = "Rights of Man" 
									}
									hidden_effect = { add_ruler_personality = tactical_genius_personality }
								}
							}
							else = {
								define_heir = {
									name = "Edward"
									dynasty = "Plantagenet"
									max_random_adm = 4
									max_random_adm = 3
									max_random_mil = 5
								}
							}
						}
						george_plantagenet = {
							define_ruler = {
								name = "George"
								dynasty = "Plantagenet"
							}
						}
						ricahrd_iii = {
							define_ruler = {
								name = "Richard"
								dynasty = "Plantagenet"
							}
						}
					}
				}
			}
		}
	}

	option = { #Support the House of Lancaster
		name = war_of_the_roses.20.a
		log = "DIS-war_of_the_roses:[GetYear]:[Root.GetName]:supported the House of Lancaster:war_of_the_roses.1"
		set_country_flag = supports_house_of_lancaster
		if = {
			limit = {
				has_dlc = "Rights of Man"
			}
			hidden_effect = {
				add_ruler_personality = well_connected_personality
			}
		}
		244 = { #Lancaster
			Public_ChangePowerbrokerLoyaltyTooltipProv  = { Powerbroker=NO Amount=100 }			
			add_province_modifier = {
				name = wotr_local_support_for_lancaster
				duration = 3650
			}
		}
		245 = { #York
			Public_ChangePowerbrokerLoyaltyTooltipProv  = { Powerbroker=NO Amount=100 }
			add_province_modifier = {
				name = wotr_local_support_for_york
				duration = 3650
			}
		}

		setup_vassal_civil_war_with_estate = {
			elite = NO
			rebel_tag = YOR
			orig_scope = ROOT
		}
	}
	option = {
		name = war_of_the_roses.20.b
		log = "DIS-war_of_the_roses:[GetYear]:[Root.GetName]:supported the House of York:war_of_the_roses.1"
		set_country_flag = supports_house_of_york
		
		if = {
			limit = {
				has_dlc = "Rights of Man"
			}
			hidden_effect = {
				add_ruler_personality = tactical_genius_personality
			}
		}
		244 = { #Lancaster
			Public_ChangePowerbrokerLoyaltyTooltipProv  = { Powerbroker=NO Amount= 100 }			
			add_province_modifier = {
				name = wotr_local_support_for_lancaster
				duration = 3650
			}
		}
		245 = {
			Public_ChangePowerbrokerLoyaltyTooltipProv  = { Powerbroker=NO Amount= 100 }
			add_province_modifier = {
				name = wotr_local_support_for_york
				duration = 3650
			}
		}
		setup_vassal_civil_war_with_estate = {
			elite = NO
			rebel_tag = YOR
			orig_scope = ROOT
		}

		switch_tag = YOR
	}
}

#For Yorkist King 
country_event = {
	id = war_of_the_roses.21
	title = war_of_the_roses.21.t
	desc = war_of_the_roses.21.d
	picture = WAR_OF_THE_ROSES_eventPicture
	major = yes
	is_triggered_only = yes
	
	immediate = {
	    set_global_flag = had_war_of_the_roses
		set_country_flag = war_of_the_roses
		set_global_flag = war_of_the_roses
		Public_ChangePowerbrokerLoyaltyTooltipProv  = { Powerbroker=NO Amount=-40 }
		Stab_Subtract2 = yes

		hidden_effect = {
			if = { #Release Lancaster 
				limit = {
					NOT = { exists = LNC }
				}
				release = LNC
				LNC = {
					change_religion = ROOT
					set_country_flag = wor_pretender
					capital_scope = {
						build_to_forcelimit = {
							infantry = 1.6
							cavalry = 0.4
						}
					}
					random_owned_province = {
						limit = {
							has_port = yes
						}
						build_to_forcelimit = {
							heavy_ship = 0.5
							light_ship = 0.5
							transport = 0.5
						}
					}
					add_treasury = 250
					if = {
						limit = {
							has_heir = yes
							heir_age = 15
						}
						define_heir_to_general = {
							fire = 2
							shock = 4
							manuever = 4
							siege = 0
						}
					}
					capital_scope = {
						add_building = fort_15th
					}
					3323 = {
						cede_province = LNC
					}
					241 = {
						cede_province = LNC
					}
					Pol_AdaptFromScope = yes
					add_government_reform = Pol_Privileges1
					if = {
						limit = {
							NOT = { has_country_flag = POP_Init }
						}
						country_event = { id = Init.1 }
					}
					trigger_switch = {
						on_trigger = has_country_flag
						henry_vi = {
							if = {
								limit = {
									is_year = 1421
								}
								define_heir = {
									name = "Henry"
									dynasty = "Plantagenet"
									birth_date = 1421.12.6
									adm = 0
									dip = 0
									mil = 0
								}
								kill_ruler = yes
								Stab_Add1 = yes
								if = {
									limit = {
										has_dlc = "Rights of Man" 
									}
									hidden_effect = { add_ruler_personality = mad_personality }
								}
							}
							else = {
								define_ruler = {
									dynasty = "Plantagenet"
									max_age = 34
								}
							}
							if = {
								limit = {
									is_year = 1471
								}
								define_heir = {
									name = "Edward"
									dynasty = "Plantagenet"
									birth_date = 1453.10.13
									adm = 2
									dip = 2
									mil = 2
								}
								if = {
									limit = {
										has_dlc = "Rights of Man" 
									}
									hidden_effect = { add_ruler_personality = cruel_personality }
								}
							}
							else = {
								define_heir = {
									name = "Edward"
									dynasty = "Plantagenet"
								}
							}
						}
						edward_westminster = {
							if = {
								limit = {
									is_year = 1453
								}
								define_ruler = {
									name = "Edward"
									dynasty = "Plantagenet"
									max_random_adm = 3
									max_random_adm = 3
									max_random_mil = 3
									age = 15
								}
								if = {
									limit = {
										has_dlc = "Rights of Man" 
									}
									hidden_effect = { add_ruler_personality = cruel_personality }
								}
							}
							else = {
								define_heir = {
									name = "Edward"
									dynasty = "Plantagenet"
									max_random_adm = 3
									max_random_adm = 3
									max_random_mil = 3
								}
							}
						}
						henry_tudor = {
							define_ruler = {
								name = "Henry"
								dynasty = "Tudor"
								max_random_adm = 5
								max_random_adm = 5
								max_random_mil = 5
							}
						}
					}
				}
			}
		}
	}

	option = { #Support the House of Lancaster
		name = war_of_the_roses.21.a
		log = "DIS-war_of_the_roses:[GetYear]:[Root.GetName]:supported the House of Lancaster:war_of_the_roses.1"
		set_country_flag = supports_house_of_lancaster
		if = {
			limit = {
				has_dlc = "Rights of Man"
			}
			hidden_effect = {
				add_ruler_personality = well_connected_personality
			}
		}
		244 = { #Lancaster
			Public_ChangePowerbrokerLoyaltyTooltipProv  = { Powerbroker=NO Amount=100 }			
			add_province_modifier = {
				name = wotr_local_support_for_lancaster
				duration = 3650
			}
		}
		245 = { #York
			Public_ChangePowerbrokerLoyaltyTooltipProv  = { Powerbroker=NO Amount=100 }
			add_province_modifier = {
				name = wotr_local_support_for_york
				duration = 3650
			}
		}

		setup_vassal_civil_war_with_estate = {
			elite = NO
			rebel_tag = LNC
			orig_scope = ROOT
		}

		switch_tag = LNC
	}
	option = {
		name = war_of_the_roses.21.b
		log = "DIS-war_of_the_roses:[GetYear]:[Root.GetName]:supported the House of York:war_of_the_roses.1"
		set_country_flag = supports_house_of_york
		
		if = {
			limit = {
				has_dlc = "Rights of Man"
			}
			hidden_effect = {
				add_ruler_personality = tactical_genius_personality
			}
		}
		244 = { #Lancaster
			Public_ChangePowerbrokerLoyaltyTooltipProv  = { Powerbroker=NO Amount= 100 }			
			add_province_modifier = {
				name = wotr_local_support_for_lancaster
				duration = 3650
			}
		}
		245 = {
			Public_ChangePowerbrokerLoyaltyTooltipProv  = { Powerbroker=NO Amount= 100 }
			add_province_modifier = {
				name = wotr_local_support_for_york
				duration = 3650
			}
		}
		setup_vassal_civil_war_with_estate = {
			elite = NO
			rebel_tag = LNC
			orig_scope = ROOT
		}
	}
}

#Bribe local nobles to join you
province_event = {
	id = war_of_the_roses.30
	title = war_of_the_roses.30.t
	desc = war_of_the_roses.30.d
	picture = WAR_OF_THE_ROSES_eventPicture
	goto = from

	is_triggered_only = yes

	trigger = {
		NOT = { check_key = { lhs = Prov_NOLoy value = 30 }}
		is_capital = no
		NOT = { has_province_modifier = nobles_bribed }
		controller = {
			treasury = 50
		}
	}

	option = {
		name = war_of_the_roses.30.a
		log = "DIS-war_of_the_roses:[GetYear]:[Root.GetName]:Bribing local nobles:war_of_the_roses.30"
		add_province_modifier = {
			name = nobles_bribed
			duration = 90
		}
		
		FROM = {
			Public_ChangeClassWealthVal = { class = NO type = value inp = 50 }
		}

		controller = { 
			add_territorial_core = FROM
		}

		FROM = {
			cede_province = controller
		}

	}
}

#Heir Legitimacy Questioned
country_event = {
	id = war_of_the_roses.31
	title = war_of_the_roses.31.t
	desc = war_of_the_roses.31.desc
	picture = WAR_OF_THE_ROSES_eventPicture
	
	trigger = {
		tag = ENG
		has_country_flag = war_of_the_roses
		has_disaster = war_of_the_roses
		NOT = { has_heir_flag = legitimacy_questioned }
	}

	mean_time_to_happen = {
		months = 72 

		modifier = {
			check_variable = { which = "number_of_episodes" value = 2 }
			factor = 0.90
		}
		modifier = {
			check_variable = { which = "number_of_episodes" value = 3 }
			factor = 0.90
		}
		modifier = {
			check_variable = { which = "number_of_episodes" value = 4 }
			factor = 0.90
		}
		modifier = {
			check_variable = { which = "number_of_episodes" value = 5 }
			factor = 0.90
		}
		modifier = {
			check_variable = { which = "number_of_episodes" value = 6 }
			factor = 0.90
		}
		modifier = {
			check_variable = { which = "number_of_episodes" value = 7 }
			factor = 0.90
		}
		modifier = {
			check_variable = { which = "number_of_episodes" value = 8 }
			factor = 0.90
		}
		modifier = {
			check_variable = { which = "number_of_episodes" value = 9 }
			factor = 0.90
		}
		modifier = {
			check_variable = { which = "number_of_episodes" value = 10 }
			factor = 0.90
		}
		modifier = {
			NOT = { heir_adm = 3 }
			factor = 0.5
		}
		modifier = {
			NOT = { heir_dip = 3 }
			factor = 0.5
		}
		modifier = {
			NOT = { heir_mil = 3 }
			factor = 0.5
		}
		modifier = {
			has_regency = yes
			factor = 0.75
		}
	}

	immediate = {
		set_heir_flag = legitimacy_questioned
	}

	option = {
		name = war_of_the_roses.31.a
		log = "DIS-war_of_the_roses:[GetYear]:[Root.GetName]:Heir legitimacy questioned:war_of_the_roses.31"
		add_heir_claim = -20
	}
}

#Ruler Legitimacy Questioned
country_event = {
	id = war_of_the_roses.32
	title = war_of_the_roses.32.t
	desc = war_of_the_roses.32.desc
	picture = WAR_OF_THE_ROSES_eventPicture
	
	trigger = {
		tag = ENG
		has_country_flag = war_of_the_roses
		has_disaster = war_of_the_roses
		NOT = { has_ruler_flag = legitimacy_questioned }
		NOT = { has_ruler_modifier = mental_illness }
	}

	mean_time_to_happen = {
		months = 72 

		modifier = {
			NOT = { adm = 3 }
			factor = 0.5
		}
		modifier = {
			NOT = { dip = 3 }
			factor = 0.5
		}
		modifier = {
			NOT = { mil = 3 }
			factor = 0.5
		}

		modifier = {
			NOT = { stability = 0 }
			factor = 0.5
		}

		modifier = {
			NOT = { stability = -1 }
			factor = 0.5
		}

		modifier = {
			NOT = { stability = -2 }
			factor = 0.5
		}
	}

	immediate = {
		set_ruler_flag = legitimacy_questioned
	}

	option = {
		name = war_of_the_roses.32.a
		log = "DIS-war_of_the_roses:[GetYear]:[Root.GetName]:Ruler legitimacy questioned:war_of_the_roses.31"
		add_legitimacy = -20
	}
}


#Lancastrians seek help 1
country_event = {
    id = war_of_the_roses.50
    title = war_of_the_roses.50.a
    desc = war_of_the_roses.50.d
    picture = WAR_OF_THE_ROSES_eventPicture

    trigger = {
        tag = ENG
        has_country_flag = war_roses
        NOT = { has_country_flag = margaret_france }
		FRA = {
			exists = yes
			is_vassal = no
		}
		war_with = YOR
    }

    mean_time_to_happen = {
        months = 36
    }

	immediate = {
		set_country_flag = margaret_france
	}

    option = {
        name = war_of_the_roses.50.a
		FRA = {
			country_event = {
				id = war_of_the_roses.52
				days = 20
				tooltip = "war_of_the_roses.52.d"
			}
		}
    }

	option = {
        name = war_of_the_roses.50.b
        add_prestige = 10
		add_legitimacy = -10
    }
}

#Lancastrians seek help 2
country_event = {
    id = war_of_the_roses.51
	title = war_of_the_roses.51.a
	desc = war_of_the_roses.51.d
    picture = WAR_OF_THE_ROSES_eventPicture

	trigger = {
		tag = ENG
		has_country_flag = war_roses
		NOT = { has_country_flag = margaret_scotland }
		SCO = {
			exists = yes
			is_vassal = no
		}
		war_with = YOR
	}

	mean_time_to_happen = { months = 36 }

	immediate = {
		set_country_flag = margaret_scotland
	}

	option = {
		name = war_of_the_roses.51.a

		SCO = {
			country_event = {
				id = war_of_the_roses.53
				days = 20
				tooltip = "war_of_the_roses.53.d"
			}
		}
	}

	option = {
        name = war_of_the_roses.51.b
        add_prestige = 10
		add_legitimacy = -10
    }
}


# Lancaster request supports from France - French response
country_event = {
	id = war_of_the_roses.52
	title = "war_of_the_roses.52.t"
	desc = "war_of_the_roses.52.d"
	picture = CIVIL_WAR_eventPicture
	is_triggered_only = yes
	option = {
		# Support the Revolt
		name = "war_of_the_roses.52.a"
		set_country_flag = civil_war_support_from_fra
		add_manpower = -3

		hidden_effect = {
			country_event = {
				id = war_of_the_roses.54
				days = 10
			}
		}
	}

	option = {
        name = "war_of_the_roses.52.b"
        add_prestige = -10

		hidden_effect = {
			country_event = {
				id = war_of_the_roses.56
				days = 10
			}
		}
    }
}

# Lancaster request supports from Scotland - Scottish response
country_event = {
	id = war_of_the_roses.53
	title = "war_of_the_roses.53.t"
	desc = "war_of_the_roses.53.d"
	picture = CIVIL_WAR_eventPicture
	is_triggered_only = yes
	option = {
		# Support the Revolt
		name = "war_of_the_roses.53.a"
		set_country_flag = civil_war_support_from_sco
		add_manpower = -3

		hidden_effect = {
			country_event = {
				id = war_of_the_roses.55
				days = 10
			}
		}
	}

	option = {
        name = "war_of_the_roses.53.b"
        add_prestige = -10

		hidden_effect = {
			country_event = {
				id = war_of_the_roses.57
				days = 10
			}
		}
    }
}

# Lancaster request success - French
country_event = {
	id = war_of_the_roses.54
	title = "war_of_the_roses.54.t"
	desc = "war_of_the_roses.54.d"
	picture = CIVIL_WAR_eventPicture
	is_triggered_only = yes
	option = {
		# Support the Revolt
		name = "war_of_the_roses.54.a"
		add_manpower = 3
	}
}

# Lancaster request success - Scottish
country_event = {
	id = war_of_the_roses.55
	title = "war_of_the_roses.54.t"
	desc = "war_of_the_roses.54.d"
	picture = CIVIL_WAR_eventPicture
	is_triggered_only = yes
	option = {
		# Support the Revolt
		name = "war_of_the_roses.54.a"
		add_manpower = 3
	}
}

# Lancaster request failure - French
country_event = {
	id = war_of_the_roses.56
	title = "war_of_the_roses.56.t"
	desc = "war_of_the_roses.56.d"
	picture = CIVIL_WAR_eventPicture
	is_triggered_only = yes
	option = {
		name = "war_of_the_roses.56.a"
		add_prestige = -10
        add_legitimacy = -5
	}
}

# Lancaster request failure - Scottish
country_event = {
	id = war_of_the_roses.57
	title = "war_of_the_roses.57.t"
	desc = "war_of_the_roses.57.d"
	picture = CIVIL_WAR_eventPicture
	is_triggered_only = yes
	option = {
		name = "war_of_the_roses.57.a"
		add_prestige = -10
        add_legitimacy = -5
	}
}

country_event = {
	id = war_of_the_roses.60	#Attainders
	title = war_of_the_roses.60.a
	desc = war_of_the_roses.60.d
    picture = WAR_OF_THE_ROSES_eventPicture

	fire_only_once = yes

	trigger = {
		tag = ENG
		has_country_flag = war_roses
		NOT = { has_country_flag = york_attainders }
	}

	mean_time_to_happen = { months = 36 }

	option = {
		name = war_of_the_roses.60.a
		ai_chance = { factor = 100 }
		set_country_flag = york_attainders
		add_treasury = 100
		random_owned_province = {
			limit = {
				NOT = { has_province_modifier = wotr_local_support_for_lancaster }
				NOT = { has_province_modifier = wotr_local_support_for_york }
				OR = {
					region = south_england_region
					region = north_england_region
				}
				units_in_province = 1
				controlled_by = ROOT
			}
			Public_ChangeClassWealthVal = { class= NO type = value inp=-50 }
			add_province_modifier = {
				name = "attain_yorkist"
				duration = 1065
			}
		}
		random_owned_province = {
			limit = {
				NOT = { has_province_modifier = wotr_local_support_for_lancaster }
				NOT = { has_province_modifier = wotr_local_support_for_york }
				OR = {
					region = south_england_region
					region = north_england_region
				}
				units_in_province = 1
				controlled_by = ROOT
			}
			Public_ChangeClassWealthVal = { class= NO type = value inp=-50 }
			add_province_modifier = {
				name = "attain_yorkist"
				duration = 1065
			}
		}
	}
	option = {
		name = war_of_the_roses.60.b
		ai_chance = { factor = 0 }
		set_country_flag = york_attainders
		add_legitimacy = 10
		add_absolutism = -10
	}
}

# Powerful nobility begins to position themselves after victory
country_event = {
	id = war_of_the_roses.61
	title = "war_of_the_roses.61.t"
	desc = "war_of_the_roses.61.d"
	picture = WAR_OF_THE_ROSES_eventPicture
	
	trigger = {
		tag = ENG
		has_country_flag = war_roses
		NOT = { has_country_flag = neville_influence }
		is_at_war = no
	}

	mean_time_to_happen = { months = 96 }

	option = {
		name = war_of_the_roses.61.a
		ai_chance = { factor = 75 }
		set_country_flag = neville_influence
		set_country_flag = neville_scorned

		Public_ChangePowerbrokerLoyaltyTooltipProv = { Powerbroker = NO Amount = -20 }
		add_legitimacy = 10
	}
	option = {
		name = war_of_the_roses.61.b
		ai_chance = { factor = 25 }
		set_country_flag = neville_influence
		set_country_flag = neville_trusted

		Public_ChangePowerbrokerLoyaltyTooltipProv = { Powerbroker = NO Amount = 20 }
		add_legitimacy = -30
		Public_ChangePowerbrokerLoyaltyTooltipProv = { Powerbroker = BU Amount = -50 }
	}
}

# Powerful nobility revenge because they are sidelined
country_event = {
	id = war_of_the_roses.62
	title = "war_of_the_roses.62.t"
	desc = "war_of_the_roses.62.d"
	picture = WAR_OF_THE_ROSES_eventPicture
	
	trigger = {
		tag = ENG
		has_country_flag = war_roses
		has_country_flag = neville_scorned
		NOT = { has_country_flag = neville_choice }
		is_at_war = no
	}

	mean_time_to_happen = { months = 96 }

	option = {
		name = war_of_the_roses.62.a
		ai_chance = { factor = 75 }
		set_country_flag = neville_influence
		set_country_flag = neville_scorned

		Stab_Subtract2 = yes
		add_country_modifier = {
			name = "deserters"
			duration = 730
		}
		random_owned_province = {
			noble_rebels = 2
		}
		set_country_flag = neville_choice
	}
}

# Powerful nobility revenge because they are sidelined
country_event = {
	id = war_of_the_roses.63
	title = "war_of_the_roses.63.t"
	desc = "war_of_the_roses.63.d"
	picture = WAR_OF_THE_ROSES_eventPicture
	
	trigger = {
		tag = ENG
		has_country_flag = war_roses
		has_country_flag = neville_trusted
		NOT = { has_country_flag = neville_coup }
		is_at_war = no
	}

	mean_time_to_happen = { months = 12 }

	option = {
		name = war_of_the_roses.63.a
		ai_chance = { factor = 75 }
		set_country_flag = neville_influence
		set_country_flag = neville_scorned

		Stab_Subtract2 = yes
		add_country_modifier = {
			name = "deserters"
			duration = 730
		}
		add_legitimacy = -30
		add_absolutism = -10
		set_country_flag = neville_coup
	}
}

# Choosing a englsih bride rather than a foreign princess
country_event = {
	id = war_of_the_roses.64
	title = "war_of_the_roses.64.t"
	desc = "war_of_the_roses.64.d"
	picture = WAR_OF_THE_ROSES_eventPicture
	
	trigger = {
		tag = ENG
		has_country_flag = war_roses
		has_country_flag = neville_scorned
		NOT = { has_country_flag = woodville }
		is_at_war = no
	}

	mean_time_to_happen = { months = 36 }

	immediate = {
		set_country_flag = woodville
	}

	option = {#Take her
		name = war_of_the_roses.64.a
		ai_chance = { factor = 75 }

		Public_ChangePowerbrokerLoyaltyTooltipProv = { Powerbroker = NO Amount = -20 }
		add_legitimacy = 15
		add_prestige = -10
		define_consort = {
			country_of_origin = ROOT
			religion = ROOT
			culture = ROOT
			female = yes
			name = "Elizabeth Woodville"
			hide_skills = yes
		}
	}

	option = {#Reject her for a better chance
		name = war_of_the_roses.64.b
		ai_chance = { factor = 25 }

		Public_ChangePowerbrokerLoyaltyTooltipProv = { Powerbroker = NO Amount = 5 }
		add_legitimacy = 10
	}
}

#### Occupation, surrender ####
country_event = {
	id = war_of_the_roses.90
	title = "war_of_the_roses.90.t"
	desc = "war_of_the_roses.90.d"
	picture = SIEGE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		tag = ENG
		any_known_country = {
			isValidCountry = yes
			OR = {
				tag = YOR
				tag = LNC
			}
			war_with = ROOT
			war_score_against = {
				who = ROOT
				value = 70
			}
			has_country_flag = wor_pretender
		}
		exists = yes
		has_disaster = war_of_the_roses
	}
	
	option = { #Surrender
		name = "war_of_the_roses.90.a"
		log = "DIS-war_of_the_roses:[GetYear]:[Root.GetName]:War is won by the Yorkist:war_of_the_roses.90"
		trigger = {
			YOR = {
				exists = yes
			}
		}
		
		set_country_flag = york_rose
		clr_country_flag = lancaster_rose

		YOR = {
			exile_ruler_as = {
				name = yorkist_ruler
			}

			exile_consort_as = yorkist_consort
			exile_heir_as = yokrist_heir
		}

		exile_heir_as = lancasterian_heir

		set_ruler = yorkist_ruler
		set_consort = yorkist_consort
		set_heir = yokrist_heir

		trigger_switch = {
			on_trigger = has_country_flag
			henry_vi = {
				clr_country_flag = henry_vi
				set_country_flag = edward_westminster
			}

			edward_westminster = {
				clr_country_flag = edward_westminster
				set_country_flag = henry_tudor
			}

			henry_tudor = {
				hidden_effect = {
					country_event = {
						id = war_of_the_roses.100
					}
				}
			}
		}
		
		ai_chance = {
			factor = 100
		}
	}

	option = { #Surrender
		name = "war_of_the_roses.90.a"
		log = "DIS-war_of_the_roses:[GetYear]:[Root.GetName]:War is won by the Lancasterian:war_of_the_roses.90"
		trigger = {
			LNC = {
				exists = yes
			}
		}
		
		set_country_flag = lancaster_rose
		clr_country_flag = york_rose

		LNC = {
			exile_ruler_as = {
				name = lancasterian_ruler
			}

			exile_consort_as = lancasterian_consort
			exile_heir_as = lancasterian_heir
		}

		exile_heir_as = yokrist_heir

		set_ruler = lancasterian_ruler
		set_consort = lancasterian_consort
		set_heir = lancasterian_heir

		trigger_switch = {
			on_trigger = has_country_flag
			richard_york = {
				clr_country_flag = richard_york
				set_country_flag = edward_iv
			}

			edward_iv = {
				clr_country_flag = edward_iv
				set_country_flag = george_plantagenet
			}

			george_plantagenet = {
				clr_country_flag = george_plantagenet
				set_country_flag = richard_iii
			}

			richard_iii = {
				hidden_effect = {
					country_event = {
						id = war_of_the_roses.100
					}
				}
			}
		}
		
		ai_chance = {
			factor = 100
		}
	}
	
	option = { #Fight on - player only
		name = "war_of_the_roses.90.b"
		log = "war_of_the_roses:[GetYear]:[Root.GetName]:refused surrendered to claimant:war_of_the_roses.90"
		ai_chance = {
			factor = 0
		}
	}
}



### THE END OF THE WAR OF THE ROSES (THE RULING DYNASTY DEFEATS THE REBELS) ###

country_event = {
	id = war_of_the_roses.100 #The End of the War of the Roses (the ruling dynasty defeats the rebels)
	title = war_of_the_roses.100.t
	desc = war_of_the_roses.100.d
	picture = WAR_OF_THE_ROSES_eventPicture
	major = yes
	is_triggered_only = yes #from "on_end" in disaster

	immediate = {
		hidden_effect = {
			remove_country_modifier = low_fertility
			remove_country_modifier = legitimacy_questioned
			every_owned_province = {
				remove_province_modifier = wotr_local_support
			 	remove_province_modifier = wotr_local_support_for_lancaster
			 	remove_province_modifier = wotr_local_support_for_york
			  	remove_province_modifier = rebel_refugees
			 	remove_province_modifier = rebel_stronghold
			}
			set_country_flag = had_war_of_the_roses
			clr_global_flag = war_of_the_roses
		}
	}
	option = {
		name = war_of_the_roses.100.a
		log = "DIS-war_of_the_roses:[GetYear]:[Root.GetName]:ruling dynasty won the War of The Roses:war_of_the_roses.100"
		log = "DIS-war_of_the_roses:[GetYear]:[Root.GetName]:end of War of the Roses:war_of_the_roses.100"
		Stab_Add1 = yes
		add_prestige = 20
		Public_ChangePowerbrokerLoyaltyTooltipProv = { Powerbroker = NO Amount = 20 }
		hidden_effect = {
			every_country = {
				limit = {
					has_country_flag = support_for_war_of_the_roses
				}
				country_event = {
					id = war_of_the_roses.104 #Relations Deteriorate with England
					days = 1
				}
			}
			clr_country_flag = supports_house_of_york
			clr_country_flag = supports_house_of_lancaster
		}
	}
}

### THE END OF THE WAR OF THE ROSES (REBELLING HOUSE OF LANCASTER WINS THE WAR) ###

country_event = {
	id = war_of_the_roses.101
	title = war_of_the_roses.101.t
	desc = war_of_the_roses.101.d
	picture = WAR_OF_THE_ROSES_eventPicture
	major = yes
	is_triggered_only = yes
	fire_only_once = yes

	trigger = {
		has_disaster = war_of_the_roses
		has_country_flag = supports_house_of_york
		dynasty = "Plantagenet"
	}

	immediate = {
		hidden_effect = {
			set_country_flag = had_war_of_the_roses
			clr_global_flag = war_of_the_roses
		}
		end_disaster = war_of_the_roses
	}

	option = {
		name = war_of_the_roses.101.a
		log = "DIS-war_of_the_roses:[GetYear]:[Root.GetName]:rebelling House of Lancaster won the War of The Roses:war_of_the_roses.101"
		log = "DIS-war_of_the_roses:[GetYear]:[Root.GetName]:end of War of the Roses:war_of_the_roses.101"
		Stab_Add50Percent = yes
		add_prestige = -10
		hidden_effect = {
			every_country = {
				limit = {
					has_country_flag = support_for_war_of_the_roses
				}
				country_event = {
					id = war_of_the_roses.103 #Improved Relations with England
					days = 1
				}
				every_country = {
					limit = {
						has_country_flag = no_support_for_rose_rebels
					}
					country_event = {
						id = war_of_the_roses.104 #Relations Deteriorate with England
						days = 1
					}
				}
			}
		}
		244 = {
			Public_ChangePowerbrokerLoyaltyTooltipProv  = { Powerbroker=NO Amount=50 }
		}
		custom_tooltip = post_war_of_the_roses_loyalty_shift_rebels_won
		every_owned_province = {
			limit = {
				OR = {
					has_province_modifier = wotr_local_support_for_lancaster
					has_province_modifier = rebel_refugees
					has_province_modifier = rebel_stronghold
				}
			}
			hidden_effect = { Public_ChangePowerbrokerLoyaltyTooltipProv  = { Powerbroker=NO Amount=30 } }
		}
		every_owned_province = {
			limit = {
				has_province_modifier = wotr_local_support
			}
			hidden_effect = { Public_ChangePowerbrokerLoyaltyTooltipProv  = { Powerbroker=NO Amount=-30 } }
		}
	}
	after = {
		hidden_effect = {
			clr_country_flag = supports_house_of_lancaster
			clr_country_flag = supports_house_of_york
			remove_country_modifier = importing_food
			remove_country_modifier = plundering_soldiers
			remove_country_modifier = legitimacy_questioned
			remove_country_modifier = low_fertility
			every_owned_province = {
				remove_province_modifier = wotr_local_support
				remove_province_modifier = wotr_local_support_for_lancaster
				remove_province_modifier = wotr_local_support_for_york
				remove_province_modifier = rebel_refugees
				remove_province_modifier = rebel_stronghold
			}
		}
	}
}

### THE END OF THE WAR OF THE ROSES (REBELLING HOUSE OF YORK WINS THE WAR) ###

country_event = {
	id = war_of_the_roses.102
	title = war_of_the_roses.102.t
	desc = war_of_the_roses.102.d
	picture = WAR_OF_THE_ROSES_eventPicture
	major = yes
	is_triggered_only = yes
	fire_only_once = yes
	trigger = {
		has_disaster = war_of_the_roses
		has_country_flag = supports_house_of_lancaster
		dynasty = "Plantagenet"
	}
	immediate = {
		hidden_effect = {
			set_country_flag = had_war_of_the_roses
			clr_global_flag = war_of_the_roses
		}
		end_disaster = war_of_the_roses
	}
	option = {
		name = war_of_the_roses.102.a
		log = "DIS-war_of_the_roses:[GetYear]:[Root.GetName]:rebelling House of York won the War of The Roses:war_of_the_roses.102"
		log = "DIS-war_of_the_roses:[GetYear]:[Root.GetName]:end of War of the Roses:war_of_the_roses.102"
		Stab_Add50Percent = yes
		add_prestige = -10
		hidden_effect = {
			every_country = {
				limit = {
					has_country_flag = support_for_war_of_the_roses
				}
				country_event = {
					id = war_of_the_roses.103 #Improved Relations with England
					days = 1
				}
			}
			every_country = {
				limit = {
					has_country_flag = no_support_for_rose_rebels
				}
				country_event = {
					id = war_of_the_roses.104 #Relations Deteriorate with England
					days = 1
				}
			}
			245 = {
				Public_ChangePowerbrokerLoyaltyTooltipProv  = { Powerbroker=NO Amount=100 }
			}
			custom_tooltip = post_war_of_the_roses_loyalty_shift_rebels_won
			every_owned_province = {
				limit = {
					OR = {
						has_province_modifier = wotr_local_support_for_lancaster
						has_province_modifier = rebel_refugees
						has_province_modifier = rebel_stronghold
					}
				}
				hidden_effect = { Public_ChangePowerbrokerLoyaltyTooltipProv  = { Powerbroker=NO Amount=30 } }
			}
			every_owned_province = {
				limit = {
					has_province_modifier = wotr_local_support
				}
				hidden_effect = { Public_ChangePowerbrokerLoyaltyTooltipProv  = { Powerbroker=NO Amount=-30 } }
			}
		}
	}
	after = {
		hidden_effect = {
			clr_country_flag = supports_house_of_lancaster
			clr_country_flag = supports_house_of_york
			remove_country_modifier = legitimacy_questioned
			remove_country_modifier = low_fertility
			every_owned_province = {
				remove_province_modifier = wotr_local_support
				remove_province_modifier = wotr_local_support_for_lancaster
				remove_province_modifier = wotr_local_support_for_york
				remove_province_modifier = rebel_refugees
				remove_province_modifier = rebel_stronghold
			}
		}
	}
}

### IMPROVED RELATIONS WITH ENGLAND ###

country_event = {
	id = war_of_the_roses.103
	title = war_of_the_roses.103.t
	desc = war_of_the_roses.103.d
	picture = WAR_OF_THE_ROSES_eventPicture
	is_triggered_only = yes
	immediate = {
		clr_country_flag = support_for_war_of_the_roses
		clr_country_flag = no_support_for_rose_rebels
	}
	option = {
		name = war_of_the_roses.103.a
		log = "DIS-war_of_the_roses:[GetYear]:[Root.GetName]:improved relation with [From.GetName]:war_of_the_roses.103"
		FROM = {
			add_opinion = {
				who = ROOT
				modifier = eng_support_during_war_of_the_roses
			}
			reverse_add_opinion = {
				who = ROOT
				modifier = eng_support_during_war_of_the_roses
			}
		}
	}
}

### RELATIONS DETERIORATE WITH ENGLAND ###

country_event = {
	id = war_of_the_roses.104
	title = war_of_the_roses.104.t
	desc = war_of_the_roses.104.d
	picture = WAR_OF_THE_ROSES_eventPicture
	is_triggered_only = yes

	option = {
		name = war_of_the_roses.104.a
		log = "DIS-war_of_the_roses:[GetYear]:[Root.GetName]:worsened relation with [From.GetName]:war_of_the_roses.104"
		trigger = {
				has_country_flag = support_for_war_of_the_roses
		}
		FROM = {
			add_opinion = {
				who = ROOT
				modifier = eng_supported_rebels_during_war_of_the_roses
			}
			reverse_add_opinion = {
				who = ROOT
				modifier = eng_supported_rebels_during_war_of_the_roses
			}
		}
		clr_country_flag = support_for_war_of_the_roses
	}
	option = {
		name = war_of_the_roses.104.b
		log = "DIS-war_of_the_roses:[GetYear]:[Root.GetName]:worsened relation with [From.GetName]:war_of_the_roses.104"
		trigger = {
			has_country_flag = no_support_for_rose_rebels
		}
		FROM = {
			add_opinion = {
				who = ROOT
				modifier = eng_didnt_support_rebels
			}
			reverse_add_opinion = {
				who = ROOT
				modifier = eng_didnt_support_rebels
			}
		}
		clr_country_flag = no_support_for_rose_rebels
	}
}

### HOUSE OF X ENDS THE WAR OF THE ROSES ###

country_event = {
	id = war_of_the_roses.106 #House of X ends the War of the Roses
	title = war_of_the_roses.106.t
	desc = war_of_the_roses.106.d
	picture = WAR_OF_THE_ROSES_eventPicture
	major = yes
	is_triggered_only = yes
	fire_only_once = yes

	trigger = {
		has_disaster = war_of_the_roses
		NOT = { dynasty = Tudor }
		NOT = { dynasty = Plantagenet }
	}

	immediate = {
		hidden_effect = {
			clr_country_flag = supports_house_of_lancaster
			clr_country_flag = supports_house_of_york
			remove_country_modifier = legitimacy_questioned
			remove_country_modifier = low_fertility
			every_owned_province = {
				remove_province_modifier = wotr_local_support
				remove_province_modifier = wotr_local_support_for_lancaster
				remove_province_modifier = wotr_local_support_for_york
				remove_province_modifier = rebel_refugees
				remove_province_modifier = rebel_stronghold
			}
			set_country_flag = had_war_of_the_roses
			clr_global_flag = war_of_the_roses
		}
		end_disaster = war_of_the_roses
	}
	option = {
		name = war_of_the_roses.106.a
		log = "DIS-war_of_the_roses:[GetYear]:[Root.GetName]:other dynasty (Root.Monarch.Dynastyt.GetName) got the throne:war_of_the_roses.106"
		log = "DIS-war_of_the_roses:[GetYear]:[Root.GetName]:end of War of the Roses:war_of_the_roses.106"
		Stab_Subtract1 = yes
		if = {
			limit = {
				owns = 245
			}
			245 = {
				add_unrest = 25
				Public_ChangePowerbrokerLoyaltyTooltipProv  = { Powerbroker=NO Amount=-100 }
			}
		}
		if = {
			limit = {
				owns = 244
			}
			244 = {
				add_unrest = 25
				Public_ChangePowerbrokerLoyaltyTooltipProv  = { Powerbroker=NO Amount=-100 }
			}
		}
	}
}
