namespace = uef_french_rebellion

#Rebellion starts
country_event = {
	id = uef_french_rebellion.1
	title = "uef_french_rebellion.1.t"
	desc = "uef_french_rebellion.1.d"
	picture = CIVIL_WAR_eventPicture
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			every_owned_province = {
				limit = {
					culture_group = langue_d_oil
					continent = europe
				}
				add_nationalism = 15
			}
		}
		Stab_Subtract3 = yes
	}
	option = {
		name = "uef_french_rebellion.1.a"
		hidden_effect = {
			if = {
				limit = {
					DAU = {
						exists = yes
					}
				}
				DAU = {
					set_country_flag = french_pretender
				}
			}
			else_if = {
				limit = {
					any_subject_country = {
						culture_group = langue_d_oil
					}
				}
				random_subject_country = {
					limit = {
						culture_group = langue_d_oil
					}
					set_country_flag = french_pretender
				}
			}
			else_if = {
				limit = { 
					BUR = {
						exists = yes
					}
				}
				set_country_flag = french_pretender
			}
		}
	}

	after = {
		if = {
			limit = {
				FROM = {
					tag = ENG
				}
			}

			country_event = {
				id = uef_french_rebellion.200
				days = 20
				tooltip = "uef_french_rebellion.200.d"
			}
		}
		else = {
			country_event = {
				id = uef_french_rebellion.300
				days = 20
				tooltip = "uef_french_rebellion.300.d"
			}
		}
	}
}

country_event = {
	id = uef_french_rebellion.200
	title = "uef_french_rebellion.200.t"
	desc = "uef_french_rebellion.200.d"
	picture = CIVIL_WAR_eventPicture
	is_triggered_only = yes

	option = {
		name = "uef_french_rebellion.200.a"
		add_prestige = -50
		add_legitimacy = -30
		every_owned_province = {
			limit = {
				culture_group = british
				continent = europe
			}
			add_province_modifier = {
				name = "ued_autonomy"
				duration = 5475
			}
		}
		hidden_effect = {
			if = {
				limit = {
					any_known_country = {
						has_country_flag = french_pretender
					}
				}
				random_known_country = {
					limit = {
						has_country_flag = french_pretender
					}
					country_event = {
						id = uef_french_rebellion.400
						tooltip = "uef_french_rebellion.400.d"
					}
				}
			}
			else = {
				country_event = {
					id = uef_french_rebellion.401
					tooltip = "uef_french_rebellion.401.d"
				}
			}
		}
	}
}

country_event = {
	id = uef_french_rebellion.300
	title = "uef_french_rebellion.300.t"
	desc = "uef_french_rebellion.300.d"
	picture = CIVIL_WAR_eventPicture
	is_triggered_only = yes

	option = {
		name = "uef_french_rebellion.300.a"
		every_owned_province = {
			limit = {
				culture_group = british
				continent = europe
			}
			hidden_effect = {
				remove_province_modifier = "emergency_tax_relief"
			}
			add_province_modifier = {
				name = "emergency_tax_relief"
				duration = 5475
			}
			add_province_modifier = {
				name = "uef_autonomy"
				duration = 5475
			}
		}
		add_legitimacy = -30
		add_prestige = -50
		hidden_effect = {
			if = {
				limit = {
					any_known_country = {
						has_country_flag = french_pretender
					}
				}
				random_known_country = {
					limit = {
						has_country_flag = french_pretender
					}
					country_event = {
						id = uef_french_rebellion.400
						tooltip = "uef_french_rebellion.400.d"
					}
				}
			}
			else = {
				country_event = {
					id = uef_french_rebellion.401
					tooltip = "uef_french_rebellion.401.d"
				}
			}
		}
	}
}

country_event = {
	id = uef_french_rebellion.400
	title = "uef_french_rebellion.400.t"
	desc = "uef_french_rebellion.400.d"
	picture = CIVIL_WAR_eventPicture
	is_triggered_only = yes

	option = {
		name = "uef_french_rebellion.400.a"
		if = {
			limit = {
				is_subject_of = ENG
			}
			FROM = {
				every_subject_country = {
					limit = {
						culture_group = langue_d_oil
						culture_group = langue_d_oc
					}

					if = {
						limit = {
							is_subject_of_type = vassal
						}

						ROOT = {
							create_vassal = PREV
						}
					}
					else_if = {
						limit = { 
							is_subject_of_type = daimyo_vassal
						}
						ROOT = {
							create_subject = {
								subject_type = daimyo_vassal
								subject = PREV
							}
						}
					}
					else_if = {
						limit = {
							is_subject_of_type = appanage_subject
						}

						ROOT = {
							create_subject = {
								subject_type = appanage_subject
								subject = PREV
							}
						}
					}
					else_if = {
						limit = {
							is_subject_of_type = overseas_fief
						}

						ROOT = {
							inherit = PREV
						}
					}
				}
			}
		}
		else_if = {
			limit = { tag = BUR }

			FROM = {
				every_subject_country = {
					limit = {
						culture_group = langue_d_oil
						culture_group = langue_d_oc
					}

					if = {
						limit = {
							is_subject_of_type = vassal
						}

						ROOT = {
							create_vassal = PREV
						}
					}
					else_if = {
						limit = { 
							is_subject_of_type = daimyo_vassal
						}
						ROOT = {
							create_subject = {
								subject_type = daimyo_vassal
								subject = PREV
							}
						}
					}
					else_if = {
						limit = {
							is_subject_of_type = appanage_subject
						}

						ROOT = {
							create_subject = {
								subject_type = appanage_subject
								subject = PREV
							}
						}
					}
					else_if = {
						limit = {
							is_subject_of_type = overseas_fief
						}

						ROOT = {
							inherit = PREV
						}
					}
				}
			}
		}
	}
}

country_event = {
	id = uef_french_rebellion.401
	title = "uef_french_rebellion.401.t"
	desc = "uef_french_rebellion.401.d"
	picture = ANGRY_MOB_eventPicture
	
	major = yes
	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				NOT = { exists = FRA }
			}
			FRA = { clr_country_flag = POP_Init }
		}
		hidden_effect = {
			france_superregion = {
				if = {
					limit = {
						OR = {
							owned_by = ENG
							owned_by = UEF
						}
					}
					add_core = FRA
					cede_province = FRA
					remove_core = ROOT
				}
			}
			FRA = {
				if = {
					limit = {
						owns = 183 # Paris
					}
					set_capital = 183
				}
			}
			# Give permanent claims
			france_superregion = {
				if = {
					limit = {
						country_or_non_sovereign_subject_holds = ROOT
					}
					add_permanent_claim = FRA
				}
			}
			# Give money
			FRA = {
				add_treasury = 500
			}
			
			# Build army and navy, add forts
			FRA = {
				capital_scope = {
					if = {
						limit = {
							has_building = fort_17th
						}
						add_building = fort_18th
					}
					else_if = {
						limit = {
							has_building = fort_16th
						}
						add_building = fort_17th
					}
					else_if = {
						limit = {
							has_building = fort_15th
						}
						add_building = fort_16th
					}
					else_if = {
						limit = {
							has_building = fort_15th
						}
						infantry = FRA
					}
					else = {
						add_building = fort_15th
					}
					build_to_forcelimit = {
						infantry = 0.6
						cavalry = 0.3
						artillery = 0.1
					}
				}
				random_owned_province = {
					limit = {
						has_port = yes
					}
					build_to_forcelimit = {
						heavy_ship = 0.3
						light_ship = 0.3
						transport = 0.2
					}
				}
				add_adm_power = 200
				add_dip_power = 200
				add_mil_power = 200
				if = {
					limit = {
						ENG = {
							exists = yes
						}
					}
					ENG = {
						capital_scope = {
							Rights_SyncFromProv = yes
						}
					}
				}
				else_if = {
					limit = {
						UEF = {
							exists = yes
						}
					}
					UEF = {
						capital_scope = {
							Rights_SyncFromProv = yes
						}
					}
				}
			}
			# Send event to rivals and possible enemies
			every_known_country = {
				limit = {
					is_rival = ROOT
					is_threat = ROOT
				}
				country_event = { id = uef_french_rebellion.402 days = 10 }
			}
			FRA = {
				every_owned_province = {
					remove_province_modifier = uef_estates_general_1
					remove_province_modifier = uef_estates_general_2
					remove_province_modifier = uef_estates_general_3
					remove_province_modifier = french_resistance
					remove_province_modifier = uef_unrest
					remove_province_modifier = ued_autonomy
					remove_province_modifier = uef_religious_compromise
				}
			}
			FRA = {
				if = {
					limit = {
						NOT = { has_country_flag = POP_Init }
					}
					country_event = { id = Init.1 }
				}
			}
			
			# Flags
			set_global_flag = french_rebellion_start
		}
	}
	option = {
		name = "uef_french_rebellion.401.a"
		ROOT = {
			declare_war_with_cb = {
				who = NED
				casus_belli = cb_french_restoration_war
			}
		}
	}
}

#Rebellion won
country_event = {
	id = uef_french_rebellion.100
	title = "uef_french_rebellion.100.t"
	desc = "uef_french_rebellion.100.d"
	picture = CIVIL_WAR_eventPicture

	trigger = {
		OR = {
			AND = {
				tag = ENG 
				OR = {
					has_global_flag = plantagenet_becomes_french_again
					has_global_flag = plantagenet_french_regent
				}
			}
			AND = {
				tag = UEF
				OR = {
					has_global_flag = plantagenet_becomes_french_again
					has_global_flag = plantagenet_french_regent
				}
			}
		}
		is_in_war = {
			casus_belli = cb_french_restoration_war
		}
		OR = {
			NOT = { has_country_flag = rebellion_exhaustion }
			had_country_flag = {
				flag = rebellion_exhaustion
				days = 180
			}
		}
	}

	mean_time_to_happen = {
		months = 120
		modifier = {
			factor = 0.5
			war_score = -75
		}

		modifier = {
			factor = 0.5
			war_score = -50
		}

		modifier = {
			factor = 0.8
			war_score = -25
		}

		modifier = {
			factor = 0.5
			current_war_losses = {
				type = soldiers
				amount = 75000
			}
		}
	}

	immediate = {
		if = {
			limit = {
				NOT = { has_country_flag = rebellion_exhaustion }
			}
			set_country_flag = rebellion_exhaustion
		}
		else = {
			add_legitimacy = -10
		}
	}

	option = {#We accept that we lost
		name = "uef_french_rebellion.100.a"
		ai_chance = {
			factor = 100
		}
		set_country_flag = uef_french_rebellion_ending_1
		hidden_effect = {
			any_known_country = {
				limit = {
					has_country_flag = french_pretender
				}
				ChangeTagEffect = { scope = FRA }
				clr_country_flag = c_of_tou
				clr_country_flag = d_of_bou
				clr_country_flag = c_of_auv
				clr_country_flag = d_of_bri
				clr_country_flag = d_of_bur
				clr_country_flag = d_of_lor
				clr_country_flag = d_of_nrm
				clr_country_flag = d_of_orl
				clr_country_flag = d_of_pro
				clr_country_flag = d_of_sav
				clr_country_flag = m_of_sal
				clr_country_flag = m_of_mft
				set_country_flag = k_of_fra

				swap_non_generic_missions = yes
				white_peace = ROOT

				if = {
					limit = {
						capetian_dynasty_trigger = yes
						NOT = {
							tag = BUR
						}
					}
					remove_government_reform = Pol_Succession1 
					add_government_reform = salic_law_reform
				}
			}
		}
	}

	option = {#We must continue the fight
		name = "uef_french_rebellion.100.a"
		ai_chance = {
			factor = 0
		}
		add_war_exhaustion = 3
	}
}


#Rebellion won, from Disaster
country_event = {
	id = uef_french_rebellion.100
	title = "uef_french_rebellion.100.t"
	desc = "uef_french_rebellion.100.d"
	picture = CIVIL_WAR_eventPicture
	is_triggered_only = yes

	immediate = {
		FROM = {
			Stab_Add3 = yes
		}

		set_global_flag = uef_french_rebellion_ending_2
	}
	option = {
		name = "uef_french_rebellion.100.a"
		hidden_effect = {
			any_known_country = {
				limit = {
					has_country_flag = french_pretender
				}
				ChangeTagEffect = { scope = FRA }
				clr_country_flag = c_of_tou
				clr_country_flag = d_of_bou
				clr_country_flag = c_of_auv
				clr_country_flag = d_of_bri
				clr_country_flag = d_of_bur
				clr_country_flag = d_of_lor
				clr_country_flag = d_of_nrm
				clr_country_flag = d_of_orl
				clr_country_flag = d_of_pro
				clr_country_flag = d_of_sav
				clr_country_flag = m_of_sal
				clr_country_flag = m_of_mft
				set_country_flag = k_of_fra

				swap_non_generic_missions = yes
			}
		}
	}
}