namespace = uef_civil_war

### WAR OF THE ROSES but happen between England and France ###

country_event = {
	id = uef_civil_war.1
	title = uef_civil_war.1.t
	desc = uef_civil_war.1.d
	picture = uef_civil_war_eventPicture
	major = yes
	is_triggered_only = yes
	
	immediate = {
	    set_global_flag = had_uef_civil_war
		set_country_flag = uef_civil_war
		set_global_flag = uef_civil_war
		Public_ChangePowerbrokerLoyaltyTooltip = { Powerbroker=NO Amount=-40 }
		Stab_Subtract2 = yes

		hidden_effect = {
			if = {
				limit = {
					tag = ENG
					has_global_flag = plantagenet_french_regent
				}

				FRA = {
					build_to_forcelimit = {
						infantry = 1.6
						cavalry = 0.4
					}
					random_owned_province = {
						limit = {
							has_port = yes
						}
						build_to_forcelimit = {
							heavy_ship = 0.5
							light_ship = 0.5
							transport = 0.5
						}
					}
					add_treasury = 250
					ENG = {
						capital_scope = {
							Rights_SyncFromProv = yes
						}
					}
					Pol_AdaptFromScopeRights = yes
					if = {
						limit = {
							is_year = 1427
						}
						define_heir = {
							name = "Richard"
							dynasty = "Plantagenet"
							birth_date = 1411.9.22
							adm = 5
							dip = 4
							mil = 4
						}
						kill_ruler = yes
						Stab_Add1 = yes
						if = {
							limit = {
								has_dlc = "Rights of Man" 
							}
							hidden_effect = { add_ruler_personality = tactical_genius_personality }
						}
					}
					else = {
						define_ruler = {
							dynasty = "Plantagenet"
							max_age = 31
						}
					}
					if = {
						limit = {
							is_year = 1456
						}
						define_heir = {
							name = "Edward"
							dynasty = "Plantagenet"
							birth_date = 1442.4.28
							adm = 4
							dip = 3
							mil = 4
						}
						if = {
							limit = {
								has_dlc = "Rights of Man" 
							}
							hidden_effect = { add_ruler_personality = tactical_genius_personality }
						}
					}
					else = {
						define_heir = {
							name = "Edward"
							dynasty = "Plantagenet"
						}
					}
				}

				ENG = {
					declare_war_with_cb = {
						who = FRA
						casus_belli = cb_overlord_attacking_independence_war
					}
				}
			}

			if = {
				limit = {
					tag = UEF
					has_global_flag = plantagenet_becomes_french_again
				}

				ENG = {
					build_to_forcelimit = {
						infantry = 1.6
						cavalry = 0.4
					}
					random_owned_province = {
						limit = {
							has_port = yes
						}
						build_to_forcelimit = {
							heavy_ship = 0.5
							light_ship = 0.5
							transport = 0.5
						}
					}
					add_treasury = 250
					capital_scope = {
						Rights_SyncFromProv = yes
					}
					Pol_AdaptFromScopeRights = yes
					if = {
						limit = {
							is_year = 1427
						}
						define_heir = {
							name = "Richard"
							dynasty = "Plantagenet"
							birth_date = 1411.9.22
							adm = 5
							dip = 4
							mil = 4
						}
						kill_ruler = yes
						Stab_Add1 = yes
						if = {
							limit = {
								has_dlc = "Rights of Man" 
							}
							hidden_effect = { add_ruler_personality = tactical_genius_personality }
						}
					}
					else = {
						define_ruler = {
							dynasty = "Plantagenet"
							max_age = 31
						}
					}
					if = {
						limit = {
							is_year = 1456
						}
						define_heir = {
							name = "Edward"
							dynasty = "Plantagenet"
							birth_date = 1442.4.28
							adm = 4
							dip = 3
							mil = 4
						}
						if = {
							limit = {
								has_dlc = "Rights of Man" 
							}
							hidden_effect = { add_ruler_personality = tactical_genius_personality }
						}
					}
					else = {
						define_heir = {
							name = "Edward"
							dynasty = "Plantagenet"
						}
					}
				}

				UEF = {
					declare_war_with_cb = {
						who = ENG
						casus_belli = cb_overlord_attacking_independence_war
					}
				}
			}
		}
	}

	option = { #Support England
		name = uef_civil_war.1.a
		log = "DIS-uef_civil_war:[GetYear]:[Root.GetName]:supported the english side:uef_civil_war.1"
		set_country_flag = uef_civil_war_support_english
		if = {
			limit = {
				has_dlc = "Rights of Man"
			}
			hidden_effect = {
				add_ruler_personality = well_connected_personality
			}
		}
		
	}
	option = {#Support France
		name = uef_civil_war.1.b
		log = "DIS-uef_civil_war:[GetYear]:[Root.GetName]:supported the french side:uef_civil_war.1"
		set_country_flag = uef_civil_war_support_french
		
		if = {
			limit = {
				has_dlc = "Rights of Man"
			}
			hidden_effect = {
				add_ruler_personality = tactical_genius_personality
			}
		}
		if = {
			limit = {
				UEF = {
					exists = yes
				}
			}
			switch_tag = UEF
		}
		else = {
			switch_tag = FRA
		}
	}
}

### SUPPORT FOR LANCASTER/YORK ###

country_event = {
	id = uef_civil_war.2 #Local support for chosen side
	title = uef_civil_war.2.t
	desc = uef_civil_war.2.d
	picture = uef_civil_war_eventPicture
	trigger = {
		any_owned_province = {
			OR = {
				region = south_england_region
				region = north_england_region
				superregion = france_superregion
			}
			NOT = { has_province_modifier = uef_civil_war_local_support }
			NOT = { has_province_modifier = uef_civil_war_local_support_for_england }
			NOT = { has_province_modifier = uef_civil_war_local_support_for_france }
			NOT = { has_province_modifier = disgruntled_nobles }
		}
	}
	is_triggered_only = yes

	option = {
		name = uef_civil_war.2.a
		random_owned_province = {
			limit = {
				OR = {
					region = south_england_region
					region = north_england_region
					superregion = france_superregion
				}
				NOT = { has_province_modifier = uef_civil_war_local_support }
				NOT = { has_province_modifier = uef_civil_war_local_support_for_england }
				NOT = { has_province_modifier = uef_civil_war_local_support_for_france }
				NOT = { has_province_modifier = disgruntled_nobles }
			}
			add_province_modifier = {
				name = uef_civil_war_local_support
				duration = 3650
			}
			set_province_flag = disgruntled_nobles_timer
			Public_ChangePowerbrokerLoyaltyTooltip = { Powerbroker=NO Amount=20 }
			every_neighbor_province = {
				limit = {
					owned_by = ROOT
					NOT = { has_province_modifier = uef_civil_war_local_support }
					NOT = { has_province_modifier = uef_civil_war_local_support_for_england }
					NOT = { has_province_modifier = uef_civil_war_local_support_for_france }
					NOT = { has_province_modifier = disgruntled_nobles }
				}
				add_province_modifier = {
					name = uef_civil_war_local_support
					duration = 3650
				}
				set_province_flag = disgruntled_nobles_timer
				Public_ChangePowerbrokerLoyaltyTooltip = { Powerbroker=NO Amount=20 }
			}
		}
	}
}

# ### LOCAL SUPPORT FOR THE LANCASTER PRETENDERS ###

country_event = {
	id = uef_civil_war.3
	title = uef_civil_war.3.t
	desc = uef_civil_war.3.d
	picture = uef_civil_war_eventPicture
	trigger = {
		has_country_flag = uef_civil_war_support_english
		any_owned_province = {
			OR = {
				region = south_england_region
				region = north_england_region
				superregion = france_superregion
			}
			is_capital = no
			NOT = { has_province_modifier = uef_civil_war_local_support }
			NOT = { has_province_modifier = uef_civil_war_local_support_for_england }
			NOT = { has_province_modifier = uef_civil_war_local_support_for_france }
		}
	}
	is_triggered_only = yes

	option = {
		name = uef_civil_war.3.a
		random_owned_province = {
			limit = {
				OR = {
					region = south_england_region
					region = north_england_region
					superregion = france_superregion
				}
				NOT = { has_province_modifier = uef_civil_war_local_support }
				NOT = { has_province_modifier = uef_civil_war_local_support_for_england }
				NOT = { has_province_modifier = uef_civil_war_local_support_for_france }
			}
			add_province_modifier = {
				name = uef_civil_war_local_support_for_england
				duration = 3650
			}
			Public_ChangePowerbrokerLoyaltyTooltip = { Powerbroker=NO Amount=-100 }
			every_neighbor_province = {
				limit = {
					owned_by = ROOT
					NOT = { has_province_modifier = uef_civil_war_local_support }
					NOT = { has_province_modifier = uef_civil_war_local_support_for_england }
					NOT = { has_province_modifier = uef_civil_war_local_support_for_france }
				}
				add_province_modifier = {
					name = uef_civil_war_local_support_for_england
					duration = 3650
				}
				Public_ChangePowerbrokerLoyaltyTooltip = { Powerbroker=NO Amount=-100 }
			}
		}
	}
}

# ### LOCAL SUPPORT FOR THE France PRETENDERS ###

country_event = {
	id = uef_civil_war.4
	title = uef_civil_war.4.t
	desc = uef_civil_war.4.d
	picture = uef_civil_war_eventPicture
	trigger = {
		has_country_flag = uef_civil_war_support_france
		any_owned_province = {
			OR = {
				region = south_england_region
				region = north_england_region
				superregion = france_superregion
			}
			is_capital = no
			NOT = { has_province_modifier = uef_civil_war_local_support }
			NOT = { has_province_modifier = uef_civil_war_local_support_for_england }
			NOT = { has_province_modifier = uef_civil_war_local_support_for_france }
		}
	}
	is_triggered_only = yes

	option = {
		name = uef_civil_war.4.a
		random_owned_province = {
			limit = {
				OR = {
					region = south_england_region
					region = north_england_region
					superregion = france_superregion
				}
				NOT = { has_province_modifier = uef_civil_war_local_support }
				NOT = { has_province_modifier = uef_civil_war_local_support_for_england }
				NOT = { has_province_modifier = uef_civil_war_local_support_for_france }
			}
			add_province_modifier = {
				name = uef_civil_war_local_support_for_france
				duration = 3650
			}
			Public_ChangePowerbrokerLoyaltyTooltip = { Powerbroker=NO Amount=100 }
			every_neighbor_province = {
				limit = {
					owned_by = ROOT
					NOT = { has_province_modifier = uef_civil_war_local_support }
					NOT = { has_province_modifier = uef_civil_war_local_support_for_england }
					NOT = { has_province_modifier = uef_civil_war_local_support_for_france }
				}
				add_province_modifier = {
					name = uef_civil_war_local_support_for_france
					duration = 3650
				}
			}
		}
	}
}

### NOBLES DISGRUNTLED ###
country_event = {
	id = uef_civil_war.5
	title = uef_civil_war.5.t
	desc = uef_civil_war.5.d
	picture = uef_civil_war_eventPicture
	trigger = {
		any_owned_province = {
			has_province_modifier = uef_civil_war_local_support
			had_province_flag = {
				flag = disgruntled_nobles_timer
				days = 547 #1.5 years
			}
		}
	}
	is_triggered_only = yes

	immediate = {
		random_owned_province = {
			limit = {
				has_province_modifier = uef_civil_war_local_support
				had_province_flag = {
					flag = disgruntled_nobles_timer
					days = 547
				}
			}
			set_province_flag = potential_disgruntled_nobles
		}
	}

	option = {
		name = uef_civil_war.5.a
		ai_chance = {
			factor = 50
		}
		add_treasury = -15
		random_owned_province = {
			limit = {
				has_province_flag = potential_disgruntled_nobles
			}
			Public_ChangeClassWealthVal = { class= NO type = value inp=15 }
			clr_province_flag = potential_disgruntled_nobles
		}
	}
	option = {
		name = uef_civil_war.5.b
		ai_chance = {
			factor = 50
		}
		random_owned_province = {
			limit = {
				has_province_flag = potential_disgruntled_nobles
			}
			Public_ChangePowerbrokerLoyaltyTooltip = { Powerbroker=NO Amount=-30 }
			remove_province_modifier = uef_civil_war_local_support
			clr_province_flag = potential_disgruntled_nobles
			hidden_effect = {
				add_province_modifier = {
					name = disgruntled_nobles
					duration = 1825
				}
			}
		}
	}
}

# Soldiers Desert
country_event = {
	id =  uef_civil_war.7
	title = uef_civil_war.7.t
	desc = uef_civil_war.7.d
	picture = uef_civil_war_eventPicture
	
	is_triggered_only = yes
	
	option = { # There is nothing we can do.
		name = uef_civil_war.7.a
		ai_chance = { factor = 10 }
		add_legitimacy = -20
	}

	option = { # Import food from abroad.
		name = uef_civil_war.7.b
		ai_chance = { factor = 70 }
		add_country_modifier = {
			name = importing_food
			duration = 1825
		}
	}

	option = { # Let them take from the local peasants.
		name = uef_civil_war.7.c
		ai_chance = { factor = 20 }
		random_owned_province = {
			limit = {
				units_in_province = 1
			}
			add_devastation = 10
		}
		add_country_modifier = {
			name = plundering_soldiers
			duration = 1825
		}
	}
}

### LEGITIMACY QUESTIONED ###

country_event = {
	id = uef_civil_war.8
	title = uef_civil_war.8.t
	desc = uef_civil_war.8.d
	picture = uef_civil_war_eventPicture
	trigger = {
		NOT = { legitimacy = 75 }
		months_of_ruling = 18
	}
	is_triggered_only = yes
	fire_only_once = yes

	option = { #Buy their continued support
		name = uef_civil_war.8.a
		ai_chance = {
			factor = 50
		}
		add_treasury = -100 #Money distributed to provinces
		random_owned_province = {
			limit = {
				NOT = { has_province_modifier = uef_civil_war_local_support_for_england }
				NOT = { has_province_modifier = uef_civil_war_local_support_for_france }
				OR = {
					region = south_england_region
					region = north_england_region
				}
				units_in_province = 1
				controlled_by = ROOT
			}
			Public_ChangeClassWealthVal = { class= NO type = value inp=50 }
		}
		random_owned_province = {
			limit = {
				NOT = { has_province_modifier = uef_civil_war_local_support_for_england }
				NOT = { has_province_modifier = uef_civil_war_local_support_for_france }
				OR = {
					region = south_england_region
					region = north_england_region
				}
				controlled_by = ROOT
			}
			Public_ChangeClassWealthVal = { class= NO type = value inp=25 }
		}
		random_owned_province = {
			limit = {
				NOT = { has_province_modifier = uef_civil_war_local_support_for_england }
				NOT = { has_province_modifier = uef_civil_war_local_support_for_france }
				OR = {
					region = south_england_region
					region = north_england_region
				}
				controlled_by = ROOT
			}
			Public_ChangeClassWealthVal = { class= NO type = value inp=25 }
		}
	}
	option = { #How dare they question me?
		name = uef_civil_war.8.b
		ai_chance = {
			factor = 50
		}
		add_country_modifier = {
			name = legitimacy_questioned #TODO: balance, -10% land morale for 5 years vs 1/2 of yearly income
			duration = 1825
		}
	}
}

### RUMORS OF LARGE REVOLT ###

country_event = {
	id = uef_civil_war.9
	title = uef_civil_war.9.t
	desc = uef_civil_war.9.d
	picture = uef_civil_war_eventPicture
	trigger = {
		any_owned_province = {
			unrest = 3
			controlled_by = ROOT
		}
	}
	is_triggered_only = yes
	fire_only_once = yes

	option = { #Send money to help the local authorities
		name = uef_civil_war.9.a
		ai_chance = {
			factor = 25
		}
		add_treasury = 100 #Money distributed to provinces
		random_owned_province = {
			limit = {
				NOT = {	superregion = british_isles_superregion }
			    unrest = 3
			    controlled_by = ROOT
			}
			Public_ChangeClassWealthVal = { class= NO type = value inp=100 }
		}
	}
	option = { #The money is needed more closer to home
		name = uef_civil_war.9.b
		ai_chance = {
			factor = 75
		}
		random_owned_province = {
			limit = {
				unrest = 3
				controlled_by = ROOT
			}
			Public_ChangePowerbrokerLoyaltyTooltip = { Powerbroker=NO Amount=-100 }
			spawn_rebels = {
				type = pretender_rebels
				size = 3
			}
			add_province_modifier = {
				name = uef_civil_war_rebel_refugees
				duration = 3650
			}
			custom_tooltip = uef_civil_war_rebel_refugees_tt
		}
	}
}

### England STRONGHOLD ###

province_event = {
	id = uef_civil_war.10
	title = uef_civil_war.10.t
	desc = uef_civil_war.10.d
	picture = uef_civil_war_eventPicture
	is_triggered_only = yes
	fire_only_once = yes
	trigger = {
		FROM = {
			tag = REB
		}
		has_province_modifier = uef_civil_war_rebel_refugees
		has_province_modifier = uef_civil_war_local_support_for_england
	}
	option = {
		name = uef_civil_war.10.a
		add_province_modifier = {
			name = uef_civil_war_rebel_stronghold
			duration = 1825
		}
		custom_tooltip = uef_civil_war_rebel_stronghold_tt
	}
}

### France STRONGHOLD ###

province_event = {
	id = uef_civil_war.11
	title = uef_civil_war.11.t
	desc = uef_civil_war.11.d
	picture = uef_civil_war_eventPicture
	is_triggered_only = yes
	fire_only_once = yes
	trigger = {
		FROM = {
			tag = REB
		}
		has_province_modifier = uef_civil_war_rebel_refugees
		has_province_modifier = uef_civil_war_local_support_for_france
	}
	option = {
		name = uef_civil_war.11.a
		add_province_modifier = {
			name = uef_civil_war_rebel_stronghold
			duration = 1825
		}
		custom_tooltip = uef_civil_war_rebel_stronghold_tt
	}
}

### SUPPORT England ###

country_event = {
	id = uef_civil_war.12
	title = uef_civil_war.12.t
	desc = uef_civil_war.12.d
	picture = uef_civil_war_eventPicture
	trigger = {
		OR = {
			capital_scope = { superregion = british_isles_superregion }
			capital_scope = { superregion = france_superregion }
			capital_scope = { superregion = iberia_superregion }
			capital_scope = { superregion = germany_superregion }
		}
		NOT = { has_disaster = uef_civil_war }
		if = { #to filter out Irish minors
		    limit = {
			    exists = UEF
			}
		    army_strength = {
			    who = UEF
			    value = 0.5
		    }
			else = {
			    army_strength = {
			        who = ENG
			        value = 0.5
		        }
			}
		}
		NOT = { has_country_flag = support_for_uef_civil_war }
		NOT = { has_country_flag = no_support_for_rose_rebels }
		any_known_country = {
		    has_disaster = uef_civil_war
			has_country_flag = uef_civil_war_support_english
			any_owned_province = {
				OR = {
					any_neighbor_province = {
						owned_by = ROOT
					}
					has_port = yes
				}
				unit_in_siege = no
			}
		}
	}
	mean_time_to_happen = {
		months = 60
	}
	option = {
		name = uef_civil_war.12.a
		ai_chance = {
			factor = 50
		}
		log = "DIS-uef_civil_war:[GetYear]:[Root.GetName]:supported England with token force:uef_civil_war.12"
		set_country_flag = support_for_uef_civil_war
		add_mil_power = -50
		hidden_effect = {
			random_known_country = {
			    limit = {
				    has_disaster = uef_civil_war
			        has_country_flag = uef_civil_war_support_english
				}
				country_event = {
					id = uef_civil_war.14
					days = 1
				}
			}
		}
	}
	option = {
		name = uef_civil_war.12.b
		ai_chance = {
			factor = 25
		}
		log = "DIS-uef_civil_war:[GetYear]:[Root.GetName]:supported France with money:uef_civil_war.12"
		set_country_flag = support_for_uef_civil_war
		add_treasury = -50
		hidden_effect = {
			random_known_country = {
			    limit = {
				    has_disaster = uef_civil_war
			        has_country_flag = uef_civil_war_support_english
				}
				country_event = {
					id = uef_civil_war.14
					days = 1
				}
			}
		}
	}
	option = {
		name = uef_civil_war.12.c
		ai_chance = {
			factor = 25
		}
		log = "DIS-uef_civil_war:[GetYear]:[Root.GetName]:refuesed to support England:uef_civil_war.12"
		set_country_flag = no_support_for_rose_rebels
		add_prestige = 5
	}
}

### SUPPORT France ###

country_event = {
	id = uef_civil_war.13
	title = uef_civil_war.13.t
	desc = uef_civil_war.13.d
	picture = uef_civil_war_eventPicture
	trigger = {
		OR = {
			capital_scope = { superregion = british_isles_superregion }
			capital_scope = { superregion = france_superregion }
			capital_scope = { superregion = iberia_superregion }
			capital_scope = { superregion = germany_superregion }
		}
		NOT = { has_disaster = uef_civil_war }
		if = { #to filter out Irish minors
		    limit = {
			    exists = UEF
			}
		    army_strength = {
			    who = UEF
			    value = 0.5
		    }
			else = {
			    army_strength = {
			        who = ENG
			        value = 0.5
		        }
			}
		}
		NOT = { has_country_flag = support_for_uef_civil_war }
		NOT = { has_country_flag = no_support_for_rose_rebels }
		any_known_country = {
		    has_disaster = uef_civil_war
			has_country_flag = uef_civil_war_support_france
			any_owned_province = {
				OR = {
					any_neighbor_province = {
						owned_by = ROOT
					}
					has_port = yes
				}
				unit_in_siege = no
			}
		}
	}
	mean_time_to_happen = {
		months = 60
	}
	option = {
		name = uef_civil_war.12.a
		ai_chance = {
			factor = 50
		}
		log = "DIS-uef_civil_war:[GetYear]:[Root.GetName]:supported France with money:uef_civil_war.13"
		set_country_flag = support_for_uef_civil_war
		hidden_effect = {
			random_known_country = {
			    limit = {
				    has_disaster = uef_civil_war
			        has_country_flag = uef_civil_war_support_france
				}
				country_event = {
					id = uef_civil_war.14
					days = 1
				}
			}
		}
	}
	option = {
		name = uef_civil_war.12.b
		ai_chance = {
			factor = 25
		}
		log = "DIS-uef_civil_war:[GetYear]:[Root.GetName]:supported France with money:uef_civil_war.13"
		set_country_flag = support_for_uef_civil_war
		add_treasury = -50
		hidden_effect = {
			random_known_country = {
			    limit = {
				    has_disaster = uef_civil_war
			        has_country_flag = uef_civil_war_support_france
				}
				country_event = {
					id = uef_civil_war.14
					days = 1
				}
			}
		}
	}
	option = {
		name = uef_civil_war.12.c
		ai_chance = {
			factor = 25
		}
		log = "DIS-uef_civil_war:[GetYear]:[Root.GetName]:refuesed to support France:uef_civil_war.13"
		set_country_flag = no_support_for_rose_rebels
		add_prestige = 5
	}
}

### X INTERVENES! ###

country_event = {
	id = uef_civil_war.14
	title = uef_civil_war.14.t
	desc = uef_civil_war.14.d
	picture = uef_civil_war_eventPicture
	is_triggered_only = yes
	option = {
		name = uef_civil_war.14.a
		if = {
			limit = {
				any_owned_province = {
					any_neighbor_province = {
						owned_by = FROM
					}
					unit_in_siege = no
				}
			}
			random_owned_province = {
				limit = {
					any_neighbor_province = {
						owned_by = FROM
					}
					unit_in_siege = no
				}
				spawn_rebels = {
					type = pretender_rebels
					size = 2
					friend = FROM
				}
			}
		}
		if = {
			limit = {
				NOT = {
					any_owned_province = {
						any_neighbor_province = {
							owned_by = FROM
						}
						unit_in_siege = no
					}
				}
				any_owned_province = {
					has_port = yes
					unit_in_siege = no
				}
			}
			random_owned_province = {
				limit = {
					has_port = yes
					unit_in_siege = no
				}
				spawn_rebels = {
					type = pretender_rebels
					size = 2
					friend = FROM
				}
			}
		}
	}
}

### THE END OF THE WAR OF THE ROSES (THE RULING DYNASTY DEFEATS THE REBELS) ###

country_event = {
	id = uef_civil_war.100 #The End of the War of the Roses (the ruling dynasty defeats the rebels)
	title = uef_civil_war.100.t
	desc = uef_civil_war.100.d
	picture = uef_civil_war_eventPicture
	major = yes
	is_triggered_only = yes #from "on_end" in disaster

	immediate = {
		hidden_effect = {
			remove_country_modifier = low_fertility
			remove_country_modifier = legitimacy_questioned
			every_owned_province = {
				remove_province_modifier = uef_civil_war_local_support
			 	remove_province_modifier = uef_civil_war_local_support_for_england
			 	remove_province_modifier = uef_civil_war_local_support_for_france
			  	remove_province_modifier = uef_civil_war_rebel_refugees
			 	remove_province_modifier = uef_civil_war_rebel_stronghold
			}
			set_country_flag = had_uef_civil_war
			clr_global_flag = uef_civil_war
		}
	}
	option = {
		name = uef_civil_war.100.a
		log = "DIS-uef_civil_war:[GetYear]:[Root.GetName]:ruling dynasty won the UEF Civil war:uef_civil_war.100"
		log = "DIS-uef_civil_war:[GetYear]:[Root.GetName]:end of UEF Civil war:uef_civil_war.100"
		Stab_Add1 = yes
		add_prestige = 20
		Public_ChangePowerbrokerLoyaltyTooltipProv = { Powerbroker = NO Amount = 20 }
		hidden_effect = {
			every_country = {
				limit = {
					has_country_flag = support_for_uef_civil_war
				}
				country_event = {
					id = uef_civil_war.104 #Relations Deteriorate with England
					days = 1
				}
			}
			clr_country_flag = uef_civil_war_support_france
			clr_country_flag = uef_civil_war_support_english
		}
	}
}

### THE END OF THE WAR OF THE ROSES (REBELLING France WINS THE WAR) ###

country_event = {
	id = uef_civil_war.101
	title = uef_civil_war.101.t
	desc = uef_civil_war.101.d
	picture = uef_civil_war_eventPicture
	major = yes
	is_triggered_only = yes
	fire_only_once = yes

	trigger = {
		tag = ENG
		has_disaster = uef_civil_war
		has_country_flag = uef_civil_war_support_france
		has_global_flag = plantagenet_becomes_french_again
		is_in_war = {
			casus_belli = cb_overlord_attacking_independence_war
		}
		OR = {
			AND = {
				war_score_against = {
					who = FRA
					value = 50
				}
				ai = yes
				FRA = {
					ai = yes
				}
			}
			AND = {
				war_score_against = {
					who = FRA
					value = 75
				}
				ai = no
				FRA = {
					ai = no
				}
			}
			AND = {
				war_score_against = {
					who = UEF
					value = 50
				}
				ai = yes
				UEF = {
					ai = yes
				}
			}
			AND = {
				war_score_against = {
					who = UEF
					value = 75
				}
				ai = no
				UEF = {
					ai = no
				}
			}
		}
	}

	immediate = {
		hidden_effect = {
			set_country_flag = had_uef_civil_war
			clr_global_flag = uef_civil_war
		}
		end_disaster = uef_civil_war
		set_country_flag = uef_plantagnet_civil_war_ending_1
		if = {
			limit = {
				war_with = FRA
			}
			white_peace = FRA
		}
		else = {
			white_peace = UEF
		}
	}

	option = {
		name = uef_civil_war.101.a
		log = "DIS-uef_civil_war:[GetYear]:[Root.GetName]:rebelling House of Lancaster won the War of The Roses:uef_civil_war.101"
		log = "DIS-uef_civil_war:[GetYear]:[Root.GetName]:end of War of the Roses:uef_civil_war.101"
		Stab_Add50Percent = yes
		add_prestige = -10
		hidden_effect = {
			every_country = {
				limit = {
					has_country_flag = support_for_uef_civil_war
				}
				country_event = {
					id = uef_civil_war.103 #Improved Relations with England
					days = 1
				}
				every_country = {
					limit = {
						has_country_flag = no_support_for_rose_rebels
					}
					country_event = {
						id = uef_civil_war.104 #Relations Deteriorate with England
						days = 1
					}
				}
			}
		}
		custom_tooltip = post_uef_civil_war_loyalty_shift_rebels_won
		every_owned_province = {
			limit = {
				OR = {
					has_province_modifier = uef_civil_war_rebel_refugees
					has_province_modifier = uef_civil_war_rebel_stronghold
				}
			}
			hidden_effect = { Public_ChangePowerbrokerLoyaltyTooltip = { Powerbroker=NO Amount=30 } }
		}
		every_owned_province = {
			limit = {
				has_province_modifier = uef_civil_war_local_support
			}
			hidden_effect = { Public_ChangePowerbrokerLoyaltyTooltip = { Powerbroker=NO Amount=-30 } }
		}
	}
	after = {
		hidden_effect = {
			clr_country_flag = uef_civil_war_support_english
			clr_country_flag = uef_civil_war_support_france
			remove_country_modifier = importing_food
			remove_country_modifier = plundering_soldiers
			remove_country_modifier = legitimacy_questioned
			remove_country_modifier = low_fertility
			every_owned_province = {
				remove_province_modifier = uef_civil_war_local_support
				remove_province_modifier = uef_civil_war_local_support_for_england
				remove_province_modifier = uef_civil_war_local_support_for_france
				remove_province_modifier = uef_civil_war_rebel_refugees
				remove_province_modifier = uef_civil_war_rebel_stronghold
			}
		}
	}
}

### THE END OF THE WAR OF THE ROSES (REBELLING France WINS THE WAR) ###

country_event = {
	id = uef_civil_war.102
	title = uef_civil_war.102.t
	desc = uef_civil_war.102.d
	picture = uef_civil_war_eventPicture
	major = yes
	is_triggered_only = yes
	fire_only_once = yes
	trigger = {
		has_disaster = uef_civil_war
		has_country_flag = uef_civil_war_support_english
		is_in_war = {
			casus_belli = cb_overlord_attacking_independence_war
		}
		OR = {
			AND = {
				war_score_against = {
					who = FRA
					value = 50
				}
				ai = yes
				FRA = {
					ai = yes
				}
			}
			AND = {
				war_score_against = {
					who = FRA
					value = 75
				}
				ai = no
				FRA = {
					ai = no
				}
			}
			AND = {
				war_score_against = {
					who = UEF
					value = 50
				}
				ai = yes
				UEF = {
					ai = yes
				}
			}
			AND = {
				war_score_against = {
					who = UEF
					value = 75
				}
				ai = no
				UEF = {
					ai = no
				}
			}
		}
	}
	immediate = {
		hidden_effect = {
			set_country_flag = had_uef_civil_war
			clr_global_flag = uef_civil_war
		}
		end_disaster = uef_civil_war
		set_country_flag = uef_plantagnet_civil_war_ending_1
		if = {
			limit = {
				war_with = FRA
			}
			white_peace = FRA
		}
		else = {
			white_peace = UEF
		}
	}
	option = {
		name = uef_civil_war.102.a
		log = "DIS-uef_civil_war:[GetYear]:[Root.GetName]:France won the civil war:uef_civil_war.102"
		log = "DIS-uef_civil_war:[GetYear]:[Root.GetName]:end of civil war:uef_civil_war.102"
		Stab_Add50Percent = yes
		add_prestige = -10
		hidden_effect = {
			every_country = {
				limit = {
					has_country_flag = support_for_uef_civil_war
				}
				country_event = {
					id = uef_civil_war.103 #Improved Relations with England
					days = 1
				}
			}
			every_country = {
				limit = {
					has_country_flag = no_support_for_rose_rebels
				}
				country_event = {
					id = uef_civil_war.104 #Relations Deteriorate with England
					days = 1
				}
			}
			custom_tooltip = post_uef_civil_war_loyalty_shift_rebels_won
			every_owned_province = {
				limit = {
					OR = {
						has_province_modifier = uef_civil_war_rebel_refugees
						has_province_modifier = uef_civil_war_rebel_stronghold
					}
				}
				hidden_effect = { Public_ChangePowerbrokerLoyaltyTooltip = { Powerbroker=NO Amount=30 } }
			}
			every_owned_province = {
				limit = {
					has_province_modifier = uef_civil_war_local_support
				}
				hidden_effect = { Public_ChangePowerbrokerLoyaltyTooltip = { Powerbroker=NO Amount=-30 } }
			}
		}
	}
	after = {
		hidden_effect = {
			clr_country_flag = uef_civil_war_support_english
			clr_country_flag = uef_civil_war_support_france
			remove_country_modifier = legitimacy_questioned
			remove_country_modifier = low_fertility
			every_owned_province = {
				remove_province_modifier = uef_civil_war_local_support
				remove_province_modifier = uef_civil_war_local_support_for_england
				remove_province_modifier = uef_civil_war_local_support_for_france
				remove_province_modifier = uef_civil_war_rebel_refugees
				remove_province_modifier = uef_civil_war_rebel_stronghold
			}
		}
	}
}

### IMPROVED RELATIONS WITH ENGLAND ###

country_event = {
	id = uef_civil_war.103
	title = uef_civil_war.103.t
	desc = uef_civil_war.103.d
	picture = uef_civil_war_eventPicture
	is_triggered_only = yes
	immediate = {
		clr_country_flag = support_for_uef_civil_war
		clr_country_flag = no_support_for_rose_rebels
	}
	option = {
		name = uef_civil_war.103.a
		log = "DIS-uef_civil_war:[GetYear]:[Root.GetName]:improved relation with [From.GetName]:uef_civil_war.103"
		FROM = {
			add_opinion = {
				who = ROOT
				modifier = eng_support_during_uef_civil_war
			}
			reverse_add_opinion = {
				who = ROOT
				modifier = eng_support_during_uef_civil_war
			}
		}
	}
}

### RELATIONS DETERIORATE WITH ENGLAND ###

country_event = {
	id = uef_civil_war.104
	title = uef_civil_war.104.t
	desc = uef_civil_war.104.d
	picture = uef_civil_war_eventPicture
	is_triggered_only = yes

	option = {
		name = uef_civil_war.104.a
		log = "DIS-uef_civil_war:[GetYear]:[Root.GetName]:worsened relation with [From.GetName]:uef_civil_war.104"
		trigger = {
				has_country_flag = support_for_uef_civil_war
		}
		FROM = {
			add_opinion = {
				who = ROOT
				modifier = eng_supported_rebels_during_uef_civil_war
			}
			reverse_add_opinion = {
				who = ROOT
				modifier = eng_supported_rebels_during_uef_civil_war
			}
		}
		clr_country_flag = support_for_uef_civil_war
	}
	option = {
		name = uef_civil_war.104.b
		log = "DIS-uef_civil_war:[GetYear]:[Root.GetName]:worsened relation with [From.GetName]:uef_civil_war.104"
		trigger = {
			has_country_flag = no_support_for_rose_rebels
		}
		FROM = {
			add_opinion = {
				who = ROOT
				modifier = eng_didnt_support_rebels_uef_civil_war
			}
			reverse_add_opinion = {
				who = ROOT
				modifier = eng_didnt_support_rebels_uef_civil_war
			}
		}
		clr_country_flag = no_support_for_rose_rebels
	}
}

### HOUSE OF X ENDS THE WAR OF THE ROSES ###

country_event = {
	id = uef_civil_war.106 #House of X ends the War of the Roses
	title = uef_civil_war.106.t
	desc = uef_civil_war.106.d
	picture = uef_civil_war_eventPicture
	major = yes
	is_triggered_only = yes
	fire_only_once = yes

	trigger = {
		has_disaster = uef_civil_war
		NOT = { dynasty = Plantagnet }
		is_in_war = {
			casus_belli = cb_overlord_attacking_independence_war
		}
	}

	immediate = {
		hidden_effect = {
			clr_country_flag = uef_civil_war_support_english
			clr_country_flag = uef_civil_war_support_france
			remove_country_modifier = legitimacy_questioned
			remove_country_modifier = low_fertility
			every_owned_province = {
				remove_province_modifier = uef_civil_war_local_support
				remove_province_modifier = uef_civil_war_local_support_for_england
				remove_province_modifier = uef_civil_war_local_support_for_france
				remove_province_modifier = uef_civil_war_rebel_refugees
				remove_province_modifier = uef_civil_war_rebel_stronghold
			}
			set_country_flag = had_uef_civil_war
			clr_global_flag = uef_civil_war
		}
		end_disaster = uef_civil_war
		set_country_flag = uef_plantagnet_civil_war_ending_2
	}
	option = {
		name = uef_civil_war.106.a
		log = "DIS-uef_civil_war:[GetYear]:[Root.GetName]:other dynasty (Root.Monarch.Dynastyt.GetName) got the throne:uef_civil_war.106"
		log = "DIS-uef_civil_war:[GetYear]:[Root.GetName]:end of Civil war:uef_civil_war.106"
		Stab_Subtract1 = yes
		if = {
			limit = {
				war_with = FRA
			}
			white_peace = FRA
		}
		else = {
			white_peace = UEF
		}
	}
}
