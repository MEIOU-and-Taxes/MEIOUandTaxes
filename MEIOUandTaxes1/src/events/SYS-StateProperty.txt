namespace = SYS_StateProperty

### Concept for Estates Acquiring State Property
# If Capacity is overburdened, prov will be found where we can sell to local powerbroker

country_event = {
	id = SYS_StateProperty.001
	title = "no_localisation"
	desc = "no_localisation"
	picture = CITY_DEVELOPMENT_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_country_flag = StatePropertyBurden
	}
	#Event decides what should be sold first
	#If sale is rejected in event 002 to 008, then 001 is called again, but that property is deactivated for one iteration
	#Weighting table is as follows:
	#########  Monarch / Tribal / Republic / Theocracy
	#Farmland   6 / 6 / 1 / 6
	#Extraction 7 / 7 / 1 / 2
	#Forestry   4 / 5 / 1 / 3
	#Fishery    5 / 4 / 1 / 5
	#Industrial 2 / 2 / 5 / 4
	#Commerce   1 / 1 / 5 / 1
	#Academic   3 / 3 / 5 / 7
	## The higher the number, the less likely it is picked for selling 
	
	#Farmland
	option = {
		name = "no_localisation"
		trigger = {
			check_key = { lhs = StatePropertyAgriculture value = 10 }
			NOT = { has_country_flag = NoFarmlandForSale }
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 2.00
				owner = { government = monarchy }
			}
			modifier = {
				factor = 2.00
				owner = { government = tribal }
			}
			modifier = {
				factor = 7.00
				owner = { government = republic }
			}
			modifier = {
				factor = 2.00
				owner = { government = theocracy }
			}
		}
		country_event = {
			id = SYS_StateProperty.002
			days = 5
			random = 15
		}		
	}
	#Extraction
	option = {
		name = "no_localisation"
		trigger = {
			check_key = { lhs = StatePropertyExtraction value = 10 }
			NOT = { has_country_flag = NoExtractionForSale }
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 1.00
				owner = { government = monarchy }
			}
			modifier = {
				factor = 1.00
				owner = { government = tribal }
			}
			modifier = {
				factor = 7.00
				owner = { government = republic }
			}
			modifier = {
				factor = 5.00
				owner = { government = theocracy }
			}
		}
		country_event = {
			id = SYS_StateProperty.002
			days = 5
			random = 15
		}		
	}
	#Forestry
	option = {
		name = "no_localisation"
		trigger = {
			check_key = { lhs = StatePropertyForestry value = 10 }
			NOT = { has_country_flag = NoForestryForSale }
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 4.00
				owner = { government = monarchy }
			}
			modifier = {
				factor = 3.00
				owner = { government = tribal }
			}
			modifier = {
				factor = 7.00
				owner = { government = republic }
			}
			modifier = {
				factor = 5.00
				owner = { government = theocracy }
			}
		}
		country_event = {
			id = SYS_StateProperty.002
			days = 5
			random = 15
		}
	}
	#Fishery
	option = {
		name = "no_localisation"
		trigger = {
			check_key = { lhs = StatePropertyFishery value = 10 }
			NOT = { has_country_flag = NoFisheryForSale }
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 4.00
				owner = { government = monarchy }
			}
			modifier = {
				factor = 3.00
				owner = { government = tribal }
			}
			modifier = {
				factor = 7.00
				owner = { government = republic }
			}
			modifier = {
				factor = 3.00
				owner = { government = theocracy }
			}
		}
		country_event = {
			id = SYS_StateProperty.002
			days = 5
			random = 15
		}		
	}
	#Industrial
	option = {
		name = "no_localisation"
		trigger = {
			check_key = { lhs = StatePropertyIndustrial value = 10 }
			NOT = { has_country_flag = NoIndustrialForSale }
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 6.00
				owner = { government = monarchy }
			}
			modifier = {
				factor = 6.00
				owner = { government = tribal }
			}
			modifier = {
				factor = 3.00
				owner = { government = republic }
			}
			modifier = {
				factor = 4.00
				owner = { government = theocracy }
			}
		}
		country_event = {
			id = SYS_StateProperty.002
			days = 5
			random = 15
		}		
	}
	#Commercial
	option = {
		name = "no_localisation"
		trigger = {
			check_key = { lhs = StatePropertyCommercial value = 10 }
			NOT = { has_country_flag = NoCommercialForSale }
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 7.00
				owner = { government = monarchy }
			}
			modifier = {
				factor = 7.00
				owner = { government = tribal }
			}
			modifier = {
				factor = 3.00
				owner = { government = republic }
			}
			modifier = {
				factor = 7.00
				owner = { government = theocracy }
			}
		}
		country_event = {
			id = SYS_StateProperty.002
			days = 5
			random = 15
		}		
	}
	#Academic
	option = {
		name = "no_localisation"
		trigger = {
			check_key = { lhs = StatePropertyAcademic value = 10 }
			NOT = { has_country_flag = NoAcademicForSale }
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 5.00
				owner = { government = monarchy }
			}
			modifier = {
				factor = 5.00
				owner = { government = tribal }
			}
			modifier = {
				factor = 3.00
				owner = { government = republic }
			}
			modifier = {
				factor = 1.00
				owner = { government = theocracy }
			}
		}
		country_event = {
			id = SYS_StateProperty.002
			days = 5
			random = 15
		}		
	}
	#NothingCanBeSold Option
	#Shouldnt be necessary, as StateCap should always be high enough to allow one option
}

country_event = {
	id = SYS_StateProperty.002
	title = "no_localisation"
	desc = "no_localisation"
	picture = CITY_DEVELOPMENT_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_country_flag = StatePropertyBurden
	}
	
	immediate = {
		#find a province
			random_owned_province = {
				limit = {
					check_key = { lhs = BU_Agriculture value = 0 }
				}
				save_event_target_as = StatePropertyBuyOut
				
				set_key = { lhs = BuyOutAmount which = BU_Agriculture }
				multiply_key = { lhs = BuyOutAmount value = 0.75 }
					
				set_key = { lhs = BuyOutValue which = Building_AgricultureGross } # take profits of that property
				#missing condition if profits are below zero
				divide_key = { lhs = BuyOutValue which = Building_Agriculture } # divide profits with size of that property
				multiply_key = { lhs = BuyOutValue value = 10 } # 10 years projected profits
				multiply_key = { lhs = BuyOutValue which = BuyOutAmount } # projected profits x amount to be sold
				ROOT = { set_key = { lhs = BuyOutValue which = PREV } } # Theoretical value saved to country scope
				
				#Nobility
				set_key = { lhs = Tmp_1 value = 1 }
				multiply_key = { lhs = Tmp_1 which = Prov_NOLoy } # 0 to 100
				change_key = { lhs = Tmp_1 value = 1 } #make sure they offer nonzero
				multiply_key = { lhs = Tmp_1 value = 0.01 } # 1 to 101 -> 0.01 to 1.01
				multiply_key = { lhs = Tmp_1 which = BuyOutValue } # Factor x Value
				#Clergy
				set_key = { lhs = Tmp_2 value = 1 }
				multiply_key = { lhs = Tmp_2 which = Prov_CLLoy } # 0 to 100
				change_key = { lhs = Tmp_2 value = 1 } #make sure they offer nonzero
				multiply_key = { lhs = Tmp_2 value = 0.01 } # 1 to 101 -> 0.01 to 1.01
				multiply_key = { lhs = Tmp_2 which = BuyOutValue } # Factor x Value				
				#Burgher
				set_key = { lhs = Tmp_3 value = 1 }
				multiply_key = { lhs = Tmp_3 which = Prov_BGLoy } # 0 to 100
				change_key = { lhs = Tmp_3 value = 1 } #make sure they offer nonzero
				multiply_key = { lhs = Tmp_3 value = 0.01 } # 1 to 101 -> 0.01 to 1.01
				multiply_key = { lhs = Tmp_3 which = BuyOutValue } # Factor x Value
				#Commoners
				set_key = { lhs = Tmp_4 value = 0.65 } #Commoners always offer 65% for now
				multiply_key = { lhs = Tmp_4 which = BuyOutValue } # Factor x Value				
			}
			
	}
	#Nobility
	option = {
		name = "no_localisation"
		trigger = {
			event_target:StatePropertyBuyOut = {
				check_key = { lhs = NO_Wealth which = Tmp_1 }
			}
		}
		hidden_effect = {
			event_target:StatePropertyBuyOut = {				
				change_key = { lhs = NO_Agriculture which = BuyOutAmount }
				subtract_key = { lhs = BU_Agriculture which = BuyOutAmount }
				
				subtract_key = { lhs = NO_Wealth which = Tmp_1 }
			}
			set_var_from_key = { var = ducat_gain key = Tmp_1 }
			old_scaled_ducat_gained_country = yes

		}
		ai_chance = {
			factor = 100
			modifier = {
				factor = 2.00
				owner = { government = monarchy }
			}
		}
		
	}
	#Clergy
	option = {
		name = "no_localisation"
		trigger = {
			event_target:StatePropertyBuyOut = {
				check_key = { lhs = CL_Wealth which = Tmp_2 }
			}
		}
		hidden_effect = {
			event_target:StatePropertyBuyOut = {				
				change_key = { lhs = CL_Agriculture which = BuyOutAmount }
				subtract_key = { lhs = BU_Agriculture which = BuyOutAmount }
				
				subtract_key = { lhs = CL_Wealth which = Tmp_2 }
			}
			set_var_from_key = { var = ducat_gain key = Tmp_2 }
			old_scaled_ducat_gained_country = yes

		}
		ai_chance = {
			factor = 100
			modifier = {
				factor = 2.00
				owner = { government = theocracy }
			}
		}
		
	}
	#Burgher
	option = {
		name = "no_localisation"
		trigger = {
			event_target:StatePropertyBuyOut = {
				check_key = { lhs = BG_Wealth which = Tmp_3 }
				Rights_BGGov4HasGreater = yes
			}
		}
		hidden_effect = {
			event_target:StatePropertyBuyOut = {
				change_key = { lhs = BG_Agriculture which = BuyOutAmount }
				subtract_key = { lhs = BU_Agriculture which = BuyOutAmount }
				
				subtract_key = { lhs = BG_Wealth which = Tmp_3 }
			}
			set_var_from_key = { var = ducat_gain key = Tmp_3 }
			old_scaled_ducat_gained_country = yes

		}
		ai_chance = {
			factor = 100
			modifier = {
				factor = 2.00
				owner = { government = republic }
			}
		}
		
	}
	#Commoners
	option = {
		name = "no_localisation"
		trigger = {
			event_target:StatePropertyBuyOut = {
				check_key = { lhs = SF_Wealth which = Tmp_4 }
			}
			OR = {
				Rights_NOTen4Has = yes
				Rights_NOGov5Has = yes
			}
		}
		hidden_effect = {
			event_target:StatePropertyBuyOut = {
				change_key = { lhs = SF_Agriculture which = BuyOutAmount }
				subtract_key = { lhs = BU_Agriculture which = BuyOutAmount }
				
				subtract_key = { lhs = SF_Wealth which = Tmp_4 }
			}
			set_var_from_key = { var = ducat_gain key = Tmp_4 }
			old_scaled_ducat_gained_country = yes

		}
		ai_chance = {
			factor = 100
			modifier = {
				owner = { num_of_cities = 50 }
				factor = 1.5
			}
			modifier = {
				owner = { num_of_cities = 80 }
				factor = 1.5
			}
		}
		
	}
	#Nobody
	option = {
		name = "no_localisation"
		trigger = {
		}
		hidden_effect = {
			event_target:StatePropertyBuyOut = {
				change_key = { lhs = Prov_BULoy value = 10 }
			}

		}
		ai_chance = {
			factor = 0
		}
		
	}
	after = {
		hidden_effect = {
			set_key = { lhs = Tmp_1 value = 0 }
			set_key = { lhs = Tmp_2 value = 0 }
			set_key = { lhs = Tmp_3 value = 0 }
			set_key = { lhs = Tmp_4 value = 0 }
		}
	}
}
