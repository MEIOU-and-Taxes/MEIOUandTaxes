namespace = SYS_StateProperty

### Concept for Estates Acquiring State Property
# If Capacity is overburdened, prov will be found where we can sell to local powerbroker


country_event = {
	id = SYS_StateProperty.001
	title = "no_localisation"
	desc = "no_localisation"
	picture = CITY_DEVELOPMENT_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_country_flag = StatePropertyBurden
	}
	
	immediate = {
		#find a province
			random_owned_province = {
				limit = {
					check_key = { lhs = BU_Agriculture value = 15 }
				}
				save_event_target_as = StatePropertyBuyOut
				
				set_key = { lhs = BuyOutAmount which = BU_Agriculture }
				multiply_key = { lhs = BuyOutAmount value = 0.75 }
					
				set_key = { lhs = BuyOutValue which = Building_AgricultureGross } # take profits of that property
				divide_key = { lhs = BuyOutValue which = Building_Agriculture } # divide profits with size of that property
				multiply_key = { lhs = BuyOutValue value = 10 } # 10 years projected profits
				multiply_key = { lhs = BuyOutValue which = BuyOutAmount } # projected profits x amount to be sold
				
				ROOT = { set_key = { lhs = BuyOutValue which = PREV } }
			}
			
	}
	#Nobility
	option = {
		name = "no_localisation"
		trigger = {
			event_target:StatePropertyBuyOut = {
				check_key = { lhs = NO_Wealth which = BuyOutValue }
			}
		}
		hidden_effect = {
			event_target:StatePropertyBuyOut = {
				set_key = { lhs = Tmp_1 value = 1 }
				multiply_key = { lhs = Tmp_1 which = Prov_NOLoy } # 0 to 100
				change_key = { lhs = Tmp_1 value = 1 } #make sure they offer nonzero
				multiply_key = { lhs = Tmp_1 value = 0.01 } # 1 to 101 -> 0.01 to 1.01
				multiply_key = { lhs = Tmp_1 which = BuyOutValue } # Factor x Value
				
				change_key = { lhs = NO_Agriculture which = BuyOutAmount }
				subtract_key = { lhs = BU_Agriculture which = BuyOutAmount }
				
				subtract_key = { lhs = NO_Wealth which = Tmp_1 }
			}
			set_var_from_key = { var = ducat_gain key = Tmp_1 }
			old_scaled_ducat_gained_country = yes

		}
		ai_chance = {
			factor = 100
			modifier = {
				factor = 2.00
				owner = { government = monarchy }
			}
		}
		
	}
	#Clergy
	option = {
		name = "no_localisation"
		trigger = {
			event_target:StatePropertyBuyOut = {
				check_key = { lhs = CL_Wealth which = BuyOutValue }
			}
		}
		hidden_effect = {
			event_target:StatePropertyBuyOut = {
				set_key = { lhs = Tmp_2 value = 1 }
				multiply_key = { lhs = Tmp_2 which = Prov_CLLoy } # 0 to 100
				change_key = { lhs = Tmp_2 value = 1 } #make sure they offer nonzero
				multiply_key = { lhs = Tmp_2 value = 0.01 } # 1 to 101 -> 0.01 to 1.01
				multiply_key = { lhs = Tmp_2 which = BuyOutValue } # Factor x Value
				
				change_key = { lhs = CL_Agriculture which = BuyOutAmount }
				subtract_key = { lhs = BU_Agriculture which = BuyOutAmount }
				
				subtract_key = { lhs = CL_Wealth which = Tmp_2 }
			}
			set_var_from_key = { var = ducat_gain key = Tmp_2 }
			old_scaled_ducat_gained_country = yes

		}
		ai_chance = {
			factor = 100
			modifier = {
				factor = 2.00
				owner = { government = theocracy }
			}
		}
		
	}
	#Burgher
	option = {
		name = "no_localisation"
		trigger = {
			event_target:StatePropertyBuyOut = {
				check_key = { lhs = BG_Wealth which = BuyOutValue }
				Rights_BGGov4HasGreater = yes
			}
		}
		hidden_effect = {
			event_target:StatePropertyBuyOut = {
				set_key = { lhs = Tmp_3 value = 1 }
				multiply_key = { lhs = Tmp_3 which = Prov_BGLoy } # 0 to 100
				change_key = { lhs = Tmp_3 value = 1 } #make sure they offer nonzero
				multiply_key = { lhs = Tmp_3 value = 0.01 } # 1 to 101 -> 0.01 to 1.01
				multiply_key = { lhs = Tmp_3 which = BuyOutValue } # Factor x Value
				
				change_key = { lhs = BG_Agriculture which = BuyOutAmount }
				subtract_key = { lhs = BU_Agriculture which = BuyOutAmount }
				
				subtract_key = { lhs = BG_Wealth which = Tmp_3 }
			}
			set_var_from_key = { var = ducat_gain key = Tmp_3 }
			old_scaled_ducat_gained_country = yes

		}
		ai_chance = {
			factor = 100
			modifier = {
				factor = 2.00
				owner = { government = republic }
			}
		}
		
	}
	#Commoners
	option = {
		name = "no_localisation"
		trigger = {
			event_target:StatePropertyBuyOut = {
				check_key = { lhs = SF_Wealth which = BuyOutValue }
			}
			OR = {
				Rights_NOTen4Has = yes
				Rights_NOGov5Has = yes
			}
		}
		hidden_effect = {
			event_target:StatePropertyBuyOut = {
				set_key = { lhs = Tmp_4 value = 0.65 } #Commoners always offer 65% for now
				multiply_key = { lhs = Tmp_4 which = BuyOutValue } # Factor x Value
				
				change_key = { lhs = SF_Agriculture which = BuyOutAmount }
				subtract_key = { lhs = BU_Agriculture which = BuyOutAmount }
				
				subtract_key = { lhs = SF_Wealth which = Tmp_4 }
			}
			set_var_from_key = { var = ducat_gain key = Tmp_4 }
			old_scaled_ducat_gained_country = yes

		}
		ai_chance = {
			factor = 100
			modifier = {
				owner = { num_of_cities = 50 }
				factor = 1.5
			}
			modifier = {
				owner = { num_of_cities = 80 }
				factor = 1.5
			}
		}
		
	}
	#Commoners
	option = {
		name = "no_localisation"
		trigger = {
		}
		hidden_effect = {
			event_target:StatePropertyBuyOut = {
				change_key = { lhs = Prov_BULoy value = 20 }
			}

		}
		ai_chance = {
			factor = 0
		}
		
	}
	after = {
		hidden_effect = {
			set_key = { lhs = Tmp_1 value = 0 }
			set_key = { lhs = Tmp_2 value = 0 }
			set_key = { lhs = Tmp_3 value = 0 }
			set_key = { lhs = Tmp_4 value = 0 }
		}
	}
}
