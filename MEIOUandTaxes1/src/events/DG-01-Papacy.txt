namespace = DG_Papacy

#001-100: Papacy maintenance
#101-200: Papal Election
#201-   : Western Schism
#901-999: Miscellaneous

#Councils
# Constance
# Basel/Florence
# Lateran
# Trent

### PAPACY MAINTENANCE ###

### DEATH OF CARDINALS
country_event = {
	id = DG_Papacy.001
	title = "DG_Papacy.001.title"
	desc = "DG_Papacy.001.desc"
	picture = catholic_college_of_cardinals
	
	is_triggered_only = yes #on_monthly pulse_system
	
	hidden = yes

	immediate = {
		hidden_effect = {
			every_province = {
				limit = {
					isValidProv = yes
					OR = {
						religion = catholic
						religion = avignonist
					}
					has_cardinal = yes
				}
				# Script to distribute tri-annual firing of cardinal death, while removing it off MTTH
				set_province_flag = AI_Pulse
				AAA = {
					trigger_switch = {
						on_trigger = has_country_flag
						triannual1 = {
							PREV = { 
								if = {
									limit = {
										check_key = { lhs = ID_Prov value = 3200 }
									}
									clr_province_flag = AI_Pulse
								}
							}
						}
						triannual2 = {
							PREV = { 
								if = {
									limit = {
										NOT = { check_key = { lhs = ID_Prov value = 3200 } }
										check_key = { lhs = ID_Prov value = 1400 }
									}
									clr_province_flag = AI_Pulse
								}
							}
						}
						triannual3 = {
							PREV = { 
								if = {
									limit = {
										NOT = { check_key = { lhs = ID_Prov value = 1400 } }
									}
									clr_province_flag = AI_Pulse
								}
							}
						}
					}
				}
                if = {
                    limit = {
						NOT = {
							has_province_flag = AI_Pulse
						}
                    }
					if = {
						limit = { religion = catholic }
						Calc_Pap_Auth = { scope = PAP }
					}
					else_if = {
						limit = { religion = avignonist }
						Calc_Pap_Auth = { scope = AVI }
					}
					#log = "DG - Cardinal dies"
					if = {		#Make sure PAP and AVI always have at least one Cardinal
						limit = {
							OR = { owned_by = PAP owned_by = AVI check_key = { lhs = MN_Cardinal value = 50 } }
						}
						AddCardinal = yes
						#log = "DG - DG replaced (province)"
					}
					else = {
						RemoveCardinal = yes
						if = {		#Replace him
							limit = {
								owner = { check_key = { lhs = MN_Cardinal value = 50 } }
								check_key = { lhs = MN_Cardinal value = 50 }
							}
							AddCardinal = yes
						}
						else_if = {		#Move Cardinal to another province 
							limit = {
								owner = { check_key = { lhs = MN_Cardinal value = 50 } }
							}
							owner = {
								random_owned_province = {
									limit = {
										check_key = { lhs = MN_Cardinal value = 50 }
									}
									AddCardinal = yes
								}
							}
						}
						else_if = {		#Move cardinal to another country
							limit = {
								owner = {
									any_known_country = {
										check_key = { lhs = MN_Cardinal value = 50 }
									}
								}	
							}
							owner = {
								random_known_country = {
									limit = {
										religion = PREV
										check_key = { lhs = MN_Cardinal value = 50 }
									}
									random_owned_province = {
										limit = {
											check_key = { lhs = MN_Cardinal value = 50 }
										}
										AddCardinal = yes 
									}
								}
							}	
						}
					}
				}
			}
			random_list = {		#Chance to increase the amount of Cardinals; Won't go over limit set in AddCardinal Scripted_effect
				75 = {
					random_country = {
						limit = {
							OR = {
								religion = catholic
								religion = avignonist
							}
							check_key = { lhs = MN_Cardinal value = 50 }
						}
						random_owned_province = {
							limit = {
								religion = PREV
								check_key = { lhs = MN_Cardinal value = 50 }
							}
							AddCardinal = yes
						}
					}
				}
				25 = { 
				}
			}
		}
	}

	option = {
		name = "DG_Papacy.001.opta"
	}
}

### PAPAL ELECTION ###

### DEATH OF THE POPE
country_event = {
	id = DG_Papacy.101
	title = "no_localisation"
	desc = "no_localisation"
	picture = catholic_college_of_cardinals
	is_triggered_only = yes #on_actions on_monarch_death
	#hidden = yes
	
	trigger = {
		NOT = { has_global_flag = DG_Western_Schism_Start }
		NOT = { has_country_flag = Conclave_Underway }
		NOT = { has_regency = yes }
		OR = {
			AND = {
				tag = PAP
				religion = catholic
				has_global_flag = DG_Live_Pope_in_Rome
				#had_global_flag = { flag = DG_Live_Pope_in_Rome days = 1095 } #Ahistorical, but prevents players from reporting bugs
			}
			AND = {
				tag = AVI
				religion = avignonist
				has_global_flag = DG_Live_Pope_in_Avignon
				#had_global_flag = { flag = DG_Live_Pope_in_Avignon days = 1095 } #Ahistorical, but prevents players from reporting bugs
			}
		}
	}
	
	# Average length of papal reign is a mere 7 years - EU4 monarch lifespans do not model popes well
	# Set to 5 years to offset 3 guaranteed years, to still get an average of 7


	immediate = {
		hidden_effect = {
			set_country_flag = Conclave_Underway
			clr_country_flag = Pious_Pope
			clr_country_flag = Secular_Pope
			clr_country_flag = Corrupt_Pope
			clr_country_flag = accepted_graft
			clr_country_flag = refused_graft
			papal_corruption_se = yes
			if = {
				limit = { tag = PAP }
				clr_global_flag = DG_Live_Pope_in_Rome
				Calc_Pap_Auth = { scope = PAP }
			}
			else_if = {
				limit = { tag = AVI }
				clr_global_flag = DG_Live_Pope_in_Avignon
				Calc_Pap_Auth = { scope = AVI }
			}
		}
		define_ruler = {
			regency = yes
			name = "(Papal Conclave)"
			#fixed = yes
			ADM = 2
			DIP = 2
			MIL = 1
		}
		log = "DG - Start of the Conclave"
		hidden_effect = {
			random_province = {
				limit = { superregion = italy_superregion has_cardinal = yes religion = ROOT }
				save_global_event_target_as = preferiti_1
				ROOT = {
					random_list = {
						25 = { set_country_flag = preferiti_1_pious }
						25 = { set_country_flag = preferiti_1_secular }
						50 = { set_country_flag = preferiti_1_corrupt }
					}
				}
			}
			random_province = {
				limit = { superregion = france_superregion has_cardinal = yes religion = ROOT }
				save_global_event_target_as = preferiti_2
				ROOT = {
					random_list = {
						25 = { set_country_flag = preferiti_2_pious }
						25 = { set_country_flag = preferiti_2_secular }
						50 = { set_country_flag = preferiti_2_corrupt }
					}
				}
			}
			random_province = {
				limit = { OR = { superregion = germany_superregion superregion = greater_austrian_circle_superregion } has_cardinal = yes religion = ROOT }
				save_global_event_target_as = preferiti_3
				ROOT = {
					random_list = {
						25 = { set_country_flag = preferiti_3_pious }
						25 = { set_country_flag = preferiti_3_secular }
						50 = { set_country_flag = preferiti_3_corrupt }
					}
				}
			}
			random_province = {
				limit = { superregion = iberia_superregion has_cardinal = yes religion = ROOT }
				save_global_event_target_as = preferiti_4
				ROOT = {
					random_list = {
						25 = { set_country_flag = preferiti_4_pious }
						25 = { set_country_flag = preferiti_4_secular }
						50 = { set_country_flag = preferiti_4_corrupt }
					}
				}
			}
		}
	}
	
	option = {
		name = "DG_Papacy.101.opta"
		if = {
			limit = {
				OR = {
					FRA = { is_papal_controller = no is_previous_papal_controller = yes }
					PAP = { is_papal_controller = yes }
				}
				has_global_flag = DG_Babylonian_Captivity_Ends
				NOT = { has_ruler_flag = Captivity_Ending_Pope }
				has_country_flag = Divided_Conclave
				NOT = { 
					OR = {
						has_global_flag = DG_Western_Schism_Mended
						has_global_flag = DG_Western_Schism_Defeated
						has_global_flag = DG_Western_Schism_Abdication
					}
				}
			}
			hidden_effect = { PAP = { set_ruler_flag = Divided_Conclave_Pope country_event = { id = DG_Papacy.200 days = 5 } } }
		}
		else = {
			#If holds Papacy captive, be Papal Controller
			if = {
				limit = {
					is_subject_other_than_tributary_trigger = yes
				}
				overlord = {
					country_event = { id = DG_Papacy.122 days = 5 }
				}
			}
			#Else, regular elections
			else = {
				every_known_country = {
					limit = {
						religion = ROOT 
						num_of_cardinals = 1
						is_excommunicated = no
					}
					country_event = { id = DG_Papacy.103 days = 15 random = 3 }
				}
				country_event = { id = DG_Papacy.106 days = 150 }
			}
			every_country = {
				limit = { religion = ROOT ai = no has_country_flag = papacy_notification }
				country_event = { id = DG_Papacy.102 days = 4 }
			}
		}
	}
}

### DEATH OF THE POPE (NOTIFICATION)
country_event = {
	id = DG_Papacy.102
	title = "DG_Papacy.102.title"
	desc = "DG_Papacy.102.desc"
	picture = catholic_habemus_papam

	is_triggered_only = yes #from DG_Papacy.101
	
	option = {
		name = "DG_Papacy.102.opta"
	}
}

### CONCLAVE UNDERWAY - VOTE
country_event = {
	id = DG_Papacy.103
	title = "DG_Papacy.103.title"
	desc = "DG_Papacy.103.desc"
	picture = catholic_habemus_papam

	is_triggered_only = yes #from DG_Papacy.101
	
	# immediate = {
	# 	hidden_effect = {
	# 		NumOfCardinals = yes
	# 	}
	# }
	
#	option = {
#		name = "DG_Papacy.103.opta" #Vote for a Pious Pope
#		trigger = { FROM = { OR = { has_country_flag = preferiti_1_pious has_country_flag = preferiti_1_secular has_country_flag = preferiti_2_pious has_country_flag = preferiti_2_secular has_country_flag = preferiti_3_pious has_country_flag = preferiti_3_secular has_country_flag = preferiti_4_pious has_country_flag = preferiti_4_secular } } }
#		hidden_effect = { country_event = { id = DG_Papacy.104 } }
#	}
#	option = {
#		name = "DG_Papacy.103.optb" #Buy the Pope
#		trigger = { FROM = { OR = { has_country_flag = preferiti_1_corrupt has_country_flag = preferiti_2_corrupt has_country_flag = preferiti_3_corrupt has_country_flag = preferiti_4_corrupt } } }
#		hidden_effect = { country_event = { id = DG_Papacy.105 } }
#	}
	option = {
		name = "DG_Papacy.103.optc" #Vote for Italian Cardinal
		hidden_effect = {
			CastingBallot = { Ballot = 1 }
			set_country_flag = vote_pope_1
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				event_target:preferiti_1 = {
					culture_group = ROOT
				}
			}
			modifier = {
				factor = 3
				event_target:preferiti_1 = {
					culture = ROOT
				}
			}
			modifier = {
				factor = 3
				event_target:preferiti_1 = {
					owner = {
						alliance_with = ROOT
					}
				}
			}
			modifier = {
				factor = 0.1
				event_target:preferiti_1 = {
					owner = {
						is_rival = ROOT
					}
				}
			}
			modifier = {
				factor = 10
				event_target:preferiti_1 = {
					owned_by = ROOT
				}
			}
			modifier = {
				factor = 0
				event_target:preferiti_1 = {
					owner = {
						war_with = ROOT
					}
				}
			}
			modifier = {
				factor = 3
				event_target:preferiti_1 = {
					owner = {
						is_subject_of = ROOT
					}
				}
			}
			modifier = {
				factor = 3
				event_target:preferiti_1 = {
					owner = {
						overlord_of = ROOT
					}
				}
			}
		}
	}
	option = {
		name = "DG_Papacy.103.optd" #Vote for French Cardinal
		hidden_effect = {
			CastingBallot = { Ballot = 2 }
			set_country_flag = vote_pope_2
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				event_target:preferiti_2 = {
					culture_group = ROOT
				}
			}
			modifier = {
				factor = 3
				event_target:preferiti_2 = {
					culture = ROOT
				}
			}
			modifier = {
				factor = 3
				event_target:preferiti_2 = {
					owner = {
						alliance_with = ROOT
					}
				}
			}
			modifier = {
				factor = 0.1
				event_target:preferiti_2 = {
					owner = {
						is_rival = ROOT
					}
				}
			}
			modifier = {
				factor = 10
				event_target:preferiti_2 = {
					owned_by = ROOT
				}
			}
			modifier = {
				factor = 0
				event_target:preferiti_2 = {
					owner = {
						war_with = ROOT
					}
				}
			}
			modifier = {
				factor = 3
				event_target:preferiti_2 = {
					owner = {
						is_subject_of = ROOT
					}
				}
			}
			modifier = {
				factor = 3
				event_target:preferiti_2 = {
					owner = {
						overlord_of = ROOT
					}
				}
			}
		}
	}
	option = {
		name = "DG_Papacy.103.opte" #Vote for Imperial Cardinal
		hidden_effect = {
			CastingBallot = { Ballot = 3 }
			set_country_flag = vote_pope_3
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				event_target:preferiti_3 = {
					culture_group = ROOT
				}
			}
			modifier = {
				factor = 3
				event_target:preferiti_3 = {
					culture = ROOT
				}
			}
			modifier = {
				factor = 3
				event_target:preferiti_3 = {
					owner = {
						alliance_with = ROOT
					}
				}
			}
			modifier = {
				factor = 0.1
				event_target:preferiti_3 = {
					owner = {
						is_rival = ROOT
					}
				}
			}
			modifier = {
				factor = 10
				event_target:preferiti_3 = {
					owned_by = ROOT
				}
			}
			modifier = {
				factor = 0
				event_target:preferiti_3 = {
					owner = {
						war_with = ROOT
					}
				}
			}
			modifier = {
				factor = 3
				event_target:preferiti_3 = {
					owner = {
						is_subject_of = ROOT
					}
				}
			}
			modifier = {
				factor = 3
				event_target:preferiti_3 = {
					owner = {
						overlord_of = ROOT
					}
				}
			}
		}
	}
	option = {
		name = "DG_Papacy.103.optf" #Vote for another Cardinal
		hidden_effect = {
			CastingBallot = { Ballot = 4 }
			set_country_flag = vote_pope_4
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				event_target:preferiti_4 = {
					culture_group = ROOT
				}
			}
			modifier = {
				factor = 3
				event_target:preferiti_4 = {
					culture = ROOT
				}
			}
			modifier = {
				factor = 3
				event_target:preferiti_4 = {
					owner = {
						alliance_with = ROOT
					}
				}
			}
			modifier = {
				factor = 0.1
				event_target:preferiti_4 = {
					owner = {
						is_rival = ROOT
					}
				}
			}
			modifier = {
				factor = 10
				event_target:preferiti_4 = {
					owned_by = ROOT
				}
			}
			modifier = {
				factor = 0
				event_target:preferiti_4 = {
					owner = {
						war_with = ROOT
					}
				}
			}
			modifier = {
				factor = 3
				event_target:preferiti_4 = {
					owner = {
						is_subject_of = ROOT
					}
				}
			}
			modifier = {
				factor = 3
				event_target:preferiti_4 = {
					owner = {
						overlord_of = ROOT
					}
				}
			}
		}
	}
}

### CONCLAVE UNDERWAY - VOTE INCONCLISE
country_event = {
	id = DG_Papacy.1033
	title = "DG_Papacy.1033.title"
	desc = "DG_Papacy.1033.desc"
	picture = catholic_habemus_papam

	is_triggered_only = yes #from DG_Papacy.106

	option = {
		name = "DG_Papacy.103.optc" #Vote for Italian Cardinal
		hidden_effect = {
			CastingBallot = { Ballot = 1 }
			set_country_flag = vote_pope_1
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				event_target:preferiti_1 = {
					culture_group = ROOT
				}
			}
			modifier = {
				factor = 3
				event_target:preferiti_1 = {
					culture = ROOT
				}
			}
			modifier = {
				factor = 3
				event_target:preferiti_1 = {
					owner = {
						alliance_with = ROOT
					}
				}
			}
			modifier = {
				factor = 0.1
				event_target:preferiti_1 = {
					owner = {
						is_rival = ROOT
					}
				}
			}
			modifier = {
				factor = 10
				event_target:preferiti_1 = {
					owned_by = ROOT
				}
			}
			modifier = {
				factor = 0
				event_target:preferiti_1 = {
					owner = {
						war_with = ROOT
					}
				}
			}
			modifier = {
				factor = 3
				event_target:preferiti_1 = {
					owner = {
						is_subject_of = ROOT
					}
				}
			}
			modifier = {
				factor = 3
				event_target:preferiti_1 = {
					owner = {
						overlord_of = ROOT
					}
				}
			}
		}
	}
	option = {
		name = "DG_Papacy.103.optd" #Vote for French Cardinal
		hidden_effect = {
			CastingBallot = { Ballot = 2 }
			set_country_flag = vote_pope_2
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				event_target:preferiti_2 = {
					culture_group = ROOT
				}
			}
			modifier = {
				factor = 3
				event_target:preferiti_2 = {
					culture = ROOT
				}
			}
			modifier = {
				factor = 3
				event_target:preferiti_2 = {
					owner = {
						alliance_with = ROOT
					}
				}
			}
			modifier = {
				factor = 0.1
				event_target:preferiti_2 = {
					owner = {
						is_rival = ROOT
					}
				}
			}
			modifier = {
				factor = 10
				event_target:preferiti_2 = {
					owned_by = ROOT
				}
			}
			modifier = {
				factor = 0
				event_target:preferiti_2 = {
					owner = {
						war_with = ROOT
					}
				}
			}
			modifier = {
				factor = 3
				event_target:preferiti_2 = {
					owner = {
						is_subject_of = ROOT
					}
				}
			}
			modifier = {
				factor = 3
				event_target:preferiti_2 = {
					owner = {
						overlord_of = ROOT
					}
				}
			}
		}
	}
	option = {
		name = "DG_Papacy.103.opte" #Vote for Imperial Cardinal
		hidden_effect = {
			CastingBallot = { Ballot = 3 }
			set_country_flag = vote_pope_3
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				event_target:preferiti_3 = {
					culture_group = ROOT
				}
			}
			modifier = {
				factor = 3
				event_target:preferiti_3 = {
					culture = ROOT
				}
			}
			modifier = {
				factor = 3
				event_target:preferiti_3 = {
					owner = {
						alliance_with = ROOT
					}
				}
			}
			modifier = {
				factor = 0.1
				event_target:preferiti_3 = {
					owner = {
						is_rival = ROOT
					}
				}
			}
			modifier = {
				factor = 10
				event_target:preferiti_3 = {
					owned_by = ROOT
				}
			}
			modifier = {
				factor = 0
				event_target:preferiti_3 = {
					owner = {
						war_with = ROOT
					}
				}
			}
			modifier = {
				factor = 3
				event_target:preferiti_3 = {
					owner = {
						is_subject_of = ROOT
					}
				}
			}
			modifier = {
				factor = 3
				event_target:preferiti_3 = {
					owner = {
						overlord_of = ROOT
					}
				}
			}
		}
	}
	option = {
		name = "DG_Papacy.103.optf" #Vote for another Cardinal
		hidden_effect = {
			CastingBallot = { Ballot = 4 }
			set_country_flag = vote_pope_4
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				event_target:preferiti_4 = {
					culture_group = ROOT
				}
			}
			modifier = {
				factor = 3
				event_target:preferiti_4 = {
					culture = ROOT
				}
			}
			modifier = {
				factor = 3
				event_target:preferiti_4 = {
					owner = {
						alliance_with = ROOT
					}
				}
			}
			modifier = {
				factor = 0.1
				event_target:preferiti_4 = {
					owner = {
						is_rival = ROOT
					}
				}
			}
			modifier = {
				factor = 10
				event_target:preferiti_4 = {
					owned_by = ROOT
				}
			}
			modifier = {
				factor = 0
				event_target:preferiti_4 = {
					owner = {
						war_with = ROOT
					}
				}
			}
			modifier = {
				factor = 3
				event_target:preferiti_4 = {
					owner = {
						is_subject_of = ROOT
					}
				}
			}
			modifier = {
				factor = 3
				event_target:preferiti_4 = {
					owner = {
						overlord_of = ROOT
					}
				}
			}
		}
	}
}

country_event = {
	id = DG_Papacy.104
	title = "DG_Papacy.104.title"
	desc = "DG_Papacy.104.desc"
	picture = catholic_habemus_papam

	is_triggered_only = yes
	
	option = {
		name = "DG_Papacy.104.opta" #Vote for Italian Cardinal
		trigger = { PAP = { OR = { has_country_flag = preferiti_1_pious has_country_flag = preferiti_1_secular } } }
		hidden_effect = {
			CastingBallot = { Ballot = 1 }
			set_country_flag = vote_pope_1
			if = {
				limit = { OR = { tag = MLO tag = FIR tag = KNP } }
				PAP = { set_variable = { which = italian_vote value = 1 } }
			}
			else_if = {
				limit = { tag = FRA }
				PAP = { set_variable = { which = french_vote value = 1 } }
			}
			else_if = {
				limit = { is_emperor = yes }
				PAP = { set_variable = { which = imperial_vote value = 1 } }
			}
		}
	}
	option = {
		name = "DG_Papacy.104.optb" #Vote for French Cardinal
		trigger = { PAP = { OR = { has_country_flag = preferiti_2_pious has_country_flag = preferiti_2_secular } } }
		hidden_effect = {
			CastingBallot = { Ballot = 2 }
			set_country_flag = vote_pope_2
			if = {
				limit = { OR = { tag = MLO tag = FIR tag = KNP } }
				PAP = { set_variable = { which = italian_vote value = 2 } }
			}
			else_if = {
				limit = { tag = FRA }
				PAP = { set_variable = { which = french_vote value = 2 } }
			}
			else_if = {
				limit = { is_emperor = yes }
				PAP = { set_variable = { which = imperial_vote value = 2 } }
			}
		}
	}
	option = {
		name = "DG_Papacy.104.optc" #Vote for Imperial Cardinal
		trigger = { PAP = { OR = { has_country_flag = preferiti_3_pious has_country_flag = preferiti_3_secular } } }
		hidden_effect = {
			CastingBallot = { Ballot = 3 }
			set_country_flag = vote_pope_3
			if = {
				limit = { OR = { tag = MLO tag = FIR tag = KNP } }
				PAP = { set_variable = { which = italian_vote value = 3 } }
			}
			else_if = {
				limit = { tag = FRA }
				PAP = { set_variable = { which = french_vote value = 3 } }
			}
			else_if = {
				limit = { is_emperor = yes }
				PAP = { set_variable = { which = imperial_vote value = 3 } }
			}
		}
	}
	option = {
		name = "DG_Papacy.104.optd" #Vote for Iberian Cardinal
		trigger = { PAP = { OR = { has_country_flag = preferiti_4_pious has_country_flag = preferiti_4_secular } } }
		hidden_effect = {
			CastingBallot = { Ballot = 4 }
			set_country_flag = vote_pope_4
			if = {
				limit = { OR = { tag = MLO tag = FIR tag = KNP } }
				PAP = { set_variable = { which = italian_vote value = 4 } }
			}
			else_if = {
				limit = { tag = FRA }
				PAP = { set_variable = { which = french_vote value = 4 } }
			}
			else_if = {
				limit = { is_emperor = yes }
				PAP = { set_variable = { which = imperial_vote value = 4 } }
			}
		}
	}
}

country_event = {
	id = DG_Papacy.105
	title = "DG_Papacy.105.title"
	desc = "DG_Papacy.105.desc"
	picture = catholic_habemus_papam

	is_triggered_only = yes
	
	option = {
		name = "DG_Papacy.105.opta" #Vote for Italian Cardinal
		trigger = { PAP = { has_country_flag = preferiti_1_corrupt } }
		hidden_effect = {
			CastingBallot = { Ballot = 1 }
			set_country_flag = buy_pope_1
			if = {
				limit = { OR = { tag = MLO tag = FIR tag = KNP } }
				PAP = { set_variable = { which = italian_vote value = 1 } }
			}
			else_if = {
				limit = { tag = FRA }
				PAP = { set_variable = { which = french_vote value = 1 } }
			}
			else_if = {
				limit = { is_emperor = yes }
				PAP = { set_variable = { which = imperial_vote value = 1 } }
			}
		}
	}
	option = {
		name = "DG_Papacy.105.optb" #Vote for French Cardinal
		trigger = { PAP = { has_country_flag = preferiti_2_corrupt } }
		hidden_effect = {
			CastingBallot = { Ballot = 2 }
			set_country_flag = buy_pope_2
			if = {
				limit = { OR = { tag = MLO tag = FIR tag = KNP } }
				PAP = { set_variable = { which = italian_vote value = 2 } }
			}
			else_if = {
				limit = { tag = FRA }
				PAP = { set_variable = { which = french_vote value = 2 } }
			}
			else_if = {
				limit = { is_emperor = yes }
				PAP = { set_variable = { which = imperial_vote value = 2 } }
			}
		}
	}
	option = {
		name = "DG_Papacy.105.optc" #Vote for Imperial Cardinal
		trigger = { PAP = { has_country_flag = preferiti_3_corrupt } }
		hidden_effect = {
			CastingBallot = { Ballot = 3 }
			set_country_flag = buy_pope_3
			if = {
				limit = { OR = { tag = MLO tag = FIR tag = KNP } }
				PAP = { set_variable = { which = italian_vote value = 3 } }
			}
			else_if = {
				limit = { tag = FRA }
				PAP = { set_variable = { which = french_vote value = 3 } }
			}
			else_if = {
				limit = { is_emperor = yes }
				PAP = { set_variable = { which = imperial_vote value = 3 } }
			}
		}
	}
	option = {
		name = "DG_Papacy.105.optd" #Vote for Iberian Cardinal
		trigger = { PAP = { has_country_flag = preferiti_4_corrupt } }
		hidden_effect = {
			CastingBallot = { Ballot = 4 }
			set_country_flag = buy_pope_4
			if = {
				limit = { OR = { tag = MLO tag = FIR tag = KNP } }
				PAP = { set_variable = { which = italian_vote value = 4 } }
			}
			else_if = {
				limit = { tag = FRA }
				PAP = { set_variable = { which = french_vote value = 4 } }
			}
			else_if = {
				limit = { is_emperor = yes }
				PAP = { set_variable = { which = imperial_vote value = 4 } }
			}
		}
	}
}

#Conclave Underway - Counting the Ballots
country_event = {
	id = DG_Papacy.106
	title = "AI_Event"
	desc = "AI_Event"
	picture = catholic_habemus_papam
	
	hidden = yes
	is_triggered_only = yes
	
	immediate = {
		clr_country_flag = Inconclusive_Vote
		hidden_effect = {
			ConclaveVotes = yes
		}
	}
	
	option = {
		name = "AI_Event" #An Italian Pope
		trigger = { is_key_equal = { lhs = VoteCountW value = 1 } }
		hidden_effect = {
			clr_country_flag = preferiti_2_pious
			clr_country_flag = preferiti_2_secular
			clr_country_flag = preferiti_2_corrupt
			clr_country_flag = preferiti_3_pious
			clr_country_flag = preferiti_3_secular
			clr_country_flag = preferiti_3_corrupt
			clr_country_flag = preferiti_4_pious
			clr_country_flag = preferiti_4_secular
			clr_country_flag = preferiti_4_corrupt
		}
		if = {
			limit = { ROOT = { has_country_flag = preferiti_1_pious } }
			event_target:preferiti_1 = {
				owner = {
					country_event = { id = DG_Papacy.107 days = 5 }
				}
			} 
		}
		else_if = {
			limit = { ROOT = { has_country_flag = preferiti_1_secular } }
			event_target:preferiti_1 = {
				owner = {
					country_event = { id = DG_Papacy.112 days = 5 }
				}
			} 
		}
		else_if = {
			limit = { ROOT = { has_country_flag = preferiti_1_corrupt } }
			event_target:preferiti_1 = {
				owner = {
					country_event = { id = DG_Papacy.120 days = 5 }
				}
			} 
		}
	}
	option = {
		name = "AI_Event" #A French Pope
		trigger = { is_key_equal = { lhs = VoteCountW value = 2 } }
		hidden_effect = {
			clr_country_flag = preferiti_1_pious
			clr_country_flag = preferiti_1_secular
			clr_country_flag = preferiti_1_corrupt
			clr_country_flag = preferiti_3_pious
			clr_country_flag = preferiti_3_secular
			clr_country_flag = preferiti_3_corrupt
			clr_country_flag = preferiti_4_pious
			clr_country_flag = preferiti_4_secular
			clr_country_flag = preferiti_4_corrupt
		}
		if = {
			limit = { ROOT = { has_country_flag = preferiti_2_pious } }
			event_target:preferiti_2 = {
				owner = {
					country_event = { id = DG_Papacy.107 days = 5 }
				}
			} 
		}
		else_if = {
			limit = { ROOT = { has_country_flag = preferiti_2_secular } }
			event_target:preferiti_2 = {
				owner = {
					country_event = { id = DG_Papacy.112 days = 5 }
				}
			} 
		}
		else_if = {
			limit = { ROOT = { has_country_flag = preferiti_2_corrupt } }
			event_target:preferiti_2 = {
				owner = {
					country_event = { id = DG_Papacy.120 days = 5 }
				}
			} 
		}
	}
	option = {
		name = "AI_Event" #A German Pope
		trigger = { is_key_equal = { lhs = VoteCountW value = 3 } }
		hidden_effect = {
			clr_country_flag = preferiti_1_pious
			clr_country_flag = preferiti_1_secular
			clr_country_flag = preferiti_1_corrupt
			clr_country_flag = preferiti_2_pious
			clr_country_flag = preferiti_2_secular
			clr_country_flag = preferiti_2_corrupt
			clr_country_flag = preferiti_4_pious
			clr_country_flag = preferiti_4_secular
			clr_country_flag = preferiti_4_corrupt
		}
		if = {
			limit = { ROOT = { has_country_flag = preferiti_3_pious } }
			event_target:preferiti_3 = {
				owner = {
					country_event = { id = DG_Papacy.107 days = 5 }
				}
			} 
		}
		else_if = {
			limit = { ROOT = { has_country_flag = preferiti_3_secular } }
			event_target:preferiti_3 = {
				owner = {
					country_event = { id = DG_Papacy.112 days = 5 }
				}
			} 
		}
		else_if = {
			limit = { ROOT = { has_country_flag = preferiti_3_corrupt } }
			event_target:preferiti_3 = {
				owner = {
					country_event = { id = DG_Papacy.120 days = 5 }
				}
			} 
		}
	}
	option = {
		name = "AI_Event" #A [preferiti_4.GetCultureName] Pope
		trigger = { is_key_equal = { lhs = VoteCountW value = 4 } }
		hidden_effect = {
			clr_country_flag = preferiti_1_pious
			clr_country_flag = preferiti_1_secular
			clr_country_flag = preferiti_1_corrupt
			clr_country_flag = preferiti_2_pious
			clr_country_flag = preferiti_2_secular
			clr_country_flag = preferiti_2_corrupt
			clr_country_flag = preferiti_3_pious
			clr_country_flag = preferiti_3_secular
			clr_country_flag = preferiti_3_corrupt
		}
		if = {
			limit = { ROOT = { has_country_flag = preferiti_4_pious } }
			event_target:preferiti_4 = {
				owner = {
					country_event = { id = DG_Papacy.107 days = 5 }
				}
			} 
		}
		else_if = {
			limit = { ROOT = { has_country_flag = preferiti_4_secular } }
			event_target:preferiti_4 = {
				owner = {
					country_event = { id = DG_Papacy.112 days = 5 }
				}
			} 
		}
		else_if = {
			limit = { ROOT = { has_country_flag = preferiti_4_corrupt } }
			event_target:preferiti_4 = {
				owner = {
					country_event = { id = DG_Papacy.120 days = 5 }
				}
			} 
		}
	}
	option = {
		name = "AI_Event"
		trigger = {
			has_country_flag = Inconclusive_Vote
		}
		every_known_country = {
			limit = {
				religion = ROOT 
				num_of_cardinals = 1
				is_excommunicated = no
			}
			country_event = { id = DG_Papacy.1033 days = 15 random = 3 }
		}
		hidden_effect = {
			set_key = { lhs = VoteCount1 value = 0 }
			set_key = { lhs = VoteCount2 value = 0 }
			set_key = { lhs = VoteCount3 value = 0 }
			set_key = { lhs = VoteCount4 value = 0 }
			set_key = { lhs = VoteCountT value = 0 }
		}
		country_event = { id = DG_Papacy.106 days = 150 }
	}
}

#Pious Pope
country_event = {
	id = DG_Papacy.107
	title = "DG_Papacy.107.title"
	desc = {
		trigger = {
			religion = catholic
		}
		desc = DG_Papacy.107.desca
	}
	desc = {
		trigger = {
			religion = avignonist
		}
		desc = DG_Papacy.107.descb
	}
	picture = catholic_habemus_papam

	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				FROM = { has_country_flag = preferiti_1_pious }
			}
			FROM = {
				define_ruler = { min_age = 58 }
				transfer_papal_controller = ROOT
				set_ruler_culture = event_target:preferiti_1
				clr_country_flag = preferiti_1_pious
			}
		}
		else_if = {
			limit = { FROM = { has_country_flag = preferiti_2_pious } }
			FROM = {
				define_ruler = { min_age = 58 }
				transfer_papal_controller = ROOT
				set_ruler_culture = event_target:preferiti_2
				clr_country_flag = preferiti_2_pious
			}
		}
		else_if = {
			limit = { FROM = { has_country_flag = preferiti_3_pious } }
			FROM = {
				define_ruler = { min_age = 58 }
				transfer_papal_controller = ROOT
				set_ruler_culture = event_target:preferiti_3
				clr_country_flag = preferiti_3_pious
			}
		}
		else_if = {
			limit = { FROM = { has_country_flag = preferiti_4_pious } }
			FROM = {
				define_ruler = { min_age = 58 }
				transfer_papal_controller = ROOT
				set_ruler_culture = event_target:preferiti_4
				clr_country_flag = preferiti_4_pious
			}
		}
		FROM = {
			clr_country_flag = Deadlocked_Conclave
			set_country_flag = Pious_Pope
			if = {
				limit = {
					tag = PAP
				}
				set_global_flag = DG_Live_Pope_in_Rome
				hidden_effect = {
					Calc_Pap_Auth = { scope = PAP }
					papal_corruption_se = yes
				}
			}
			else_if = {
				limit = {
					tag = AVI
				}
				set_global_flag = DG_Live_Pope_in_Avignon
				hidden_effect = {
					Calc_Pap_Auth = { scope = AVI }
					papal_corruption_se = yes
				}
			}
			log = "DG - Getting new pope - pious"
		}
	}
	
	
	option = {
		name = "OPT.DULYNOTED2"
		every_country = {
			limit = { ai = no religion = ROOT has_country_flag = papacy_notification }
			country_event = { id = DG_Papacy.108 days = 2 }
		}
		add_reform_desire = -0.0001
	}
	after = {
		FROM = { country_event = { id = DG_Papacy.109 days = 10 } }
	}
}

country_event = {
	id = DG_Papacy.108
	title = "DG_Papacy.107.title"
	desc = {
		trigger = {
			religion = catholic
		}
		desc = DG_Papacy.107.desca
	}
	desc = {
		trigger = {
			religion = avignonist
		}
		desc = DG_Papacy.107.descb
	}
	picture = catholic_habemus_papam

	is_triggered_only = yes
	
	immediate = {
	}
	
	option = {
		name = "OPT.DULYNOTED2"
	}
}

#Cleanup of flags, post-conclave
country_event = {
	id = DG_Papacy.109
	title = "AI_Event"
	desc = "AI_Event"
	picture = catholic_college_of_cardinals

	hidden = yes
	is_triggered_only = yes
	
	option = {
		name = "AI_Event"
		clr_country_flag = Conclave_Underway
		clear_global_event_target = preferiti_1
		clear_global_event_target = preferiti_2
		clear_global_event_target = preferiti_3
		clear_global_event_target = preferiti_4
		set_key = { lhs = VoteCount1 value = 0 }
		set_key = { lhs = VoteCount2 value = 0 }
		set_key = { lhs = VoteCount3 value = 0 }
		set_key = { lhs = VoteCount4 value = 0 }
		set_key = { lhs = VoteCountW value = 0 }
		set_key = { lhs = VoteCountT value = 0 }
		every_country = {
			limit = { religion = ROOT }
			clr_country_flag = buy_pope_1
			clr_country_flag = vote_pope_1
			clr_country_flag = buy_pope_2
			clr_country_flag = vote_pope_2
			clr_country_flag = buy_pope_3
			clr_country_flag = vote_pope_3
			clr_country_flag = buy_pope_4
			clr_country_flag = vote_pope_4
		}
	}
}

#Among those who voted for the future pope, the nation with the greater number of cardinals
country_event = {
	id = DG_Papacy.110
	title = "AI_Event"
	desc = "AI_Event"
	picture = catholic_college_of_cardinals

	hidden = yes
	is_triggered_only = yes
	
	option = {
		name = "AI_Event"
		trigger = { PAP = { has_country_flag = preferiti_1_secular } }
		if = {
			limit = { any_country = { has_country_flag = vote_pope_1 num_of_cardinals = 8 } }
			random_country = { limit = { has_country_flag = vote_pope_1 num_of_cardinals = 8 } country_event = { id = DG_Papacy.111 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = vote_pope_1 num_of_cardinals = 6 } }
			random_country = { limit = { has_country_flag = vote_pope_1 num_of_cardinals = 6 } country_event = { id = DG_Papacy.111 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = vote_pope_1 num_of_cardinals = 4 } }
			random_country = { limit = { has_country_flag = vote_pope_1 num_of_cardinals = 4 } country_event = { id = DG_Papacy.111 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = vote_pope_1 num_of_cardinals = 2 } }
			random_country = { limit = { has_country_flag = vote_pope_1 num_of_cardinals = 2 } country_event = { id = DG_Papacy.111 days = 5 } }
		}
		else = {
			PAP = { country_event = { id = DG_Papacy.112 days = 5 } }
		}
	}
	option = {
		name = "AI_Event"
		trigger = { PAP = { has_country_flag = preferiti_2_secular } }
		if = {
			limit = { any_country = { has_country_flag = vote_pope_2 num_of_cardinals = 8 } }
			random_country = { limit = { has_country_flag = vote_pope_2 num_of_cardinals = 8 } country_event = { id = DG_Papacy.111 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = vote_pope_2 num_of_cardinals = 6 } }
			random_country = { limit = { has_country_flag = vote_pope_2 num_of_cardinals = 6 } country_event = { id = DG_Papacy.111 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = vote_pope_2 num_of_cardinals = 4 } }
			random_country = { limit = { has_country_flag = vote_pope_2 num_of_cardinals = 4 } country_event = { id = DG_Papacy.111 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = vote_pope_2 num_of_cardinals = 2 } }
			random_country = { limit = { has_country_flag = vote_pope_2 num_of_cardinals = 2 } country_event = { id = DG_Papacy.111 days = 5 } }
		}
		else = {
			PAP = { country_event = { id = DG_Papacy.112 days = 5 } }
		}
	}
	option = {
		name = "AI_Event"
		trigger = { PAP = { has_country_flag = preferiti_3_secular } }
		if = {
			limit = { any_country = { has_country_flag = vote_pope_3 num_of_cardinals = 8 } }
			random_country = { limit = { has_country_flag = vote_pope_3 num_of_cardinals = 8 } country_event = { id = DG_Papacy.111 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = vote_pope_3 num_of_cardinals = 6 } }
			random_country = { limit = { has_country_flag = vote_pope_3 num_of_cardinals = 6 } country_event = { id = DG_Papacy.111 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = vote_pope_3 num_of_cardinals = 4 } }
			random_country = { limit = { has_country_flag = vote_pope_3 num_of_cardinals = 4 } country_event = { id = DG_Papacy.111 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = vote_pope_3 num_of_cardinals = 2 } }
			random_country = { limit = { has_country_flag = vote_pope_3 num_of_cardinals = 2 } country_event = { id = DG_Papacy.111 days = 5 } }
		}
		else = {
			PAP = { country_event = { id = DG_Papacy.112 days = 5 } }
		}
	}
	option = {
		name = "AI_Event"
		trigger = { PAP = { has_country_flag = preferiti_4_secular } }
		if = {
			limit = { any_country = { has_country_flag = vote_pope_4 num_of_cardinals = 8 } }
			random_country = { limit = { has_country_flag = vote_pope_4 num_of_cardinals = 8 } country_event = { id = DG_Papacy.111 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = vote_pope_4 num_of_cardinals = 6 } }
			random_country = { limit = { has_country_flag = vote_pope_4 num_of_cardinals = 6 } country_event = { id = DG_Papacy.111 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = vote_pope_4 num_of_cardinals = 4 } }
			random_country = { limit = { has_country_flag = vote_pope_4 num_of_cardinals = 4 } country_event = { id = DG_Papacy.111 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = vote_pope_4 num_of_cardinals = 2 } }
			random_country = { limit = { has_country_flag = vote_pope_4 num_of_cardinals = 2 } country_event = { id = DG_Papacy.111 days = 5 } }
		}
		else = {
			PAP = { country_event = { id = DG_Papacy.112 days = 5 } }
		}
	}
	option = {
		name = "AI_Event"
		trigger = { AVI = { has_country_flag = preferiti_1_secular } }
		if = {
			limit = { any_country = { has_country_flag = vote_pope_1 num_of_cardinals = 8 } }
			random_country = { limit = { has_country_flag = vote_pope_1 num_of_cardinals = 8 } country_event = { id = DG_Papacy.111 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = vote_pope_1 num_of_cardinals = 6 } }
			random_country = { limit = { has_country_flag = vote_pope_1 num_of_cardinals = 6 } country_event = { id = DG_Papacy.111 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = vote_pope_1 num_of_cardinals = 4 } }
			random_country = { limit = { has_country_flag = vote_pope_1 num_of_cardinals = 4 } country_event = { id = DG_Papacy.111 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = vote_pope_1 num_of_cardinals = 2 } }
			random_country = { limit = { has_country_flag = vote_pope_1 num_of_cardinals = 2 } country_event = { id = DG_Papacy.111 days = 5 } }
		}
		else = {
			AVI = { country_event = { id = DG_Papacy.112 days = 5 } }
		}
	}
	option = {
		name = "AI_Event"
		trigger = { AVI = { has_country_flag = preferiti_2_secular } }
		if = {
			limit = { any_country = { has_country_flag = vote_pope_2 num_of_cardinals = 8 } }
			random_country = { limit = { has_country_flag = vote_pope_2 num_of_cardinals = 8 } country_event = { id = DG_Papacy.111 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = vote_pope_2 num_of_cardinals = 6 } }
			random_country = { limit = { has_country_flag = vote_pope_2 num_of_cardinals = 6 } country_event = { id = DG_Papacy.111 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = vote_pope_2 num_of_cardinals = 4 } }
			random_country = { limit = { has_country_flag = vote_pope_2 num_of_cardinals = 4 } country_event = { id = DG_Papacy.111 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = vote_pope_2 num_of_cardinals = 2 } }
			random_country = { limit = { has_country_flag = vote_pope_2 num_of_cardinals = 2 } country_event = { id = DG_Papacy.111 days = 5 } }
		}
		else = {
			AVI = { country_event = { id = DG_Papacy.112 days = 5 } }
		}
	}
	option = {
		name = "AI_Event"
		trigger = { AVI = { has_country_flag = preferiti_3_secular } }
		if = {
			limit = { any_country = { has_country_flag = vote_pope_3 num_of_cardinals = 8 } }
			random_country = { limit = { has_country_flag = vote_pope_3 num_of_cardinals = 8 } country_event = { id = DG_Papacy.111 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = vote_pope_3 num_of_cardinals = 6 } }
			random_country = { limit = { has_country_flag = vote_pope_3 num_of_cardinals = 6 } country_event = { id = DG_Papacy.111 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = vote_pope_3 num_of_cardinals = 4 } }
			random_country = { limit = { has_country_flag = vote_pope_3 num_of_cardinals = 4 } country_event = { id = DG_Papacy.111 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = vote_pope_3 num_of_cardinals = 2 } }
			random_country = { limit = { has_country_flag = vote_pope_3 num_of_cardinals = 2 } country_event = { id = DG_Papacy.111 days = 5 } }
		}
		else = {
			AVI = { country_event = { id = DG_Papacy.112 days = 5 } }
		}
	}
	option = {
		name = "AI_Event"
		trigger = { AVI = { has_country_flag = preferiti_4_secular } }
		if = {
			limit = { any_country = { has_country_flag = vote_pope_4 num_of_cardinals = 8 } }
			random_country = { limit = { has_country_flag = vote_pope_4 num_of_cardinals = 8 } country_event = { id = DG_Papacy.111 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = vote_pope_4 num_of_cardinals = 6 } }
			random_country = { limit = { has_country_flag = vote_pope_4 num_of_cardinals = 6 } country_event = { id = DG_Papacy.111 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = vote_pope_4 num_of_cardinals = 4 } }
			random_country = { limit = { has_country_flag = vote_pope_4 num_of_cardinals = 4 } country_event = { id = DG_Papacy.111 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = vote_pope_4 num_of_cardinals = 2 } }
			random_country = { limit = { has_country_flag = vote_pope_4 num_of_cardinals = 2 } country_event = { id = DG_Papacy.111 days = 5 } }
		}
		else = {
			AVI = { country_event = { id = DG_Papacy.112 days = 5 } }
		}
	}
}

#The future papal controller gets papal influence
country_event = {
	id = DG_Papacy.111
	title = "DG_Papacy.111.title"
	desc = "DG_Papacy.111.desc"
	picture = catholic_college_of_cardinals

	is_triggered_only = yes
	
	option = {
		name = "OPT.GOOD2"
		random_list = {
			50 = { ROOT = { country_event = { id = DG_Papacy.112 days =  45 } } }
			20 = { ROOT = { country_event = { id = DG_Papacy.112 days =  60 } } }
			10 = { ROOT = { country_event = { id = DG_Papacy.112 days =  75 } } }
			 9 = { ROOT = { country_event = { id = DG_Papacy.112 days =  90 } } }
			 5 = { ROOT = { country_event = { id = DG_Papacy.112 days = 105 } } }
			 1 = { ROOT = { country_event = { id = DG_Papacy.112 days = 120 } } }
		}
		log = "DG - [Root.GetName] is Papal Controller"
	}
}

#Secular Pope
country_event = {
	id = DG_Papacy.112
	title = "DG_Papacy.112.title"
	desc = {
		trigger = {
			religion = catholic
		}
		desc = DG_Papacy.112.desca
	}
	desc = {
		trigger = {
			religion = avignonist
		}
		desc = DG_Papacy.112.descb
	}
	picture = catholic_habemus_papam

	is_triggered_only = yes
	hidden = yes
	
	immediate = {
		if = {
			limit = {
				religion = catholic
			}
			if = {
				limit = {
					PAP = { is_subject_of = ROOT }
				}
				PAP = { define_ruler = { min_age = 58 } }
				transfer_papal_controller = ROOT
				if = {
					limit = { ROOT = { western_christian = yes } }
					PAP = { set_ruler_culture = ROOT }
				}
				else = {
					set_ruler_culture = umbrian
				}
			}
			else = {
				if = {
					limit = { PAP = { has_country_flag = preferiti_1_secular } }
					PAP = {
						define_ruler = { min_age = 58 }
						transfer_papal_controller = ROOT
						set_ruler_culture = event_target:preferiti_1
						clr_country_flag = preferiti_1_secular
					}
				}
				else_if = {
					limit = { PAP = { has_country_flag = preferiti_2_secular } }
					PAP = {
						define_ruler = { min_age = 58 }
						transfer_papal_controller = ROOT
						set_ruler_culture = event_target:preferiti_2
						clr_country_flag = preferiti_2_secular
					}
				}
				else_if = {
					limit = { PAP = { has_country_flag = preferiti_3_secular } }
					PAP = {
						define_ruler = { min_age = 58 }
						transfer_papal_controller = ROOT
						set_ruler_culture = event_target:preferiti_3
						clr_country_flag = preferiti_3_secular
					}
				}
				else_if = {
					limit = { PAP = { has_country_flag = preferiti_4_secular } }
					PAP = {
						define_ruler = { min_age = 58 }
						transfer_papal_controller = ROOT
						set_ruler_culture = event_target:preferiti_4
						clr_country_flag = preferiti_4_secular
					}
				}
			}
			PAP = {
				clr_country_flag = Deadlocked_Conclave
				set_country_flag = Secular_Pope
				set_global_flag = DG_Live_Pope_in_Rome
				hidden_effect = {
					Calc_Pap_Auth = { scope = PAP }
					papal_corruption_se = yes
				}
			}
			log = "DG - Getting new pope - secular"
		}
		else_if = {
			limit = {
				religion = avignonist
			}
			if = {
				limit = {
					AVI = { is_subject_of = ROOT }
				}
				AVI = { define_ruler = { min_age = 58 } }
				transfer_papal_controller = ROOT
				if = {
					limit = { ROOT = { western_christian = yes } }
					AVI = { set_ruler_culture = ROOT }
				}
				else = {
					set_ruler_culture = provencal
				}
			}
			else = {
				if = {
					limit = { AVI = { has_country_flag = preferiti_1_secular } }
					AVI = {
						define_ruler = { min_age = 58 }
						transfer_papal_controller = ROOT
						set_ruler_culture = event_target:preferiti_1
						clr_country_flag = preferiti_1_secular
					}
				}
				else_if = {
					limit = { AVI = { has_country_flag = preferiti_2_secular } }
					AVI = {
						define_ruler = { min_age = 58 }
						transfer_papal_controller = ROOT
						set_ruler_culture = event_target:preferiti_2
						clr_country_flag = preferiti_2_secular
					}
				}
				else_if = {
					limit = { AVI = { has_country_flag = preferiti_3_secular } }
					AVI = {
						define_ruler = { min_age = 58 }
						transfer_papal_controller = ROOT
						set_ruler_culture = event_target:preferiti_3
						clr_country_flag = preferiti_3_secular
					}
				}
				else_if = {
					limit = { AVI = { has_country_flag = preferiti_4_secular } }
					AVI = {
						define_ruler = { min_age = 58 }
						transfer_papal_controller = ROOT
						set_ruler_culture = event_target:preferiti_4
						clr_country_flag = preferiti_4_secular
					}
				}
			}
			AVI = {
				clr_country_flag = Deadlocked_Conclave
				set_country_flag = Secular_Pope
				set_global_flag = DG_Live_Pope_in_Avignon
				hidden_effect = {
					Calc_Pap_Auth = { scope = AVI }
					papal_corruption_se = yes
				}
			}
			log = "DG - Getting new pope - secular"
		}
	}
	
	option = {
		name = "OPT.DULYNOTED2"
		hidden_effect = {
			every_country = {
				limit = { religion = ROOT ai = no has_country_flag = papacy_notification }
				country_event = { id = DG_Papacy.113 days = 2 }
			}
			
		}
	}
	after = {
		if = {
			limit = {
				religion = catholic
			}
			PAP = { country_event = { id = DG_Papacy.109 days = 15 } }
		}
		if = {
			limit = {
				religion = avignonist
			}
			AVI = { country_event = { id = DG_Papacy.109 days = 15 } }
		}
	}
}

country_event = {
	id = DG_Papacy.113
	title = "DG_Papacy.112.title"
	desc = {
		trigger = {
			religion = catholic
		}
		desc = DG_Papacy.112.desca
	}
	desc = {
		trigger = {
			religion = avignonist
		}
		desc = DG_Papacy.112.descb
	}
	picture = catholic_habemus_papam

	is_triggered_only = yes
	
	immediate = {
	}
	
	option = {
		name = "OPT.DULYNOTED2"
	}
}

#Among those who try to corrupt the future pope, the nation with the greater number of cardinals
country_event = {
	id = DG_Papacy.114
	title = "AI_Event"
	desc = "AI_Event"
	picture = catholic_college_of_cardinals

	hidden = yes
	is_triggered_only = yes
	
	option = {
		name = "AI_Event"
		trigger = { PAP = { has_country_flag = preferiti_1_corrupt } }
		if = {
			limit = { any_country = { has_country_flag = buy_vote_1 num_of_cardinals = 8 } }
			random_country = { limit = { has_country_flag = buy_vote_1 num_of_cardinals = 8 } country_event = { id = DG_Papacy.115 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = buy_vote_1 num_of_cardinals = 6 } }
			random_country = { limit = { has_country_flag = buy_vote_1 num_of_cardinals = 6 } country_event = { id = DG_Papacy.116 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = buy_vote_1 num_of_cardinals = 4 } }
			random_country = { limit = { has_country_flag = buy_vote_1 num_of_cardinals = 4 } country_event = { id = DG_Papacy.117 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = buy_vote_1 num_of_cardinals = 2 } }
			random_country = { limit = { has_country_flag = buy_vote_1 num_of_cardinals = 2 } country_event = { id = DG_Papacy.118 days = 5 } }
		}
		else = {
			PAP = { country_event = { id = DG_Papacy.120 days = 5 } }
		}
	}
	option = {
		name = "AI_Event"
		trigger = { PAP = { has_country_flag = preferiti_2_corrupt } }
		if = {
			limit = { any_country = { has_country_flag = buy_vote_2 num_of_cardinals = 8 } }
			random_country = { limit = { has_country_flag = buy_vote_2 num_of_cardinals = 8 } country_event = { id = DG_Papacy.115 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = buy_vote_2 num_of_cardinals = 6 } }
			random_country = { limit = { has_country_flag = buy_vote_2 num_of_cardinals = 6 } country_event = { id = DG_Papacy.116 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = buy_vote_2 num_of_cardinals = 4 } }
			random_country = { limit = { has_country_flag = buy_vote_2 num_of_cardinals = 4 } country_event = { id = DG_Papacy.117 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = buy_vote_2 num_of_cardinals = 2 } }
			random_country = { limit = { has_country_flag = buy_vote_2 num_of_cardinals = 2 } country_event = { id = DG_Papacy.118 days = 5 } }
		}
		else = {
			PAP = { country_event = { id = DG_Papacy.120 days = 5 } }
		}
	}
	option = {
		name = "AI_Event"
		trigger = { PAP = { has_country_flag = preferiti_3_corrupt } }
		if = {
			limit = { any_country = { has_country_flag = buy_vote_3 num_of_cardinals = 8 } }
			random_country = { limit = { has_country_flag = buy_vote_3 num_of_cardinals = 8 } country_event = { id = DG_Papacy.115 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = buy_vote_3 num_of_cardinals = 6 } }
			random_country = { limit = { has_country_flag = buy_vote_3 num_of_cardinals = 6 } country_event = { id = DG_Papacy.116 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = buy_vote_3 num_of_cardinals = 4 } }
			random_country = { limit = { has_country_flag = buy_vote_3 num_of_cardinals = 4 } country_event = { id = DG_Papacy.117 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = buy_vote_3 num_of_cardinals = 2 } }
			random_country = { limit = { has_country_flag = buy_vote_3 num_of_cardinals = 2 } country_event = { id = DG_Papacy.118 days = 5 } }
		}
		else = {
			PAP = { country_event = { id = DG_Papacy.120 days = 5 } }
		}
	}
	option = {
		name = "AI_Event"
		trigger = { PAP = { has_country_flag = preferiti_4_corrupt } }
		if = {
			limit = { any_country = { has_country_flag = buy_vote_4 num_of_cardinals = 8 } }
			random_country = { limit = { has_country_flag = buy_vote_4 num_of_cardinals = 8 } country_event = { id = DG_Papacy.115 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = buy_vote_4 num_of_cardinals = 6 } }
			random_country = { limit = { has_country_flag = buy_vote_4 num_of_cardinals = 6 } country_event = { id = DG_Papacy.116 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = buy_vote_4 num_of_cardinals = 4 } }
			random_country = { limit = { has_country_flag = buy_vote_4 num_of_cardinals = 4 } country_event = { id = DG_Papacy.117 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = buy_vote_4 num_of_cardinals = 2 } }
			random_country = { limit = { has_country_flag = buy_pope_4 num_of_cardinals = 2 } country_event = { id = DG_Papacy.118 days = 5 } }
		}
		else = {
			PAP = { country_event = { id = DG_Papacy.120 days = 5 } }
		}
	}
}

country_event = {
	id = DG_Papacy.115
	title = "DG_Papacy.115.title"
	desc = {
		desc = "DG_Papacy.115.desa"
		trigger = { PAP = { has_country_flag = preferiti_1_corrupt } }
	}
	desc = {
		desc = "DG_Papacy.115.desb"
		trigger = { PAP = { has_country_flag = preferiti_2_corrupt } }
	}
	desc = {
		desc = "DG_Papacy.115.desc"
		trigger = { PAP = { has_country_flag = preferiti_3_corrupt } }
	}
	desc = {
		desc = "DG_Papacy.115.desd"
		trigger = { PAP = { has_country_flag = preferiti_4_corrupt } }
	}
	picture = catholic_college_of_cardinals

	is_triggered_only = yes
	
	option = {
		name = "DG_Papacy.115.opta"
		trigger = { OR = { ai = no treasury = 150 } }
		ai_chance = { factor = 75 }
		add_treasury = -100
		PAP = { add_treasury = 100 }
		country_event = { id = DG_Papacy.119 days = 5 }
	}
	option = {
		name = "DG_Papacy.115.optb"
		trigger = { PAP = { has_country_flag = preferiti_1_corrupt } }
		ai_chance = { factor = 25 }
		if = {
			limit = { any_country = { has_country_flag = buy_vote_1 num_of_cardinals = 6 } }
			random_country = { limit = { has_country_flag = buy_vote_1 num_of_cardinals = 6 } country_event = { id = DG_Papacy.116 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = buy_vote_1 num_of_cardinals = 4 } }
			random_country = { limit = { has_country_flag = buy_vote_1 num_of_cardinals = 4 } country_event = { id = DG_Papacy.117 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = buy_vote_1 num_of_cardinals = 2 } }
			random_country = { limit = { has_country_flag = buy_vote_1 num_of_cardinals = 2 } country_event = { id = DG_Papacy.118 days = 5 } }
		}
		else = {
			PAP = { country_event = { id = DG_Papacy.120 days = 5 } }
		}
	}
	option = {
		name = "DG_Papacy.115.optb"
		trigger = { PAP = { has_country_flag = preferiti_2_corrupt } }
		ai_chance = { factor = 25 }
		if = {
			limit = { any_country = { has_country_flag = buy_vote_2 num_of_cardinals = 6 } }
			random_country = { limit = { has_country_flag = buy_vote_2 num_of_cardinals = 6 } country_event = { id = DG_Papacy.116 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = buy_vote_2 num_of_cardinals = 4 } }
			random_country = { limit = { has_country_flag = buy_vote_2 num_of_cardinals = 4 } country_event = { id = DG_Papacy.117 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = buy_vote_2 num_of_cardinals = 2 } }
			random_country = { limit = { has_country_flag = buy_vote_2 num_of_cardinals = 2 } country_event = { id = DG_Papacy.118 days = 5 } }
		}
		else = {
			PAP = { country_event = { id = DG_Papacy.120 days = 5 } }
		}
	}
	option = {
		name = "DG_Papacy.115.optb"
		trigger = { PAP = { has_country_flag = preferiti_3_corrupt } }
		ai_chance = { factor = 25 }
		if = {
			limit = { any_country = { has_country_flag = buy_vote_3 num_of_cardinals = 6 } }
			random_country = { limit = { has_country_flag = buy_vote_3 num_of_cardinals = 6 } country_event = { id = DG_Papacy.116 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = buy_vote_3 num_of_cardinals = 4 } }
			random_country = { limit = { has_country_flag = buy_vote_3 num_of_cardinals = 4 } country_event = { id = DG_Papacy.117 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = buy_vote_3 num_of_cardinals = 2 } }
			random_country = { limit = { has_country_flag = buy_vote_3 num_of_cardinals = 2 } country_event = { id = DG_Papacy.118 days = 5 } }
		}
		else = {
			PAP = { country_event = { id = DG_Papacy.120 days = 5 } }
		}
	}
	option = {
		name = "DG_Papacy.115.optb"
		trigger = { PAP = { has_country_flag = preferiti_4_corrupt } }
		ai_chance = { factor = 25 }
		if = {
			limit = { any_country = { has_country_flag = buy_vote_4 num_of_cardinals = 6 } }
			random_country = { limit = { has_country_flag = buy_vote_4 num_of_cardinals = 6 } country_event = { id = DG_Papacy.116 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = buy_vote_4 num_of_cardinals = 4 } }
			random_country = { limit = { has_country_flag = buy_vote_4 num_of_cardinals = 4 } country_event = { id = DG_Papacy.117 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = buy_vote_4 num_of_cardinals = 2 } }
			random_country = { limit = { has_country_flag = buy_pope_4 num_of_cardinals = 2 } country_event = { id = DG_Papacy.118 days = 5 } }
		}
		else = {
			PAP = { country_event = { id = DG_Papacy.120 days = 5 } }
		}
	}
}

country_event = {
	id = DG_Papacy.116
	title = "DG_Papacy.115.title"
	desc = {
		desc = "DG_Papacy.115.desa"
		trigger = { PAP = { has_country_flag = preferiti_1_corrupt } }
	}
	desc = {
		desc = "DG_Papacy.115.desb"
		trigger = { PAP = { has_country_flag = preferiti_2_corrupt } }
	}
	desc = {
		desc = "DG_Papacy.115.desc"
		trigger = { PAP = { has_country_flag = preferiti_3_corrupt } }
	}
	desc = {
		desc = "DG_Papacy.115.desd"
		trigger = { PAP = { has_country_flag = preferiti_4_corrupt } }
	}
	picture = catholic_college_of_cardinals

	is_triggered_only = yes
	
	option = {
		name = "DG_Papacy.115.opta"
		trigger = { OR = { ai = no treasury = 150 } }
		ai_chance = { factor = 75 }
		add_treasury = -100
		PAP = { add_treasury = 100 }
		country_event = { id = DG_Papacy.119 days = 5 }
	}
	option = {
		name = "DG_Papacy.115.optb"
		trigger = { PAP = { has_country_flag = preferiti_1_corrupt } }
		ai_chance = { factor = 25 }
		if = {
			limit = { any_country = { has_country_flag = buy_vote_1 num_of_cardinals = 4 } }
			random_country = { limit = { has_country_flag = buy_vote_1 num_of_cardinals = 4 } country_event = { id = DG_Papacy.117 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = buy_vote_1 num_of_cardinals = 2 } }
			random_country = { limit = { has_country_flag = buy_vote_1 num_of_cardinals = 2 } country_event = { id = DG_Papacy.118 days = 5 } }
		}
		else = {
			PAP = { country_event = { id = DG_Papacy.120 days = 5 } }
		}
	}
	option = {
		name = "DG_Papacy.115.optb"
		trigger = { PAP = { has_country_flag = preferiti_2_corrupt } }
		ai_chance = { factor = 25 }
		if = {
			limit = { any_country = { has_country_flag = buy_vote_2 num_of_cardinals = 4 } }
			random_country = { limit = { has_country_flag = buy_vote_2 num_of_cardinals = 4 } country_event = { id = DG_Papacy.117 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = buy_vote_2 num_of_cardinals = 2 } }
			random_country = { limit = { has_country_flag = buy_vote_2 num_of_cardinals = 2 } country_event = { id = DG_Papacy.118 days = 5 } }
		}
		else = {
			PAP = { country_event = { id = DG_Papacy.120 days = 5 } }
		}
	}
	option = {
		name = "DG_Papacy.115.optb"
		trigger = { PAP = { has_country_flag = preferiti_3_corrupt } }
		ai_chance = { factor = 25 }
		if = {
			limit = { any_country = { has_country_flag = buy_vote_3 num_of_cardinals = 4 } }
			random_country = { limit = { has_country_flag = buy_vote_3 num_of_cardinals = 4 } country_event = { id = DG_Papacy.117 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = buy_vote_3 num_of_cardinals = 2 } }
			random_country = { limit = { has_country_flag = buy_vote_3 num_of_cardinals = 2 } country_event = { id = DG_Papacy.118 days = 5 } }
		}
		else = {
			PAP = { country_event = { id = DG_Papacy.120 days = 5 } }
		}
	}
	option = {
		name = "DG_Papacy.115.optb"
		trigger = { PAP = { has_country_flag = preferiti_4_corrupt } }
		ai_chance = { factor = 25 }
		if = {
			limit = { any_country = { has_country_flag = buy_vote_4 num_of_cardinals = 4 } }
			random_country = { limit = { has_country_flag = buy_vote_4 num_of_cardinals = 4 } country_event = { id = DG_Papacy.117 days = 5 } }
		}
		else_if = {
			limit = { any_country = { has_country_flag = buy_vote_4 num_of_cardinals = 2 } }
			random_country = { limit = { has_country_flag = buy_pope_4 num_of_cardinals = 2 } country_event = { id = DG_Papacy.118 days = 5 } }
		}
		else = {
			PAP = { country_event = { id = DG_Papacy.120 days = 5 } }
		}
	}
}

country_event = {
	id = DG_Papacy.117
	title = "DG_Papacy.115.title"
	desc = {
		desc = "DG_Papacy.115.desa"
		trigger = { PAP = { has_country_flag = preferiti_1_corrupt } }
	}
	desc = {
		desc = "DG_Papacy.115.desb"
		trigger = { PAP = { has_country_flag = preferiti_2_corrupt } }
	}
	desc = {
		desc = "DG_Papacy.115.desc"
		trigger = { PAP = { has_country_flag = preferiti_3_corrupt } }
	}
	desc = {
		desc = "DG_Papacy.115.desd"
		trigger = { PAP = { has_country_flag = preferiti_4_corrupt } }
	}
	picture = catholic_college_of_cardinals

	is_triggered_only = yes
	
	option = {
		name = "DG_Papacy.115.opta"
		trigger = { OR = { ai = no treasury = 150 } }
		ai_chance = { factor = 75 }
		add_treasury = -100
		PAP = { add_treasury = 100 }
		country_event = { id = DG_Papacy.119 days = 5 }
	}
	option = {
		name = "DG_Papacy.115.optb"
		trigger = { PAP = { has_country_flag = preferiti_1_corrupt } }
		ai_chance = { factor = 25 }
		if = {
			limit = { any_country = { has_country_flag = buy_vote_1 num_of_cardinals = 2 } }
			random_country = { limit = { has_country_flag = buy_vote_1 num_of_cardinals = 2 } country_event = { id = DG_Papacy.118 days = 5 } }
		}
		else = {
			PAP = { country_event = { id = DG_Papacy.120 days = 5 } }
		}
	}
	option = {
		name = "DG_Papacy.115.optb"
		trigger = { PAP = { has_country_flag = preferiti_2_corrupt } }
		ai_chance = { factor = 25 }
		if = {
			limit = { any_country = { has_country_flag = buy_vote_2 num_of_cardinals = 2 } }
			random_country = { limit = { has_country_flag = buy_vote_2 num_of_cardinals = 2 } country_event = { id = DG_Papacy.118 days = 5 } }
		}
		else = {
			PAP = { country_event = { id = DG_Papacy.120 days = 5 } }
		}
	}
	option = {
		name = "DG_Papacy.115.optb"
		trigger = { PAP = { has_country_flag = preferiti_3_corrupt } }
		ai_chance = { factor = 25 }
		if = {
			limit = { any_country = { has_country_flag = buy_vote_3 num_of_cardinals = 2 } }
			random_country = { limit = { has_country_flag = buy_vote_3 num_of_cardinals = 2 } country_event = { id = DG_Papacy.118 days = 5 } }
		}
		else = {
			PAP = { country_event = { id = DG_Papacy.120 days = 5 } }
		}
	}
	option = {
		name = "DG_Papacy.115.optb"
		trigger = { PAP = { has_country_flag = preferiti_4_corrupt } }
		ai_chance = { factor = 25 }
		if = {
			limit = { any_country = { has_country_flag = buy_vote_4 num_of_cardinals = 2 } }
			random_country = { limit = { has_country_flag = buy_pope_4 num_of_cardinals = 2 } country_event = { id = DG_Papacy.118 days = 5 } }
		}
		else = {
			PAP = { country_event = { id = DG_Papacy.120 days = 5 } }
		}
	}
}

country_event = {
	id = DG_Papacy.118
	title = "DG_Papacy.115.title"
	desc = {
		desc = "DG_Papacy.115.desa"
		trigger = { PAP = { has_country_flag = preferiti_1_corrupt } }
	}
	desc = {
		desc = "DG_Papacy.115.desb"
		trigger = { PAP = { has_country_flag = preferiti_2_corrupt } }
	}
	desc = {
		desc = "DG_Papacy.115.desc"
		trigger = { PAP = { has_country_flag = preferiti_3_corrupt } }
	}
	desc = {
		desc = "DG_Papacy.115.desd"
		trigger = { PAP = { has_country_flag = preferiti_4_corrupt } }
	}
	picture = catholic_college_of_cardinals

	is_triggered_only = yes
	
	option = {
		name = "DG_Papacy.115.opta"
		trigger = { OR = { ai = no treasury = 150 } }
		ai_chance = { factor = 75 }
		add_treasury = -100
		PAP = { add_treasury = 100 }
		country_event = { id = DG_Papacy.119 days = 5 }
	}
	option = {
		name = "DG_Papacy.115.optb"
		ai_chance = { factor = 25 }
		PAP = { country_event = { id = DG_Papacy.120 days = 5 } }
	}
}

#The future papal controller gets papal influence
country_event = {
	id = DG_Papacy.119
	title = "DG_Papacy.111.title"
	desc = "DG_Papacy.111.desc"
	picture = catholic_college_of_cardinals

	is_triggered_only = yes
	
	option = {
		name = "OPT.GOOD2"
		random_list = {
			50 = { ROOT = { country_event = { id = DG_Papacy.120 days =  45 } } }
			20 = { ROOT = { country_event = { id = DG_Papacy.120 days =  60 } } }
			10 = { ROOT = { country_event = { id = DG_Papacy.120 days =  75 } } }
			 9 = { ROOT = { country_event = { id = DG_Papacy.120 days =  90 } } }
			 5 = { ROOT = { country_event = { id = DG_Papacy.120 days = 105 } } }
			 1 = { ROOT = { country_event = { id = DG_Papacy.120 days = 120 } } }
		}
		log = "DG - [Root.GetName] is Papal Controller"
	}
}

#Corrupt Pope
country_event = {
	id = DG_Papacy.120
	title = "DG_Papacy.120.title"
	desc = {
		trigger = {
			religion = catholic
		}
		desc = DG_Papacy.120.desca
	}
	desc = {
		trigger = {
			religion = avignonist
		}
		desc = DG_Papacy.120.descb
	}
	picture = catholic_habemus_papam

	hidden = yes
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				religion = catholic	
			}
			if = {
				limit = {
					PAP = { is_subject_of = ROOT }
				}
				PAP = { define_ruler = { min_age = 58 } }
				transfer_papal_controller = ROOT
				if = {
					limit = { ROOT = { western_christian = yes } }
					PAP = { set_ruler_culture = ROOT }
				}
				else = {
					set_ruler_culture = umbrian
				}
			}
			else = {
				if = {
					limit = { PAP = { has_country_flag = preferiti_1_corrupt } }
					PAP = {
						define_ruler = { min_age = 58 }
						transfer_papal_controller = ROOT
						set_ruler_culture = event_target:preferiti_1
						clr_country_flag = preferiti_1_corrupt
					}
				}
				else_if = {
					limit = { PAP = { has_country_flag = preferiti_2_corrupt } }
					PAP = {
						define_ruler = { min_age = 58 }
						transfer_papal_controller = ROOT
						set_ruler_culture = event_target:preferiti_2
						clr_country_flag = preferiti_2_corrupt
					}
				}
				else_if = {
					limit = { PAP = { has_country_flag = preferiti_3_corrupt } } 
					PAP = {
						define_ruler = { min_age = 58 }
						transfer_papal_controller = ROOT
						set_ruler_culture = event_target:preferiti_3
						clr_country_flag = preferiti_3_corrupt
					}
				}
				else_if = {
					limit = { PAP = { has_country_flag = preferiti_4_corrupt } } 
					PAP = {
						define_ruler = { min_age = 58 }
						transfer_papal_controller = ROOT
						set_ruler_culture = event_target:preferiti_4
						clr_country_flag = preferiti_4_corrupt
					}
				}
				hidden_effect = {
					every_country = {
						limit = { religion = ROOT ai = no has_country_flag = papacy_notification }
						country_event = { id = DG_Papacy.121 days = 2}
					}
				}
			}
			PAP = {
				clr_country_flag = Deadlocked_Conclave
				set_country_flag = Corrupt_Pope
				set_global_flag = DG_Live_Pope_in_Rome
				hidden_effect = {
					Calc_Pap_Auth = { scope = PAP }
					papal_corruption_se = yes
				}
			}
		}
		else_if = {
			limit = {
				religion = avignonist
			}
			if = {
				limit = {
					AVI = { is_subject_of = ROOT }
				}
				AVI = { define_ruler = { min_age = 58 } }
				transfer_papal_controller = ROOT
				if = {
					limit = { ROOT = { western_christian = yes } }
					AVI = { set_ruler_culture = ROOT }
				}
				else = {
					set_ruler_culture = provencal
				}
			}
			else = {
				if = {
					limit = { AVI = { has_country_flag = preferiti_1_corrupt } }
					AVI = {
						define_ruler = { min_age = 58 }
						transfer_papal_controller = ROOT
						set_ruler_culture = event_target:preferiti_1
						clr_country_flag = preferiti_1_corrupt
					}
				}
				else_if = {
					limit = { AVI = { has_country_flag = preferiti_2_corrupt } }
					AVI = {
						define_ruler = { min_age = 58 }
						transfer_papal_controller = ROOT
						set_ruler_culture = event_target:preferiti_2
						clr_country_flag = preferiti_2_corrupt
					}
				}
				else_if = {
					limit = { AVI = { has_country_flag = preferiti_3_corrupt } } 
					AVI = {
						define_ruler = { min_age = 58 }
						transfer_papal_controller = ROOT
						set_ruler_culture = event_target:preferiti_3
						clr_country_flag = preferiti_3_corrupt
					}
				}
				else_if = {
					limit = { AVI = { has_country_flag = preferiti_4_corrupt } } 
					AVI = {
						define_ruler = { min_age = 58 }
						transfer_papal_controller = ROOT
						set_ruler_culture = event_target:preferiti_4
						clr_country_flag = preferiti_4_corrupt
					}
				}
				hidden_effect = {
					every_country = {
						limit = { religion = ROOT ai = no has_country_flag = papacy_notification }
						country_event = { id = DG_Papacy.121 days = 2}
					}
				}
			}
			AVI = {
				clr_country_flag = Deadlocked_Conclave
				set_country_flag = Corrupt_Pope
				set_global_flag = DG_Live_Pope_in_Avignon
				hidden_effect = {
					Calc_Pap_Auth = { scope = AVI }
					papal_corruption_se = yes
				}
			}
		}
		
		log = "DG - Getting new pope - corrupt"
		add_reform_desire = 0.0001
	}
	
	option = {
		name = "OPT.DULYNOTED2"
	}
	
	after = {
		if = {
			limit = {
				religion = catholic
			}
			PAP = { country_event = { id = DG_Papacy.109 days = 15 } }
		}
		if = {
			limit = {
				religion = avignonist
			}
			AVI = { country_event = { id = DG_Papacy.109 days = 15 } }
		}
	}
}

country_event = {
	id = DG_Papacy.121
	title = "DG_Papacy.120.title"
	desc = {
		trigger = {
			religion = catholic
		}
		desc = DG_Papacy.120.desca
	}
	desc = {
		trigger = {
			religion = avignonist
		}
		desc = DG_Papacy.120.descb
	}
	picture = catholic_habemus_papam

	is_triggered_only = yes
	
	immediate = {
	}
	
	option = {
		name = "OPT.DULYNOTED2"
	}
}

#Papal Captor gets dibs on selecting to be Papal Controller
country_event = {
	id = DG_Papacy.122
	title = "DG_Papacy.122.title"
	desc = "DG_Papacy.122.desc"
	picture = catholic_habemus_papam

	is_triggered_only = yes
	
	trigger = {
		OR = {
			has_country_flag = papal_captor
			overlord_of = FROM
		}
		OR = {
			ai = no
			had_global_flag = { flag = meiou_and_taxes_mod_start days = 7300 }
		}
	}
	
	option = {
		name = "DG_Papacy.122.opta" #Maintain Status Quo
		trigger = { has_country_flag = papal_captor NOT = { overlord_of = FROM } OR = { ai = no NOT = { had_global_flag = { flag = meiou_and_taxes_mod_start days = 7300 } } } }
		add_opinion = { who = PAP modifier = papacy_bad }
		ai_chance = { factor = 0 }
		add_reform_desire = 0.0001
		hidden_effect = {
			country_event = { id = DG_Papacy.110 days = 5 }
		}
	}
	option = {
		name = "DG_Papacy.122.optb" #Negociate Return
		trigger = { has_country_flag = papal_captor NOT = { overlord_of = FROM } OR = { ai = no had_global_flag = { flag = meiou_and_taxes_mod_start days = 7300 } } num_of_cardinals = 1 }
		ai_chance = { factor = 35 }
		add_reform_desire = 0.00005
		add_opinion = { who = PAP modifier = papacy_good }
		clr_country_flag = papal_captor
		hidden_effect = {
			add_opinion = { who = PAP modifier = papacy_good }
			country_event = { id = DG_Papacy.110 days = 5 } #251 days = 5 }
			PAP = {
				Effect_set_capital = { target = 2530 }
				event_target:the_vatican  = { clear_global_event_target = the_vatican }
				2530 = { save_global_event_target_as = the_vatican }
				clr_country_flag = French_Curia
				clr_country_flag = Italian_Curia
				clr_country_flag = Iberian_Curia
				clr_country_flag = Imperial_Curia
				clr_country_flag = English_Curia
				set_global_flag = DG_Babylonian_Captivity_Ends
				set_ruler_flag = Captivity_Ending_Pope
				set_country_flag = Divided_Conclave
				restore_country_name = yes
			}
		}
	}
	option = {
		name = "DG_Papacy.122.optc" #Control the Election
		ai_chance = { factor = 15 }
		random_list = {
			60 = { ROOT = { country_event = { id = DG_Papacy.120 days =  5 } } }
			40 = { ROOT = { country_event = { id = DG_Papacy.112 days =  5 } } }
		}
	}
	option = {
		name = "DG_Papacy.122.optd" #No Interference
		trigger = { OR = { ai = no had_global_flag = { flag = meiou_and_taxes_mod_start days = 7300 } } }
		ai_chance = { factor = 50 }
		add_reform_desire = -0.0001
		hidden_effect = {
			add_opinion = { who = PAP modifier = papacy_good }
			clr_country_flag = papal_captor
			PAP = {
				Effect_set_capital = { target = 2530 }
				clr_country_flag = French_Curia
				clr_country_flag = Italian_Curia
				clr_country_flag = Iberian_Curia
				clr_country_flag = Imperial_Curia
				clr_country_flag = English_Curia
				set_global_flag = DG_Babylonian_Captivity_Ends
				set_ruler_flag = Captivity_Ending_Pope
				set_country_flag = Divided_Conclave
				restore_country_name = yes
			}
		}
		hidden_effect = {
			every_known_country = {
				limit = {
					religion = ROOT 
					num_of_cardinals = 1
					is_excommunicated = no
				}
				country_event = { id = DG_Papacy.103 days = 15 random = 3 }
			}
			country_event = { id = DG_Papacy.106 days = 150 }
		}
	}
}

### THE WESTERN SCHISM ###

### THE VATICAN STANDOFF
country_event = {
	id = DG_Papacy.200
	title = "AI_Event"
	desc = "AI_Event"
	picture = hindu_mob
	
	trigger = {
		tag = PAP
	}
	
	hidden = yes
	fire_only_once = yes

	option = {
		if = {
			limit = { is_subject = no }
			country_event = { id = DG_Papacy.201 }
		}
		else = {
			overlord = { country_event = { id = DG_Papacy.203 } }
		}
	}
}	

# The Origins - PAP is independent
country_event = {
	id = DG_Papacy.201
	title = "DG_Papacy.201.title"
	desc = "DG_Papacy.201.desc"
	picture = hindu_mob
	
	fire_only_once = yes
	
	trigger = {
		tag = PAP
		is_subject = no
		capital_scope = { province_id = 2530 }
		owns = 202
		OR = {
			has_global_flag = DG_Babylonian_Captivity_Ends
			has_country_flag = Conclave_Underway
			capital_scope = { controlled_by = REB }
		}
		NOT = { has_ruler_flag = Divided_Conclave_Pope }
		has_country_flag = Divided_Conclave
	}
	
	mean_time_to_happen = { months = 2 }
	
	immediate = {
		log = "DG:[GetYear]: Election of the Roman Pope"
		add_reform_desire = 0.0005
		set_global_flag = DG_Western_Schism_Start
	}
	
	option = {
		name = "DG_Papacy.201.opta"
		ai_chance = {
			factor = 99
			modifier = {
				NOT = { capital_scope = { controlled_by = ROOT } }
				factor = 1.4
			}
			modifier = {
				is_at_war = yes
				factor = 1.4
			}
			modifier = {
				NOT = { prestige = 0 }
				factor = 0.7
			}
		}
		add_prestige = -5
		hidden_effect = {
			every_country = {
				limit = { papal_influence = 1 }
				add_papal_influence = -400
			}
			every_known_country = {
				limit = { religion = catholic NOT = { tag = PAP } has_country_flag = papacy_notification }
				country_event = { id = DG_Papacy.202 }
			}
		}
		define_ruler      = { min_age = 58 }
		set_ruler_culture = umbrian
		clr_country_flag  = Conclave_Underway
		clr_country_flag  = Deadlocked_Conclave
		set_country_flag  = Corrupt_Pope
		set_global_flag   = DG_Live_Pope_in_Rome
		hidden_effect = {
			Calc_Pap_Auth = { scope = PAP }
			papal_corruption_se = yes
		}
		hidden_effect = {
			set_global_flag = DG_Rigged_Conclave
			every_known_country = {
				limit = { ai = no }
				country_event = { id = DG_Papacy.202 }
			}
			PAP = { country_event = { id = DG_Papacy.205 days = 180 random = 30 } }
		}
	}
	option = {
		name = "DG_Papacy.201.optb"
		ai_chance = { factor = 1 }
		capital_scope = {
			add_province_modifier = {
				name = "fanatics_organizing"
				duration = 1825
			}
			add_unrest = 5
		}
		hidden_effect = {	
			every_known_country = {
				limit = {
					religion = ROOT 
					num_of_cardinals = 1
					is_excommunicated = no
				}
				country_event = { id = DG_Papacy.103 days = 15 random = 3 }
			}
			country_event = { id = DG_Papacy.106 days = 150 }
			clr_global_flag = DG_Western_Schism_Start
			set_global_flag = DG_Regular_Conclave
			every_known_country = {
				limit = { ai = no }
				country_event = { id = DG_Papacy.202 }
			}
			PAP = { country_event = { id = DG_Papacy.205 days = 180 random = 30 } }
		}
	}
}

country_event = {
	id = DG_Papacy.202
	title = "DG_Papacy.201.title"
	desc = "DG_Papacy.202.desc"
	picture = hindu_mob

	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = { has_global_flag = DG_Rigged_Conclave }
			custom_tooltip = DG_Rigged_Conclave_tt
		}
		else_if = {
			limit = { has_global_flag = DG_Regular_Conclave }
			custom_tooltip = DG_Regular_Conclave_tt
		}
	}
	
	option = {
		name = "OPT.DULYNOTED2"
		hidden_effect = {
			clr_global_flag = DG_Rigged_Conclave
			clr_global_flag = DG_Regular_Conclave
		}
	}
}

# The Origins - PAP is subject
country_event = {
	id = DG_Papacy.203
	title = "DG_Papacy.203.title"
	desc = "DG_Papacy.203.desc"
	picture = hindu_mob
	
	fire_only_once = yes
	
	trigger = {
		overlord_of = PAP
		owns_or_non_sovereign_subject_of = 202	
		PAP = {
			capital_scope = { province_id = 2530 }
			OR = {
				has_global_flag = DG_Babylonian_Captivity_Ends
				has_country_flag = Conclave_Underway
				capital_scope = { controlled_by = REB }
			}
			NOT = { has_ruler_flag = Divided_Conclave_Pope }
			has_country_flag = Divided_Conclave
		}
	}
	
	mean_time_to_happen = { months = 2 }
	
	immediate = {
		log = "DG:[GetYear]: Election of the Roman Pope"
		add_reform_desire = 0.0005
		set_global_flag = DG_Western_Schism_Start
	}
	
	option = {
		name = "DG_Papacy.203.opta"
		ai_chance = {
			factor = 99
			modifier = {
				is_at_war = yes
				factor = 1.4
			}
			modifier = {
				NOT = { prestige = 0 }
				factor = 0.7
			}
		}
		hidden_effect = {
			every_country = {
				limit = { papal_influence = 1 }
				add_papal_influence = -400
			}
			every_known_country = {
				limit = { religion = catholic NOT = { tag = PAP } has_country_flag = papacy_notification }
				country_event = { id = DG_Papacy.202 }
			}
		}
		PAP = {
			define_ruler      = {}
			set_ruler_culture = umbrian
			clr_country_flag  = Conclave_Underway
			clr_country_flag  = Deadlocked_Conclave
			set_country_flag  = Corrupt_Pope
			set_global_flag   = DG_Live_Pope_in_Rome
			hidden_effect = {
				Calc_Pap_Auth = { scope = PAP }
				papal_corruption_se = yes
				set_global_flag = DG_Rigged_Conclave
				every_known_country = {
					limit = { ai = no }
					country_event = { id = DG_Papacy.202 }
				}
			}
		}
		if = {
			limit = { tag = FRA }
			PAP = { country_event = { id = DG_Papacy.206 days = 180 random = 30 } }
		}
		else = {
			PAP = { country_event = { id = DG_Papacy.205 days = 180 random = 30 } }
		}
	}
	option = {
		name = "DG_Papacy.203.optb"
		ai_chance = { factor = 1 }
		add_prestige = -15
		hidden_effect = {	
			every_known_country = {
				limit = {
					religion = ROOT 
					num_of_cardinals = 1
					is_excommunicated = no
				}
				country_event = { id = DG_Papacy.103 days = 15 random = 3 }
			}
			
			PAP = {
				country_event = { id = DG_Papacy.106 days = 150 }
				set_global_flag = DG_Regular_Conclave
			}
			if = {
				limit = { tag = FRA }
				country_event = { id = DG_Papacy.206 days = 180 random = 30 }
			}
			else = {
				country_event = { id = DG_Papacy.205 days = 180 random = 30 }
			}
			hidden_effect = {
				every_known_country = {
					limit = { ai = no }
					country_event = { id = DG_Papacy.202 }
				}
				clr_global_flag = DG_Western_Schism_Start
			}
		}
	}
}

# The Start
country_event = {
	id = DG_Papacy.205
	title = "DG_Papacy.205.title"
	desc = "DG_Papacy.205.desc"
	picture = catholic_schism
	
	is_triggered_only = yes
	fire_only_once = yes
	
	immediate = {
		log = "DG:[GetYear]: Election of the Avignonist Pope"
		set_global_flag = DG_Ongoing_Western_Schism
		set_global_flag = DG_Western_Schism_Timer
		set_global_flag = DG_Live_Pope_in_Avignon
		202 = {
			add_core = AVI
			cede_province = AVI
			change_religion = avignonist
			hidden_effect = { MN_RlgChange = { from = 1 to = 7 } }
			add_province_modifier = { name = papal_seat_em duration = -1 hidden = yes }
			add_core = PAP
		}
		2530 = {
			add_province_modifier = { name = papal_seat_em duration = -1 hidden = yes }
			add_core = AVI
		}
		AVI = {
			#papafication_effect = yes
			#change_religion = avignonist
			override_country_name = AVI_Schism
			Pol_ChangeGovTheocracy = { Organisation=3 Mediumship=4 Assembly=1 }
			change_title_5 = yes
		}
		PAP = {
			override_country_name = PAP_Schism
			add_truce_with = AVI	#Give AVI some time to get allies
		}
	}
	
	option = {
		name = "DG_Papacy.205.opta"
	}
	
	option = {
		name = "DG_Papacy.205.optb"
		switch_tag = AVI
	}
	
	after = {
		if = { 
			limit = {
				exists = FRA
			} 
			FRA = { country_event = { id = DG_Papacy.207 days = 15 } }
		}
		else_if = {
			limit = { 
				exists = KNP 
			} 
			KNP = { country_event = { id = DG_Papacy.207 days = 15 } }
		}
		else_if = {
			limit = { 
				exists = NAP 
			}
			NAP = { country_event = { id = DG_Papacy.207 days = 15 } }
		}
		else_if = {
			limit = {
				exists = ENG
				ENG = {
					religion = catholic
				}
			}
			ENG = { country_event = { id = DG_Papacy.207 days = 15 } }
		}
		else = {
			random_country = {
				limit = {
					religion = catholic
					total_development = 75
				}
				country_event  = { id = DG_Papacy.207 days = 15 } 
			}
		}
		clr_country_flag = Divided_Conclave
	}
}

country_event = {
	id = DG_Papacy.206
	title = "DG_Papacy.206.title"
	desc = "DG_Papacy.206.desc"
	picture = catholic_schism
	
	is_triggered_only = yes
	fire_only_once = yes
	
	immediate = {
		log = "DG:[GetYear]: Election of the Avignonist Pope"
		set_global_flag = DG_Ongoing_Western_Schism
		set_global_flag = DG_Western_Schism_Timer
		set_global_flag = DG_Live_Pope_in_Avignon
		ChangeTagEffect = { scope=AVI }
		every_owned_province = {
			limit = { superregion = italy_superregion }
			add_core = PAP
			cede_province = PAP
		}
		2530 = {
			add_province_modifier = { name = papal_seat_em duration = -1 hidden = yes }
			add_core = AVI
		}
		every_owned_province = {
			change_religion = avignonist
			hidden_effect = { MN_RlgChange = { from = 1 to = 7 } }
		}
		202 = {
			add_province_modifier = { name = papal_seat_em duration = -1 hidden = yes }
			add_core = PAP
		}
		AVI = {
			#papafication_effect = yes
			#change_religion = avignonist
			override_country_name = AVI_Schism
			Pol_ChangeGovTheocracy = { Organisation=3 Mediumship=4 Assembly=1 }
			change_title_5 = yes
		}
		PAP = {
			override_country_name = PAP_Schism
			add_truce_with = AVI	#Give AVI some time to get allies
		}
	}
	
	option = {
		name = "DG_Papacy.205.opta"
	}
	
	option = {
		name = "DG_Papacy.205.optb"
		switch_tag = PAP
	}
	
	after = {
		if = { 
			limit = {
				exists = FRA
			} 
			FRA = { country_event = { id = DG_Papacy.207 days = 15 } }
		}
		else_if = {
			limit = { 
				exists = KNP 
			} 
			KNP = { country_event = { id = DG_Papacy.207 days = 15 } }
		}
		else_if = {
			limit = { 
				exists = NAP 
			}
			NAP = { country_event = { id = DG_Papacy.207 days = 15 } }
		}
		else_if = {
			limit = {
				exists = ENG
				ENG = {
					religion = catholic
				}
			}
			ENG = { country_event = { id = DG_Papacy.207 days = 15 } }
		}
		else = {
			random_country = {
				limit = {
					religion = catholic
					total_development = 75
				}
				country_event  = { id = DG_Papacy.207 days = 15 } 
			}
		}
		clr_country_flag = Divided_Conclave
	}
}

country_event = {
	id = DG_Papacy.207
	title = "DG_Papacy.207.title"
	desc = "DG_Papacy.207.desc"
	picture = catholic_schism
	
	is_triggered_only = yes
	fire_only_once = yes
	
	option = {
		name = "OPT.DULYNOTED2"
		if = {
			limit = { religion = catholic }
			change_religion = avignonist
		}
		every_owned_province = {
			if = {
				limit = { religion = catholic }
				if = {
					limit = { has_cardinal = yes }
					set_province_flag = dg_has_cardinal
					RemoveCardinal = yes
				}
				change_religion = avignonist
				if = {
					limit = { has_province_flag = dg_has_cardinal }
					AddCardinal = yes
					clr_province_flag = dg_has_cardinal
				}
			}
			hidden_effect = { MN_RlgChange = { from = 1 to = 7 } }
		}
		add_opinion = { who = AVI modifier = western_schism_support }
		reverse_add_opinion = { who = AVI modifier = western_schism_support }
		add_opinion = { who = PAP modifier = western_schism_defiance }
		reverse_add_opinion = { who = PAP modifier = western_schism_defiance }
		add_historical_friend = AVI 
		create_guarantee = AVI
		add_historical_rival = PAP
		AVI = { define_ruler = { min_age = 58 } }
		transfer_papal_controller = ROOT
		if = {
			limit = {
				PAP = { guaranteed_by = ROOT }
			}
			remove_guarantee = PAP
		}
	}
	
	after = {
		hidden_effect = {
			every_known_country = {
				limit = { religion = catholic NOT = { tag = PAP } is_subject = no is_emperor = no }
				country_event = { id = DG_Papacy.208 days = 15 }
			}
			every_subject_country = { country_event = { id = DG_Papacy.209 days = 5 } }
		}
		clr_global_flag = DG_Western_Schism_Start
	}
}

country_event = {
	id = DG_Papacy.208
	title = "DG_Papacy.208.title"
	desc = "DG_Papacy.208.desc"
	picture = catholic_schism
	
	is_triggered_only = yes
	
	option = {
		name = "DG_Papacy.208.opta"
		trigger = {
			NOT = { historical_friend_with = FROM }
			NOT = { alliance_with = FROM }
			NOT = { overlord_of = PAP }
		}
		ai_chance = {
			factor = 60
			modifier = {
				NOT = { has_opinion = { who = FROM value = -150 } }
				factor = 1.2
			}
			modifier = {
				NOT = { has_opinion = { who = FROM value = -100 } }
				factor = 1.2
			}
			modifier = {
				NOT = { has_opinion = { who = FROM value = -50 } }
				factor = 1.2
			}
			modifier = {
				NOT = { has_opinion = { who = FROM value = 0 } }
				factor = 1.2
			}
			modifier = {
				capital_scope = { superregion = balkan_superregion }
				factor = 2.5
			}
			modifier = {
				capital_scope = { superregion = commonwealth_superregion }
				factor = 2.5
			}
			modifier = {
				capital_scope = { superregion = italy_superregion NOT = { region = naples_region } }
				factor = 2.5
			}
			modifier = {
				capital_scope = { superregion = scandinavian_superregion }
				factor = 2.5
			}
			modifier = {
				is_emperor = yes
				factor = 1.7
			}
			modifier = {
				alliance_with = ENG
				factor = 2.0
			}
		}
		add_opinion = { who = PAP modifier = western_schism_support }
		reverse_add_opinion = { who = PAP modifier = western_schism_support }
		add_opinion = { who = AVI modifier = western_schism_defiance }
		reverse_add_opinion = { who = AVI modifier = western_schism_defiance }
		if = {
			limit = { is_emperor = yes }
			country_event = { id = DG_Papacy.210 days = 15 }
		}
	}
	option = {
		name = "DG_Papacy.208.optb"
		trigger = {
			NOT = { is_rival = FROM }
			NOT = { war_with = FROM }
			is_emperor = no
			NOT = { overlord_of = AVI }
		}
		ai_chance = {
			factor = 40
			modifier = {
				has_opinion = { who = FROM value = 150 }
				factor = 1.2
			}
			modifier = {
				has_opinion = { who = FROM value = 100 }
				factor = 1.2
			}
			modifier = {
				has_opinion = { who = FROM value = 50 }
				factor = 1.2
			}
			modifier = {
				tag = KNP
				factor = 1.5
			}
			modifier = {
				capital_scope = { superregion = balkan_superregion }
				factor = 0.5
			}
			modifier = {
				capital_scope = { superregion = commonwealth_superregion }
				factor = 0.5
			}
			modifier = {
				capital_scope = { superregion = italy_superregion NOT = { region = naples_region } }
				factor = 0.5
			}
			modifier = {
				capital_scope = { superregion = scandinavian_superregion }
				factor = 0.5
			}
			modifier = {
				is_emperor = yes
				factor = 0.7
			}
			modifier = {
				alliance_with = ENG
				factor = 0.0
			}
			modifier = {
				alliance_with = PAP
				factor = 0
			}
		}
		if = {
			limit = { religion = catholic }
			change_religion = avignonist
		}
		every_owned_province = {
			if = {
				limit = { religion = catholic }
				if = {
					limit = { has_cardinal = yes }
					set_province_flag = dg_has_cardinal
					RemoveCardinal = yes
				}
				change_religion = avignonist
				if = {
					limit = { has_province_flag = dg_has_cardinal }
					AddCardinal = yes
					clr_province_flag = dg_has_cardinal
				}
			}
			hidden_effect = { MN_RlgChange = { from = 1 to = 7 } }
		}
		add_opinion = { who = AVI modifier = western_schism_support }
		reverse_add_opinion = { who = AVI modifier = western_schism_support }
		add_opinion = { who = PAP modifier = western_schism_defiance }
		reverse_add_opinion = { who = PAP modifier = western_schism_defiance }
		hidden_effect = {
			if = {
				limit = { tag = KNP }
				create_guarantee = AVI
			}
			every_subject_country = { country_event = { id = DG_Papacy.209 days = 5 } }
		}
	}
}

country_event = {
	id = DG_Papacy.209
	title = "DG_Papacy.209.title"
	desc = "DG_Papacy.209.desc"
	picture = catholic_schism
	
	is_triggered_only = yes
	
	option = {
		name = "OPT.DULYNOTED2"
		if = {
			limit = { religion = catholic }
			change_religion = avignonist
		}
		every_owned_province = {
			if = {
				limit = { religion = catholic }
				if = {
					limit = { has_cardinal = yes }
					set_province_flag = dg_has_cardinal
					RemoveCardinal = yes
				}
				change_religion = avignonist
				if = {
					limit = { has_province_flag = dg_has_cardinal }
					AddCardinal = yes
					clr_province_flag = dg_has_cardinal
				}
			}
			hidden_effect = { MN_RlgChange = { from = 1 to = 7 } }
		}
		hidden_effect = {
			every_subject_country = { country_event = { id = DG_Papacy.209 days = 5 } }
		}
	}
}

# DG_Papacy.210 - Emperor choses to guarantee the Pope or not
country_event = {
	id = DG_Papacy.210
	title = "DG_Papacy.210.title"
	desc = "DG_Papacy.210.desc"
	picture = catholic_schism
	
	is_triggered_only = yes
	
	immediate = {
		add_opinion = { who = PAP modifier = western_schism_support }
		reverse_add_opinion = { who = PAP modifier = western_schism_support }
		add_opinion = { who = AVI modifier = western_schism_defiance }
		reverse_add_opinion = { who = AVI modifier = western_schism_defiance }
	}
	
	option = {
		name = "OPT.DULYNOTED2"
		create_guarantee = PAP
	}
	option = {
		name = "DG_Papacy.210.optb"
		trigger = { ai = no }
		add_prestige = -5
	}
}

# DG_Papacy.221 - Catholics take control of Avignon
country_event = {
	id = DG_Papacy.221
	title = "DG_Papacy.221.title"
	desc = "DG_Papacy.221.desc"
	picture = catholic_schism
	
	is_triggered_only = yes

	trigger = {
		has_global_flag = DG_Ongoing_Western_Schism
	}

	immediate = {
		clr_global_flag = DG_Ongoing_Western_Schism
		clr_global_flag = DG_Live_Pope_In_Avignon
		set_global_flag = DG_Western_Schism_Defeated
		if = {
			limit = {
				NOT = {
					has_global_flag = DG_Live_Pope_in_Rome
				}
			}
			set_global_flag = DG_Live_Pope_in_Rome
		}
	}
	
	option = {
		name = "OPT.DULYNOTED2"
		clr_global_flag = DG_Ongoing_Western_Schism
		AVI = { override_country_name = AVI }
		PAP = { override_country_name = PAP }
		hidden_effect = {
			202 = {
				remove_province_modifier = papal_seat_em
			}
			2530 = {
				remove_province_modifier = papal_seat_em
			}
			FRA = { remove_historical_friend = AVI }
			FRA = { remove_historical_rival = PAP }
		}
		every_country = {
			limit = { war_with = AVI }
			white_peace = AVI
		}
		if = {
			limit = { AVI = { ai = no } }
			AVI = { switch_tag = PAP }
		}
		PAP = { inherit = AVI }
		hidden_effect = {
			if = {
				limit = { religion_group = christian }
				if = {
					limit = { religion = avignonist }
					change_religion = catholic
				}
				every_owned_province = {
					if = {
						limit = { religion = avignonist }
						if = {
							limit = { has_cardinal = yes }
							RemoveCardinal = yes
						}
						change_religion = catholic
					}
					hidden_effect = { MN_RlgChange = { from = 7 to = 1 } }
				}
			}
			every_known_country = {
				limit = { religion_group = christian }
				if = {
					limit = { religion = avignonist }
					change_religion = catholic
				}
				every_owned_province = {
					if = {
						limit = { religion = avignonist }
						if = {
							limit = { has_cardinal = yes }
							RemoveCardinal = yes
						}
						change_religion = catholic
					}
					hidden_effect = { MN_RlgChange = { from = 7 to = 1 } }
				}
				if = {
					limit = { ai = no }
					country_event = { id = DG_Papacy.222 }
				}
			}
			every_known_country = {
				limit = { any_owned_province = { MN_CheckRelSlot = { Type = value Religion = 7 } } }
				every_owned_province = {
					if = {
						limit = { religion = avignonist }
						if = {
							limit = { has_cardinal = yes }
							RemoveCardinal = yes
						}
						change_religion = catholic
					}
					hidden_effect = { MN_RlgChange = { from = 7 to = 1 } }
				}
			}
		}
	}

	after = {
		every_province = {
			limit = {
				is_core = AVI
			}
			remove_core = AVI
		}
		PAP = { Pol_ChangeGovTheocracy = { Organisation=3 Mediumship=4 Assembly=1 } }
	}
}

country_event = {
	id = DG_Papacy.222
	title = "DG_Papacy.221.title"
	desc = "DG_Papacy.221.desc"
	picture = catholic_schism
	
	is_triggered_only = yes
	
	option = {
		name = "OPT.DULYNOTED2"
	}
}

# DG_Papacy.231 - Avignonists take control of Rome
country_event = {
	id = DG_Papacy.231
	title = "DG_Papacy.231.title"
	desc = "DG_Papacy.231.desc"
	picture = catholic_schism
	
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = DG_Ongoing_Western_Schism
	}

	immediate = {
		clr_global_flag = DG_Ongoing_Western_Schism
		clr_global_flag = DG_Live_Pope_In_Avignon
		set_global_flag = DG_Western_Schism_Defeated
		if = {
			limit = {
				NOT = {
					has_global_flag = DG_Live_Pope_in_Rome
				}
			}
			set_global_flag = DG_Live_Pope_in_Rome
		}
	}

	option = {
		name = "OPT.DULYNOTED2"
		AVI = { override_country_name = AVI }
		PAP = { override_country_name = PAP }
		hidden_effect = {
			202 = {
				remove_province_modifier = papal_seat_em
			}
			2530 = {
				remove_province_modifier = papal_seat_em
			}
			FRA = { remove_historical_friend = AVI }
			FRA = { remove_historical_rival = PAP }
		}
		every_country = {
			limit = { war_with = PAP }
			white_peace = PAP
		}
		if = {
			limit = { PAP = { ai = no } }
			PAP = { switch_tag = AVI }
		}
		AVI = { inherit = PAP ChangeTagEffect = { scope=PAP } }
		if = {
			limit = { religion_group = christian }
			if = {
				limit = { religion = avignonist }
				change_religion = catholic
			}
			every_owned_province = {
				if = {
					limit = { religion = avignonist }
					if = {
						limit = { has_cardinal = yes }
						RemoveCardinal = yes
					}
					change_religion = catholic
				}
				hidden_effect = { MN_RlgChange = { from = 7 to = 1 } }
			}
		}
		every_known_country = {
			limit = { religion_group = christian }
			if = {
				limit = { religion = avignonist }
				change_religion = catholic
			}
			every_owned_province = {
				if = {
					limit = { religion = avignonist }
					if = {
						limit = { has_cardinal = yes }
						RemoveCardinal = yes
					}
					change_religion = catholic
				}
				hidden_effect = { MN_RlgChange = { from = 7 to = 1 } }
			}
			if = {
				limit = { ai = no }
				country_event = { id = DG_Papacy.232 }
			}
		}
		every_known_country = {
			limit = { any_owned_province = { MN_CheckRelSlot = { Type = value Religion = 7 } } }
			every_owned_province = {
				if = {
					limit = { religion = avignonist }
					if = {
						limit = { has_cardinal = yes }
						RemoveCardinal = yes
					}
					change_religion = catholic
				}
				hidden_effect = { MN_RlgChange = { from = 7 to = 1 } }
			}
		}
	}
	after = {
		every_province = {
			limit = {
				is_core = AVI
			}
			remove_core = AVI
		}
		PAP = { Pol_ChangeGovTheocracy = { Organisation=3 Mediumship=4 Assembly=1 } }
	}
}

country_event = {
	id = DG_Papacy.232
	title = "DG_Papacy.231.title"
	desc = "DG_Papacy.231.desc"
	picture = catholic_schism
	
	is_triggered_only = yes
	
	option = {
		name = "OPT.DULYNOTED2"
	}
}

# DG_Papacy.241 - Council of [western_schism_site.GetName] of [PAP.western_schism_year.GetValue]
province_event = {
	id = DG_Papacy.241
	title = "AI_Event"
	desc = "AI_Event"
	picture = catholic_schism
	
	hidden = yes

	trigger = {
		is_part_of_hre = yes
		OR = {
			AND = {
				had_global_flag = { flag = DG_Ongoing_Western_Schism days = 5475 }
				religion_years = { hussite = 10 } #is_religion_enabled = hussite
			}
			AND = {
				religion_years = { hussite = 15 }
				NOT = { has_global_flag = DG_Jan_Hus_Fate }
			}
			
		}
		NOT = { emperor = { has_ruler_flag = aborted_schism_council } }
		NOT = { has_global_flag = DG_Ongoing_Schism_Council }
		NOT = { emperor = { has_ruler_flag = western_schism_council } }
	}
	
	mean_time_to_happen = {
		years = 10
		 
		modifier = {
			factor = 0.85
			religion_years = {
				hussite = 15
			}
		}
		modifier = {
			factor = 0.7
			religion_years = {
				hussite = 20
			}
		}
		modifier = {
			factor = 0.5
			religion_years = {
				hussite = 25
			}
		}
		modifier = {
			factor = 0.90
			had_global_flag = { flag = DG_Ongoing_Western_Schism days = 7300 }
		}
		modifier = {
			factor = 0.80
			had_global_flag = { flag = DG_Ongoing_Western_Schism days = 10950 }
		}
		modifier = {
			factor = 0.70
			had_global_flag = { flag = DG_Ongoing_Western_Schism days = 14600 }
		}
		modifier = {
			factor = 0.50
			had_global_flag = { flag = DG_Ongoing_Western_Schism days = 18250 }
		}
		modifier = {
			factor = 2.00
			NOT = { owner = { government = theocracy } }
		}
	}
	
	immediate = {
		set_global_flag = DG_Ongoing_Schism_Council
		set_global_flag = DG_Schism_Council_Start
		if = {
			limit = { has_global_flag = DG_Aborted_Schism_Council }
			clr_global_flag = DG_Aborted_Schism_Council
			set_global_flag = DG_New_Schism_Council
		}
	}

	option = {
		name = "AI_Event"
		save_global_event_target_as = western_schism_site
		PAP = {
			export_to_variable = { which = western_schism_year value = trigger_value:is_year }
		}
		emperor = { 
			country_event = {
				id = DG_Papacy.242 
			}
		}
	}
}

# DG_Papacy.242 - Emperor sends invites
country_event = {
	id = DG_Papacy.242
	title = "DG_Papacy.242.title"
	desc = "DG_Papacy.242.desc"
	picture = catholic_schism

	is_triggered_only = yes
	
	option = {
		name = "DG_Papacy.242.opta"
		every_known_country = {
			limit = {
				OR = {
					religion = catholic
					religion = avignonist
				}
				is_emperor = no
				num_of_cardinals = 1
			}
			country_event = { id = DG_Papacy.243 days = 25 random = 5 }
		}
		hidden_effect = {
			#NumOfBishops = yes
			if = {
				limit = { has_global_flag = DG_Ongoing_Western_Schism }
				PAP = { country_event = { id = DG_Papacy.244 days = 45 random = 5 } }
				AVI = { country_event = { id = DG_Papacy.244 days = 75 random = 5 } }
			}
			set_variable = { which = council_participants value = 1 }
			country_event = { id = DG_Papacy.245 days = 150 }
			set_country_flag = schism_council_participation
		}
	}
	option = {
		name = "DG_Papacy.242.optb"
		trigger = { ai = no }
		clr_global_flag = DG_Ongoing_Schism_Council
	}
}

# DG_Papacy.243 - Invitation Received
country_event = {
	id = DG_Papacy.243
	title = "DG_Papacy.243.title"
	desc = {
		trigger = {
			has_global_flag = DG_Ongoing_Western_Schism
		}
		desc = "DG_Papacy.243.desca"
	}
	desc = {
		trigger = {
			NOT = { has_global_flag = DG_Ongoing_Western_Schism }
		}
		desc = "DG_Papacy.243.descb"
	}
	picture = catholic_schism

	is_triggered_only = yes
	
	option = {
		name = "DG_Papacy.243.opta"
		ai_chance = { factor = 75 }
		set_country_flag = schism_council_participation
		#hidden_effect = { NumOfBishops = yes }
		hidden_effect = { emperor = { change_variable = { which = council_participants value = 1 } } }
	}
	option = {
		name = "DG_Papacy.243.optb"
		ai_chance = { factor = 25 }
		trigger = { OR = { ai = no has_global_flag = DG_New_Schism_Council } }
	}
}

# DG_Papacy.244 - Popes react to the Council
country_event = {
	id = DG_Papacy.244
	title = "DG_Papacy.244.title"
	desc = "DG_Papacy.244.desc"
	picture = catholic_schism

	is_triggered_only = yes
	
	option = {
		name = "DG_Papacy.244.opta"
		trigger = { OR = { ai = no tag = PAP PAP = { has_country_flag = resisting_pope } } }
		ai_chance = { factor = 25 }
		set_country_flag = abdicating_pope
	}
	option = {
		name = "DG_Papacy.244.optb"
		ai_chance = { factor = 75 }
		set_country_flag = resisting_pope
	}
}

# DG_Papacy.245 - Emperor checks if at least 5 nations are represented 
country_event = {
	id = DG_Papacy.245
	title = "AI_Event"
	desc = "AI_Event"
	picture = catholic_schism

	hidden = yes
	is_triggered_only = yes
	
	option = {
		name = "AI_Event" # Not enough participants
		trigger = { NOT = { check_variable = { which = council_participants value = 5 } } }
		if = {
			limit = { has_global_flag = DG_Ongoing_Western_Schism }
			emperor = { country_event = { id = DG_Papacy.246 days = 30 } }
		}
	}
	option = {
		name = "AI_Event" # Choosing a topic
		trigger = { check_variable = { which = council_participants value = 5 } }
		emperor = { country_event = { id = DG_Papacy.255 days = 30 } }
	}
}

country_event = {
	id = DG_Papacy.246
	title = "AI_Event"
	desc = "AI_Event"
	picture = catholic_schism

	hidden = yes
	is_triggered_only = yes
	
	option = {
		name = "AI_Event" # No Council - Avignon Pope Abdicates
		trigger = { PAP = { has_country_flag = resisting_pope } AVI = { has_country_flag = abdicating_pope } }
		emperor = { country_event = { id = DG_Papacy.247 days = 15 } }
	}
	option = {
		name = "AI_Event" # No Council - Roman Pope Abdicates
		trigger = { PAP = { has_country_flag = abdicating_pope } AVI = { has_country_flag = resisting_pope } }
		emperor = { country_event = { id = DG_Papacy.249 days = 15 } }
	}
	option = {
		name = "AI_Event" # No Council - Both Popes Abdicate
		trigger = { PAP = { has_country_flag = abdicating_pope } AVI = { has_country_flag = abdicating_pope } }
		emperor = { country_event = { id = DG_Papacy.251 days = 15 } }
	}
	option = {
		name = "AI_Event" # No Council - No abdication
		trigger = { PAP = { has_country_flag = resisting_pope } AVI = { has_country_flag = resisting_pope } }
		emperor = { country_event = { id = DG_Papacy.253 days = 15 } }
	}
	
	after = {
		clr_global_flag = DG_Ongoing_Schism_Council
		set_variable = { which = council_participants value = 0 }
		every_known_country = {
			limit = { has_country_flag = schism_council_participation }
			clr_country_flag = schism_council_participation
		}
	}
}

country_event = {
	id = DG_Papacy.247 #Avignon Pope Abdicates
	title = "DG_Papacy.247.title"
	desc = "DG_Papacy.247.desc"
	picture = catholic_schism

	is_triggered_only = yes

	trigger = {
		has_global_flag = DG_Ongoing_Western_Schism
	}

	immediate = {
		clr_global_flag = DG_Ongoing_Western_Schism
		clr_global_flag = DG_Live_Pope_In_Avignon
		set_global_flag = DG_Western_Schism_Abdication
		if = {
			limit = {
				NOT = {
					has_global_flag = DG_Live_Pope_in_Rome
				}
			}
			set_global_flag = DG_Live_Pope_in_Rome
		}
	}
	
	option = {
		name = "OPT.DULYNOTED2" # Not enough participants
		
		clr_global_flag = DG_Ongoing_Western_Schism
		AVI = { restore_country_name = yes }
		PAP = { restore_country_name = yes }
		hidden_effect = {
			202 = {
				remove_province_modifier = papal_seat_em
			}
			2530 = {
				remove_province_modifier = papal_seat_em
			}
			FRA = { remove_historical_friend = AVI }
			FRA = { remove_historical_rival = PAP }
		}
		every_country = {
			limit = { war_with = AVI }
			white_peace = AVI
		}
		if = {
			limit = { AVI = { ai = no } }
			AVI = { switch_tag = PAP }
		}
		PAP = { inherit = AVI }
		if = {
			limit = { religion_group = christian }
			if = {
				limit = { religion = avignonist }
				change_religion = catholic
			}
			every_owned_province = {
				if = {
					limit = { religion = avignonist }
					if = {
						limit = { has_cardinal = yes }
						set_province_flag = dg_has_cardinal
						RemoveCardinal = yes
					}
					change_religion = catholic
					if = {
						limit = { has_province_flag = dg_has_cardinal }
						AddCardinal = yes
						clr_province_flag = dg_has_cardinal
					}
				}
				hidden_effect = { MN_RlgChange = { from = 7 to = 1 } }
			}
		}
		every_known_country = {
			limit = { religion_group = christian }
			if = {
				limit = { religion = avignonist }
				change_religion = catholic
			}
			every_owned_province = {
				if = {
					limit = { religion = avignonist }
					if = {
						limit = { has_cardinal = yes }
						set_province_flag = dg_has_cardinal
						RemoveCardinal = yes
					}
					change_religion = catholic
					if = {
						limit = { has_province_flag = dg_has_cardinal }
						AddCardinal = yes
						clr_province_flag = dg_has_cardinal
					}
				}
				hidden_effect = { MN_RlgChange = { from = 7 to = 1 } }
			}
			if = {
				limit = { ai = no is_emperor = no }
				country_event = { id = DG_Papacy.248 }
			}
		}
		every_known_country = {
			limit = { any_owned_province = { MN_CheckRelSlot = { Type = value Religion = 7 } } }
			every_owned_province = {
				if = {
					limit = { religion = avignonist }
					if = {
						limit = { has_cardinal = yes }
						set_province_flag = dg_has_cardinal
						RemoveCardinal = yes
					}
					change_religion = catholic
					if = {
						limit = { has_province_flag = dg_has_cardinal }
						AddCardinal = yes
						clr_province_flag = dg_has_cardinal
					}
				}
				hidden_effect = { MN_RlgChange = { from = 7 to = 1 } }
			}
		}
	}
	after = {
		every_province = {
			limit = {
				is_core = AVI
			}
			remove_core = AVI
		}
		PAP = { Pol_ChangeGovTheocracy = { Organisation=3 Mediumship=4 Assembly=1 } }
	}
}

country_event = {
	id = DG_Papacy.248
	title = "DG_Papacy.247.title"
	desc = "DG_Papacy.247.desc"
	picture = catholic_schism
	
	is_triggered_only = yes
	
	option = {
		name = "OPT.DULYNOTED2"
	}
}

country_event = {
	id = DG_Papacy.249 #Rome Pope Abdicates
	title = "DG_Papacy.249.title"
	desc = "DG_Papacy.249.desc"
	picture = catholic_schism

	is_triggered_only = yes

	trigger = {
		has_global_flag = DG_Ongoing_Western_Schism
	}

	immediate = {
		clr_global_flag = DG_Ongoing_Western_Schism
		clr_global_flag = DG_Live_Pope_In_Avignon
		set_global_flag = DG_Western_Schism_Abdication
		if = {
			limit = {
				NOT = {
					has_global_flag = DG_Live_Pope_in_Rome
				}
			}
			set_global_flag = DG_Live_Pope_in_Rome
		}
	}
	
	option = {
		name = "OPT.DULYNOTED2" # Not enough participants
		AVI = { restore_country_name = yes }
		PAP = { restore_country_name = yes }
		hidden_effect = {
			202 = {
				remove_province_modifier = papal_seat_em
			}
			2530 = {
				remove_province_modifier = papal_seat_em
			}
			FRA = { remove_historical_friend = AVI }
			FRA = { remove_historical_rival = PAP }
		}
		every_country = {
			limit = { war_with = PAP }
			white_peace = PAP
		}
		AVI = { inherit = PAP ChangeTagEffect = { scope=PAP } }
		if = {
			limit = { religion_group = christian }
			if = {
				limit = { religion = avignonist }
				change_religion = catholic
			}
			every_owned_province = {
				if = {
					limit = { religion = avignonist }
					if = {
						limit = { has_cardinal = yes }
						set_province_flag = dg_has_cardinal
						RemoveCardinal = yes
					}
					change_religion = catholic
					if = {
						limit = { has_province_flag = dg_has_cardinal }
						AddCardinal = yes
						clr_province_flag = dg_has_cardinal
					}
				}
				hidden_effect = { MN_RlgChange = { from = 7 to = 1 } }
			}
		}
		every_known_country = {
			limit = { religion_group = christian }
			if = {
				limit = { religion = avignonist }
				change_religion = catholic
			}
			every_owned_province = {
				if = {
					limit = { religion = avignonist }
					if = {
						limit = { has_cardinal = yes }
						set_province_flag = dg_has_cardinal
						RemoveCardinal = yes
					}
					change_religion = catholic
					if = {
						limit = { has_province_flag = dg_has_cardinal }
						AddCardinal = yes
						clr_province_flag = dg_has_cardinal
					}
				}
				hidden_effect = { MN_RlgChange = { from = 7 to = 1 } }
			}
			if = {
				limit = { ai = no is_emperor = no }
				country_event = { id = DG_Papacy.250 }
			}
		}
		every_known_country = {
			limit = { any_owned_province = { MN_CheckRelSlot = { Type = value Religion = 7 } } }
			every_owned_province = {
				if = {
					limit = { religion = avignonist }
					if = {
						limit = { has_cardinal = yes }
						set_province_flag = dg_has_cardinal
						RemoveCardinal = yes
					}
					change_religion = catholic
					if = {
						limit = { has_province_flag = dg_has_cardinal }
						AddCardinal = yes
						clr_province_flag = dg_has_cardinal
					}
				}
				hidden_effect = { MN_RlgChange = { from = 7 to = 1 } }
			}
		}
	}
	after = {
		every_province = {
			limit = {
				is_core = AVI
			}
			remove_core = AVI
		}
		PAP = { Pol_ChangeGovTheocracy = { Organisation=3 Mediumship=4 Assembly=1 } }
	}
}

country_event = {
	id = DG_Papacy.250
	title = "DG_Papacy.249.title"
	desc = "DG_Papacy.249.desc"
	picture = catholic_schism
	
	is_triggered_only = yes
	
	option = {
		name = "OPT.DULYNOTED2"
	}
}

country_event = {
	id = DG_Papacy.251 #Both Popes Abdicate
	title = "DG_Papacy.251.title"
	desc = "DG_Papacy.251.desc"
	picture = catholic_schism

	is_triggered_only = yes

	trigger = {
		has_global_flag = DG_Ongoing_Western_Schism
	}

	immediate = {
		clr_global_flag = DG_Ongoing_Western_Schism
		clr_global_flag = DG_Live_Pope_In_Avignon
		set_global_flag = DG_Western_Schism_Abdication
		if = {
			limit = {
				NOT = {
					has_global_flag = DG_Live_Pope_in_Rome
				}
			}
			set_global_flag = DG_Live_Pope_in_Rome
		}
	}
	
	option = {
		name = "OPT.DULYNOTED2" # Not enough participants
		AVI = { restore_country_name = yes }
		PAP = { restore_country_name = yes }
		hidden_effect = {
			202 = {
				remove_province_modifier = papal_seat_em
			}
			2530 = {
				remove_province_modifier = papal_seat_em
			}
			FRA = { remove_historical_friend = AVI }
			FRA = { remove_historical_rival = PAP }
		}
		every_country = {
			limit = { war_with = AVI }
			white_peace = AVI
		}
		PAP = { inherit = AVI kill_ruler = yes }
		if = {
			limit = { religion_group = christian }
			if = {
				limit = { religion = avignonist }
				change_religion = catholic
			}
			every_owned_province = {
				if = {
					limit = { religion = avignonist }
					if = {
						limit = { has_cardinal = yes }
						set_province_flag = dg_has_cardinal
						RemoveCardinal = yes
					}
					change_religion = catholic
					if = {
						limit = { has_province_flag = dg_has_cardinal }
						AddCardinal = yes
						clr_province_flag = dg_has_cardinal
					}
				}
				hidden_effect = { MN_RlgChange = { from = 7 to = 1 } }
			}
		}
		every_known_country = {
			limit = { religion_group = christian }
			if = {
				limit = { religion = avignonist }
				change_religion = catholic
			}
			every_owned_province = {
				if = {
					limit = { religion = avignonist }
					if = {
						limit = { has_cardinal = yes }
						set_province_flag = dg_has_cardinal
						RemoveCardinal = yes
					}
					change_religion = catholic
					if = {
						limit = { has_province_flag = dg_has_cardinal }
						AddCardinal = yes
						clr_province_flag = dg_has_cardinal
					}
				}
				hidden_effect = { MN_RlgChange = { from = 7 to = 1 } }
			}
			if = {
				limit = { ai = no is_emperor = no }
				country_event = { id = DG_Papacy.252 }
			}
		}
		every_known_country = {
			limit = { any_owned_province = { MN_CheckRelSlot = { Type = value Religion = 7 } } }
			every_owned_province = {
				if = {
					limit = { religion = avignonist }
					if = {
						limit = { has_cardinal = yes }
						set_province_flag = dg_has_cardinal
						RemoveCardinal = yes
					}
					change_religion = catholic
					if = {
						limit = { has_province_flag = dg_has_cardinal }
						AddCardinal = yes
						clr_province_flag = dg_has_cardinal
					}
				}
				hidden_effect = { MN_RlgChange = { from = 7 to = 1 } }
			}
		}
		#PAP = { country_event = { id = DG_Papacy.101 } }		#Not needed, already triggered from killing the ruler above
	}
	after = {
		every_province = {
			limit = {
				is_core = AVI
			}
			remove_core = AVI
		}
		PAP = { Pol_ChangeGovTheocracy = { Organisation=3 Mediumship=4 Assembly=1 } }
	}
}

country_event = {
	id = DG_Papacy.252
	title = "DG_Papacy.251.title"
	desc = "DG_Papacy.251.desc"
	picture = catholic_schism
	
	is_triggered_only = yes
	
	option = {
		name = "OPT.DULYNOTED2"
	}
}

country_event = {
	id = DG_Papacy.253
	title = "DG_Papacy.253.title"
	desc = "DG_Papacy.253.desc"
	picture = catholic_schism
	
	is_triggered_only = yes
	
	option = {
		name = "OPT.DULYNOTED2"
		every_known_country = {
			limit = { western_christian = yes ai = no is_emperor = no }
			country_event = { id = DG_Papacy.254 }
		}
	}
}

country_event = {
	id = DG_Papacy.254
	title = "DG_Papacy.253.title"
	desc = "DG_Papacy.253.desc"
	picture = catholic_schism
	
	is_triggered_only = yes
	
	option = {
		name = "OPT.DULYNOTED2"
	}
}

# Ensures the Emperor remains in control even if Emperor just changed
country_event = {
	id = DG_Papacy.255
	title = "AI_Event"
	desc = "AI_Event"
	picture = catholic_schism
	
	hidden = yes
	is_triggered_only = yes
	
	immediate = {
		2359 = {
			set_key = { lhs = VoteCountT value = 0 }
			set_key = { lhs = VoteCount1 value = 0 }
			set_key = { lhs = VoteCount2 value = 0 }
			set_key = { lhs = VoteCount3 value = 0 }
			set_key = { lhs = VoteCount4 value = 0 }
			set_key = { lhs = VoteCountW value = 0 }
		}
		if = {
			limit = { has_global_flag = DG_Western_Schism_Vote }
			if = {
				limit = { has_global_flag = DG_Inconclusive_Vote }
				clr_global_flag = DG_Inconclusive_Vote
			}
			else = {
				set_global_flag = DG_Western_Schism_Mended
			}
			clr_global_flag = DG_Western_Schism_Vote
		}
		else_if = {
			limit = { has_global_flag = DG_Jan_Hus_Trial }
			if = {
				limit = { has_global_flag = DG_Inconclusive_Vote }
				clr_global_flag = DG_Inconclusive_Vote
			}
			else = {
				set_global_flag = DG_Jan_Hus_Trial_Over
			}
			clr_global_flag = DG_Jan_Hus_Trial
		}
		else_if = {
			limit = { has_global_flag = DG_Baltic_Crusade_Legality }
			clr_global_flag = DG_Baltic_Crusade_Legality
			set_global_flag = DG_Baltic_Crusade_Legality_Decided
		}
	}
	option = { 
		name = "AI_Event"
		trigger = {
			OR = {
				NOT = { has_global_flag = DG_Western_Schism_Mended }
				NOT = { has_global_flag = DG_Jan_Hus_Trial_Over }
				#NOT = { has_global_flag = DG_Baltic_Crusade_Legality_Decided }
			}
		} 
		emperor = { country_event = { id = DG_Papacy.256 days = 15 } }
	}
	option = { 
		name = "AI_Event"
		trigger = {
			has_global_flag = DG_Western_Schism_Mended
			has_global_flag = DG_Jan_Hus_Trial_Over
			#has_global_flag = DG_Baltic_Crusade_Legality_Decided
		}
		set_global_flag = DG_Schism_Council_Over
		#clr_global_flag = DG_Jan_Hus_Fate
		clr_global_flag = DG_Jan_Hus_Trial_Over
		clr_global_flag = DG_Ongoing_Schism_Council
		#emperor = {  country_event = {  id = DG_Papacy.XXX days = 15 } }
	}
}

# The Agenda
country_event = {
	id = DG_Papacy.256
	title = "DG_Papacy.256.title"
	desc = "DG_Papacy.256.desc"
	picture = catholic_schism
	
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			every_country = {
				limit = {
					OR = {
						has_country_modifier = casted_vote_ballot_1
						has_country_modifier = casted_vote_ballot_2
						has_country_modifier = casted_vote_ballot_3
						has_country_modifier = casted_vote_ballot_4
					}
				}
				remove_country_modifier = casted_vote_ballot_1
				remove_country_modifier = casted_vote_ballot_2
				remove_country_modifier = casted_vote_ballot_3
				remove_country_modifier = casted_vote_ballot_4
			}
		}
	}

	option = {
		name = "DG_Papacy.256.opta" # Western Schism
		log = "DG_Papacy.256.opta happened"
		trigger = { AVI = { exists = yes religion = avignonist } NOT = { has_global_flag = DG_Western_Schism_Mended } }
		ai_chance = { factor = 75 }
		set_global_flag = DG_Western_Schism_Vote
		every_known_country = {
			limit = {
				OR = {
					religion = catholic
					religion = avignonist
				}
				is_emperor = no
				num_of_cardinals = 1
				has_country_flag = schism_council_participation
			}
			country_event = { id = DG_Papacy.257 days = 15 random = 5 }
		}
		country_event = { id = DG_Papacy.257 days = 5 }
		country_event = { id = DG_Papacy.258 days = 75 }
	}
	option = {
		name = "DG_Papacy.256.optb" # Jan Hus
		log = "DG_Papacy.256.optb happened"
		trigger = { 
			OR = { 
				ai = no 
				NOT = {
					AVI = { exists = yes religion = avignonist } 
				} 
			} 
			is_religion_enabled = hussite 
			NOT = { has_global_flag = DG_Jan_Hus_Fate } 
		}
		ai_chance = { factor = 25 }
		set_global_flag = DG_Jan_Hus_Trial
		every_known_country = {
			limit = {
				OR = {
					religion = catholic
					religion = avignonist
				}
				is_emperor = no
				num_of_cardinals = 1
				has_country_flag = schism_council_participation
			}
			country_event = { id = DG_Papacy.266 days = 15 random = 5 }
		}
		country_event = { id = DG_Papacy.266 days = 5 }
		country_event = { id = DG_Papacy.267 days = 75 }
	}
	option = {
		name = "DG_Papacy.256.optc" # Legality of Teutonic Wars
		trigger = { always = no OR = { ai = no NOT = { AVI = { exists = yes religion = avignonist } } } NOT = { has_global_flag = DG_teutonic_war_legality } }
		set_global_flag = DG_Baltic_Crusade_Legality
		#emperor = { country_event = { id = DG_Papacy.256 days = 30 } }
		hidden_effect = { country_event = { id = DG_Papacy.255 days = 180 random = 15 } }
	}
	option = {
		name = "DG_Papacy.256.optd" # Nothing for now
		trigger = { ai = no }
		hidden_effect = { country_event = { id = DG_Papacy.255 days = 120 random = 15 } }
	}
	option = {
		name = "DG_Papacy.256.opte" # Ajourn
		trigger = { OR = { ai = no has_global_flag = DG_Western_Schism_Mended } }
		ai_chance = { factor = 1 }
		set_global_flag = DG_Aborted_Schism_Council
		set_ruler_flag = aborted_schism_council
		hidden_effect = {
			if = {
				limit = { NOT = { has_global_flag = DG_Jan_Hus_Fate } }
				country_event = { id = DG_Papacy.276 days = 5 }
			}
		}
	}
}

#Vote regarding the Western Schism
country_event = {
	id = DG_Papacy.257
	title = "DG_Papacy.257.title"
	desc = "DG_Papacy.257.desc"
	picture = catholic_schism
	
	is_triggered_only = yes

	option = {
		name = "DG_Papacy.257.opta" # Choose the Rome Pope
		trigger = { religion = catholic PAP = { has_country_flag = resisting_pope } }
		ai_chance = { factor = 20 }
		CastingVote = { Ballot = 1 }
		add_country_modifier = {
			name = casted_vote_ballot_1
			duration = 500
			hidden = yes
		}
	}
	option = {
		name = "DG_Papacy.257.optb" # Choose the Avignon Pope
		trigger = { religion = avignonist AVI = { has_country_flag = resisting_pope } }
		ai_chance = { factor = 20 }
		CastingVote = { Ballot = 2 }
		add_country_modifier = {
			name = casted_vote_ballot_2
			duration = 500
			hidden = yes
		}
	}
	option = {
		name = "DG_Papacy.257.optc" # Pick a Third Candidate
		trigger = { PAP = { has_country_flag = resisting_pope } AVI = { has_country_flag = resisting_pope } }
		ai_chance = { factor = 80 }
		CastingVote = { Ballot = 3 }
		add_country_modifier = {
			name = casted_vote_ballot_3
			duration = 500
			hidden = yes
		}
	}
	option = {
		name = "DG_Papacy.257.optd" # Pick a Third Candidate
		trigger = { OR = { AND = { PAP = { has_country_flag = resisting_pope } NOT = { AVI = { has_country_flag = resisting_pope } } } AND = { NOT = { PAP = { has_country_flag = resisting_pope } } AVI = { has_country_flag = resisting_pope } } } }
		ai_chance = { factor = 80 }
		CastingVote = { Ballot = 3 }
		add_country_modifier = {
			name = casted_vote_ballot_3
			duration = 500
			hidden = yes
		}
	}
	option = {
		name = "DG_Papacy.257.opte" # Pick a Third Candidate
		trigger = { NOT = { PAP = { has_country_flag = resisting_pope } } NOT = { AVI = { has_country_flag = resisting_pope } } }
		ai_chance = { factor = 80 }
		CastingVote = { Ballot = 3 }
		add_country_modifier = {
			name = casted_vote_ballot_3
			duration = 500
			hidden = yes
		}
	}
	option = {
		name = "DG_Papacy.257.optf" # Abstain
		trigger = { ai = no }
		CastingVote = { Ballot = 4 }
		add_country_modifier = {
			name = casted_vote_ballot_4
			duration = 500
			hidden = yes
		}
	}
}

#Tallying the votes regarding the Western Schism
country_event = {
	id = DG_Papacy.258
	title = "AI_Event"
	desc = "AI_Event"
	picture = catholic_schism
	
	hidden = yes
	is_triggered_only = yes
	
	immediate = {
		TallyingVotes = yes
	}

	option = {
		name = "AI_Event" # Rome Pope Chosen
		trigger = { 2359 = { is_key_equal = { lhs = VoteCountW value = 1 } } }
		emperor = { country_event = { id = DG_Papacy.259 days = 5 } }
	}
	option = {
		name = "AI_Event" # Avignon Pope Chosen
		trigger = { 2359 = { is_key_equal = { lhs = VoteCountW value = 2 } } }
		emperor = { country_event = { id = DG_Papacy.261 days = 5 } }
	}
	option = {
		name = "AI_Event" # Third Candidate Chosen
		trigger = { 2359 = { is_key_equal = { lhs = VoteCountW value = 3 } } }
		emperor = { country_event = { id = DG_Papacy.263 days = 5 } }
	}
	option = {
		name = "AI_Event" # Stalemate Vote
		trigger = { has_global_flag = DG_Inconclusive_Vote }
		emperor = { country_event = { id = DG_Papacy.265 days = 5 } }
	}
}

#Rome Pope Chosen
country_event = {
	id = DG_Papacy.259
	title = "DG_Papacy.259.title"
	desc = "DG_Papacy.259.desc"
	picture = catholic_schism
	
	is_triggered_only = yes

	trigger = {
		has_global_flag = DG_Ongoing_Western_Schism
	}

	immediate = {
		clr_global_flag = DG_Ongoing_Western_Schism
		clr_global_flag = DG_Live_Pope_In_Avignon
		if = {
			limit = {
				NOT = {
					has_global_flag = DG_Live_Pope_in_Rome
				}
			}
			set_global_flag = DG_Live_Pope_in_Rome
		}
	}
	
	option = {
		name = "OPT.VERYWELL"
		AVI = { restore_country_name = yes }
		PAP = { restore_country_name = yes }
		hidden_effect = {
			202 = {
				remove_province_modifier = papal_seat_em
			}
			2530 = {
				remove_province_modifier = papal_seat_em
			}
			FRA = { remove_historical_friend = AVI }
			FRA = { remove_historical_rival = PAP }
		}
		every_country = {
			limit = { war_with = AVI }
			white_peace = AVI
		}
		if = {
			limit = { AVI = { ai = no } }
			AVI = { switch_tag = PAP }
		}
		PAP = { inherit = AVI }
		if = {
			limit = { religion_group = christian }
			if = {
				limit = { religion = avignonist }
				change_religion = catholic
			}
			every_owned_province = {
				if = {
					limit = { religion = avignonist }
					if = {
						limit = { has_cardinal = yes }
						RemoveCardinal = yes
					}
					change_religion = catholic
				}
				hidden_effect = { MN_RlgChange = { from = 7 to = 1 } }
			}
		}
		every_known_country = {
			limit = { religion_group = christian }
			if = {
				limit = { religion = avignonist }
				change_religion = catholic
			}
			every_owned_province = {
				if = {
					limit = { religion = avignonist }
					if = {
						limit = { has_cardinal = yes }
						RemoveCardinal = yes
					}
					change_religion = catholic
				}
				hidden_effect = { MN_RlgChange = { from = 7 to = 1 } }
			}
			if = {
				limit = { ai = no }
				country_event = { id = DG_Papacy.260 }
			}
		}
		every_known_country = {
			limit = { any_owned_province = { MN_CheckRelSlot = { Type = value Religion = 7 } } }
			every_owned_province = {
				if = {
					limit = { religion = avignonist }
					if = {
						limit = { has_cardinal = yes }
						RemoveCardinal = yes
					}
					change_religion = catholic
				}
				hidden_effect = { MN_RlgChange = { from = 7 to = 1 } }
			}
		}
	}
	
	after = {
		country_event = { id = DG_Papacy.255 days = 100 random = 15 }
		every_province = {
			limit = {
				is_core = AVI
			}
			remove_core = AVI
		}
		PAP = { Pol_ChangeGovTheocracy = { Organisation=3 Mediumship=4 Assembly=1 } }
	}
}

country_event = {
	id = DG_Papacy.260
	title = "DG_Papacy.259.title" #player-only notification event
	desc = "DG_Papacy.259.desc"
	picture = catholic_schism
	
	is_triggered_only = yes
	
	option = {
		name = "DG_Papacy.260.opta"
		every_country = {
			limit = {
				has_country_modifier = casted_vote_ballot_1
			}
			remove_country_modifier = casted_vote_ballot_1
		}
	}
	option = {
		name = "DG_Papacy.260.optb"
		every_country = {
			limit = {
				has_country_modifier = casted_vote_ballot_2
			}
			remove_country_modifier = casted_vote_ballot_2
		}
	}
	option = {
		name = "DG_Papacy.260.optc"
		every_country = {
			limit = {
				has_country_modifier = casted_vote_ballot_3
			}
			remove_country_modifier = casted_vote_ballot_3
		}
	}
	option = {
		name = "DG_Papacy.260.optd"
		every_country = {
			limit = {
				has_country_modifier = casted_vote_ballot_4
			}
			remove_country_modifier = casted_vote_ballot_4
		}
	}
	option = {
		name = "OPT.ISEE"
	}

	after = {
		hidden_effect = {
			every_country = {
				limit = {
					OR = {
						has_country_modifier = casted_vote_ballot_1
						has_country_modifier = casted_vote_ballot_2
						has_country_modifier = casted_vote_ballot_3
						has_country_modifier = casted_vote_ballot_4
					}
				}
				remove_country_modifier = casted_vote_ballot_1
				remove_country_modifier = casted_vote_ballot_2
				remove_country_modifier = casted_vote_ballot_3
				remove_country_modifier = casted_vote_ballot_4
			}
		}
	}
}

#Avignon Pope Chosen
country_event = {
	id = DG_Papacy.261
	title = "DG_Papacy.261.title"
	desc = "DG_Papacy.261.desc"
	picture = catholic_schism

	is_triggered_only = yes

	trigger = {
		has_global_flag = DG_Ongoing_Western_Schism
	}
	
	immediate = {
		clr_global_flag = DG_Ongoing_Western_Schism
		clr_global_flag = DG_Live_Pope_In_Avignon
		if = {
			limit = {
				NOT = {
					has_global_flag = DG_Live_Pope_in_Rome
				}
			}
			set_global_flag = DG_Live_Pope_in_Rome
		}
	}

	option = {
		name = "OPT.VERYWELL"
		AVI = { restore_country_name = yes }
		PAP = { restore_country_name = yes }
		hidden_effect = {
			202 = {
				remove_province_modifier = papal_seat_em
			}
			2530 = {
				remove_province_modifier = papal_seat_em
			}
			FRA = { remove_historical_friend = AVI }
			FRA = { remove_historical_rival = PAP }
		}
		every_country = {
			limit = { war_with = AVI }
			white_peace = AVI
		}
		if = {
			limit = { AVI = { ai = no } }
			AVI = { switch_tag = PAP }
		}
		PAP = { inherit = AVI }
		if = {
			limit = { religion_group = christian }
			if = {
				limit = { religion = avignonist }
				change_religion = catholic
			}
			every_owned_province = {
				if = {
					limit = { religion = catholic has_cardinal = yes }
						RemoveCardinal = yes
					}
				else_if = {
					limit = { religion = avignonist }
					if = {
						limit = { has_cardinal = yes }
						set_province_flag = dg_has_cardinal
						RemoveCardinal = yes
					}
					change_religion = catholic
					if = {
						limit = { has_province_flag = dg_has_cardinal }
						AddCardinal = yes
						clr_province_flag = dg_has_cardinal
					}
				}
				hidden_effect = { MN_RlgChange = { from = 7 to = 1 } }
			}
		}
		every_known_country = {
			limit = { religion_group = christian }
			if = {
				limit = { religion = avignonist }
				change_religion = catholic
			}
			every_owned_province = {
				if = {
					limit = { religion = catholic has_cardinal = yes }
						RemoveCardinal = yes
					}
				else_if = {
					limit = { religion = avignonist }
					if = {
						limit = { has_cardinal = yes }
						set_province_flag = dg_has_cardinal
						RemoveCardinal = yes
					}
					change_religion = catholic
					if = {
						limit = { has_province_flag = dg_has_cardinal }
						AddCardinal = yes
						clr_province_flag = dg_has_cardinal
					}
				}
				hidden_effect = { MN_RlgChange = { from = 7 to = 1 } }
			}
			if = {
				limit = { ai = no }
				country_event = { id = DG_Papacy.262 }
			}
		}
		every_known_country = {
			limit = { any_owned_province = { MN_CheckRelSlot = { Type = value Religion = 7 } } }
			every_owned_province = {
				if = {
					limit = { religion = catholic has_cardinal = yes }
						RemoveCardinal = yes
					}
				else_if = {
					limit = { religion = avignonist }
					if = {
						limit = { has_cardinal = yes }
						set_province_flag = dg_has_cardinal
						RemoveCardinal = yes
					}
					change_religion = catholic
					if = {
						limit = { has_province_flag = dg_has_cardinal }
						AddCardinal = yes
						clr_province_flag = dg_has_cardinal
					}
				}
				hidden_effect = { MN_RlgChange = { from = 7 to = 1 } }
			}
		}
		#AVI = { change_religion = catholic }

	}
	
	after = {
		country_event = { id = DG_Papacy.255 days = 100 random = 15 }
		every_province = {
			limit = {
				is_core = AVI
			}
			remove_core = AVI
		}
		PAP = { Pol_ChangeGovTheocracy = { Organisation=3 Mediumship=4 Assembly=1 } }
	}
}

country_event = {
	id = DG_Papacy.262
	title = "DG_Papacy.261.title"
	desc = "DG_Papacy.261.desc"
	picture = catholic_schism
	
	is_triggered_only = yes
	
	option = {
		name = "DG_Papacy.260.opta"
		every_country = {
			limit = {
				has_country_modifier = casted_vote_ballot_1
			}
			remove_country_modifier = casted_vote_ballot_1
		}
	}
	option = {
		name = "DG_Papacy.260.optb"
		every_country = {
			limit = {
				has_country_modifier = casted_vote_ballot_2
			}
			remove_country_modifier = casted_vote_ballot_2
		}
	}
	option = {
		name = "DG_Papacy.260.optc"
		every_country = {
			limit = {
				has_country_modifier = casted_vote_ballot_3
			}
			remove_country_modifier = casted_vote_ballot_3
		}
	}
	option = {
		name = "DG_Papacy.260.optd"
		every_country = {
			limit = {
				has_country_modifier = casted_vote_ballot_4
			}
			remove_country_modifier = casted_vote_ballot_4
		}
	}
	option = {
		name = "OPT.ISEE"
	}

	after = {
		hidden_effect = {
			every_country = {
				limit = {
					OR = {
						has_country_modifier = casted_vote_ballot_1
						has_country_modifier = casted_vote_ballot_2
						has_country_modifier = casted_vote_ballot_3
						has_country_modifier = casted_vote_ballot_4
					}
				}
				remove_country_modifier = casted_vote_ballot_1
				remove_country_modifier = casted_vote_ballot_2
				remove_country_modifier = casted_vote_ballot_3
				remove_country_modifier = casted_vote_ballot_4
			}
		}
	}
}

#Third Candidate Chosen
country_event = {
	id = DG_Papacy.263
	title = "DG_Papacy.263.title"
	desc = "DG_Papacy.263.desc"
	picture = catholic_schism

	is_triggered_only = yes

	trigger = {
		has_global_flag = DG_Ongoing_Western_Schism
	}
	
	immediate = {
		clr_global_flag = DG_Ongoing_Western_Schism
		clr_global_flag = DG_Live_Pope_In_Avignon
		if = {
			limit = {
				NOT = {
					has_global_flag = DG_Live_Pope_in_Rome
				}
			}
			set_global_flag = DG_Live_Pope_in_Rome
		}
	}

	option = {
		name = "OPT.VERYWELL"
		AVI = { restore_country_name = yes }
		PAP = { restore_country_name = yes }
		hidden_effect = {
			202 = {
				remove_province_modifier = papal_seat_em
			}
			2530 = {
				remove_province_modifier = papal_seat_em
			}
			FRA = { remove_historical_friend = AVI }
			FRA = { remove_historical_rival = PAP }
		}
		every_country = {
			limit = { war_with = AVI }
			white_peace = AVI
		}
		if = {
			limit = { AVI = { ai = no } }
			AVI = { switch_tag = PAP }
		}
		PAP = { inherit = AVI kill_ruler = yes }
		if = {
			limit = { religion_group = christian }
			if = {
				limit = { religion = avignonist }
				change_religion = catholic
			}
			every_owned_province = {
				if = {
					limit = { religion = avignonist }
					if = {
						limit = { has_cardinal = yes }
						set_province_flag = dg_has_cardinal
						RemoveCardinal = yes
					}
					change_religion = catholic
					if = {
						limit = { has_province_flag = dg_has_cardinal }
						AddCardinal = yes
						clr_province_flag = dg_has_cardinal
					}
				}
				hidden_effect = { MN_RlgChange = { from = 7 to = 1 } }
			}
		}
		every_country = {
			limit = { religion_group = christian }
			if = {
				limit = { religion = avignonist }
				change_religion = catholic
			}
			every_owned_province = {
				if = {
					limit = { religion = avignonist }
					if = {
						limit = { has_cardinal = yes }
						set_province_flag = dg_has_cardinal
						RemoveCardinal = yes
					}
					change_religion = catholic
					if = {
						limit = { has_province_flag = dg_has_cardinal }
						AddCardinal = yes
						clr_province_flag = dg_has_cardinal
					}
				}
				hidden_effect = { MN_RlgChange = { from = 7 to = 1 } }
			}
			if = {
				limit = { ai = no }
				country_event = { id = DG_Papacy.264 }
			}
		}
		every_country = {
			limit = { any_owned_province = { MN_CheckRelSlot = { Type = value Religion = 7 } } }
			every_owned_province = {
				if = {
					limit = { religion = avignonist }
					if = {
						limit = { has_cardinal = yes }
						set_province_flag = dg_has_cardinal
						RemoveCardinal = yes
					}
					change_religion = catholic
					if = {
						limit = { has_province_flag = dg_has_cardinal }
						AddCardinal = yes
						clr_province_flag = dg_has_cardinal
					}
				}
				hidden_effect = { MN_RlgChange = { from = 7 to = 1 } }
			}
		}
	}
	
	after = {
		country_event = { id = DG_Papacy.255 days = 100 random = 15 }
		every_province = {
			limit = {
				is_core = AVI
			}
			remove_core = AVI
		}
		PAP = { Pol_ChangeGovTheocracy = { Organisation=3 Mediumship=4 Assembly=1 } }

	}
}

country_event = {
	id = DG_Papacy.264
	title = "DG_Papacy.263.title"
	desc = "DG_Papacy.263.desc"
	picture = catholic_schism
	
	is_triggered_only = yes
	
	option = {
		name = "DG_Papacy.260.opta"
		every_country = {
			limit = {
				has_country_modifier = casted_vote_ballot_1
			}
			remove_country_modifier = casted_vote_ballot_1
		}
	}
	option = {
		name = "DG_Papacy.260.optb"
		every_country = {
			limit = {
				has_country_modifier = casted_vote_ballot_2
			}
			remove_country_modifier = casted_vote_ballot_2
		}
	}
	option = {
		name = "DG_Papacy.260.optc"
		every_country = {
			limit = {
				has_country_modifier = casted_vote_ballot_3
			}
			remove_country_modifier = casted_vote_ballot_3
		}
	}
	option = {
		name = "DG_Papacy.260.optd"
		every_country = {
			limit = {
				has_country_modifier = casted_vote_ballot_4
			}
			remove_country_modifier = casted_vote_ballot_4
		}
	}
	option = {
		name = "OPT.ISEE"
	}

	after = {
		hidden_effect = {
			every_country = {
				limit = {
					OR = {
						has_country_modifier = casted_vote_ballot_1
						has_country_modifier = casted_vote_ballot_2
						has_country_modifier = casted_vote_ballot_3
						has_country_modifier = casted_vote_ballot_4
					}
				}
				remove_country_modifier = casted_vote_ballot_1
				remove_country_modifier = casted_vote_ballot_2
				remove_country_modifier = casted_vote_ballot_3
				remove_country_modifier = casted_vote_ballot_4
			}
		}
	}
}

#Vote is Inconclusive
country_event = {
	id = DG_Papacy.265
	title = "DG_Papacy.265.title"
	desc = "DG_Papacy.265.desc"
	picture = catholic_schism
	
	is_triggered_only = yes
	
	option = {
		name = "DG_Papacy.265.opta"
		every_country = {
			limit = { religion_group = christian }
			if = {
				limit = { ai = no }
				country_event = { id = DG_Papacy.2650 }
			}
		}
	}
	
	after = {
		country_event = { id = DG_Papacy.255 days = 100 random = 15 } 
	}
}

country_event = {
	id = DG_Papacy.2650
	title = "DG_Papacy.265.title"
	desc = "DG_Papacy.265.desc"
	picture = catholic_schism
	
	is_triggered_only = yes
	
	option = {
		name = "DG_Papacy.260.opta"
		every_country = {
			limit = {
				has_country_modifier = casted_vote_ballot_1
			}
			remove_country_modifier = casted_vote_ballot_1
		}
	}
	option = {
		name = "DG_Papacy.260.optb"
		every_country = {
			limit = {
				has_country_modifier = casted_vote_ballot_2
			}
			remove_country_modifier = casted_vote_ballot_2
		}
	}
	option = {
		name = "DG_Papacy.260.optc"
		every_country = {
			limit = {
				has_country_modifier = casted_vote_ballot_3
			}
			remove_country_modifier = casted_vote_ballot_3
		}
	}
	option = {
		name = "DG_Papacy.260.optd"
		every_country = {
			limit = {
				has_country_modifier = casted_vote_ballot_4
			}
			remove_country_modifier = casted_vote_ballot_4
		}
	}
	option = {
		name = "DG_Papacy.265.opta"
	}

	after = {
		hidden_effect = {
			every_country = {
				limit = {
					OR = {
						has_country_modifier = casted_vote_ballot_1
						has_country_modifier = casted_vote_ballot_2
						has_country_modifier = casted_vote_ballot_3
						has_country_modifier = casted_vote_ballot_4
					}
				}
				remove_country_modifier = casted_vote_ballot_1
				remove_country_modifier = casted_vote_ballot_2
				remove_country_modifier = casted_vote_ballot_3
				remove_country_modifier = casted_vote_ballot_4
			}
		}
	}
}

#Vote regarding Jan Hus
country_event = {
	id = DG_Papacy.266
	title = "DG_Papacy.266.title"
	desc = "DG_Papacy.266.desc"
	picture = catholic_schism
	
	is_triggered_only = yes

	option = {
		name = "DG_Papacy.266.opta" #Burn Jan Hus
		ai_chance = {
			factor = 75
		}
		CastingVote = { Ballot = 1 }
		add_country_modifier = {
			name = casted_vote_ballot_1
			duration = 500
			hidden = yes
		}
	}
	option = {
		name = "DG_Papacy.266.optb" #Excommunicate
		ai_chance = {
			factor =  5
			modifier = {
				factor = 0
				is_emperor = yes
			}
		}
		CastingVote = { Ballot = 2 }
		add_country_modifier = {
			name = casted_vote_ballot_2
			duration = 500
			hidden = yes
		}
	}
	option = {
		name = "DG_Papacy.266.optc" #Reform the Church
		ai_chance = {
			factor =  5
			modifier = {
				factor = 0
				capital_scope = { superregion = italy_superregion }
			}
			modifier = {
				factor = 0
				capital_scope = { superregion = iberia_superregion }
			}
			modifier = {
				factor = 0
				is_emperor = yes
			}
		}
		CastingVote = { Ballot = 3 }
		add_country_modifier = {
			name = casted_vote_ballot_3
			duration = 500
			hidden = yes
		}
	}
	option = {
		name = "DG_Papacy.266.optd" #Abstain
		trigger = { ai = no }
		CastingVote = { Ballot = 4 }
		add_country_modifier = {
			name = casted_vote_ballot_4
			duration = 500
			hidden = yes
		}
	}
}

#Tallying the votes regarding Jan Hus
country_event = {
	id = DG_Papacy.267
	title = "AI_Event"
	desc = "AI_Event"
	picture = catholic_schism
	
	hidden = yes
	is_triggered_only = yes
	
	immediate = {
		TallyingVotes = yes
	}

	option = {
		name = "AI_Event" #Burn Jan Hus
		trigger = { 2359 = { is_key_equal = { lhs = VoteCountW value = 1 } } }
		emperor  = {
			country_event = { id = DG_Papacy.268 days = 5 }
		}
	}
	option = {
		name = "AI_Event" #Excommunicate Jan Hus
		trigger = { 2359 = { is_key_equal = { lhs = VoteCountW value = 2 } } }
		emperor = {
			country_event = { id = DG_Papacy.270 days = 5 }
		}

	}
	option = {
		name = "AI_Event" #Reform the Church
		trigger = { 2359 = { is_key_equal = { lhs = VoteCountW value = 3 } } }
		emperor  = {
			country_event = { id = DG_Papacy.272 days = 5 }
		}
	}
	option = {
		name = "AI_Event" # Stalemate Vote
		trigger = { has_global_flag = DG_Inconclusive_Vote }
		emperor  = {
			country_event = { id = DG_Papacy.274 days = 5 }
		}
	}
}

#Burn Jan Hus
country_event = {
	id = DG_Papacy.268
	title = "DG_Papacy.268.title"
	desc = "DG_Papacy.268.desc"
	picture = catholic_schism

	major = yes
	
	is_triggered_only = yes
	
	immediate = {
		emperor = {
			set_global_flag = DG_Jan_Hus_Fate
			set_global_flag = DG_Burn_Jan_Hus
			add_reform_desire = 0.0005
		}
		hidden_effect = {
			every_province = {
				limit = { OR = { culture = czech culture = moravian } }
				set_key = { lhs = Heresy_Scalar value = 0 }
				random_list = {
					40 = { set_key = { lhs = Heresy_Scalar value = 0.60 } }
					30 = { set_key = { lhs = Heresy_Scalar value = 0.50 } }
					20 = { set_key = { lhs = Heresy_Scalar value = 0.40 } }
					10 = { set_key = { lhs = Heresy_Scalar value = 0.30 } }
					1 = { set_key = { lhs = Heresy_Scalar value = 0.20 } }
				}
				if = {
					limit = {
						check_key = { lhs = Heresy_Scalar value = 0.05 }
					}
					MN_HeresySpread = { typefrom = value from = 1 to = 4 incr = Heresy_Scalar typeIncr = which }
				}
				set_key = { lhs = Heresy_Scalar value = 0 }
				random_list = {
					50 = { MN_Attribute_Effect = { reltype = value religion = 4 typeEffect = Preach typeStrength = value strength = 0 } }
					25 = { MN_Attribute_Effect = { reltype = value religion = 4 typeEffect = Preach typeStrength = value strength = 1 } }
					15 = { MN_Attribute_Effect = { reltype = value religion = 4 typeEffect = Preach typeStrength = value strength = 2 } }
					10 = { MN_Attribute_Effect = { reltype = value religion = 4 typeEffect = Preach typeStrength = value strength = 5 } }
				}
			}
		}
	}
	
	option = {
		name = "DG_Papacy.268.opta"
		trigger = { any_owned_province = { has_province_flag = hus_craddle } }
		country_event = { id = DG_Hussites.006 days = 14 }
	}

	option = {
		name = "OPT.VERYWELL"
		trigger = { NOT = { any_owned_province = { has_province_flag = hus_craddle } } }
		random_country = {
		    limit = {
			    any_owned_province = { has_province_flag = hus_craddle }
			}
			country_event = { id = DG_Hussites.006 days = 14 }
		}
	}
	
	after = { 
		hidden_effect = {
			every_known_country = {
				limit = { OR = { religion = catholic religion = avignonist } ai = no }
				country_event = { id = DG_Papacy.269 days = 15 }
			}
		}
	}
}

country_event = {
	id = DG_Papacy.269
	title = "DG_Papacy.268.title"
	desc = "DG_Papacy.268.desc"
	picture = catholic_schism
	
	is_triggered_only = yes
	
	option = {
		name = "DG_Papacy.269.opta"
		every_country = {
			limit = {
				has_country_modifier = casted_vote_ballot_1
			}
			remove_country_modifier = casted_vote_ballot_1
		}
	}
	option = {
		name = "DG_Papacy.269.optb"
		every_country = {
			limit = {
				has_country_modifier = casted_vote_ballot_2
			}
			remove_country_modifier = casted_vote_ballot_2
		}
	}
	option = {
		name = "DG_Papacy.269.optc"
		every_country = {
			limit = {
				has_country_modifier = casted_vote_ballot_3
			}
			remove_country_modifier = casted_vote_ballot_3
		}
		custom_tooltip = tooltip_flavor_pol.3021.a
	}
	option = {
		name = "DG_Papacy.269.optd"
		every_country = {
			limit = {
				has_country_modifier = casted_vote_ballot_4
			}
			remove_country_modifier = casted_vote_ballot_4
			custom_tooltip = tooltip_flavor_pol.3021.a
		}
	}
	option = {
		name = "DG_Papacy.268.opta"
	}

	after = {
		hidden_effect = {
			every_country = {
				limit = {
					OR = {
						has_country_modifier = casted_vote_ballot_1
						has_country_modifier = casted_vote_ballot_2
						has_country_modifier = casted_vote_ballot_3
						has_country_modifier = casted_vote_ballot_4
					}
				}
				remove_country_modifier = casted_vote_ballot_1
				remove_country_modifier = casted_vote_ballot_2
				remove_country_modifier = casted_vote_ballot_3
				remove_country_modifier = casted_vote_ballot_4
			}
		}
	}
}

#Excommunicate Jan Hus
country_event = {
	id = DG_Papacy.270
	title = "DG_Papacy.270.title"
	desc = "DG_Papacy.270.desc"
	picture = catholic_schism

	is_triggered_only = yes

	major = yes
	
	immediate = {
		emperor = {
			set_global_flag = DG_Jan_Hus_Fate
			set_global_flag = DG_Excom_Jan_Hus
			add_reform_desire = 0.0001
		}
		hidden_effect = {
			every_province = {
				limit = { OR = { culture = czech culture = moravian } }
				set_key = { lhs = Heresy_Scalar value = 0 }
				random_list = {
					40 = { set_key = { lhs = Heresy_Scalar value = 0.50 } }
					30 = { set_key = { lhs = Heresy_Scalar value = 0.40 } }
					20 = { set_key = { lhs = Heresy_Scalar value = 0.30 } }
					10 = { set_key = { lhs = Heresy_Scalar value = 0.20 } }
					1 = { set_key = { lhs = Heresy_Scalar value = 0.10 } }
				}
				if = {
					limit = {
						check_key = { lhs = Heresy_Scalar value = 0.05 }
					}
					MN_HeresySpread = { typefrom = value from = 1 to = 4 incr = Heresy_Scalar typeIncr = which }
				}
				set_key = { lhs = Heresy_Scalar value = 0 }
				random_list = {
					50 = { MN_Attribute_Effect = { reltype = value religion = 4 typeEffect = Preach typeStrength = value strength = 0 } }
					25 = { MN_Attribute_Effect = { reltype = value religion = 4 typeEffect = Preach typeStrength = value strength = 1 } }
					15 = { MN_Attribute_Effect = { reltype = value religion = 4 typeEffect = Preach typeStrength = value strength = 2 } }
					10 = { MN_Attribute_Effect = { reltype = value religion = 4 typeEffect = Preach typeStrength = value strength = 5 } }
				}
			}
		}
	}
	
	option = {
		name = "DG_Papacy.270.opta"
		trigger = { any_owned_province = { has_province_flag = hus_craddle } }
		country_event = { id = DG_Hussites.006 days = 14 }
	}

	option = {
		name = "OPT.VERYWELL"
		trigger = { NOT = { any_owned_province = { has_province_flag = hus_craddle } } }
		random_country = {
		    limit = {
			    any_owned_province = { has_province_flag = hus_craddle }
			}
			country_event = { id = DG_Hussites.006 days = 14 }
		}
	}
	
	after = {
		hidden_effect = {
			every_known_country = {
				limit = { OR = { religion = catholic religion = avignonist } ai = no }
				country_event = { id = DG_Papacy.271 days = 15 }
			}
		}
	}
}

country_event = {
	id = DG_Papacy.271
	title = "DG_Papacy.270.title"
	desc = "DG_Papacy.270.desc"
	picture = catholic_schism
	
	is_triggered_only = yes
	
	option = {
		name = "OPT.VERYWELL"
	}
}

#Reform the Church
country_event = {
	id = DG_Papacy.272
	title = "DG_Papacy.272.title"
	desc = "DG_Papacy.272.desc"
	picture = catholic_schism

	is_triggered_only = yes
	
	option = {
		name = "OPT.VERYWELL"
		emperor = {
			set_global_flag = DG_Jan_Hus_Fate
			set_global_flag = DG_Reform_Church
		}
		if = {
			limit = { religion = hussite }
			change_religion = catholic
			set_ruler_religion = catholic
		}
		every_country = {
			limit = { OR = { religion = catholic religion = avignonist } }
			SetHussiteCompromiseAspects = yes	#Pending a vote on actual reforms
		}
	}
	
	after = {
		hidden_effect = {
			country_event = { id = DG_Papacy.255 days = 100 random = 15 }
			every_known_country = {
				limit = { OR = { religion = catholic religion = avignonist } ai = no }
				country_event = { id = DG_Papacy.273 days = 15 }
			}
		}
	}
}

country_event = {
	id = DG_Papacy.273
	title = "DG_Papacy.272.title"
	desc = "DG_Papacy.272.desc"
	picture = catholic_schism
	
	is_triggered_only = yes
	
	option = {
		name = "OPT.VERYWELL"
	}
}

#Vote is Inconclusive
country_event = {
	id = DG_Papacy.274
	title = "DG_Papacy.274.title"
	desc = "DG_Papacy.274.desc"
	picture = catholic_schism
	
	is_triggered_only = yes
	
	option = {
		name = "DG_Papacy.274.opta"
	}
	
	after = {
		hidden_effect = {
			country_event = { id = DG_Papacy.255 days = 100 random = 15 }
			every_known_country = {
				limit = { OR = { religion = catholic religion = avignonist } ai = no }
				country_event = { id = DG_Papacy.275 days = 15 }
			}
		}
	}
}

country_event = {
	id = DG_Papacy.275
	title = "DG_Papacy.274.title"
	desc = "DG_Papacy.274.desc"
	picture = catholic_schism
	
	is_triggered_only = yes
	
	option = {
		name = "DG_Papacy.274.opta"
	}
}

# DG_Papacy.276 - Notification if adjourning council without dealing with Jan Hus
country_event = {
	id = DG_Papacy.276
	title = "DG_Papacy.276.title"
	desc = "DG_Papacy.276.desc"
	picture = catholic_schism
	
	is_triggered_only = yes
	
	option = {
		name = "DG_Papacy.276.opta"
		add_prestige = -5
	}
}

### MISCALLANEUOUS ###

### THE DOCTRINE OF PARTICULAR JUDGEMENT
country_event = {
	id = DG_Papacy.901
	title = "DG_Papacy.901.title"
	desc = "DG_Papacy.901.desc"
	picture = POPE_PREACHING_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		religion = catholic
		NOT = { has_global_flag = DG_Counter_Reformation }
		NOT = { tag = PAP }
		any_owned_province = {
			religion = catholic
		}
	}
	
	mean_time_to_happen = {
		days = 1
	}
	immediate = {
		hidden_effect = {
			random_owned_province = {
				limit = {
					religion = catholic
				}
				save_event_target_as = unrest_province
			}
		}
	}
	option = {
		name = "DG_Papacy.901.opta"
		add_reform_desire = 0.00002
		add_papal_influence = 2
	}
	option = {
		name = "DG_Papacy.901.optb"
		goto = unrest_province
		add_reform_desire = -0.00002
		event_target:unrest_province = {
			add_unrest = 5
		}
	}
}

### SIMONY
country_event = {
	id = DG_Papacy.902
	title = "DG_Papacy.902.title"
	desc = "DG_Papacy.902.desc"
	picture = RELIGION_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		religion = catholic
		NOT = { has_global_flag = DG_Counter_Reformation }
		NOT = { tag = PAP }
		NOT = {
			has_global_flag = pap_disables_simony_flag
		}
	}
	
	mean_time_to_happen = {
		days = 1
		
	}
	option = {
		name = "DG_Papacy.902.opta"
		ai_chance = {
			factor = 10
			modifier = {
				factor = 5
				has_global_flag = borgia_pope_global
			}
		}
		add_years_of_income = 0.2
		add_reform_desire = 0.00002
	}
	option = {
		name = "DG_Papacy.902.optb"
		ai_chance = {
			factor = 10
		}
		add_papal_influence = 10
		add_devotion = 1
		add_reform_desire = -0.00002
	}
}

### SELLING OF INDULGENCES
country_event = {
	id = DG_Papacy.903
	title = "DG_Papacy.903.title"
	desc = "DG_Papacy.903.desc"
	picture = RELIGION_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		religion = catholic
		NOT = { has_global_flag = DG_Counter_Reformation }
		NOT = { tag = PAP }
		is_year = 1480
		ruler_age = 45
		NOT = {
			has_global_flag = pap_disables_indulgences_flag
		}
		is_excommunicated = no
		NOT = { has_country_modifier = papal_indulgence }
		NOT = {
			reverse_has_opinion_modifier = {
				who = PAP
				modifier = bought_indulgence
			}
		}
	}
	
	mean_time_to_happen = {
		days = 1
	}
	option = {
		name = "DG_Papacy.903.opta"
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0.5
				is_rival = PAP
			}
		}
		add_years_of_income = -1
		if = {
			limit = { NOT = { num_of_cities = 6 } }
			add_curia_treasury_small_effect = yes
		}
		else = {
			add_curia_treasury_medium_effect = yes
		}
		add_papal_influence = 10
		add_reform_desire = 0.00002
	}
	option = {
		name = "DG_Papacy.903.optb"
		ai_chance = {
			factor = 10
			modifier = {
				factor = 2
				has_global_flag = borgia_pope_global
			}
			modifier = {
				factor = 0.5
				alliance_with = PAP
			}
		}
		add_reform_desire = -0.00002
		add_papal_influence = -10
		PAP = {
			add_opinion = {
				who = root
				modifier = catholic_obstructing_church
			}
		}
	}
}

### VENERATION OF RELICS
country_event = {
	id = DG_Papacy.904
	title = "DG_Papacy.904.title"
	desc = "DG_Papacy.904.desc"
	picture = RELIGION_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		religion = catholic
		NOT = { has_global_flag = DG_Counter_Reformation }
		NOT = { tag = PAP }
		any_owned_province = {
			religion = catholic
		}
		is_year = 1490
		NOT = {
			has_global_flag = pap_disables_veneration_relics_flag
		}
	}
	
	immediate = {
		hidden_effect = {
			random_owned_province = {
				limit = {
					religion = catholic
				}
				save_event_target_as = unrest_province
			}
		}
	}

	mean_time_to_happen = {
		days = 1
		
	}
	option = {
		name = "DG_Papacy.904.opta"
		ai_chance = {
			factor = 10
		}
		add_reform_desire = 0.00002
		add_papal_influence = 2
	}
	option = {
		name = "DG_Papacy.904.optb"
		goto = unrest_province
		ai_chance = {
			factor = 10
			modifier = {
				factor = 5
				has_global_flag = borgia_pope_global
			}
		}
		event_target:unrest_province = {
			add_unrest = 5
		}
		add_reform_desire = -0.00002
	}
}

### VENERATION OF THE VIRGIN MARY
country_event = {
	id = DG_Papacy.905
	title = "DG_Papacy.905.title"
	desc = "DG_Papacy.905.desc"
	picture = RELIGION_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		religion = catholic
		NOT = { has_global_flag = DG_Counter_Reformation }
		NOT = { tag = PAP }
	}
	
	mean_time_to_happen = {
		days = 1
		
	}
	option = {
		name = "DG_Papacy.905.opta"
		add_reform_desire = 0.00002
		add_papal_influence = 2
	}
	option = {
		name = "DG_Papacy.905.optb"
		PAP = {
			add_opinion = {
				who = root
				modifier = opinion_denying_the_holy_mother
			}
		}
		add_reform_desire = -0.00002
	}
}

### ABSENTEE BISHOP
province_event = {
	id = DG_Papacy.906
	title = DG_Papacy.906.title
	desc = DG_Papacy.906.desc
	picture = catholic_corrupt_priest
	
	is_triggered_only = yes #on_actions on_yearly_pulse_2
	
	trigger = {
	    NOT = { has_global_flag = DG_Counter_Reformation }
		owner = {
		    catholic_trigger = yes
		    NOT = { tag = PAP }
			NOT = { tag = AVI }
		}
		OR = { #Bishoprics were localised in major cities
		    has_province_modifier = preeminent_region_city
			check_key = { lhs = Class_Urban value = 10 }
		}
		religion = owner
		NOT = { has_province_modifier = catholic_archbishopric }
		NOT = { has_province_modifier = greedy_bishop }
		NOT = { has_province_modifier = effective_bishop }
		NOT = { has_province_modifier = absentee_bishop }
		NOT = { has_province_modifier = indulgence_peddler }
		NOT = { has_province_modifier = religious_scandal_province }
	}
	
	option = {
		name = DG_Papacy.906.opta #Heresy and greed!
		ai_chance = {
			factor = 70
			modifier = {
			    factor = 0.5
				has_country_flag = humanism
			}
		}
		owner = { add_reform_desire = 0.00002 }
		if = {
			limit = { owner = { check_key = { lhs = Prov_CLPow value = 80 } } }
			add_province_modifier = { name = absentee_bishop duration = 2000 }
		}
		else_if = {
			limit = { owner = { check_key = { lhs = Prov_CLPow value = 60 } } }
			add_province_modifier = { name = absentee_bishop duration = 1600 }
		}
		else_if = {
			limit = { owner = { check_key = { lhs = Prov_CLPow value = 40 } } }
			add_province_modifier = { name = absentee_bishop duration = 1200 }
		}
		else_if = {
			limit = { owner = { check_key = { lhs = Prov_CLPow value = 20 } } }
			add_province_modifier = { name = absentee_bishop duration = 800 }
		}
		else = {
			add_province_modifier = { name = absentee_bishop duration = 400 }
		}
	}
	option = {
		name = DG_Papacy.906.optb #Hire a foreign preacher to come to $PROVINCECAPITAL$
		ai_chance = { 
		    factor = 30
			modifier = {
			    factor = 0.5
				NOT = { treasury = 20 }
			}
			modifier = {
			    factor = 0.5
				num_of_loans = 1
			}
		}
		owner = {
			add_treasury = -20
			add_adm_power = -10
		}
		owner = { add_reform_desire = -0.00002 }
		hidden_effect = {
		    owner = {
			    capital_scope = {
				    Public_ChangeClassWealthVal = { class=CL type=value inp=20 }
				}
			}
		}
	}
}

### THE BISHOP'S MISTRESS
province_event = {
	id = DG_Papacy.907
	title = DG_Papacy.907.title
	desc = DG_Papacy.907.desc
	picture = catholic_papal_nepotism
	
	is_triggered_only = yes #on_actions on_yearly_pulse_2
	
	trigger = {
	    NOT = { has_global_flag = DG_Counter_Reformation }
		owner = {
		    catholic_trigger = yes
		    NOT = { tag = PAP }
			NOT = { tag = AVI }
		}
		OR = { #Bishoprics were localised in major cities
		    has_province_modifier = preeminent_region_city
			check_key = { lhs = Class_Urban value = 10 }
		}
		religion = owner
		NOT = { has_province_modifier = catholic_archbishopric }
		NOT = { has_province_modifier = greedy_bishop }
		NOT = { has_province_modifier = effective_bishop }
		NOT = { has_province_modifier = absentee_bishop }
		NOT = { has_province_modifier = indulgence_peddler }
		NOT = { has_province_modifier = religious_scandal_province }
	}
	
	option = {
		name = DG_Papacy.907.opta #Look the other way
		ai_chance = {
			factor = 70
			modifier = {
			    factor = 0.5
				has_country_flag = humanism
			}
		}
		owner = { add_reform_desire = 0.00002 }
		if = {
			limit = { owner = { check_key = { lhs = Prov_CLPow value = 80 } } }
			add_province_modifier = { name = religious_scandal_province duration = 2000 }
		}
		else_if = {
			limit = { owner = { check_key = { lhs = Prov_CLPow value = 60 } } }
			add_province_modifier = { name = religious_scandal_province duration = 1600 }
		}
		else_if = {
			limit = { owner = { check_key = { lhs = Prov_CLPow value = 40 } } }
			add_province_modifier = { name = religious_scandal_province duration = 1200 }
		}
		else_if = {
			limit = { owner = { check_key = { lhs = Prov_CLPow value = 20 } } }
			add_province_modifier = { name = religious_scandal_province duration = 800 }
		}
		else = {
			add_province_modifier = { name = religious_scandal_province duration = 400 }
		}
	}
	option = {
		name = DG_Papacy.907.optb #Get rid of him
		ai_chance = {
			factor = 30
			modifier = {
				check_key = { lhs = Prov_CLLoy value = 70 }
				factor = 2
			}
		}
		owner = {
		    add_adm_power = -10
		    Public_ChangePowerbrokerLoyaltyTooltipProv = { Powerbroker=CL Amount=-5 }
			add_reform_desire = -0.00002
		}
	}
}

### INDULGENCE PEDDLER
province_event = {
	id = DG_Papacy.908
	title = DG_Papacy.908.title
	desc = DG_Papacy.908.desc
	picture = catholic_indulgences
	
	is_triggered_only = yes #on_actions on_yearly_pulse_2
	
	trigger = {
	    NOT = { has_global_flag = DG_Counter_Reformation }
		owner = {
		    catholic_trigger = yes
		    NOT = { tag = PAP }
			NOT = { tag = AVI }
		}
		religion = owner
		NOT = { has_province_modifier = catholic_archbishopric }
		NOT = { has_province_modifier = greedy_bishop }
		NOT = { has_province_modifier = effective_bishop }
		NOT = { has_province_modifier = absentee_bishop }
		NOT = { has_province_modifier = indulgence_peddler }
		NOT = { has_province_modifier = religious_scandal_province }
		NOT = {
			has_global_flag = pap_disables_indulgences_flag
		}
	}
    
	immediate = {
	    if = {
			limit = { owner = { check_key = { lhs = Prov_CLPow value = 80 } } }
			add_province_modifier = { name = indulgence_peddler duration = 1000 }
		}
		else_if = {
			limit = { owner = { check_key = { lhs = Prov_CLPow value = 60 } } }
			add_province_modifier = { name = indulgence_peddler duration = 800 }
		}
		else_if = {
			limit = { owner = { check_key = { lhs = Prov_CLPow value = 40 } } }
			add_province_modifier = { name = indulgence_peddler duration = 600 }
		}
		else_if = {
			limit = { owner = { check_key = { lhs = Prov_CLPow value = 20 } } }
			add_province_modifier = { name = indulgence_peddler duration = 400 }
		}
		else = {
			add_province_modifier = { name = indulgence_peddler duration = 200 }
		}
	}
	
	option = {
		name = DG_Papacy.908.optb #Allow this practice
		ai_chance = { 
		    factor = 50
			modifier = {
			    factor = 2
				has_country_flag = renaissance
			}
		}
		owner = { add_reform_desire = 0.00002 }
		owner = {
		    Public_ChangePowerbrokerLoyaltyTooltipProv = { Powerbroker=CL Amount=2.5 }
		}
	}
	option = {
		name = DG_Papacy.908.optc #Condemn the practice
		ai_chance = {
			factor = 50
			modifier = {
			    factor = 2
				has_country_flag = humanism
			}
		}
		owner = { add_reform_desire = -0.00002 }
		if = {
			limit = { owner = { DIP = 6 } }
			random = { chance = 90 remove_province_modifier = indulgence_peddler }
		}
		else_if = {
			limit = { owner = { DIP = 5 } }
			random = { chance = 75 remove_province_modifier = indulgence_peddler }
		}
		else_if = {
			limit = { owner = { DIP = 4 } }
			random = { chance = 60 remove_province_modifier = indulgence_peddler }
		}
		else_if = {
			limit = { owner = { DIP = 3 } }
			random = { chance = 40 remove_province_modifier = indulgence_peddler }
		}
		else_if = {
			limit = { owner = { DIP = 2 } }
			random = { chance = 30 remove_province_modifier = indulgence_peddler }
		}
		else = {
			random = { chance = 15 remove_province_modifier = indulgence_peddler }
		}
		owner = {
			reverse_add_opinion = { who = PAP modifier = disobeyed_religious_leader }
			add_papal_influence = -5
			Public_ChangePowerbrokerLoyaltyTooltipProv = { Powerbroker=CL Amount=-5 }
		}
	}
}

### ECCLESIASTICAL JURISDICTION
country_event = {
	id = DG_Papacy.909
	title = DG_Papacy.909.title
	desc = DG_Papacy.909.desc
	picture = catholic_church_trial
	
	is_triggered_only = yes #on_actions on_thri_yearly_pulse_2
	
	trigger = {
	    NOT = { has_global_flag = DG_Counter_Reformation }
		catholic_trigger = yes
		NOT = { government = theocracy }
		Rights_CLHie1Has = yes
		check_key = { lhs = Prov_CLPow value = 30 }
	}
	
	option = {
		name = DG_Papacy.909.opta #Submit to the authority of the church
		ai_chance = {
			factor = 50
			modifier = {
				NOT = { check_key = { lhs = Prov_CLLoy value = 30 } }
				factor = 2
			}
		}
	    Public_ChangePowerbrokerLoyaltyTooltipProv = { Powerbroker=CL Amount=5 }
		add_faction_influence = {
            faction = FC_CL
            influence = 10
        }
	}
	option = {
		name = DG_Papacy.909.optb #Sentence them under secular law
		ai_chance = { 
		    factor = 50
			modifier = {
				check_key = { lhs = Prov_CLLoy value = 70 }
				factor = 2
			}
		}
		Public_ChangePowerbrokerLoyaltyTooltipProv = { Powerbroker=CL Amount=-5 }
		add_faction_influence = {
            faction = FC_CL
            influence = -10
        }
		
		if = {
			limit = { religion = catholic }
			reverse_add_opinion = { who = PAP modifier = disobeyed_religious_leader }
		}
		else_if = {
			limit = { religion = avignonist }
			reverse_add_opinion = { who = AVI modifier = disobeyed_religious_leader }
		}
		
		if = {
			limit = { check_key = { lhs = Prov_CLPow value = 60 } }
			add_country_modifier = { name = religious_scandal_country_strong duration = 365 }
		}
		else_if = {
			limit = { check_key = { lhs = Prov_CLPow value = 40 } }
			add_country_modifier = { name = religious_scandal_country duration = 365 }
		}
		else = {
			add_country_modifier = { name = religious_scandal_country_weak duration = 365 }
		}
	}
}

### POPULAR PIETY
country_event = {
	id = DG_Papacy.910
	title = DG_Papacy.910.title
	desc = DG_Papacy.910.desc
	picture = all_pilgrims
	
	is_triggered_only = yes #on_actions on_thri_yearly_pulse_2
	
	trigger = {
	    NOT = { is_religion_enabled = protestant }
		has_global_flag = renaissance
		catholic_trigger = yes
		OR = {
		    any_owned_province = { has_province_modifier = absentee_bishop }
			any_owned_province = { has_province_modifier = religious_scandal_province }
			any_owned_province = { has_province_modifier = indulgence_peddler }
			has_country_modifier = anticlericalism
			has_country_modifier = religious_scandal_country_strong
			has_country_modifier = religious_scandal_country
			has_country_modifier = religious_scandal_country_weak
		}
	}
	
	option = {
		name = DG_Papacy.910.opta #Embrace popular piety
		ai_chance = {
			factor = 50
			modifier = {
				check_key = { lhs = Prov_CLLoy value = 70 }
				factor = 2
			}
		}
		CL_Leverage = yes
		custom_tooltip = CL_Leverage_effect
		Public_ChangePowerbrokerLoyaltyTooltipProv = { Powerbroker=CL Amount=-10 }
		add_country_modifier = { name = religious_controversy duration = 1825 } #5 years
	}
	option = {
		name = DG_Papacy.910.optb #Embrace anticlericalism
		ai_chance = {
			factor = 50
			modifier = {
				NOT = { check_key = { lhs = Prov_CLLoy value = 30 } }
				factor = 2
			}
		}
		CL_PopularReform = yes
		Public_ChangePowerbrokerLoyaltyTooltipProv = { Powerbroker=CL Amount=10 }
		add_country_modifier = { name = religious_controversy duration = 1825 } #5 years
	}
}

### POPE'S LEGITIMACY QUESTIONED
country_event = {
	id = dg_papacy.953
	title = dg_papacy.053.t
	desc = dg_papacy.053.d
	picture = catholic_trial
	
	is_triggered_only = yes #from dg_humanism.012
	
	immediate = {
		set_country_flag = constantine_donation_cf_exposed
	}
	
	option = {
		name = dg_papacy.053.a #Deny these accusations
		trigger = {
			DIP = 4
		}
		ai_chance = { factor = 90 }
		add_prestige = -5
		add_opinion = { who = FROM modifier = disobeyed_religious_leader }
		reverse_add_opinion = { who = FROM modifier = papacy_bad }
		FROM = { add_papal_influence = -10 }
	}
	option = {
		name = dg_papacy.053.b #Accept the inevitable
		ai_chance = { factor = 10 }
		custom_tooltip = papal_authority_lowered
		add_prestige = -20
		every_province = {
			limit = {
				north_italy_region_trigger = yes
				is_claim = PAP
				NOT = { owned_by = PAP }
			}
			remove_claim = PAP
		}
	}
}

### LOGGING OF PAPAL AUTHORITY
country_event = {
	id = DG_Papacy.999
	title = "DG_Papacy.999.title"
	desc = "DG_Papacy.999.desc"
	picture = catholic_college_of_cardinals

	is_triggered_only = yes
	hidden = yes
	
	trigger = {
		tag = PAP
	}

	immediate = {
#		export_to_key = {
#			lhs = DG_Tmp1
#			value = reform_desire
#		}
#		export_to_key = {
#			lhs = DG_Tmp2
#			value = modifier:reform_desire
#		}
	}
	
	option = {
#		log = "DG:[GetYear]: :[This.kdt.GetValue]:Reform Desire: :[This.GetName]"
#		log = "DG:[GetYear]: :[This.kdu.GetValue]:Reform Desire: :[This.GetName]"
		log = "DG:[GetYear]: :[This.nto.GetValue]:Papal Authority: :[This.GetName]"
	}

	after = {
#		export_to_key = {
#			lhs = DG_Tmp1
#			value = 0
#		}
#		export_to_key = {
#			lhs = DG_Tmp2
#			value = 0
#		}
	}
}
