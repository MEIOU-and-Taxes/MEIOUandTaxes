#by Shiro and KJH

namespace = AI_Invest

country_event = {
    id = AI_Invest.1
    title = no_localisation
    desc = no_localisation
	picture = ai_only

    hidden = yes

    is_triggered_only = yes

    immediate = {
        hidden_effect = {
            every_country = {
                limit = {
                    isValidCountry = yes
					ai = yes
                }
				clr_country_flag = AI_Pulse
				AAA = {
					trigger_switch = {
						on_trigger = has_country_flag
						pentannual1 = {
							PREV = {
								if = {
									limit = {
										check_key = { lhs = ID_Tag_Opt which = ID_Pent1 }
									}
									set_country_flag = AI_Pulse
								}
							}
						}
						pentannual2 = {
							PREV = {
								if = {
									limit = {
										NOT = { check_key = { lhs = ID_Tag_Opt which = ID_Pent1 } }
										check_key = { lhs = ID_Tag_Opt which = ID_Pent2 }
									}
									set_country_flag = AI_Pulse
								}
							}
						}
						pentannual3 = {
							PREV = {
								if = {
									limit = {
										NOT = { check_key = { lhs = ID_Tag_Opt which = ID_Pent2 } }
										check_key = { lhs = ID_Tag_Opt which = ID_Pent3 }
									}
									set_country_flag = AI_Pulse
								}
							}
						}
						pentannual4 = {
							PREV = {
								if = {
									limit = {
										NOT = { check_key = { lhs = ID_Tag_Opt which = ID_Pent3 } }
										check_key = { lhs = ID_Tag_Opt which = ID_Pent4 }
									}
									set_country_flag = AI_Pulse
								}
							}
						}
						pentannual5 = {
							PREV = {
								if = {
									limit = {
										NOT = { check_key = { lhs = ID_Tag_Opt which = ID_Pent4 } }
									}
									set_country_flag = AI_Pulse
								}
							}
						}
					}
				}
                if = {
                    limit = {
						has_country_flag = AI_Pulse
                    }
                    if = {
                        limit = {
                            NOT = { num_of_loans = 1 }
                            monthly_income = 0
                            OR = {
                                AND = {
                                    is_at_war = yes
                                    war_score = 15
                                }
                                is_at_war = no
                            }
                        }
                        set_key = { lhs = Public_Tmp1 value = 0 }
                        set_key = { lhs = Public_Tmp2 value = 0 }
                        set_key = { lhs = Public_Tmp3 value = 0 }
                        set_key = { lhs = Public_Tmp4 value = 0 }
                        set_key = { lhs = Public_Tmp5 value = 0 }
                        set_key = { lhs = Public_Tmp6 value = 0 }
                        
                        export_to_key = {
                            lhs = Public_Tmp1
                            value = treasury
                        }
                        export_to_key = {
                            lhs = Public_Tmp2
                            value = monthly_income
                        }
                        
                        multiply_key = { lhs = Public_Tmp2 value = 12 }        		 # `DEFINE_AI_AUTOINVESTOR_MONTHS_OF_INCOME_RETAINED~value`
                        subtract_key = { lhs = Public_Tmp1 which = Public_Tmp2 }	 # treasury - 1.5 years of income
                        set_key = 	   { lhs = Public_Tmp3 value = 0.35 }			 # `DEFINE_AI_AUTOINVESTOR_PERCENTAGE_USAGE_OF_BASE_BUDGET~value`
                        
                        Modi_AiInvestBudget = yes #this modifies base budget percentage (Public_Tmp3) based on ruler personality
                        
                        multiply_key = { lhs = Public_Tmp1 which = Public_Tmp3 }  # this is this year's budget	
                        set_key = { lhs = Ai_Invest_BudgetFixed which = Public_Tmp1 }
                        
                        if = { #do not invest if investment budget is below 5 ducats (?)
                            limit = {
                                check_key = { lhs = Ai_Invest_BudgetFixed value = 5 }
                            }
                            #_#_log = "SYS-StateInvestmentBudget:[GetYear]:[This.GetName]::investment budget of:[GV_Ai_Invest_BudgetFixed]:investment going forward"
                            #log = "SYS-StateInvestment:[GetYear]:[This.GetName]:Agriculture:Forestry:Extraction:Fishery:Industrial:Academic"
                            every_owned_province = {
                                limit = {
                                    controlled_by = owner
                                    is_core = PREV
                                    check_key = { lhs = Prov_BUPow value = 2.5 }    #NEVER invest under 2.5 State Reach (investment pool won't drain)
                                }
                                
                                set_province_flag = possible_investment
                                set_key = { lhs = Public_Tmp1 value = 0 }
                                set_key = { lhs = Public_Tmp2 value = 0 }
                                set_key = { lhs = Public_Tmp3 value = 0 }
                                set_key = { lhs = Public_Tmp4 value = 0 }
                                set_key = { lhs = Public_Tmp5 value = 0 }
                                set_key = { lhs = Public_Tmp6 value = 0 }
                                
                                Infra_AISpendCheck_Agriculture = { type = Agriculture return = Public_Tmp1 cap = Building_AgricultureMax }
                                Infra_AISpendCheck_Forestry = { type = Forestry return=Public_Tmp2 cap = Building_ForestryMax }
                                Infra_AISpendCheck_Extraction = { type = Extraction return = Public_Tmp3 cap = Building_ExtractionMax }
                                Infra_AISpendCheck_Fishery = { type = Fishery return = Public_Tmp4  cap = Building_FisheryMax }
                                Infra_AISpendCheck_Industrial = { type = Industrial return = Public_Tmp5 }
                                Infra_AISpendCheck_Academic = { type = Academic return = Public_Tmp6 }
                                #logging scores on province level
                                #log = "SYS-StateInvestment:[GetYear]:[This.Owner.GetName]:[This.GetName]:[GV_Public_Tmp1]:[GV_Public_Tmp2]:[GV_Public_Tmp3]:[GV_Public_Tmp4]:[GV_Public_Tmp5]:[GV_Public_Tmp6]"
                            }
                    
                            set_key = { lhs = Public_Tmp1 value = 0 }
                            set_key = { lhs = Public_Tmp2 value = 0 }
                            set_key = { lhs = Public_Tmp3 value = 0 }
                            set_key = { lhs = Public_Tmp4 value = 0 }
                            set_key = { lhs = Public_Tmp5 value = 0 }
                            set_key = { lhs = Public_Tmp6 value = 0 }
                        
                            every_owned_province = {
                                limit = {
                                    has_province_flag = possible_investment
                                }
                                PREV = { #add scores of every province to the country
                                    change_key = { lhs = Public_Tmp1 which = PREV } 
                                    change_key = { lhs = Public_Tmp2 which = PREV }
                                    change_key = { lhs = Public_Tmp3 which = PREV }
                                    change_key = { lhs = Public_Tmp4 which = PREV }
                                    change_key = { lhs = Public_Tmp5 which = PREV }
                                    change_key = { lhs = Public_Tmp6 which = PREV }
                                }
                            }
                            #logging summed score on country level
                            #_#_log = "SYS-StateInvestmentScore:[GetYear]:[This.GetName]::Agriculture:Forestry:Extraction:Fishery:Industrial:Academic"
                            #_#_log = "SYS-StateInvestmentScore:[GetYear]:[This.GetName]::[GV_Public_Tmp1]:[GV_Public_Tmp2]:[GV_Public_Tmp3]:[GV_Public_Tmp4]:[GV_Public_Tmp5]:[GV_Public_Tmp6]"
                                #sum all scores into 1
                            set_key = { lhs = Public_Tmp0 which = Public_Tmp1 }
                            change_key = { lhs = Public_Tmp0 which = Public_Tmp2 }
                            change_key = { lhs = Public_Tmp0 which = Public_Tmp3 }
                            change_key = { lhs = Public_Tmp0 which = Public_Tmp4 }
                            change_key = { lhs = Public_Tmp0 which = Public_Tmp5 }
                            change_key = { lhs = Public_Tmp0 which = Public_Tmp6 }
                            
                            set_key = { lhs = Public_Tmp9 which = Public_Tmp0 } #save total score here
                            divide_key = { lhs = Public_Tmp0 which = Ai_Invest_BudgetFixed } #total score divided by budget
                            #log = "SYS-StateInvestment:[GetYear]:[This.GetName]:Total Score divided by budget = [GV_Public_Tmp9]/[GV_Ai_Invest_BudgetFixed] = [GV_Public_Tmp0]"

                            set_key = { lhs = Tmp_9 value = 0 }
                            set_key = { lhs = Public_Tmp7 value = 0 } #Key to be used to substract treasury
                            
                            #_#_log = "SYS-StateInvestmentDucat:Year:Country:Province:Agriculture:Forestry:Extraction:Fishery:Industrial:Academic:IndustrialUp:IndustrialDown:IndustrialGross"
                            every_owned_province = {
                                limit = {
                                    has_province_flag = possible_investment
                                }
                                set_key = { lhs = Tmp_9 value = 0 }
                                    # set total score per province of each type of building (the one that came from Infra_AISpendCheck)
                                set_key = { lhs = Tmp_1 which = Public_Tmp1 } 
                                set_key = { lhs = Tmp_2 which = Public_Tmp2 }
                                set_key = { lhs = Tmp_3 which = Public_Tmp3 }
                                set_key = { lhs = Tmp_4 which = Public_Tmp4 }
                                set_key = { lhs = Tmp_5 which = Public_Tmp5 }
                                set_key = { lhs = Tmp_6 which = Public_Tmp6 }
                                
                                    # calculate each score's percentage % from the total country's score for each type of building
                                set_key = { lhs = Public_Tmp9 which = PREV } #total country score
                                divide_key = { lhs = Tmp_1 which = Public_Tmp9 } 
                                divide_key = { lhs = Tmp_2 which = Public_Tmp9 }
                                divide_key = { lhs = Tmp_3 which = Public_Tmp9 }
                                divide_key = { lhs = Tmp_4 which = Public_Tmp9 }
                                divide_key = { lhs = Tmp_5 which = Public_Tmp9 }
                                divide_key = { lhs = Tmp_6 which = Public_Tmp9 }
                                
                                    # tmp_1 is how much % of the total score of the entire country represents this province, #tmp_2 fishery, etc. in raw percentage value
                                multiply_key = { lhs = Tmp_1 value = 100 }
                                multiply_key = { lhs = Tmp_2 value = 100 }
                                multiply_key = { lhs = Tmp_3 value = 100 }
                                multiply_key = { lhs = Tmp_4 value = 100 }
                                multiply_key = { lhs = Tmp_5 value = 100 }
                                multiply_key = { lhs = Tmp_6 value = 100 }
                                    # if more than 60% of total score goes into 1 specific industry, set a flag to next time reduce score
                                if = {
                                    limit = {
                                        is_capital = no
                                    }
                                    if = {
                                        limit = {
                                            check_key = { lhs = Tmp_1 value = 60 }
                                        }
                                        if = {
                                            limit = {
                                                check_key = { lhs = Tmp_1 value = 80 }
                                            }
                                            set_province_flag = AgricultureInvestment8
                                        }
                                        else = {
                                            set_province_flag = AgricultureInvestment6
                                        }
                                    }
                                    else_if = {
                                        limit = {
                                            check_key = { lhs = Tmp_2 value = 60 }
                                        }
                                        if = {
                                            limit = {
                                                check_key = { lhs = Tmp_2 value = 80 }
                                            }
                                            set_province_flag = ForestryInvestment8
                                        }
                                        else = {
                                            set_province_flag = ForestryInvestment6
                                        }
                                    }
                                    else_if = {
                                        limit = {
                                            check_key = { lhs = Tmp_3 value = 60 }
                                        }
                                        if = {
                                            limit = {
                                                check_key = { lhs = Tmp_3 value = 80 }
                                            }
                                            set_province_flag = ExtractionInvestment8
                                        }
                                        else = {
                                            set_province_flag = ExtractionInvestment6
                                        }
                                    }
                                    else_if = {
                                        limit = {
                                            check_key = { lhs = Tmp_4 value = 60 }
                                        }
                                        if = {
                                            limit = {
                                                check_key = { lhs = Tmp_4 value = 80 }
                                            }
                                            set_province_flag = FisheryInvestment8
                                        }
                                        else = {
                                            set_province_flag = FisheryInvestment6
                                        }
                                    }
                                    else_if = {
                                        limit = {
                                            check_key = { lhs = Tmp_5 value = 60 }
                                        }
                                        if = {
                                            limit = {
                                                check_key = { lhs = Tmp_5 value = 80 }
                                            }
                                            set_province_flag = IndustrialInvestment8
                                        }
                                        else = {
                                            set_province_flag = IndustrialInvestment6
                                        }
                                    }
                                    else_if = {
                                        limit = {
                                            check_key = { lhs = Tmp_6 value = 60 }
                                        }
                                        if = {
                                            limit = {
                                                check_key = { lhs = Tmp_6 value = 80 }
                                            }
                                            set_province_flag = AcademicInvestment8
                                        }
                                        else = {
                                            set_province_flag = AcademicInvestment6
                                        }
                                    }
                                }

                                # calculate score / total budget to get in raw money value how much it will be invested
                                set_key = { lhs = Public_Tmp0 which = PREV } # total budget
                                if = {
                                    limit = {
                                        check_key = { lhs = Public_Tmp0 value = 0.001 }
                                    }
                                    divide_key = { lhs = Public_Tmp1 which = Public_Tmp0 }
                                    divide_key = { lhs = Public_Tmp2 which = Public_Tmp0 }
                                    divide_key = { lhs = Public_Tmp3 which = Public_Tmp0 }
                                    divide_key = { lhs = Public_Tmp4 which = Public_Tmp0 }
                                    divide_key = { lhs = Public_Tmp5 which = Public_Tmp0 }
                                    divide_key = { lhs = Public_Tmp6 which = Public_Tmp0 }
                                }
                                
                                
                                # invest
                                #_#_log = "SYS-StateInvestmentDucat:[GetYear]:[This.Owner.GetName]:[This.GetName]:[GV_Public_Tmp1]:[GV_Public_Tmp2]:[GV_Public_Tmp3]:[GV_Public_Tmp4]:[GV_Public_Tmp5]:[GV_Public_Tmp6]:[GV_Building_IndustrialUp]:[GV_Building_IndustrialDown]:[GV_Building_IndustrialGross]"
                                
                                Do_InvestAI = { type=Agriculture return=Public_Tmp1 score=Tmp_1 }
                                
                                Do_InvestAI = { type=Forestry return=Public_Tmp2 score=Tmp_2 }
                                
                                Do_InvestAI = { type=Extraction return=Public_Tmp3 score=Tmp_3 }
                            
                                Do_InvestAI = { type=Fishery return=Public_Tmp4 score=Tmp_4 }
                                
                                Do_InvestAI = { type=Industrial return=Public_Tmp5 score=Tmp_5 }
                                
                                Do_InvestAI = { type=Academic return=Public_Tmp6 score=Tmp_6 }
                                
                                clr_province_flag = possible_investment
                            }
                            POP_RemoveDucat = { type = which inp = Public_Tmp7 }
                            set_key = { lhs = Ai_Invest_BudgetFixed value = 0 }
                        }
                        else = {
                            #_#_log = "SYS-StateInvestmentBudget:[GetYear]:[This.GetName]::investment budget of:[GV_Ai_Invest_BudgetFixed]:no investment"
                        }
		            }
                }
            }
        }
	}
	option = {
		name = no_localisation
	}
}
country_event = {
    id = AI_Invest.100
    title = no_localisation
    desc = no_localisation
    picture = ai_only


    hidden = yes
    is_triggered_only = yes

    immediate = {
            every_country = {
                limit = {
                    ai = no
                    isValidCountry = yes
                }
                AAA = {
                    if = {
                        limit = {
                            has_country_flag = triannual1
                        }
                        PREV = {
                            country_event = {
                                id = AI_Invest.2
                                days = 1
                            }
                        }
                    }
                    else_if = {
                        limit = { 
                            has_country_flag = quadannual1
                        }
                        PREV = {
                            country_event = {
                                id = AI_Invest.3
                                days = 1
                            }
                        }
                    }
                    else_if = {
                        limit = {
                            has_country_flag = pentannual1
                        }
                        PREV = {
                            country_event = {
                                id = AI_Invest.4
                                days = 1
                            }
                        }
                    }
                }
            }
    }
    option = {
        name = no_localisation
        log = "AAA tried to invest to player"
    }
}
country_event = {
    id = AI_Invest.2
    title = "AI_Invest_title"
    desc = no_localisation
	picture = ai_only

    is_triggered_only = yes

    trigger = {
        ai = no
        isValidCountry = yes
        has_country_flag = Automatic_Invest
        has_country_flag = invest_every_3
	}

    mean_time_to_happen = {
        days = 1
    }

    immediate = {
        hidden_effect = {
            if = {
                limit = {
                    NOT = { num_of_loans = 1 }
                    monthly_income = 0
                    OR = {
                        AND = {
                            is_at_war = yes
                            war_score = 15
                        }
                        is_at_war = no
                    }
                }
                set_key = { lhs = Tmp_Misc0 value = 0 }
                set_key = { lhs = Public_Tmp1 value = 0 }
                set_key = { lhs = Public_Tmp2 value = 0 }
                set_key = { lhs = Public_Tmp3 value = 0 }
                set_key = { lhs = Public_Tmp4 value = 0 }
                set_key = { lhs = Public_Tmp5 value = 0 }
                set_key = { lhs = Public_Tmp6 value = 0 }
                
                export_to_key = {
                    lhs = Ai_Invest_BudgetFixed
                    value = treasury
                }
                
                set_key = { lhs = Tmp_Misc0 which = Ai_Invest_Budget }
                multiply_key = { lhs = Tmp_Misc0 value = 0.01 }
                multiply_key = { lhs = Ai_Invest_BudgetFixed which = Tmp_Misc0 }
                   
                if = {
                    limit = {
                        check_key = { lhs = Ai_Invest_BudgetFixed value = 5 }
                        check_key = { lhs = Prov_BUPow value = 2.5 }    #NEVER invest under 2.5 State Reach (investment pool won't drain)
                    }
                    
                    set_key = { lhs = Public_Tmp1 value = 0 }
                    set_key = { lhs = Public_Tmp2 value = 0 }
                    set_key = { lhs = Public_Tmp3 value = 0 }
                    set_key = { lhs = Public_Tmp4 value = 0 }
                    set_key = { lhs = Public_Tmp5 value = 0 }
                    set_key = { lhs = Public_Tmp6 value = 0 }
                    every_owned_province = {
                        limit = {
                            has_province_flag = Invest
                            controlled_by = owner
                            is_core = owner
                        }
                        clr_province_flag = invested
                        set_province_flag = possible_investment
                        set_key = { lhs = Public_Tmp1 value = 0 }
                        set_key = { lhs = Public_Tmp2 value = 0 }
                        set_key = { lhs = Public_Tmp3 value = 0 }
                        set_key = { lhs = Public_Tmp4 value = 0 }
                        set_key = { lhs = Public_Tmp5 value = 0 }
                        set_key = { lhs = Public_Tmp6 value = 0 }
                        
                        Infra_AISpendCheck_Agriculture = { type = Agriculture return = Public_Tmp1 cap = Building_AgricultureMax }
                        Infra_AISpendCheck_Forestry = { type = Forestry return=Public_Tmp2 cap = Building_ForestryMax }
                        Infra_AISpendCheck_Extraction = { type = Extraction return = Public_Tmp3 cap = Building_ExtractionMax }
                        Infra_AISpendCheck_Fishery = { type = Fishery return = Public_Tmp4  cap = Building_FisheryMax }
                        Infra_AISpendCheck_Industrial = { type = Industrial return = Public_Tmp5 }
                        Infra_AISpendCheck_Academic = { type = Academic return = Public_Tmp6 }  
                        PREV = { #add scores of every province to the country
                            change_key = { lhs = Public_Tmp1 which = PREV } 
                            change_key = { lhs = Public_Tmp2 which = PREV }
                            change_key = { lhs = Public_Tmp3 which = PREV }
                            change_key = { lhs = Public_Tmp4 which = PREV }
                            change_key = { lhs = Public_Tmp5 which = PREV }
                            change_key = { lhs = Public_Tmp6 which = PREV }
                        }     
                    }

                    #sum all scores into 1
                    set_key = { lhs = Public_Tmp0 which = Public_Tmp1 }
                    change_key = { lhs = Public_Tmp0 which = Public_Tmp2 }
                    change_key = { lhs = Public_Tmp0 which = Public_Tmp3 }
                    change_key = { lhs = Public_Tmp0 which = Public_Tmp4 }
                    change_key = { lhs = Public_Tmp0 which = Public_Tmp5 }
                    change_key = { lhs = Public_Tmp0 which = Public_Tmp6 }
                    
                    set_key = { lhs = Public_Tmp9 which = Public_Tmp0 } #save total score here
                    divide_key = { lhs = Public_Tmp0 which = Ai_Invest_BudgetFixed } #total score divided by budget
                    
                    set_key = { lhs = Tmp_9 value = 0 }
                    set_key = { lhs = Public_Tmp7 value = 0 } #Key to be used to substract treasury
                    every_owned_province = {
                        limit = {
                            has_province_flag = possible_investment
                        }
                        set_key = { lhs = Tmp_9 value = 0 }
                            # set total score per province of each type of building (the one that came from Infra_AISpendCheck)
                        set_key = { lhs = Tmp_1 which = Public_Tmp1 } 
                        set_key = { lhs = Tmp_2 which = Public_Tmp2 }
                        set_key = { lhs = Tmp_3 which = Public_Tmp3 }
                        set_key = { lhs = Tmp_4 which = Public_Tmp4 }
                        set_key = { lhs = Tmp_5 which = Public_Tmp5 }
                        set_key = { lhs = Tmp_6 which = Public_Tmp6 }
                        
                            # calculate each score's percentage % from the total country's score for each type of building
                        set_key = { lhs = Public_Tmp9 which = PREV } #total country score
                        divide_key = { lhs = Tmp_1 which = Public_Tmp9 } 
                        divide_key = { lhs = Tmp_2 which = Public_Tmp9 }
                        divide_key = { lhs = Tmp_3 which = Public_Tmp9 }
                        divide_key = { lhs = Tmp_4 which = Public_Tmp9 }
                        divide_key = { lhs = Tmp_5 which = Public_Tmp9 }
                        divide_key = { lhs = Tmp_6 which = Public_Tmp9 }
                        
                            # tmp_1 is how much % of the total score of the entire country represents this province, #tmp_2 fishery, etc. in raw percentage value
                        multiply_key = { lhs = Tmp_1 value = 100 }
                        multiply_key = { lhs = Tmp_2 value = 100 }
                        multiply_key = { lhs = Tmp_3 value = 100 }
                        multiply_key = { lhs = Tmp_4 value = 100 }
                        multiply_key = { lhs = Tmp_5 value = 100 }
                        multiply_key = { lhs = Tmp_6 value = 100 }
                            # if more than 60% of total score goes into 1 specific industry, set a flag to next time reduce score
                        if = {
                            limit = {
                                NOT = { is_capital = yes }
                            }
                            if = {
                                limit = {
                                    check_key = { lhs = Tmp_1 value = 60 }
                                }
                                if = {
                                    limit = {
                                        check_key = { lhs = Tmp_1 value = 80 }
                                    }
                                    set_province_flag = AgricultureInvestment8
                                }
                                else = {
                                    set_province_flag = AgricultureInvestment6
                                }
                            }
                            else_if = {
                                limit = {
                                    check_key = { lhs = Tmp_2 value = 60 }
                                }
                                if = {
                                    limit = {
                                        check_key = { lhs = Tmp_2 value = 80 }
                                    }
                                    set_province_flag = ForestryInvestment8
                                }
                                else = {
                                    set_province_flag = ForestryInvestment6
                                }
                            }
                            else_if = {
                                limit = {
                                    check_key = { lhs = Tmp_3 value = 60 }
                                }
                                if = {
                                    limit = {
                                        check_key = { lhs = Tmp_3 value = 80 }
                                    }
                                    set_province_flag = ExtractionInvestment8
                                }
                                else = {
                                    set_province_flag = ExtractionInvestment6
                                }
                            }
                            else_if = {
                                limit = {
                                    check_key = { lhs = Tmp_4 value = 60 }
                                }
                                if = {
                                    limit = {
                                        check_key = { lhs = Tmp_4 value = 80 }
                                    }
                                    set_province_flag = FisheryInvestment8
                                }
                                else = {
                                    set_province_flag = FisheryInvestment6
                                }
                            }
                            else_if = {
                                limit = {
                                    check_key = { lhs = Tmp_5 value = 60 }
                                }
                                if = {
                                    limit = {
                                        check_key = { lhs = Tmp_5 value = 80 }
                                    }
                                    set_province_flag = IndustrialInvestment8
                                }
                                else = {
                                    set_province_flag = IndustrialInvestment6
                                }
                            }
                            else_if = {
                                limit = {
                                    check_key = { lhs = Tmp_6 value = 60 }
                                }
                                if = {
                                    limit = {
                                        check_key = { lhs = Tmp_6 value = 80 }
                                    }
                                    set_province_flag = AcademicInvestment8
                                }
                                else = {
                                    set_province_flag = AcademicInvestment6
                                }
                            }
                        }
            
                        # calculate score / total budget to get in raw money value how much it will be invested
                        set_key = { lhs = Public_Tmp0 which = PREV } # total budget
                        
                        if = {
                            limit = {
                                check_key = { lhs = Public_Tmp0 value = 0.001 }
                            }
                            divide_key = { lhs = Public_Tmp1 which = Public_Tmp0 }
                            divide_key = { lhs = Public_Tmp2 which = Public_Tmp0 }
                            divide_key = { lhs = Public_Tmp3 which = Public_Tmp0 }
                            divide_key = { lhs = Public_Tmp4 which = Public_Tmp0 }
                            divide_key = { lhs = Public_Tmp5 which = Public_Tmp0 }
                            divide_key = { lhs = Public_Tmp6 which = Public_Tmp0 }
                        }
                        
                        # invest
                        
                        Do_Invest_Player = { type=Agriculture return=Public_Tmp1 score=Tmp_1 }
                        
                        Do_Invest_Player = { type=Forestry return=Public_Tmp2 score=Tmp_2 }
                        
                        Do_Invest_Player = { type=Extraction return=Public_Tmp3 score=Tmp_3 }
                       
                        Do_Invest_Player = { type=Fishery return=Public_Tmp4 score=Tmp_4 }
                        
                        Do_Invest_Player = { type=Industrial return=Public_Tmp5 score=Tmp_5 }
                        
                        Do_Invest_Player = { type=Academic return=Public_Tmp6 score=Tmp_6 }
                        
                        clr_province_flag = possible_investment
                    }
                    if = {
                        limit = {
                            has_country_flag = show_investment
                            check_key = { lhs = Tmp_Misc0 value = 0.001 }
                        }
                        random_owned_province = {
                            limit = {
                                has_province_flag = invested
                            }
                            province_event = { 
                                id = AI_Invest.9
                            }
                        }
                    }
                    POP_RemoveDucat = { type = which inp = Public_Tmp7 }
                    
                }
            }
        }
	}
	option = {
		name = "OPT.GREAT"
        log = "Player tried to invest"
	}
    after = {
        set_key = { lhs = Ai_Invest_BudgetFixed value = 0 }
    }
}
country_event = {
    id = AI_Invest.3
    title = "AI_Invest_title"
    desc = no_localisation
	picture = ai_only

    is_triggered_only = yes

    trigger = {
        ai = no
        isValidCountry = yes
        has_country_flag = Automatic_Invest
        has_country_flag = invest_every_4
	}

    mean_time_to_happen = {
        days = 1
    }

    immediate = {
        hidden_effect = {
            if = {
                limit = {
                    NOT = { num_of_loans = 1 }
                    monthly_income = 0
                    OR = {
                        AND = {
                            is_at_war = yes
                            war_score = 15
                        }
                        is_at_war = no
                    }
                }
                set_key = { lhs = Tmp_Misc0 value = 0 }
                set_key = { lhs = Public_Tmp1 value = 0 }
                set_key = { lhs = Public_Tmp2 value = 0 }
                set_key = { lhs = Public_Tmp3 value = 0 }
                set_key = { lhs = Public_Tmp4 value = 0 }
                set_key = { lhs = Public_Tmp5 value = 0 }
                set_key = { lhs = Public_Tmp6 value = 0 }
                
                export_to_key = {
                    lhs = Ai_Invest_BudgetFixed
                    value = treasury
                }
                
                set_key = { lhs = Tmp_Misc0 which = Ai_Invest_Budget }
                multiply_key = { lhs = Tmp_Misc0 value = 0.01 }
                multiply_key = { lhs = Ai_Invest_BudgetFixed which = Tmp_Misc0 }
                   
                if = {
                    limit = {
                        check_key = { lhs = Ai_Invest_BudgetFixed value = 5 }
                        check_key = { lhs = Prov_BUPow value = 2.5 }    #NEVER invest under 2.5 State Reach (investment pool won't drain)
                    }
                    
                    set_key = { lhs = Public_Tmp1 value = 0 }
                    set_key = { lhs = Public_Tmp2 value = 0 }
                    set_key = { lhs = Public_Tmp3 value = 0 }
                    set_key = { lhs = Public_Tmp4 value = 0 }
                    set_key = { lhs = Public_Tmp5 value = 0 }
                    set_key = { lhs = Public_Tmp6 value = 0 }
                    every_owned_province = {
                        limit = {
                            has_province_flag = Invest
                            controlled_by = owner
                            is_core = owner
                        }
                        clr_province_flag = invested
                        set_province_flag = possible_investment
                        set_key = { lhs = Public_Tmp1 value = 0 }
                        set_key = { lhs = Public_Tmp2 value = 0 }
                        set_key = { lhs = Public_Tmp3 value = 0 }
                        set_key = { lhs = Public_Tmp4 value = 0 }
                        set_key = { lhs = Public_Tmp5 value = 0 }
                        set_key = { lhs = Public_Tmp6 value = 0 }
                        
                        Infra_AISpendCheck_Agriculture = { type = Agriculture return = Public_Tmp1 cap = Building_AgricultureMax }
                        Infra_AISpendCheck_Forestry = { type = Forestry return=Public_Tmp2 cap = Building_ForestryMax }
                        Infra_AISpendCheck_Extraction = { type = Extraction return = Public_Tmp3 cap = Building_ExtractionMax }
                        Infra_AISpendCheck_Fishery = { type = Fishery return = Public_Tmp4  cap = Building_FisheryMax }
                        Infra_AISpendCheck_Industrial = { type = Industrial return = Public_Tmp5 }
                        Infra_AISpendCheck_Academic = { type = Academic return = Public_Tmp6 }  
                        PREV = { #add scores of every province to the country
                            change_key = { lhs = Public_Tmp1 which = PREV } 
                            change_key = { lhs = Public_Tmp2 which = PREV }
                            change_key = { lhs = Public_Tmp3 which = PREV }
                            change_key = { lhs = Public_Tmp4 which = PREV }
                            change_key = { lhs = Public_Tmp5 which = PREV }
                            change_key = { lhs = Public_Tmp6 which = PREV }
                        }     
                    }

                    #sum all scores into 1
                    set_key = { lhs = Public_Tmp0 which = Public_Tmp1 }
                    change_key = { lhs = Public_Tmp0 which = Public_Tmp2 }
                    change_key = { lhs = Public_Tmp0 which = Public_Tmp3 }
                    change_key = { lhs = Public_Tmp0 which = Public_Tmp4 }
                    change_key = { lhs = Public_Tmp0 which = Public_Tmp5 }
                    change_key = { lhs = Public_Tmp0 which = Public_Tmp6 }
                    
                    set_key = { lhs = Public_Tmp9 which = Public_Tmp0 } #save total score here
                    divide_key = { lhs = Public_Tmp0 which = Ai_Invest_BudgetFixed } #total score divided by budget
                    
                    set_key = { lhs = Tmp_9 value = 0 }
                    set_key = { lhs = Public_Tmp7 value = 0 } #Key to be used to substract treasury
                    every_owned_province = {
                        limit = {
                            has_province_flag = possible_investment
                        }
                        set_key = { lhs = Tmp_9 value = 0 }
                            # set total score per province of each type of building (the one that came from Infra_AISpendCheck)
                        set_key = { lhs = Tmp_1 which = Public_Tmp1 } 
                        set_key = { lhs = Tmp_2 which = Public_Tmp2 }
                        set_key = { lhs = Tmp_3 which = Public_Tmp3 }
                        set_key = { lhs = Tmp_4 which = Public_Tmp4 }
                        set_key = { lhs = Tmp_5 which = Public_Tmp5 }
                        set_key = { lhs = Tmp_6 which = Public_Tmp6 }
                        
                            # calculate each score's percentage % from the total country's score for each type of building
                        set_key = { lhs = Public_Tmp9 which = PREV } #total country score
                        divide_key = { lhs = Tmp_1 which = Public_Tmp9 } 
                        divide_key = { lhs = Tmp_2 which = Public_Tmp9 }
                        divide_key = { lhs = Tmp_3 which = Public_Tmp9 }
                        divide_key = { lhs = Tmp_4 which = Public_Tmp9 }
                        divide_key = { lhs = Tmp_5 which = Public_Tmp9 }
                        divide_key = { lhs = Tmp_6 which = Public_Tmp9 }
                        
                            # tmp_1 is how much % of the total score of the entire country represents this province, #tmp_2 fishery, etc. in raw percentage value
                        multiply_key = { lhs = Tmp_1 value = 100 }
                        multiply_key = { lhs = Tmp_2 value = 100 }
                        multiply_key = { lhs = Tmp_3 value = 100 }
                        multiply_key = { lhs = Tmp_4 value = 100 }
                        multiply_key = { lhs = Tmp_5 value = 100 }
                        multiply_key = { lhs = Tmp_6 value = 100 }
                            # if more than 60% of total score goes into 1 specific industry, set a flag to next time reduce score
                        if = {
                            limit = {
                                NOT = { is_capital = yes }
                            }
                            if = {
                                limit = {
                                    check_key = { lhs = Tmp_1 value = 60 }
                                }
                                if = {
                                    limit = {
                                        check_key = { lhs = Tmp_1 value = 80 }
                                    }
                                    set_province_flag = AgricultureInvestment8
                                }
                                else = {
                                    set_province_flag = AgricultureInvestment6
                                }
                            }
                            else_if = {
                                limit = {
                                    check_key = { lhs = Tmp_2 value = 60 }
                                }
                                if = {
                                    limit = {
                                        check_key = { lhs = Tmp_2 value = 80 }
                                    }
                                    set_province_flag = ForestryInvestment8
                                }
                                else = {
                                    set_province_flag = ForestryInvestment6
                                }
                            }
                            else_if = {
                                limit = {
                                    check_key = { lhs = Tmp_3 value = 60 }
                                }
                                if = {
                                    limit = {
                                        check_key = { lhs = Tmp_3 value = 80 }
                                    }
                                    set_province_flag = ExtractionInvestment8
                                }
                                else = {
                                    set_province_flag = ExtractionInvestment6
                                }
                            }
                            else_if = {
                                limit = {
                                    check_key = { lhs = Tmp_4 value = 60 }
                                }
                                if = {
                                    limit = {
                                        check_key = { lhs = Tmp_4 value = 80 }
                                    }
                                    set_province_flag = FisheryInvestment8
                                }
                                else = {
                                    set_province_flag = FisheryInvestment6
                                }
                            }
                            else_if = {
                                limit = {
                                    check_key = { lhs = Tmp_5 value = 60 }
                                }
                                if = {
                                    limit = {
                                        check_key = { lhs = Tmp_5 value = 80 }
                                    }
                                    set_province_flag = IndustrialInvestment8
                                }
                                else = {
                                    set_province_flag = IndustrialInvestment6
                                }
                            }
                            else_if = {
                                limit = {
                                    check_key = { lhs = Tmp_6 value = 60 }
                                }
                                if = {
                                    limit = {
                                        check_key = { lhs = Tmp_6 value = 80 }
                                    }
                                    set_province_flag = AcademicInvestment8
                                }
                                else = {
                                    set_province_flag = AcademicInvestment6
                                }
                            }
                        }
            
                        # calculate score / total budget to get in raw money value how much it will be invested
                        set_key = { lhs = Public_Tmp0 which = PREV } # total budget
                        
                        if = {
                            limit = {
                                check_key = { lhs = Public_Tmp0 value = 0.001 }
                            }
                            divide_key = { lhs = Public_Tmp1 which = Public_Tmp0 }
                            divide_key = { lhs = Public_Tmp2 which = Public_Tmp0 }
                            divide_key = { lhs = Public_Tmp3 which = Public_Tmp0 }
                            divide_key = { lhs = Public_Tmp4 which = Public_Tmp0 }
                            divide_key = { lhs = Public_Tmp5 which = Public_Tmp0 }
                            divide_key = { lhs = Public_Tmp6 which = Public_Tmp0 }
                        }
                        
                        # invest
                        
                        Do_Invest_Player = { type=Agriculture return=Public_Tmp1 score=Tmp_1 }
                        
                        Do_Invest_Player = { type=Forestry return=Public_Tmp2 score=Tmp_2 }
                        
                        Do_Invest_Player = { type=Extraction return=Public_Tmp3 score=Tmp_3 }
                       
                        Do_Invest_Player = { type=Fishery return=Public_Tmp4 score=Tmp_4 }
                        
                        Do_Invest_Player = { type=Industrial return=Public_Tmp5 score=Tmp_5 }
                        
                        Do_Invest_Player = { type=Academic return=Public_Tmp6 score=Tmp_6 }
                        
                        clr_province_flag = possible_investment
                    }
                    if = {
                        limit = {
                            has_country_flag = show_investment
                            check_key = { lhs = Tmp_Misc0 value = 0.001 }
                        }
                        random_owned_province = {
                            limit = {
                                has_province_flag = invested
                            }
                            province_event = { 
                                id = AI_Invest.9
                            }
                        }
                    }
                    POP_RemoveDucat = { type = which inp = Public_Tmp7 }
                    
                }
            }
        }
	}
	option = {
		name = "OPT.GREAT"
        log = "Player tried to invest"
	}
    after = {
        set_key = { lhs = Ai_Invest_BudgetFixed value = 0 }
    }
}
country_event = {
    id = AI_Invest.4
    title = "AI_Invest_title"
    desc = no_localisation
	picture = ai_only

    is_triggered_only = yes

    trigger = {
        ai = no
        isValidCountry = yes
        has_country_flag = Automatic_Invest
        has_country_flag = invest_every_5
	}

    mean_time_to_happen = {
        days = 1
    }

    immediate = {
        hidden_effect = {
            if = {
                limit = {
                    NOT = { num_of_loans = 1 }
                    monthly_income = 0
                    OR = {
                        AND = {
                            is_at_war = yes
                            war_score = 15
                        }
                        is_at_war = no
                    }
                }
                set_key = { lhs = Tmp_Misc0 value = 0 }
                set_key = { lhs = Public_Tmp1 value = 0 }
                set_key = { lhs = Public_Tmp2 value = 0 }
                set_key = { lhs = Public_Tmp3 value = 0 }
                set_key = { lhs = Public_Tmp4 value = 0 }
                set_key = { lhs = Public_Tmp5 value = 0 }
                set_key = { lhs = Public_Tmp6 value = 0 }
                
                export_to_key = {
                    lhs = Ai_Invest_BudgetFixed
                    value = treasury
                }
                
                set_key = { lhs = Tmp_Misc0 which = Ai_Invest_Budget }
                multiply_key = { lhs = Tmp_Misc0 value = 0.01 }
                multiply_key = { lhs = Ai_Invest_BudgetFixed which = Tmp_Misc0 }
                   
                if = {
                    limit = {
                        check_key = { lhs = Ai_Invest_BudgetFixed value = 5 }
                        check_key = { lhs = Prov_BUPow value = 2.5 }    #NEVER invest under 2.5 State Reach (investment pool won't drain)
                    }
                    
                    set_key = { lhs = Public_Tmp1 value = 0 }
                    set_key = { lhs = Public_Tmp2 value = 0 }
                    set_key = { lhs = Public_Tmp3 value = 0 }
                    set_key = { lhs = Public_Tmp4 value = 0 }
                    set_key = { lhs = Public_Tmp5 value = 0 }
                    set_key = { lhs = Public_Tmp6 value = 0 }
                    every_owned_province = {
                        limit = {
                            has_province_flag = Invest
                            controlled_by = owner
                            is_core = owner
                        }
                        clr_province_flag = invested
                        set_province_flag = possible_investment
                        set_key = { lhs = Public_Tmp1 value = 0 }
                        set_key = { lhs = Public_Tmp2 value = 0 }
                        set_key = { lhs = Public_Tmp3 value = 0 }
                        set_key = { lhs = Public_Tmp4 value = 0 }
                        set_key = { lhs = Public_Tmp5 value = 0 }
                        set_key = { lhs = Public_Tmp6 value = 0 }
                        
                        Infra_AISpendCheck_Agriculture = { type = Agriculture return = Public_Tmp1 cap = Building_AgricultureMax }
                        Infra_AISpendCheck_Forestry = { type = Forestry return=Public_Tmp2 cap = Building_ForestryMax }
                        Infra_AISpendCheck_Extraction = { type = Extraction return = Public_Tmp3 cap = Building_ExtractionMax }
                        Infra_AISpendCheck_Fishery = { type = Fishery return = Public_Tmp4  cap = Building_FisheryMax }
                        Infra_AISpendCheck_Industrial = { type = Industrial return = Public_Tmp5 }
                        Infra_AISpendCheck_Academic = { type = Academic return = Public_Tmp6 }  
                        PREV = { #add scores of every province to the country
                            change_key = { lhs = Public_Tmp1 which = PREV } 
                            change_key = { lhs = Public_Tmp2 which = PREV }
                            change_key = { lhs = Public_Tmp3 which = PREV }
                            change_key = { lhs = Public_Tmp4 which = PREV }
                            change_key = { lhs = Public_Tmp5 which = PREV }
                            change_key = { lhs = Public_Tmp6 which = PREV }
                        }     
                    }

                    #sum all scores into 1
                    set_key = { lhs = Public_Tmp0 which = Public_Tmp1 }
                    change_key = { lhs = Public_Tmp0 which = Public_Tmp2 }
                    change_key = { lhs = Public_Tmp0 which = Public_Tmp3 }
                    change_key = { lhs = Public_Tmp0 which = Public_Tmp4 }
                    change_key = { lhs = Public_Tmp0 which = Public_Tmp5 }
                    change_key = { lhs = Public_Tmp0 which = Public_Tmp6 }
                    
                    set_key = { lhs = Public_Tmp9 which = Public_Tmp0 } #save total score here
                    divide_key = { lhs = Public_Tmp0 which = Ai_Invest_BudgetFixed } #total score divided by budget
                    
                    set_key = { lhs = Tmp_9 value = 0 }
                    set_key = { lhs = Public_Tmp7 value = 0 } #Key to be used to substract treasury
                    every_owned_province = {
                        limit = {
                            has_province_flag = possible_investment
                        }
                        set_key = { lhs = Tmp_9 value = 0 }
                            # set total score per province of each type of building (the one that came from Infra_AISpendCheck)
                        set_key = { lhs = Tmp_1 which = Public_Tmp1 } 
                        set_key = { lhs = Tmp_2 which = Public_Tmp2 }
                        set_key = { lhs = Tmp_3 which = Public_Tmp3 }
                        set_key = { lhs = Tmp_4 which = Public_Tmp4 }
                        set_key = { lhs = Tmp_5 which = Public_Tmp5 }
                        set_key = { lhs = Tmp_6 which = Public_Tmp6 }
                        
                            # calculate each score's percentage % from the total country's score for each type of building
                        set_key = { lhs = Public_Tmp9 which = PREV } #total country score
                        divide_key = { lhs = Tmp_1 which = Public_Tmp9 } 
                        divide_key = { lhs = Tmp_2 which = Public_Tmp9 }
                        divide_key = { lhs = Tmp_3 which = Public_Tmp9 }
                        divide_key = { lhs = Tmp_4 which = Public_Tmp9 }
                        divide_key = { lhs = Tmp_5 which = Public_Tmp9 }
                        divide_key = { lhs = Tmp_6 which = Public_Tmp9 }
                        
                            # tmp_1 is how much % of the total score of the entire country represents this province, #tmp_2 fishery, etc. in raw percentage value
                        multiply_key = { lhs = Tmp_1 value = 100 }
                        multiply_key = { lhs = Tmp_2 value = 100 }
                        multiply_key = { lhs = Tmp_3 value = 100 }
                        multiply_key = { lhs = Tmp_4 value = 100 }
                        multiply_key = { lhs = Tmp_5 value = 100 }
                        multiply_key = { lhs = Tmp_6 value = 100 }
                            # if more than 60% of total score goes into 1 specific industry, set a flag to next time reduce score
                        if = {
                            limit = {
                                NOT = { is_capital = yes }
                            }
                            if = {
                                limit = {
                                    check_key = { lhs = Tmp_1 value = 60 }
                                }
                                if = {
                                    limit = {
                                        check_key = { lhs = Tmp_1 value = 80 }
                                    }
                                    set_province_flag = AgricultureInvestment8
                                }
                                else = {
                                    set_province_flag = AgricultureInvestment6
                                }
                            }
                            else_if = {
                                limit = {
                                    check_key = { lhs = Tmp_2 value = 60 }
                                }
                                if = {
                                    limit = {
                                        check_key = { lhs = Tmp_2 value = 80 }
                                    }
                                    set_province_flag = ForestryInvestment8
                                }
                                else = {
                                    set_province_flag = ForestryInvestment6
                                }
                            }
                            else_if = {
                                limit = {
                                    check_key = { lhs = Tmp_3 value = 60 }
                                }
                                if = {
                                    limit = {
                                        check_key = { lhs = Tmp_3 value = 80 }
                                    }
                                    set_province_flag = ExtractionInvestment8
                                }
                                else = {
                                    set_province_flag = ExtractionInvestment6
                                }
                            }
                            else_if = {
                                limit = {
                                    check_key = { lhs = Tmp_4 value = 60 }
                                }
                                if = {
                                    limit = {
                                        check_key = { lhs = Tmp_4 value = 80 }
                                    }
                                    set_province_flag = FisheryInvestment8
                                }
                                else = {
                                    set_province_flag = FisheryInvestment6
                                }
                            }
                            else_if = {
                                limit = {
                                    check_key = { lhs = Tmp_5 value = 60 }
                                }
                                if = {
                                    limit = {
                                        check_key = { lhs = Tmp_5 value = 80 }
                                    }
                                    set_province_flag = IndustrialInvestment8
                                }
                                else = {
                                    set_province_flag = IndustrialInvestment6
                                }
                            }
                            else_if = {
                                limit = {
                                    check_key = { lhs = Tmp_6 value = 60 }
                                }
                                if = {
                                    limit = {
                                        check_key = { lhs = Tmp_6 value = 80 }
                                    }
                                    set_province_flag = AcademicInvestment8
                                }
                                else = {
                                    set_province_flag = AcademicInvestment6
                                }
                            }
                        }
            
                        # calculate score / total budget to get in raw money value how much it will be invested
                        set_key = { lhs = Public_Tmp0 which = PREV } # total budget
                        
                        if = {
                            limit = {
                                check_key = { lhs = Public_Tmp0 value = 0.001 }
                            }
                            divide_key = { lhs = Public_Tmp1 which = Public_Tmp0 }
                            divide_key = { lhs = Public_Tmp2 which = Public_Tmp0 }
                            divide_key = { lhs = Public_Tmp3 which = Public_Tmp0 }
                            divide_key = { lhs = Public_Tmp4 which = Public_Tmp0 }
                            divide_key = { lhs = Public_Tmp5 which = Public_Tmp0 }
                            divide_key = { lhs = Public_Tmp6 which = Public_Tmp0 }
                        }
                        
                        # invest
                        
                        Do_Invest_Player = { type=Agriculture return=Public_Tmp1 score=Tmp_1 }
                        
                        Do_Invest_Player = { type=Forestry return=Public_Tmp2 score=Tmp_2 }
                        
                        Do_Invest_Player = { type=Extraction return=Public_Tmp3 score=Tmp_3 }
                       
                        Do_Invest_Player = { type=Fishery return=Public_Tmp4 score=Tmp_4 }
                        
                        Do_Invest_Player = { type=Industrial return=Public_Tmp5 score=Tmp_5 }
                        
                        Do_Invest_Player = { type=Academic return=Public_Tmp6 score=Tmp_6 }
                        
                        clr_province_flag = possible_investment
                    }
                    if = {
                        limit = {
                            has_country_flag = show_investment
                            check_key = { lhs = Tmp_Misc0 value = 0.001 }
                        }
                        random_owned_province = {
                            limit = {
                                has_province_flag = invested
                            }
                            province_event = { 
                                id = AI_Invest.9
                            }
                        }
                    }
                    POP_RemoveDucat = { type = which inp = Public_Tmp7 }
                    
                }
            }
        }
	}
	option = {
		name = "OPT.GREAT"
        log = "Player tried to invest"
	}
    after = {
        set_key = { lhs = Ai_Invest_BudgetFixed value = 0 }
    }
}
#Auto Investor
country_event = {
    id = AI_Invest.5
    title = AI_Invest.5_title
    desc = AI_Invest.5.a_desc
    picture = ai_only
    is_triggered_only = yes

    trigger = {
        ai = no
    }
    
    immediate = {
        
    }
    option = {
        name = AI_Invest.5.k
		custom_tooltip = AI_Invest.5.k.custom
		trigger = {
			NOT = { has_country_flag = Automatic_Invest }
		}
		every_owned_province = {
			limit = {
				NOT = { has_province_flag = Invest }
				OR = {
					is_state = yes
					is_owned_by_trade_company = yes
				}
			}
			set_province_flag = Invest
		}
		set_country_flag = Automatic_Invest
		country_event = { id = AI_Invest.6 }
    }
    option = {
        name = AI_Invest.5.l
		trigger = {
			has_country_flag = Automatic_Invest
		}
		every_owned_province = {
			limit = {
				has_province_flag = Invest
			}
			clr_province_flag = Invest
		}
		clr_country_flag = Automatic_Invest
		country_event = { id = AI_Invest.6 }
    }
    option = {
        trigger = {
            NOT = { check_key = { lhs = Ai_Invest_Budget value = 90 } }
        }
        name = AI_Invest.5.a
        hidden_effect = {
            change_key = { lhs = Ai_Invest_Budget value = 10 }
            country_event = { id = AI_Invest.6 }
        }
    }
    option = {
        trigger = {
            NOT = { check_key = { lhs = Ai_Invest_Budget value = 95 } }
        }
        name = AI_Invest.5.a2
        hidden_effect = {
            change_key = { lhs = Ai_Invest_Budget value = 5 }
            country_event = { id = AI_Invest.6 }
        }
    }
    option = {
        trigger = {
            check_key = { lhs = Ai_Invest_Budget value = 10 }
        }
        name = AI_Invest.5.b
        hidden_effect = {
            change_key = { lhs = Ai_Invest_Budget value = -10 }
            country_event = { id = AI_Invest.6 }
        }
        
    }
    option = {
        trigger = {
           check_key = { lhs = Ai_Invest_Budget value = 5 }
        }
        name = AI_Invest.5.b2
        hidden_effect = {
            change_key = { lhs = Ai_Invest_Budget value = -5 }
            country_event = { id = AI_Invest.6 }
        }
        
    }
    option = {
        name = AI_Invest.5.c
        set_country_flag = invest_every_5
        clr_country_flag = invest_every_4
        clr_country_flag = invest_every_3
        country_event = { id = AI_Invest.6 }
    }
    option = {
        name = AI_Invest.5.d
        set_country_flag = invest_every_4
        clr_country_flag = invest_every_3
        clr_country_flag = invest_every_5
        country_event = { id = AI_Invest.6 }
    }
    option = {
        name = AI_Invest.5.e
        set_country_flag = invest_every_3
        clr_country_flag = invest_every_4
        clr_country_flag = invest_every_5
        country_event = { id = AI_Invest.6 }
    }
    option = {
        name = AI_Invest.5.g
        custom_tooltip = AI_Invest.5.custom
        random_owned_province = {
            limit = {
                has_province_flag = UI_Select
            }
            province_event = { id = AI_Invest.7 }
            
        }
    }
    option = {
        name = AI_Invest.5.h
        trigger = {
            NOT = { has_country_flag = show_investment }
        }
        custom_tooltip = AI_Invest.5.h.custom
        set_country_flag = show_investment
        country_event = { id = AI_Invest.6 }
    }
    option = {
        name = AI_Invest.5.i
        trigger = {
            has_country_flag = show_investment
        }
        clr_country_flag = show_investment
        country_event = { id = AI_Invest.6 }
    }
    option = { #advanced options
        name = AI_Invest.5.j
        country_event = { id = AI_Invest.14 }
    }
    option = {
        name = AI_Invest.5.f
    }
    after = {
        
    }
}
#Auto Investor Helper
country_event = {
    id = AI_Invest.6
    title = AI_Invest.5_title
    desc = AI_Invest.5.a_desc
    picture = ai_only
    is_triggered_only = yes

    trigger = {
        ai = no
    }
    
    immediate = {
        
    }
    
    option = {
        name = AI_Invest.5.k
		custom_tooltip = AI_Invest.5.k.custom
		trigger = {
			NOT = { has_country_flag = Automatic_Invest }
		}
		every_owned_province = {
			limit = {
				NOT = { has_province_flag = Invest }
				OR = {
					is_state = yes
					is_owned_by_trade_company = yes
				}
			}
			set_province_flag = Invest
		}
		set_country_flag = Automatic_Invest
		country_event = { id = AI_Invest.5 }
    }
    option = {
        name = AI_Invest.5.l
		trigger = {
			has_country_flag = Automatic_Invest
		}
		every_owned_province = {
			limit = {
				has_province_flag = Invest
			}
			clr_province_flag = Invest
		}
		clr_country_flag = Automatic_Invest
		country_event = { id = AI_Invest.5 }
    }
    option = {
        trigger = {
            NOT = { check_key = { lhs = Ai_Invest_Budget value = 90 } }
        }
        name = AI_Invest.5.a
        hidden_effect = {
            change_key = { lhs = Ai_Invest_Budget value = 10 }
            country_event = { id = AI_Invest.5 }
        }
    }
    option = {
        trigger = {
            NOT = { check_key = { lhs = Ai_Invest_Budget value = 95 } }
        }
        name = AI_Invest.5.a2
        hidden_effect = {
            change_key = { lhs = Ai_Invest_Budget value = 5 }
            country_event = { id = AI_Invest.5 }
        }
    }
    option = {
        trigger = {
            check_key = { lhs = Ai_Invest_Budget value = 10 }
        }
        name = AI_Invest.5.b
        hidden_effect = {
            change_key = { lhs = Ai_Invest_Budget value = -10 }
            country_event = { id = AI_Invest.5 }
        }
    }
    option = {
        trigger = {
           check_key = { lhs = Ai_Invest_Budget value = 5 }
        }
        name = AI_Invest.5.b2
        hidden_effect = {
            change_key = { lhs = Ai_Invest_Budget value = -5 }
            country_event = { id = AI_Invest.5 }
        }
    }
    option = {
        name = AI_Invest.5.c
        set_country_flag = invest_every_5
        clr_country_flag = invest_every_4
        clr_country_flag = invest_every_3
        country_event = { id = AI_Invest.5 }
    }
    option = {
        name = AI_Invest.5.d
        set_country_flag = invest_every_4
        clr_country_flag = invest_every_3
        clr_country_flag = invest_every_5
        country_event = { id = AI_Invest.5 }
    }
    option = {
        name = AI_Invest.5.e
        set_country_flag = invest_every_3
        clr_country_flag = invest_every_4
        clr_country_flag = invest_every_5
        country_event = { id = AI_Invest.5 }
    }
    option = {
        name = AI_Invest.5.g
        set_country_flag = budget_exitter
        custom_tooltip = AI_Invest.5.custom
        random_owned_province = {
            limit = {
                has_province_flag = UI_Select
            }
            province_event = { id = AI_Invest.7 }
        }
    }
    option = {
        name = AI_Invest.5.h
        trigger = {
            NOT = { has_country_flag = show_investment }
        }
        custom_tooltip = AI_Invest.5.h.custom
        set_country_flag = show_investment
        country_event = { id = AI_Invest.5 }
    }
    option = {
        name = AI_Invest.5.i
        trigger = {
            has_country_flag = show_investment
        }
        clr_country_flag = show_investment
        country_event = { id = AI_Invest.5 }
    }
    option = { #advanced options
        name = AI_Invest.5.j
        
        country_event = { id = AI_Invest.14 }
    }
    option = {
        name = AI_Invest.5.f
        
    }
    after = {
        
    }
}
#Cycle provinces to display investment history
province_event = {
    id = AI_Invest.7
    title = AI_Invest.7_title
    desc = AI_Invest.7_desc
    picture = ai_only
    is_triggered_only = yes

    trigger = {
    }
    
    immediate = {
		province_event = { id = SYS_Pin.001 }
    }
    
    option = {
        name = AI_Invest.7.a
        owner = {
            random_owned_province = {
                limit = {
                    has_province_flag = UI_Select
                }
                province_event = { id = AI_Invest.8 }
            }
        }
    }
    option = {
        name = AI_Invest.7.b
    }
}
#Cycle provinces to display investment history helper
province_event = {
    id = AI_Invest.8
    title = AI_Invest.8_title
    desc = AI_Invest.8_desc
    picture = ai_only
    is_triggered_only = yes

    trigger = {
    }
    
    immediate = {
		province_event = { id = SYS_Pin.001 }
    }
    
    option = {
        name = AI_Invest.7.a
        owner = {
            random_owned_province = {
                limit = {
                    has_province_flag = UI_Select
                }
                province_event = { id = AI_Invest.7 }
            }
        }
    }
    option = {
        name = AI_Invest.7.b
    }
}
province_event = {
    id = AI_Invest.9
    title = AI_Invest.9_title
    desc = AI_Invest.9_desc
    picture = ai_only
    is_triggered_only = yes

    trigger = {
    }
    
    immediate = {
        clr_province_flag = invested
		province_event = { id = SYS_Pin.001 }
    }
    
    option = { #cycle to flagged 
        name = AI_Invest.9.a
        custom_tooltip = custom.AI_Invest.9.a
        owner = {
            random_owned_province = {
                limit = {
                    has_province_flag = invested
                }
                province_event = { id = AI_Invest.10 }
            }
        }
    }
    option = { #cycle to selected
        name = AI_Invest.9.b
        custom_tooltip = custom.AI_Invest.9.b
        owner = {
            random_owned_province = {
                limit = {
                    has_province_flag = UI_Select
                }
                province_event = { id = AI_Invest.11 }
            }
        }
    }
    option = { #exit
        name = AI_Invest.9.c
    }
}
province_event = {
    id = AI_Invest.10
    title = AI_Invest.10_title
    desc = AI_Invest.10_desc
    picture = ai_only
    is_triggered_only = yes

    trigger = {
    }
    
    immediate = {
        clr_province_flag = invested
		province_event = { id = SYS_Pin.001 }
    }
    
    option = { #cycle to flagged
        name = AI_Invest.9.a
        owner = {
            random_owned_province = {
                limit = {
                    has_province_flag = invested
                }
                province_event = { id = AI_Invest.9 }
            }
        }
    }
    option = { #cycle to selected
        name = AI_Invest.9.b
        owner = {
            random_owned_province = {
                limit = {
                    has_province_flag = UI_Select
                }
                province_event = { id = AI_Invest.11 }
            }
        }
    }
    option = { #exit
        name = AI_Invest.9.c
    }
}
province_event = {
    id = AI_Invest.11
    title = AI_Invest.11_title
    desc = AI_Invest.11_desc
    picture = ai_only
    is_triggered_only = yes

    trigger = {
    }
    
    immediate = {   
        clr_province_flag = invested
		province_event = { id = SYS_Pin.001 }
    }
    
    option = { #cycle to flagged
        name = AI_Invest.9.a
        owner = {
            random_owned_province = {
                limit = {
                    has_province_flag = invested
                }
                province_event = { id = AI_Invest.9 }
            }
        }
    }
    option = { #cycle to selected
        name = AI_Invest.9.b
        owner = {
            random_owned_province = {
                limit = {
                    has_province_flag = UI_Select
                }
                province_event = { id = AI_Invest.12 }
            }
        }
    }
    option = { #exit
        name = AI_Invest.9.c
    }
}
province_event = {
    id = AI_Invest.12
    title = AI_Invest.12_title
    desc = AI_Invest.12_desc
    picture = ai_only
    is_triggered_only = yes

    trigger = {
    }
    
    immediate = {
        clr_province_flag = invested
        #remove_estate = UI_Select
		province_event = { id = SYS_Pin.001 }
    }
    
    option = { #cycle to flagged
        name = AI_Invest.9.a
        owner = {
            random_owned_province = {
                limit = {
                    has_province_flag = invested
                }
                province_event = { id = AI_Invest.9 }
            }
        }
    }
    option = { #cycle to selected
        name = AI_Invest.9.b
        owner = {
            random_owned_province = {
                limit = {
                    has_province_flag = UI_Select
                }
                province_event = { id = AI_Invest.11 }
            }
        }
    }
    option = { #exit
        name = AI_Invest.9.c
    }
}
country_event = {
    id = AI_Invest.13
    title = AI_Invest.13_title
    desc = AI_Invest.13_desc
    picture = ai_only
    is_triggered_only = yes

    trigger = {
    }
    
    immediate = {
        every_owned_province = {
            if = {
                limit = {
                    has_province_flag = Invest
                    NOT = { has_province_flag = NIndus }
                }
                add_province_modifier = {
                    name = Invest_All
                    duration = -1
                }
            }
            else_if = {
                limit = {
                    has_province_flag = Invest
                    has_province_flag = NIndus
                }
                add_province_modifier = {
                    name = Invest_NOIndustry
                    duration = -1
                }
            }
        }
    }
    
    option = { #go back
        name = AI_Invest.13.a
        hidden_effect = {
            every_owned_province = {
                remove_province_modifier = Invest_All
                remove_province_modifier = Invest_NOIndustry
            }
            country_event = { id = AI_Invest.14 }
        }
    }
    option = { #exit
        name = AI_Invest.13.b
        hidden_effect = {
            every_owned_province = {
                remove_province_modifier = Invest_All
                remove_province_modifier = Invest_NOIndustry
            }
        }
    }
}
#Advanced options
country_event = {
    id = AI_Invest.14
    title = AI_Invest.14_title
    desc = AI_Invest.14_desc
    picture = ai_only
    is_triggered_only = yes

    trigger = {
    }
    
    immediate = {
        clr_country_flag = budget_exitter
        
    }
    
    option = {
        name = AI_Invest.14.a
        custom_tooltip = custom.AI_Invest.14.a
        every_owned_province = { 
            limit = {
                has_province_flag = UI_Select
            }
            set_province_flag = NIndus
        }   
        hidden_effect = {
            country_event = { id = AI_Invest.15 }
        }
    }
    option = {
        name = AI_Invest.14.b
        every_owned_province = { 
            limit = {
                has_province_flag = UI_Select
            }
            clr_province_flag = NIndus
        }  
        hidden_effect = {
            country_event = { id = AI_Invest.15 }
        }
    }
    option = { #Fire provinces display
        name = AI_Invest.14.c
        trigger = {
        }
        country_event = { id = AI_Invest.13 }
    }
    option = {
        name = AI_Invest.14.d
        country_event = { id = AI_Invest.5 }
    }
    option = {
        name = AI_Invest.14.e
    }
}
#Advanced options helper
country_event = {
    id = AI_Invest.15
    title = AI_Invest.14_title
    desc = AI_Invest.14_desc
    picture = ai_only
    is_triggered_only = yes

    trigger = {
    }
    
    immediate = {
        
    }
    
    option = {
        name = AI_Invest.14.a
        custom_tooltip = custom.AI_Invest.14.a
        hidden_effect = {
            every_owned_province = { 
                limit = {
                    has_province_flag = UI_Select
                }
                set_province_flag = NIndus
            }   
            country_event = { id = AI_Invest.14 }
        }
    }
    option = {
        name = AI_Invest.14.b
        every_owned_province = { 
            limit = {
                has_province_flag = UI_Select
            }
            clr_province_flag = NIndus
        }
        hidden_effect = {
            country_event = { id = AI_Invest.14 }
        }
    }
    option = {
        name = AI_Invest.14.c
        trigger = {
            any_owned_province = {
                has_province_flag = Invest
            }
        }
        country_event = { id = AI_Invest.13 }
    }
    option = {
        name = AI_Invest.14.d
        country_event = { id = AI_Invest.5 }
    }
    option = {
        name = AI_Invest.14.e
    }
}