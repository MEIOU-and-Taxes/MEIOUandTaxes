namespace = POP_Display

country_event = { 
    id = POP_Display.001
    title = POP_Display.001.t
    desc = POP_Display.001.d
    picture = CITY_DEVELOPMENT_eventPicture

    is_triggered_only = yes

    option = {
        name = POP_Display.001.1

        country_event = {
            id = POP_Display.002
        }
    }
    option = {
        name = POP_Display.001.2

        country_event = {
            id = POP_Display.005
        }
    }
    option = {
        name = POP_Display.001.3

        trigger = {
            any_province = {
				has_province_flag = UI_Select
            }
        }

        hidden_effect = {
            Rep_1 = { class = SF }
            Rep_1 = { class = NM }
            Rep_1 = { class = RE }
            Rep_1 = { class = NO }
            Rep_1 = { class = BG }
            Rep_1 = { class = CL }
            set_key = { lhs = Class_Total value = 0 }

            # Edit for new produce
            set_key = { lhs = TN_ProvSply1 value = 0 }
            set_key = { lhs = TN_ProvSply2 value = 0 }
            set_key = { lhs = TN_ProvSply4 value = 0 }
            set_key = { lhs = TN_ProvSply5 value = 0 }
            set_key = { lhs = TN_ProvSply6 value = 0 }
            set_key = { lhs = TN_ProvSply9 value = 0 }
            set_key = { lhs = TN_ProvSply10 value = 0 }

            set_key = { lhs = TN_ProvSply21 value = 0 }
            set_key = { lhs = TN_ProvSply22 value = 0 }
            set_key = { lhs = TN_ProvSply23 value = 0 }
            set_key = { lhs = TN_ProvSply24 value = 0 }
            set_key = { lhs = TN_ProvSply25 value = 0 }

            set_key = { lhs = TN_ProvSply41 value = 0 }
            set_key = { lhs = TN_ProvSply51 value = 0 }
            
            set_key = { lhs = TN_ProvSubsistSply1 value = 0 }
            set_key = { lhs = TN_ProvSubsistSply2 value = 0 }
            set_key = { lhs = TN_ProvSubsistSply4 value = 0 }
            set_key = { lhs = TN_ProvSubsistSply5 value = 0 }
            set_key = { lhs = TN_ProvSubsistSply6 value = 0 }
            set_key = { lhs = TN_ProvSubsistSply9 value = 0 }
            set_key = { lhs = TN_ProvSubsistSply10 value = 0 }
            set_key = { lhs = TN_ProvSubsistSply21 value = 0 }
            set_key = { lhs = TN_ProvSubsistSply22 value = 0 }
            set_key = { lhs = TN_ProvSubsistSply23 value = 0 }
            set_key = { lhs = TN_ProvSubsistSply24 value = 0 }
            set_key = { lhs = TN_ProvSubsistSply25 value = 0 }
            set_key = { lhs = TN_ProvSubsistSply41 value = 0 }

            # Edit for new produce
            set_key = { lhs = TN_ProvDmnd1 value = 0 }
            set_key = { lhs = TN_ProvDmnd2 value = 0 }
            set_key = { lhs = TN_ProvDmnd4 value = 0 }
            set_key = { lhs = TN_ProvDmnd5 value = 0 }
            set_key = { lhs = TN_ProvDmnd6 value = 0 }
            set_key = { lhs = TN_ProvDmnd9 value = 0 }
            set_key = { lhs = TN_ProvDmnd10 value = 0 }
            
            set_key = { lhs = TN_ProvDmnd21 value = 0 }
            set_key = { lhs = TN_ProvDmnd22 value = 0 }
            set_key = { lhs = TN_ProvDmnd23 value = 0 }
            set_key = { lhs = TN_ProvDmnd24 value = 0 }
            set_key = { lhs = TN_ProvDmnd25 value = 0 }

            set_key = { lhs = TN_ProvDmnd41 value = 0 }
            set_key = { lhs = TN_ProvDmnd51 value = 0 }

            every_province = {
                limit = {
					has_province_flag = UI_Select
                }
                PREV = {
                    Rep_2 = { class = SF }
                    Rep_2 = { class = NM }
                    Rep_2 = { class = RE }
                    Rep_2 = { class = NO }
                    Rep_2 = { class = BG }
                    Rep_2 = { class = CL }
                    change_key = { lhs = Class_Total which = PREV }

                        # Edit for new produce
                        # Calculate Local Subsistence
					set_key = { lhs = TN_ProvSubsistSply1 which = TN_Subsistence1 }
					set_key = { lhs = TN_ProvSubsistSply2 which = TN_Subsistence2 }
					set_key = { lhs = TN_ProvSubsistSply4 which = TN_Subsistence4 }
					set_key = { lhs = TN_ProvSubsistSply5 which = TN_Subsistence5 }
					set_key = { lhs = TN_ProvSubsistSply6 which = TN_Subsistence6 }
					set_key = { lhs = TN_ProvSubsistSply9 which = TN_Subsistence9 }
					set_key = { lhs = TN_ProvSubsistSply10 which = TN_Subsistence10 }
					set_key = { lhs = TN_ProvSubsistSply21 which = TN_Subsistence21 }
					set_key = { lhs = TN_ProvSubsistSply22 which = TN_Subsistence22 }
					set_key = { lhs = TN_ProvSubsistSply23 which = TN_Subsistence23 }
					set_key = { lhs = TN_ProvSubsistSply24 which = TN_Subsistence24 }
					set_key = { lhs = TN_ProvSubsistSply25 which = TN_Subsistence25 }
					set_key = { lhs = TN_ProvSubsistSply41 which = TN_Subsistence41 }
                    
                    multiply_key = { lhs = TN_ProvSubsistSply1 which = TN_ProvSply1 }
                    multiply_key = { lhs = TN_ProvSubsistSply2 which = TN_ProvSply2 }
                    multiply_key = { lhs = TN_ProvSubsistSply4 which = TN_ProvSply4 }
                    multiply_key = { lhs = TN_ProvSubsistSply5 which = TN_ProvSply5 }
                    multiply_key = { lhs = TN_ProvSubsistSply6 which = TN_ProvSply6 }
                    multiply_key = { lhs = TN_ProvSubsistSply9 which = TN_ProvSply9 }
                    multiply_key = { lhs = TN_ProvSubsistSply10 which = TN_ProvSply10 }
                    multiply_key = { lhs = TN_ProvSubsistSply21 which = TN_ProvSply21 }
                    multiply_key = { lhs = TN_ProvSubsistSply22 which = TN_ProvSply22 }
                    multiply_key = { lhs = TN_ProvSubsistSply23 which = TN_ProvSply23 }
                    multiply_key = { lhs = TN_ProvSubsistSply24 which = TN_ProvSply24 }
                    multiply_key = { lhs = TN_ProvSubsistSply25 which = TN_ProvSply25 }
                    multiply_key = { lhs = TN_ProvSubsistSply41 which = TN_ProvSply41 }
                    
                    subtract_key = { lhs = TN_ProvSply1 which = TN_ProvSubsistSply1 }
                    subtract_key = { lhs = TN_ProvSply2 which = TN_ProvSubsistSply2 }
                    subtract_key = { lhs = TN_ProvSply4 which = TN_ProvSubsistSply4 }
                    subtract_key = { lhs = TN_ProvSply5 which = TN_ProvSubsistSply5 }
                    subtract_key = { lhs = TN_ProvSply6 which = TN_ProvSubsistSply6 }
                    subtract_key = { lhs = TN_ProvSply9 which = TN_ProvSubsistSply9 }
                    subtract_key = { lhs = TN_ProvSply10 which = TN_ProvSubsistSply10 }
                    subtract_key = { lhs = TN_ProvSply21 which = TN_ProvSubsistSply21 }
                    subtract_key = { lhs = TN_ProvSply22 which = TN_ProvSubsistSply22 }
                    subtract_key = { lhs = TN_ProvSply23 which = TN_ProvSubsistSply23 }
                    subtract_key = { lhs = TN_ProvSply24 which = TN_ProvSubsistSply24 }
                    subtract_key = { lhs = TN_ProvSply25 which = TN_ProvSubsistSply25 }
                    subtract_key = { lhs = TN_ProvSply41 which = TN_ProvSubsistSply41 }
                    
                    change_key = { lhs = TN_ProvSply1 which = PREV }
                    change_key = { lhs = TN_ProvSply2 which = PREV }
                    change_key = { lhs = TN_ProvSply4 which = PREV }
                    change_key = { lhs = TN_ProvSply5 which = PREV }
                    change_key = { lhs = TN_ProvSply6 which = PREV }
                    change_key = { lhs = TN_ProvSply9 which = PREV }
                    change_key = { lhs = TN_ProvSply10 which = PREV }

                    change_key = { lhs = TN_ProvSply21 which = PREV }
                    change_key = { lhs = TN_ProvSply22 which = PREV }
                    change_key = { lhs = TN_ProvSply23 which = PREV }
                    change_key = { lhs = TN_ProvSply24 which = PREV }
                    change_key = { lhs = TN_ProvSply25 which = PREV }

                    change_key = { lhs = TN_ProvSply41 which = PREV }
                    change_key = { lhs = TN_ProvSply51 which = PREV }
                    
                    # Edit for new produce
                    change_key = { lhs = TN_ProvSubsistSply1 which = PREV }
                    change_key = { lhs = TN_ProvSubsistSply2 which = PREV }
                    change_key = { lhs = TN_ProvSubsistSply4 which = PREV }
                    change_key = { lhs = TN_ProvSubsistSply5 which = PREV }
                    change_key = { lhs = TN_ProvSubsistSply6 which = PREV }
                    change_key = { lhs = TN_ProvSubsistSply9 which = PREV }
                    change_key = { lhs = TN_ProvSubsistSply10 which = PREV }

                    change_key = { lhs = TN_ProvSubsistSply21 which = PREV }
                    change_key = { lhs = TN_ProvSubsistSply22 which = PREV }
                    change_key = { lhs = TN_ProvSubsistSply23 which = PREV }
                    change_key = { lhs = TN_ProvSubsistSply24 which = PREV }
                    change_key = { lhs = TN_ProvSubsistSply25 which = PREV }

                    change_key = { lhs = TN_ProvSubsistSply41 which = PREV }

                    # Edit for new produce
                    change_key = { lhs = TN_ProvDmnd1 which = PREV }
                    change_key = { lhs = TN_ProvDmnd2 which = PREV }
                    change_key = { lhs = TN_ProvDmnd4 which = PREV }
                    change_key = { lhs = TN_ProvDmnd5 which = PREV }
                    change_key = { lhs = TN_ProvDmnd6 which = PREV }
                    change_key = { lhs = TN_ProvDmnd9 which = PREV }
                    change_key = { lhs = TN_ProvDmnd10 which = PREV }
                    
                    change_key = { lhs = TN_ProvDmnd21 which = PREV }
                    change_key = { lhs = TN_ProvDmnd22 which = PREV }
                    change_key = { lhs = TN_ProvDmnd23 which = PREV }
                    change_key = { lhs = TN_ProvDmnd24 which = PREV }
                    change_key = { lhs = TN_ProvDmnd25 which = PREV }

                    change_key = { lhs = TN_ProvDmnd41 which = PREV }
                    change_key = { lhs = TN_ProvDmnd51 which = PREV }
                }
            }

            Rep_3 = { class = SF }
            Rep_3 = { class = NM }
            Rep_3 = { class = RE }
            Rep_3 = { class = NO }
            Rep_3 = { class = BG }
            Rep_3 = { class = CL }
            
            change_key = { lhs = TN_ProvSply1 which = TN_ProvSubsistSply1 }
            change_key = { lhs = TN_ProvSply2 which = TN_ProvSubsistSply2 }
            change_key = { lhs = TN_ProvSply4 which = TN_ProvSubsistSply4 }
            change_key = { lhs = TN_ProvSply5 which = TN_ProvSubsistSply5 }
            change_key = { lhs = TN_ProvSply6 which = TN_ProvSubsistSply6 }
            change_key = { lhs = TN_ProvSply9 which = TN_ProvSubsistSply9 }
            change_key = { lhs = TN_ProvSply10 which = TN_ProvSubsistSply10 }
            change_key = { lhs = TN_ProvSply21 which = TN_ProvSubsistSply21 }
            change_key = { lhs = TN_ProvSply22 which = TN_ProvSubsistSply22 }
            change_key = { lhs = TN_ProvSply23 which = TN_ProvSubsistSply23 }
            change_key = { lhs = TN_ProvSply24 which = TN_ProvSubsistSply24 }
            change_key = { lhs = TN_ProvSply25 which = TN_ProvSubsistSply25 }
            change_key = { lhs = TN_ProvSply41 which = TN_ProvSubsistSply41 }
        }

        country_event = {
            id = POP_Display.003
        }
    }
    option = {
        name = exit
        highlight = yes
    }
}

country_event = { 
    id = POP_Display.002
    title = POP_Display.002.t
    desc = POP_Display.002.d
    picture = CITY_DEVELOPMENT_eventPicture

    is_triggered_only = yes

    option = {
        name = POP_Display.002.0

        trigger = {
            has_country_flag = Census_S0Has
        }

        hidden_effect = {
            Rep_4 = { slot = 0 }
        }

        country_event = {
            id = POP_Display.003
        }
    }
    option = {
        name = POP_Display.002.1

        trigger = {
            has_country_flag = Census_S1Has
        }

        hidden_effect = {
            Rep_4 = { slot = 1 }
        }

        country_event = {
            id = POP_Display.003
        }
    }
    option = {
        name = POP_Display.002.2

        trigger = {
            has_country_flag = Census_S2Has
        }

        hidden_effect = {
            Rep_4 = { slot = 2 }
        }

        country_event = {
            id = POP_Display.003
        }
    }
    option = {
        name = POP_Display.002.3

        trigger = {
            has_country_flag = Census_S3Has
        }

        hidden_effect = {
            Rep_4 = { slot = 3 }
        }

        country_event = {
            id = POP_Display.003
        }
    }
    option = {
        name = POP_Display.002.4

        trigger = {
            has_country_flag = Census_S4Has
        }

        hidden_effect = {
            Rep_4 = { slot = 4 }
        }

        country_event = {
            id = POP_Display.003
        }
    }
    
    option = {
        name = back
		highlight = yes

        country_event = {
            id = POP_Display.001
        }
    }
    option = {
        name = exit
        highlight = yes
    }
}

country_event = {
    id = POP_Display.003
    title = POP_Display.006.t
    desc = POP_Display.006.d
	picture = CITY_DEVELOPMENT_eventPicture

    is_triggered_only = yes

    option = {
        name = POP_Display.006.1

        country_event = {
            id = POP_Display.0071
        }
    }
    option = {
        name = POP_Display.006.2

        country_event = {
            id = POP_Display.0081
        }
    }
    option = {
        name = save

        country_event = {
            id = POP_Display.004
        }
    }
    option = {
        name = back
		highlight = yes

        country_event = {
            id = POP_Display.001
        }
    }
    option = {
        name = exit
		highlight = yes
    }
}

country_event = { 
    id = POP_Display.004
    title = POP_Display.004.t
    desc = POP_Display.004.d
    picture = CITY_DEVELOPMENT_eventPicture

    is_triggered_only = yes

    option = {
        name = POP_Display.002.0

        trigger = {
            NOT = { has_country_flag = Census_S0Has }
        }

        hidden_effect = {
            Rep_5 = { slot = 0 }
        }

        country_event = {
            id = POP_Display.003
        }
    }
    option = {
        name = POP_Display.002.1

        trigger = {
            NOT = { has_country_flag = Census_S1Has }
        }

        hidden_effect = {
            Rep_5 = { slot = 1 }
        }

        country_event = {
            id = POP_Display.003
        }
    }
    option = {
        name = POP_Display.002.2

        trigger = {
            NOT = { has_country_flag = Census_S2Has }
        }

        hidden_effect = {
            Rep_5 = { slot = 2 }
        }

        country_event = {
            id = POP_Display.003
        }
    }
    option = {
        name = POP_Display.002.3

        trigger = {
            NOT = { has_country_flag = Census_S3Has }
        }

        hidden_effect = {
            Rep_5 = { slot = 3 }
        }

        country_event = {
            id = POP_Display.003
        }
    }
    option = {
        name = POP_Display.002.4

        trigger = {
            NOT = { has_country_flag = Census_S4Has }
        }

        hidden_effect = {
            Rep_5 = { slot = 4 }
        }

        country_event = {
            id = POP_Display.003
        }
    }
    
    option = {
        name = back
		highlight = yes

        country_event = {
            id = POP_Display.003
        }
    }
    option = {
        name = exit
        highlight = yes
    }
}

country_event = { 
    id = POP_Display.005
    title = POP_Display.005.t
    desc = POP_Display.005.d
    picture = CITY_DEVELOPMENT_eventPicture

    is_triggered_only = yes

    option = {
        name = POP_Display.002.0

        trigger = {
            has_country_flag = Census_S0Has
        }

        hidden_effect = {
            clr_country_flag = Census_S0Has
        }

        country_event = {
            id = POP_Display.001
        }
    }
    option = {
        name = POP_Display.002.1

        trigger = {
            has_country_flag = Census_S1Has
        }

        hidden_effect = {
            clr_country_flag = Census_S1Has
        }

        country_event = {
            id = POP_Display.001
        }
    }
    option = {
        name = POP_Display.002.2

        trigger = {
            has_country_flag = Census_S2Has
        }

        hidden_effect = {
            clr_country_flag = Census_S2Has
        }

        country_event = {
            id = POP_Display.001
        }
    }
    option = {
        name = POP_Display.002.3

        trigger = {
            has_country_flag = Census_S3Has
        }

        hidden_effect = {
            clr_country_flag = Census_S3Has
        }

        country_event = {
            id = POP_Display.001
        }
    }
    option = {
        name = POP_Display.002.4

        trigger = {
            has_country_flag = Census_S4Has
        }

        hidden_effect = {
            clr_country_flag = Census_S4Has
        }

        country_event = {
            id = POP_Display.001
        }
    }
    
    option = {
        name = back
		highlight = yes

        country_event = {
            id = POP_Display.001
        }
    }
    option = {
        name = exit
        highlight = yes
    }
}

country_event = {
    id = POP_Display.0071
    title = POP_Display.0071.t
    desc = POP_Display.0071.d
	picture = CITY_DEVELOPMENT_eventPicture

    is_triggered_only = yes

    option = {
        name = POP_Display.0071.1

        country_event = {
            id = POP_Display.0072
        }
    }
    option = {
        name = POP_Display.0071.2

        country_event = {
            id = POP_Display.0075
        }
    }
    option = {
        name = back
		highlight = yes

        country_event = {
            id = POP_Display.003
        }
    }
}
country_event = {
    id = POP_Display.0072
    title = POP_Display.0072.t
    desc = POP_Display.0072.d
	picture = CITY_DEVELOPMENT_eventPicture

    is_triggered_only = yes

    option = {
        name = next
		highlight = yes

        country_event = {
            id = POP_Display.0073
        }
    }
    option = {
        name = back
		highlight = yes

        country_event = {
            id = POP_Display.0071
        }
    }
}
country_event = {
    id = POP_Display.0073
    title = POP_Display.0072.t
    desc = POP_Display.0073.d
	picture = CITY_DEVELOPMENT_eventPicture

    is_triggered_only = yes

    option = {
        name = next
		highlight = yes

        country_event = {
            id = POP_Display.0074
        }
    }
    option = {
        name = back
		highlight = yes

        country_event = {
            id = POP_Display.0071
        }
    }
}
country_event = {
    id = POP_Display.0074
    title = POP_Display.0072.t
    desc = POP_Display.0074.d
	picture = CITY_DEVELOPMENT_eventPicture

    is_triggered_only = yes

    option = {
        name = next
		highlight = yes

        country_event = {
            id = POP_Display.0072
        }
    }
    option = {
        name = back
		highlight = yes

        country_event = {
            id = POP_Display.0071
        }
    }
}
country_event = {
    id = POP_Display.0075
    title = POP_Display.0075.t
    desc = POP_Display.0075.d
	picture = CITY_DEVELOPMENT_eventPicture

    is_triggered_only = yes

    option = {
        name = next
		highlight = yes

        country_event = {
            id = POP_Display.0076
        }
    }
    option = {
        name = back
		highlight = yes

        country_event = {
            id = POP_Display.0071
        }
    }
}
country_event = {
    id = POP_Display.0076
    title = POP_Display.0075.t
    desc = POP_Display.0076.d
	picture = CITY_DEVELOPMENT_eventPicture

    is_triggered_only = yes

    option = {
        name = next
		highlight = yes

        country_event = {
            id = POP_Display.0077        
        }
    }
    option = {
        name = back
		highlight = yes

        country_event = {
            id = POP_Display.0071
        }
    }
}
country_event = {
    id = POP_Display.0077
    title = POP_Display.0075.t
    desc = POP_Display.0077.d
	picture = CITY_DEVELOPMENT_eventPicture

    is_triggered_only = yes

    option = {
        name = next
		highlight = yes

        country_event = {
            id = POP_Display.0075
        }
    }
    option = {
        name = back
		highlight = yes

        country_event = {
            id = POP_Display.0071
        }
    }
}

country_event = {
    id = POP_Display.0081
    title = POP_Display.0081.t
    desc = POP_Display.0081.d
	picture = CITY_DEVELOPMENT_eventPicture

    is_triggered_only = yes

    option = {
        name = next
		highlight = yes

        country_event = {
            id = POP_Display.0082
        }
    }
    option = {
        name = back
		highlight = yes

        country_event = {
            id = POP_Display.003
        }
    }
}
country_event = {
    id = POP_Display.0082
    title = POP_Display.0081.t
    desc = POP_Display.0082.d
	picture = CITY_DEVELOPMENT_eventPicture

    is_triggered_only = yes

    option = {
        name = next
		highlight = yes

        country_event = {
            id = POP_Display.0083
        }
    }
    option = {
        name = back
		highlight = yes

        country_event = {
            id = POP_Display.003
        }
    }
}
country_event = {
    id = POP_Display.0083
    title = POP_Display.0081.t
    desc = POP_Display.0083.d
	picture = CITY_DEVELOPMENT_eventPicture

    is_triggered_only = yes

    option = {
        name = next
		highlight = yes

        country_event = {
            id = POP_Display.0084
        }
    }
    option = {
        name = back
		highlight = yes

        country_event = {
            id = POP_Display.003
        }
    }
}
country_event = {
    id = POP_Display.0084
    title = POP_Display.0081.t
    desc = POP_Display.0084.d
    picture = CITY_DEVELOPMENT_eventPicture

    is_triggered_only = yes

    option = {
        name = next
        highlight = yes

        country_event = {
            id = POP_Display.0085
        }
    }
    option = {
        name = back
        highlight = yes

        country_event = {
            id = POP_Display.003
        }
    }
}
country_event = {
    id = POP_Display.0085
    title = POP_Display.0081.t
    desc = POP_Display.0085.d
	picture = CITY_DEVELOPMENT_eventPicture

    is_triggered_only = yes

    option = {
        name = next
		highlight = yes

        country_event = {
            id = POP_Display.0081
        }
    }
    option = {
        name = back
		highlight = yes

        country_event = {
            id = POP_Display.003
        }
    }
}

country_event = {
    id = POP_Display.999
    title = no_localisation
    desc = no_localisation
	picture = MEIOU_AND_TAXES_eventPicture

    is_triggered_only = yes

    hidden = yes
	
	immediate = {
		every_province = {
			limit = {
				NOT = {
					has_province_flag = SMM_SectorPart
				}
				
				isValidProv = yes
			}
			set_province_flag = SMM_SectorCent
			set_province_flag = SMM_SectorPart
			
			every_trade_node_member_province = {
				if = {	
					limit = {
						OR = {
							is_city = yes
							is_colony = yes
						}
						
						owned_by = PREV
						
						NOT = {
							province_id = PREV
						}
					}
					set_province_flag = SMM_SectorPart
					
					PREV = {
						change_key = { lhs = SMM_Sply which = PREV }
						change_key = { lhs = SMM_Dmnd which = PREV }
						change_key = { lhs = SMM_Subsist which = PREV }
						change_key = { lhs = SMM_Trade which = PREV }
						
						change_key = { lhs = SMM_Offer which = PREV }
						change_key = { lhs = SMM_Bid which = PREV }
						
						change_key = { lhs = SMM_Prc which = PREV }
						change_key = { lhs = SMM_Dev which = PREV }
					}
					
					set_key = { lhs = SMM_Sply value = 0 }
					set_key = { lhs = SMM_Dmnd value = 0 }
					set_key = { lhs = SMM_Subsist value = 0 }
					set_key = { lhs = SMM_Offer value = 0 }
					set_key = { lhs = SMM_Bid value = 0 }
					set_key = { lhs = SMM_Prc value = 0 }
					set_key = { lhs = SMM_Dev value = 0 }
				}
			}
			
			divide_key = { lhs = SMM_Prc which = SMM_Dev }
		}
		
		every_province = {
			limit = {
				NOT = {
					has_province_flag = SMM_SectorPart
				}
				
				isValidProv = yes
			}
			set_province_flag = SMM_SectorCent
			set_province_flag = SMM_SectorPart
			
			every_trade_node_member_province = {
				if = {	
					limit = {
						NOT = {
							has_province_flag = SMM_SectorPart
						}
						
						isValidProv = yes
						
						NOT = {
							province_id = PREV
						}
					}
					set_province_flag = SMM_SectorPart
					
					PREV = {
						change_key = { lhs = SMM_Sply which = PREV }
						change_key = { lhs = SMM_Dmnd which = PREV }
						change_key = { lhs = SMM_Subsist which = PREV }
						change_key = { lhs = SMM_Trade which = PREV }
						
						change_key = { lhs = SMM_Offer which = PREV }
						change_key = { lhs = SMM_Bid which = PREV }
						
						change_key = { lhs = SMM_Prc which = PREV }
						change_key = { lhs = SMM_Dev which = PREV }
					}
					
					set_key = { lhs = SMM_Sply value = 0 }
					set_key = { lhs = SMM_Dmnd value = 0 }
					set_key = { lhs = SMM_Subsist value = 0 }
					set_key = { lhs = SMM_Offer value = 0 }
					set_key = { lhs = SMM_Bid value = 0 }
					set_key = { lhs = SMM_Prc value = 0 }
					set_key = { lhs = SMM_Dev value = 0 }
				}
			}
			
			divide_key = { lhs = SMM_Prc which = SMM_Dev }
		}
		
		regiongroup = {
			region = {
				limit = {
					has_province_flag = SMM_SectorCent
					
					isValidProv = yes
				}
				save_event_target_as = Prov

				set_key = { lhs = Tmp_0 value = 0 }
				set_key = { lhs = Tmp_1 value = 0 }

				owner = {
					every_owned_province = {
						limit = {
							has_province_flag = SMM_SectorPart
							
							check_key = { lhs = TN_ProvSply51 value = 0.001 }

							same_trade_node_as = event_target:Prov
						}
						set_key = { lhs = Tmp_2 which = TN_ProvSply51 }

						event_target:Prov = {
							set_key = { lhs = Tmp_2 which = PREV }

							change_key = { lhs = Tmp_0 which = Tmp_2 }
						}

						export_to_key = { lhs = Tmp_2 value = local_autonomy }
						subtract_key = { lhs = Tmp_2 value = 100 }
						divide_key = { lhs = Tmp_2 value = -100 }
						multiply_key = { lhs = Tmp_2 which = Prov_BUPow }
						divide_key = { lhs = Tmp_2 value = 100 }
				
						multiply_key = { lhs = Tmp_2 which = TN_ProvSply51 }

						event_target:Prov = {
							set_key = { lhs = Tmp_2 which = PREV }

							change_key = { lhs = Tmp_1 which = Tmp_2 }
						}

						set_key = { lhs = Tmp_2 value = 0 }
					}
				}

				if = {
					limit = {
						check_key = { lhs = Tmp_0 value = 0.001 }
					}
					divide_key = { lhs = Tmp_1 which = Tmp_0 }
				}
				
				set_key = { lhs = SMM_Tariff value = 0.2 }

				if = {
					limit = {
						NOT = {
							check_key = { lhs = Tmp_1 which = SMM_Tariff }
						}
					}
					set_key = { lhs = Tmp_2 which = SMM_Tariff }
					subtract_key = { lhs = Tmp_2 which = Tmp_1 }
				}
				else = {
					set_key = { lhs = Tmp_2 value = 0 }
				}

				if = {
					limit = {
						owner = {
							Privilege_HasBGSmuggling = yes
						}
					}
					change_key = { lhs = Tmp_2 value = 0.1 }

					if = {
						limit = {
							check_key = { lhs = Tmp_2 value = 1 }
						}
						set_key = { lhs = Tmp_2 value = 1 }
					}
				}

				subtract_key = { lhs = Tmp_2 value = 1 }
				multiply_key = { lhs = Tmp_2 value = -1 }

				multiply_key = { lhs = SMM_Tariff which = Tmp_2 }

				# Tweak
				multiply_key = { lhs = SMM_Tariff value = 0.2 }
			}
		}
		
		every_province = {
			limit = {
				has_province_flag = SMM_SectorCent
			}
			set_key = { lhs = SMM_Score value = 1 }
		}
		
		every_country = {
			limit = {
				isValidCountry = yes
			}
			POP_GetMerchant = { return = SMM_Score }
			change_key = { lhs = SMM_Score value = 1 }
			if = {
				limit = {
					Rights_BGCom6HasGreater = yes
				}
				change_key = { lhs = SMM_Score value = 1 }
			}
			if = {
				limit = {
					has_reform = Pol_Mandate3
					#is_key_equal = { lhs = Pol_Mandate value = 2 }
				}
				change_key = { lhs = SMM_Score value = 2 }
			}
			if = {
				limit = {
					has_idea_group = free_trade_ideas
				}
				change_key = { lhs = SMM_Score value = 4 }
			}
			else_if = {
				limit = {
					has_idea_group = mercantilism_ideas
				}
				change_key = { lhs = SMM_Score value = 2 }
			}
			else_if = {
				limit = {
					has_idea_group = trade_ideas
				}
				change_key = { lhs = SMM_Score value = 1 }
			}

			capital_scope = {
				save_event_target_as = Prov
			}

			every_owned_province = {
				limit = {
					has_province_flag = SMM_SectorCent
				}
				set_key = { lhs = SMM_Score which = PREV }
				if = {
					limit = {
						same_trade_node_as = event_target:Prov
					}
					change_key = { lhs = SMM_Score value = 3 }
				}
				if = { 
					limit = {
						is_strongest_trade_power = PREV
					}
					change_key = { lhs = SMM_Score value = 5 }
				}
				
				
				save_event_target_as = ProvNew
				
				
				# If has no center of trade within a sector, set score to 0
				# That prevents the sector from trading with other sectors
				if = {
					limit = {
						owner = {
							NOT = {
								any_owned_province = {
									has_province_flag = SMM_SectorPart
									
									same_trade_node_as = event_target:ProvNew
									
									has_province_flag = TN_COT
								}
							}
						}
					}
					set_province_flag = TN_SectorCentNoTC
					
					set_key = { lhs = SMM_Score value = 0 }
				}
			}
		}
		
		every_province = {
			limit = {
				has_province_flag = SMM_SectorCent
			}
			subtract_key = { lhs = SMM_Bid which = SMM_Offer }
			
			if = {
				limit = {
					NOT = {
						check_key = { lhs = SMM_Bid value = 0 }
					}
				}
				set_key = { lhs = SMM_Bid value = 0 }
			}
			
			multiply_key = { lhs = SMM_Bid value = 0.5 }
			multiply_key = { lhs = SMM_Offer value = 0.5 }
			
			if = {
				limit = {
					check_key = { lhs = SMM_Subsist value = 0.001 }
					check_key = { lhs = SMM_Bid value = 0.001 }
				}
				if = {
					limit = {
						check_key = { lhs = SMM_Subsist which = SMM_Bid }
					}
					if = {
						limit = {
							has_global_flag = SMM_TradeIn
							
							owned_by = ROOT
						}
						change_key = { lhs = SMM_Val which = SMM_Bid }
					}
					
					set_key = { lhs = SMM_Bid value = 0 }
				}
				else = {
					if = {
						limit = {
							has_global_flag = SMM_TradeIn
							
							owned_by = ROOT
						}
						change_key = { lhs = SMM_Val which = SMM_Subsist }
					}
					
					subtract_key = { lhs = SMM_Bid which = SMM_Subsist }
				}
			}

			if = {
				limit = {
					check_key = { lhs = SMM_Sply value = 0.001 }
					check_key = { lhs = SMM_Bid value = 0.001 }
				}
				if = {
					limit = {
						check_key = { lhs = SMM_Sply which = SMM_Bid }
					}
					if = {
						limit = {
							has_global_flag = SMM_TradeIn
							
							owned_by = ROOT
						}
						change_key = { lhs = SMM_Val which = SMM_Bid }
					}
					
					set_key = { lhs = SMM_Bid value = 0 }
				}
				else = {
					if = {
						limit = {
							has_global_flag = SMM_TradeIn
							
							owned_by = ROOT
						}
						change_key = { lhs = SMM_Val which = SMM_Sply }
					}
					
					subtract_key = { lhs = SMM_Bid which = SMM_Sply }
				}
			}

			if = {
				limit = {
					check_key = { lhs = SMM_Dmnd value = 0.001 }
					check_key = { lhs = SMM_Offer value = 0.001 }
				}
				if = {
					limit = {
						check_key = { lhs = SMM_Dmnd which = SMM_Offer }
					}
					if = {
						limit = {
							has_global_flag = SMM_TradeOut
							
							owned_by = ROOT
						}
						change_key = { lhs = SMM_Val which = SMM_Offer }
					}
					
					set_key = { lhs = SMM_Offer value = 0 }
				}
				else = {
					if = {
						limit = {
							has_global_flag = SMM_TradeOut
							
							owned_by = ROOT
						}
						change_key = { lhs = SMM_Val which = SMM_Dmnd }
					}
					
					subtract_key = { lhs = SMM_Offer which = SMM_Dmnd }
				}
			}
		}
		
		AAA = {
			set_global_flag = SMM_Loop1
			
			tradenode_centers = {
				save_event_target_as = Prov

				if = {
					limit = {
						NOT = {
							has_province_flag = SMM_SectorCent
						}
					}
					set_key = { lhs = SMM_Score value = 0 }
				}

				every_trade_node_member_province = {
					if = {
						limit = {
							has_province_flag = SMM_SectorCent
							
							check_key = { lhs = SMM_Score which = event_target:Prov }
						}
						save_event_target_as = Prov
					}
				}
				# Flags the best sector of each node
				event_target:Prov = {
					set_province_flag = SMM_SectorCentNodeBest
				}
			}

			while = {
				limit = {
					has_global_flag = SMM_Loop1
				}
				set_key = { lhs = SMM_Score value = 0 }
				
				save_event_target_as = Prov
				
				every_province = {
					limit = {
						has_province_flag = SMM_SectorCentNodeBest
						check_key = { lhs = SMM_Score which = event_target:Prov }
					}
					save_event_target_as = Prov # This is the winner, highest sector score of the world
				}
				
				event_target:Prov = {
					if = {
						limit = {
							is_key_equal = { lhs = SMM_Score value = 0 }
						}
						clr_global_flag = SMM_Loop1
					}
					else = {
						TN_SetReach = yes
						
						tradenode_centers = {
							limit = {
								any_trade_node_member_province = {
									has_province_flag = TN_SectorCentReachWithin
								}
							}
							set_province_flag = TN_SectorCentReachContain
						}
						
						TN_DoTradeSetScoreImport = { price = SMM_Prc tariff = SMM_Tariff return = Tmp_0 }
						TN_DoTradeSetAmountImport = { bid = SMM_Bid offer = SMM_Offer return = Tmp_1 }
						
						if = {
							limit = {
								check_key = { lhs = Tmp_1 value = 0.001 }
							}
							TN_DoTradeDistrib = { score = Tmp_0 amount = Tmp_1 return = Tmp_2 }
							
							save_event_target_as = Prov
							
							tradenode_centers = {
								limit = {
									has_province_flag = TN_SectorCentReachContain
								}
								every_trade_node_member_province = {
									if = {
										limit = {
											has_province_flag = TN_SectorCentReachWithin
											
											check_key = { lhs = Tmp_2 value = 0.001 }
											
											NOT = {
												province_id = event_target:Prov
											}
										}
									}
								}
							}
							clr_province_flag = SMM_Pass2
							
							tradenode_centers = {
								limit = {
									has_province_flag = TN_SectorCentReachContain
								}
								
								every_trade_node_member_province = {
									if = {
										limit = {
											has_province_flag = TN_SectorCentReachBest
										}
										clr_province_flag = TN_SectorCentReachBest
									}
								}
							}
						}
						
						if = {
							limit = {
								check_key = { lhs = SMM_Offer value = 0.001 }
							}
							save_event_target_as = Prov
							
							set_key = { lhs = Tmp_0 which = SMM_Prc }
						}
						
						TN_DoTradeSetScoreExport = { price = SMM_Prc tariff = SMM_Tariff return = Tmp_0 }
						TN_DoTradeSetAmountExport = { bid = SMM_Bid offer = SMM_Offer return = Tmp_1 }
						
						if = {
							limit = {
								check_key = { lhs = Tmp_1 value = 0.001 }
							}
							TN_DoTradeDistrib = { score = Tmp_0 amount = Tmp_1 return = Tmp_2 }
							
							save_event_target_as = Prov
							
							tradenode_centers = {
								limit = {
									has_province_flag = TN_SectorCentReachContain
								}
								every_trade_node_member_province = {
									if = {
										limit = {
											has_province_flag = TN_SectorCentReachWithin
											
											
											NOT = {
												province_id = event_target:Prov
											}
										
											check_key = { lhs = Tmp_2 value = 0.001 }
											
											NOT = {
												province_id = event_target:Prov
											}
										}
										if = {
											limit = {
												owned_by = ROOT
												
												has_global_flag = SMM_TradeIn
											}
										}
									}
								}
							}
							clr_province_flag = SMM_Pass2
							
							tradenode_centers = {
								limit = {
									has_province_flag = TN_SectorCentReachContain
								}
								
								every_trade_node_member_province = {
									if = {
										limit = {
											has_province_flag = TN_SectorCentReachBest
										}
										clr_province_flag = TN_SectorCentReachBest
									}
								}
							}
						}
						
						tradenode_centers = {
							limit = {
								has_province_flag = TN_SectorCentReachContain
							}
							clr_province_flag = TN_SectorCentReachContain
							
							every_trade_node_member_province = {
								if = {
									limit = {
										has_province_flag = TN_SectorCentReachWithin
									}
									clr_province_flag = TN_SectorCentReachWithin
								}
							}
						}
						
						clr_province_flag = SMM_SectorCentNodeBest
                
						set_key = { lhs = SMM_Score value = 0 }
						
						save_event_target_as = Prov
						
						every_trade_node_member_province = {
							if = {
								limit = {
									has_province_flag = SMM_SectorCent
									
									check_key = { lhs = SMM_Score which = event_target:Prov }
								}
								save_event_target_as = Prov
							}
						}
						# This is to compare it to the previous winners in the loop -> it goes on top to be matched against the previous winners again.
						event_target:Prov = {
							set_province_flag = SMM_SectorCentNodeBest
						}
					}
				}
			}
			
			every_province = {
				limit = {
					has_province_flag = SMM_SectorCent
				}
				divide_key = { lhs = SMM_Val which = SMM_Trade }
				
				every_trade_node_member_province = {
					if = {
						limit = {
							has_province_flag = SMM_SectorPart
							
							check_key = { lhs = TN_ProvSply51 value = 0.001 }
							
							OR = {
								AND = {
									PREV = {
										is_city = no
										is_colony = no
									}
									
									is_city = no
									is_colony = no
								}
								
								AND = {
									PREV = {
										OR = {
											is_city = yes
											is_colony = yes
										}
									}
									
									OR = {
										is_city = yes
										is_colony = yes
									}
									
									owned_by = PREV
								}
							}
						}
						set_key = { lhs = SMM_Val which = PREV }
					}
				}
			}
			
			every_province = {
				limit = {
					check_key = { lhs = SMM_Val value = 0.001 }
					check_key = { lhs = TN_ProvSply51 value = 0.001 }
				}
				multiply_key = { lhs = SMM_Val which = TN_ProvSply51 }
			}
			
			every_province = {
				limit = {
					isValidProv = yes
					has_province_flag = smm
				}
				set_var_from_key = { var=calcvar_L key=SMM_Val }
			}
			
			smm_scale_get_maxmin = { var=calcvar_L }
			
			every_province = {
				limit = {
					isValidProv = yes
					has_province_flag = smm
				}
				set_variable = { which = calcvar_L value = 0 }
			}
		}
		
		every_country = {
			limit = {
				isValidCountry = yes
			}
			set_key = { lhs = SMM_Score value = 0 }
		}
		
		every_province = {
			limit = {
				isValidProv = yes
			}
			clr_province_flag = TN_SectorCentNoTC
			clr_province_flag = SMM_SectorCentNodeBest
			clr_province_flag = SMM_SectorCent
			clr_province_flag = SMM_SectorPart
			
			set_key = { lhs = SMM_Score value = 0 }
			
			set_key = { lhs = SMM_Sply value = 0 }
			set_key = { lhs = SMM_Dmnd value = 0 }
			set_key = { lhs = SMM_Subsist value = 0 }
			set_key = { lhs = SMM_Trade value = 0 }
			set_key = { lhs = SMM_Offer value = 0 }
			set_key = { lhs = SMM_Bid value = 0 }
			set_key = { lhs = SMM_Prc value = 0 }
			set_key = { lhs = SMM_Dev value = 0 }
			set_key = { lhs = SMM_Val value = 0 }
			set_key = { lhs = SMM_Tariff value = 0 }
		}
		
		every_country = {
            limit = {
                isValidCountry = yes
            }
            capital_scope = {
				remove_trade_modifier = {
					who = owner
					key = trade_capital
				}
            }
        }
		
		101 = {
			every_country = {
				limit = {
					isValidCountry = yes
				}
				PREV = {
					remove_trade_modifier = {
						who = PREV
						key = trade_capital
					}
				}
			}
		}
		112 = {
			every_country = {
				limit = {
					isValidCountry = yes
				}
				PREV = {
					remove_trade_modifier = {
						who = PREV
						key = trade_capital
					}
				}
			}
		}
		
		1471 = {
			every_country = {
				limit = {
					isValidCountry = yes
				}
				PREV = {
					remove_trade_modifier = {
						who = PREV
						key = trade_capital
					}
				}
			}
		}
		3506 = {
			every_country = {
				limit = {
					isValidCountry = yes
				}
				PREV = {
					remove_trade_modifier = {
						who = PREV
						key = trade_capital
					}
				}
			}
		}
	}
	
	option = {
		name = no_localisation
	}
}