########################################
#              Japan Events            #
########################################
namespace = japan
### Introductions - Japan ###
country_event = {
	id = japan.1
	title = "japan.1.n"
	desc = "japan.1.d"
	picture = SIEGE_eventPicture
	
	is_triggered_only = yes
	hidden = yes
	
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					OR = {
						tag = AKG
						is_subject_of = AKG
					}
				}
				every_known_country = {
					limit = {
						OR = {
							is_subject_of = AKG
							tag = AKG
						}
					}
					add_opinion = {
						who = ROOT
						modifier = opinion_joined_our_court
					}
					reverse_add_opinion = {
						who = ROOT
						modifier = opinion_joined_our_court
					}
				}
				every_known_country = {
					limit = {
						OR = {
							is_subject_of = JAP
							tag = JAP
						}
					}
					add_opinion = {
						who = ROOT
						modifier = opinion_joined_enemy_court
					}
					reverse_add_opinion = {
						who = ROOT
						modifier = opinion_joined_enemy_court
					}
				}
			}
			if = {
				limit = {
					OR = {
						tag = JAP
						is_subject_of = JAP
					}
				}
				every_known_country = {
					limit = {
						OR = {
							is_subject_of = JAP
							tag = JAP
						}
					}
					add_opinion = {
						who = ROOT
						modifier = opinion_joined_our_court
					}
					reverse_add_opinion = {
						who = ROOT
						modifier = opinion_joined_our_court
					}
				}
				every_known_country = {
					limit = {
						OR = {
							is_subject_of = AKG
							tag = AKG
						}
					}
					add_opinion = {
						who = ROOT
						modifier = opinion_joined_enemy_court
					}
					reverse_add_opinion = {
						who = ROOT
						modifier = opinion_joined_enemy_court
					}
				}
			}
			AKG = { save_global_event_target_as = japanese_shogun }
		}
	}
	
	option = {
		name = "japan.a"
	}
}

#One of the lords changes sides
country_event = {
	id = japan.2
	title = "japan.2.t"
	picture = SHOGUNATE_eventPicture
	
	is_triggered_only = yes
	
	desc = {
		trigger = {
			OR = {
				has_country_flag = supporting_southern_court
				tag = JAP
			}
			FROM = { has_country_flag = supporting_northern_court }
		}
		desc = japan.2.da
	}
	
	desc = {
		trigger = {
			OR = {
				has_country_flag = supporting_northern_court
				tag = event_target:japanese_shogun
			}
			FROM = { has_country_flag = supporting_southern_court }
		}
		desc = japan.2.db
	}
	
	desc = {
		trigger = {
			OR = {
				has_country_flag = supporting_southern_court
				tag = JAP
			}
			FROM = { has_country_flag = supporting_southern_court }
		}
		desc = japan.2.dc
	}
	
	desc = {
		trigger = {
			OR = {
				has_country_flag = supporting_northern_court
				tag = event_target:japanese_shogun
			}
			FROM = { has_country_flag = supporting_northern_court }
		}
		desc = japan.2.dd
	}
	
	option = {
		name = "japan.2a"
		trigger = {
			OR = {
				has_country_flag = supporting_southern_court
				tag = JAP
			}
			FROM = { has_country_flag = supporting_northern_court }
		}
	}
	option = {
		name = "japan.2b"
		trigger = {
			OR = {
				has_country_flag = supporting_northern_court
				tag = event_target:japanese_shogun
			}
			FROM = { has_country_flag = supporting_southern_court }
		}
	}
	option = {
		name = "japan.2c"
		trigger = {
			OR = {
				has_country_flag = supporting_southern_court
				tag = JAP
			}
			FROM = { has_country_flag = supporting_southern_court }
		}
	}
	option = {
		name = "japan.2d"
		trigger = {
			OR = {
				has_country_flag = supporting_northern_court
				tag = event_target:japanese_shogun
			}
			FROM = { has_country_flag = supporting_northern_court }
		}
	}
	option = {
		name = "japan.2e"
		trigger = {
			NOT = { has_country_flag = supporting_northern_court }
			NOT = { has_country_flag = supporting_southern_court }
			NOT = { tag = event_target:japanese_shogun }
			NOT = { tag = JAP }
		}
	}
}

### The Shogunate is victorious

country_event = { #
	id = japan.3
	title = "japan.3.t"
	
	desc = {
		trigger = {
			has_country_flag = meitoku_treaty
		}
		desc = japan.3.da
	}
	desc = {
		trigger = {
			NOT = { has_country_flag = meitoku_treaty }
		}
		desc = japan.3.db
	}
	picture = SHOGUNATE_eventPicture
	
	major = yes
	is_triggered_only = yes
	
	trigger = {
		tag = event_target:japanese_shogun
		culture_group = japanese_g
		has_global_flag = nanbokucho
		FROM = { tag = JAP }
	}
	
	immediate = {
		if = {
			limit = {
				3973 = { controlled_by = JAP }
			}
			set_country_flag = meitoku_treaty
		}
		clear_global_event_target = imperial_capital
	}
	
	option = { #
		name = "japan.3a"
		add_prestige = 50
		add_legitimacy = 50
		Stab_Add2 = yes
		
		inherit = JAP
		every_known_country = {
			limit = {
				NOT = { tag = JAP }
				culture_group = japanese_g
				exists = yes
				NOT = { is_subject_of = ROOT }
				NOT = { overlord = { is_subject_of = ROOT } }
			}
			hidden_effect = { set_key = { lhs = Vassal_Type value = 10 } }
			ROOT = {
				create_subject = {
					who = PREV
					subject_type = daimyo_vassal
				}
			}
		}
		every_known_country = {
			limit = {
				OR = {
					has_country_flag = supporting_northern_court
					has_country_flag = supporting_southern_court
				}
			}
			if = {
				limit = {
					has_country_flag = supporting_southern_court
					OR = {
						has_country_flag = kyushu_tandai
						has_country_flag = chugoku_tandai
						has_country_flag = shikoku_tandai
						has_country_flag = uo_tandai
					}
				}
				clr_country_flag = kyushu_tandai
				clr_country_flag = chugoku_tandai
				clr_country_flag = shikoku_tandai
				clr_country_flag = uo_tandai
				change_title_2 = yes
			}
			clr_country_flag = supporting_northern_court
			clr_country_flag = supporting_southern_court
		}
		2283 = {
			add_permanent_province_modifier = {
				name = emperors_palace
				duration = -1
			}
			save_global_event_target_as = imperial_capital
		}
		clr_global_flag = nanbokucho
	}
}

### The Emperor is victorious

country_event = { #
	id = japan.4
	title = "japan.4.t"
	desc = "japan.4.d"
	picture = SHOGUNATE_eventPicture
	
	major = yes
	is_triggered_only = yes
	
	trigger = {
		tag = JAP
		has_global_flag = nanbokucho
		FROM = { tag = event_target:japanese_shogun }
	}

	immediate = {
		random_province = {
			limit = {
				superregion = japan_superregion
				has_province_modifier = emperors_palace
			}
			remove_province_modifier = emperors_palace
			clear_global_event_target = imperial_capital
		}
	}
	
	option = {
		name = "japan.4a"
		add_prestige = 50
		add_legitimacy = 50
		Stab_Add2 = yes
		event_target:japanese_shogun = {
			if = {
				limit = {
					has_reform = shogunate
					#is_key_equal = { lhs = Pol_Privileges value = 4 }
				}
				add_government_reform = Pol_Privileges1
			}
		}
		inherit = event_target:japanese_shogun
		Effect_set_capital = { target=2283 }
		2283 = {
			add_permanent_province_modifier = {
				name = emperors_palace
				duration = -1
			}
			save_global_event_target_as = imperial_capital
		}
		every_known_country = {
			limit = {
				NOT = { tag = event_target:japanese_shogun }
				culture_group = japanese_g
				exists = yes
				NOT = { is_subject_of = ROOT }
				NOT = { overlord = { is_subject_of = ROOT } }
			}
			hidden_effect = { set_key = { lhs = Vassal_Type value = 10 } }
			ROOT = {
				create_subject = {
					who = PREV
					subject_type = daimyo_vassal
				}
			}
		}
		every_known_country = {
			limit = {
				OR = {
					has_country_flag = supporting_northern_court
					has_country_flag = supporting_southern_court
				}
			}
			if = {
				limit = {
					has_country_flag = supporting_southern_court
					NOT = { has_country_flag = kami }
				}
				#set_country_flag = kami
			}
			if = {
				limit = {
					has_country_flag = supporting_northern_court
					OR = {
						has_country_flag = kyushu_tandai
						has_country_flag = chugoku_tandai
						has_country_flag = shikoku_tandai
						has_country_flag = uo_tandai
					}
				}
				clr_country_flag = kyushu_tandai
				clr_country_flag = chugoku_tandai
				clr_country_flag = shikoku_tandai
				clr_country_flag = uo_tandai
				change_title_2 = yes
			}
			if = {
				limit = {
					has_country_flag = kyoto_kanrei
				}
				clr_country_flag = kyoto_kanrei
				change_title_2 = yes
			}
			if = {
				limit = {
					has_country_flag = kanrei_appointement
				}
				clr_country_flag = kanrei_appointement
				change_title_2 = yes
			}
			clr_country_flag = supporting_northern_court
			clr_country_flag = supporting_southern_court
		}
		random_province = {
			limit = {
				superregion = japan_superregion
				has_province_modifier = emperors_palace
			}
			remove_province_modifier = emperors_palace
			clear_global_event_target = imperial_capital
		}
		clr_global_flag = nanbokucho
	}
}

### New Shogunate is proclaimed

country_event = { # Event fired from decision claim_shogunate
	id = japan.5
	title = "japan.5.t"
	desc = "japan.5.d"
	picture = SHOGUNATE_eventPicture
	
	major = yes
	is_triggered_only = yes
	
	option = {
		name = "japan.4a"
		ROOT = { save_global_event_target_as = japanese_shogun }
		if = {
			limit = {
				NOT = { 
					has_reform = shogunate
					#is_key_equal = { lhs = Pol_Privileges value = 4 }
				}
			}
			add_government_reform = shogunate
		}
		if = {
			limit = {
				NOT = { has_saved_event_target = imperial_capital }
			}
			capital_scope = {
				save_global_event_target_as = imperial_capital
				add_permanent_province_modifier = {
					name = emperors_palace
					duration = -1
				}
			}
		}
		if = {
			limit = {
				2283 = { is_capital = no }
			}
			capital_scope = {
				if = {
					limit = {
						OR = {
							region = west_japan_region
							area = west_kansai_area
							NOT = { province_id = 2281 }
						}
					}
					rename_capital = "Saikyau"
				}
				else_if = {
					limit = {
						OR = {
							region = east_japan_region
							area = chubu_area
							province_id = 3958
						}
					}
					rename_capital = "Toukyau"
				}
				else_if = {
					limit = {
						OR = {
							province_id = 2280
							province_id = 3959
							province_id = 3973
							province_id = 2281
						}
					}
					rename_capital = "Nankyau"
				}
				else_if = {
					limit = {
						OR = {
							province_id = 2796
							area = hokuriku_area
						}
					}
					rename_capital = "Hokukyau"
				}
			}
		}
		every_known_country = {
			limit = {
				culture_group = japanese_g
				NOT = {
					primary_culture = ryukyuan
				}
			}
			country_event = { id = japan.6 days = 30 random = 15 }
		}
	}
}

country_event = { # Notification for all daimyo
	id = japan.6
	title = "japan.6.t"
	desc = "japan.6.d"
	picture = SHOGUNATE_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = "japan.6a" # Accept new Shogun
		hidden_effect = { set_key = { lhs = Vassal_Type value = 10 } }
		FROM = {
			create_subject = {
				who = ROOT
				subject_type = daimyo_vassal
			}
			add_opinion = {
				who = ROOT
				modifier = opinion_loyal_daimyo
			}
			hidden_effect = {
				country_event = { id = japan.7 days = 30 random = 15 }
			}
		}
	}
	option = {
		name = "japan.6b" # Denounce new Shogun
		#Custom tooltip about AE
		custom_tooltip = facing_shogunate.tt
		FROM = {
			add_opinion = {
				who = ROOT
				modifier = opinion_disloyal_daimyo
			}
			hidden_effect = {
				country_event = { id = japan.8 days = 30 random = 15 }
			}
		}
	}
}

country_event = { # Event after accepting new Shogun
	id = japan.7
	title = "japan.7.t"
	desc = "japan.7.d"
	picture = SHOGUNATE_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = "japan.7a"
		FROM = {
			add_opinion = {
				who = ROOT
				modifier = opinion_new_shogun
			}
		}
	}
}

country_event = { # Event after denouncing new Shogun
	id = japan.8
	title = "japan.8.t"
	desc = "japan.8.d"
	picture = SHOGUNATE_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = "japan.8a"
		#Opinion
		FROM = {
			add_opinion = {
				who = ROOT
				modifier = opinion_enemy_shogun
			}
		}
		every_known_country = {
			limit = {
				culture_group = japanese_g
				is_subject_of = ROOT
			}
			set_variable = { which = max_tries value = 4 }
			while = {
				limit = {
					NOT = {
						has_opinion_modifier = {
							who = FROM
							modifier = aggressive_expansion
							value = -50
						}
					}
					check_variable = { which = max_tries value = 1 }
				}
				add_opinion = {
					who = FROM
					modifier = aggressive_expansion
				}
				subtract_variable = { which = max_tries value = 1 }
			}
			set_variable = { which = max_tries value = 0 }
		}
	}
}

# Shogun takes the mantle of the Retired Emperor
country_event = { # Event fired from decision claim_imperial_throne
	id = japan.9
	title = "japan.9.t"
	desc = "japan.9.d"
	picture = SHOGUNATE_eventPicture
	
	major = yes
	is_triggered_only = yes
	
	option = {
		name = "japan.9a" #We have to stop this
		ai_chance = {
			factor = 50
			
			modifier = {
				factor = 0
				has_opinion = {
					who = FROM
					value = 175
				}
			}
		}
		add_opinion = {
			who = FROM
			modifier = opinion_displeased
		}
		FROM = { change_variable = { which = opposition_to_emperorship value = 1 } }
	}
	
	option = {
		name = "japan.9b" #Why not?
		ai_chance = {
			factor = 50
			
			modifier = {
				factor = 0
				NOT = {
					has_opinion = {
						who = FROM
						value = 100
					}
				}
			}
		}
		add_opinion = {
			who = FROM
			modifier = opinion_pleased
		}
		FROM = { change_variable = { which = agreement_to_emperorship value = 1 } }
	}
}

# Shogun officially becomes Daijo Tenno
country_event = { #
	id = japan.10
	title = "japan.10.t"
	desc = "japan.10.d"
	picture = SHOGUNATE_eventPicture
	
	major = yes
	trigger = {
		has_country_flag = tried_claiming_throne
		NOT = { has_country_flag = japan_lost_ambition }
	}
	
	mean_time_to_happen = {
		years = 2
	}
	
	immediate = {
		hidden_effect = {
			every_subject_country = {
				limit = {
					culture_group = japanese_g
					is_subject_of_type = daimyo_vassal
				}
				PREV = { change_variable = { which = "number_of_subjects" value = 1 } }
			}
			export_to_variable = {
				variable_name = number_of_subjects_t
				value = trigger_value:num_of_subjects
			}
			
			change_variable = {
				which = "number_of_subjects_t"
				which = "number_of_subjects"
			}
			
			divide_variable = { which = "number_of_subjects_t" value = 2 }
		
		}
	}
	
	option = {
		name = "japan.10a" #Give up
		trigger = {
			OR = {
				check_variable = {
					which = opposition_to_emperorship
					which = number_of_subjects_t
				}
				ai = no
			}
		}
		set_country_flag = japan_lost_ambition
		every_subject_country = {
			remove_opinion = {
				who = ROOT
				modifier = opinion_displeased
			}
			country_event = { id = japan.11 days = 30 random = 15 }
		}
	}
	
	option = {
		name = "japan.10b" #We will manage
		trigger = {
			OR = {
				check_variable = {
					which = agreement_to_emperorship
					which = number_of_subjects_t
				}
				ai = no
			}
		}
		custom_tooltip = shugo_will_rebel.tt
		every_subject_country = {
			limit = {
				has_opinion_modifier = {
					who = ROOT
					modifier = opinion_displeased
				}
			}
			country_event = { id = japan.12 days = 30 random = 15 }
		}
		set_country_flag = daijo_tenno
		clr_country_flag = tried_claiming_throne
	}
	after = {
		set_variable = { which = opposition_to_emperorship value = 0 }
		set_variable = { which = agreement_to_emperorship value = 0 }
		set_variable = { which = number_of_subjects value = 0 }
		set_variable = { which = number_of_subjects_t value = 0 }
	}
}

# Vassals notified of Shogun yielding
country_event = { #
	id = japan.11
	title = "japan.11.t"
	desc = "japan.11.d"
	picture = SHOGUNATE_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = "japan.11a" #Give up
	}
}

# Vassals notified of Shogun not giving up
country_event = { #
	id = japan.12
	title = "japan.12.t"
	desc = "japan.12.d"
	picture = SHOGUNATE_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = "japan.12a" #War!
		overlord = { free_vassal = PREV }
		set_country_flag = denounced_overlord
	}
}

# The son of the Retired Emperor becomes the Emperor
country_event = { #
	id = japan.13
	title = "japan.13.t"
	desc = "japan.13.d"
	picture = SHOGUNATE_eventPicture
	
	major = yes
	is_triggered_only = yes
	
	trigger = {
		singleplayer_trigger = yes # change_tag in events causes desynchs in MP games
		has_country_flag = daijo_tenno
		NOT = { exists = JAP }
	}
	
	option = {
		name = "japan.13a" #Give up
		change_title_6 = yes
		clr_country_flag = daijo_tenno
		add_legitimacy = 15
		add_prestige = 20
		hidden_effect = { free_vassal = JAP }
		JAP = {
			dependency_lost_color_effect = yes
		}
		log = "FE-JAP:[GetYear]:[Root.GetName]:formed [JAP.GetName]:japan.13"
		ChangeTagEffect = { scope=JAP }
		if = {
			limit = {
				any_owned_province = {
					has_province_modifier = emperors_palace
				}
			}
			event_target:imperial_capital = {
				remove_province_modifier = emperors_palace
			}
			clear_global_event_target = imperial_capital
		}
		every_subject_country = {
			country_event = { id = japan.14 days = 30 random = 15 }
		}
	}
}

# Vassals notified of new Emperor
country_event = { #
	id = japan.14
	title = "japan.14.t"
	desc = "japan.14.d"
	picture = SHOGUNATE_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = "japan.14a"
	}
}

# Shogun dies childless
country_event = { #on_new_monarch
	id = japan.15
	title = "japan.15.t"
	desc = "japan.15.d"
	picture = SHOGUNATE_eventPicture
	
	is_triggered_only = yes
	hidden = yes
	
	trigger = {
		NOT = { has_global_flag = nanbokucho }
		culture_group = japanese_g
		daimyo_trigger = yes
		NOT = { has_country_flag = centralised_japan }
		has_country_modifier = title_5
		any_subject_country = { has_country_flag = kyoto_kanrei }
		OR = {
			has_regency = yes
			has_consort_regency = yes
			is_female = yes
		}
	}
	
	option = {
		name = "japan.15a" #Kanrei is notified
		random_subject_country = {
			limit = {
				has_country_flag = kyoto_kanrei
			}
			country_event = { id = japan.16 days = 30 random = 15 }
		}
	}
}

# Kyoto Kanrei can choose to support the appointment or try to contest it with a pretender
country_event = { #
	id = japan.16
	title = "japan.16.t"
	desc = "japan.16.d"
	picture = SHOGUNATE_eventPicture
	
	major = yes
	is_triggered_only = yes #fired from on_new_monarch
	
	option = {
		name = "japan.16a" #Support the new Shogun
		ai_chance = {
			factor = 50
			
			modifier = {
				factor = 2
				num_of_cities = 4
			}
			modifier = {
				factor = 2
				num_of_cities = 6
			}
			modifier = {
				factor = 2
				num_of_cities = 10
			}
		}
		FROM = {
			if = {
				limit = {
					OR = {
						has_regency = yes
						has_consort_regency = yes
					}
				}
				add_heir_claim = 100
				Stab_Add1 = yes
			}
			else = {
				add_legitimacy = 100
				Stab_Add1 = yes
			}
		}
	}
	option = {
		name = "japan.16b" #Put up your own puppet on the throne
		ai_chance = {
			factor = 50
			
			modifier = {
				factor = 2
				num_of_cities = 1
			}
			modifier = {
				factor = 2
				num_of_cities = 2
			}
			modifier = {
				factor = 2
				num_of_cities = 3
			}
		}
		FROM = {
			if = {
				limit = {
					OR = {
						has_regency = yes
						has_consort_regency = yes
					}
				}
				exile_heir_as = deposed_shogun
			}
			else = {
				exile_ruler_as = { name = deposed_shogun }
			}
		}
		FROM = {
			free_vassal = ROOT 
			hidden_effect = { set_key = { lhs = Vassal_Type value = 10 } }	
		}
		dependency_lost_color_effect = yes
		create_subject = { subject_type = daimyo_vassal who = FROM }
		every_known_country = {
			limit = {
				culture_group = japanese_g
				is_subject_of_type = daimyo_vassal
				NOT = { tag = FROM }
				exists = yes
			}
			#hidden_effect = {
			#	ROOT = { create_subject = { subject_type = daimyo_vassal who = PREV } }
			#}
			country_event = { id = japan.17 days = 30 random = 15 }
		}
	}
}

# Notification for everyone. Some can put up support for the deposed Emperor.
country_event = { #
	id = japan.17
	title = "japan.17.t"
	desc = "japan.17.d"
	picture = SHOGUNATE_eventPicture
	
	is_triggered_only = yes #fired from on_new_monarch
	
	option = {
		name = "japan.17a" #Support the usurper
		ai_chance = {
			factor = 50
			
			modifier = {
				factor = 2
				has_opinion = { who = FROM value = 0 }
			}
			modifier = {
				factor = 5
				has_opinion = { who = FROM value = 50 }
			}
			modifier = {
				factor = 10
				has_opinion = { who = FROM value = 100 }
			}
		}
		if = {
			limit = {
				FROM = {
					is_vassal = yes
				}
			}
			free_vassal = FROM
		}
		FROM = {
			dependency_lost_color_effect = yes
			create_subject = { subject_type = daimyo_vassal who = ROOT } 
		}
	}
	option = {
		name = "japan.17b" #Support the rightful ruler
		ai_chance = {
			factor = 50
			
			modifier = {
				factor = 2
				NOT = { has_opinion = { who = FROM value = 0 } }
			}
			modifier = {
				factor = 5
				NOT = { has_opinion = { who = FROM value = -50 } }
			}
			modifier = {
				factor = 10
				NOT = { has_opinion = { who = FROM value = -100 } }
			}
		}
		overlord = { free_vassal = ROOT }
		dependency_lost_color_effect = yes
		set_global_flag = two_shoguns
		set_country_flag = denounced_overlord
	}
}

# If situation lasts too long, then Sengoku Jidai starts
country_event = { #
	id = japan.18
	title = "japan.18.t"
	desc = "japan.18.d"
	picture = SHOGUNATE_eventPicture
	
	hidden = yes
	
	mean_time_to_happen = { 
		months = 1
	}
	
	trigger = {
		culture_group = japanese_g
		has_country_modifier = title_5
		had_global_flag = { flag = two_shoguns days = 1825 }
	}
	
	option = {
		name = "japan.18a"
		if = {
			limit = {
				any_known_country = {
					culture_group = japanese_g
					NOT = { primary_culture = ryukyuan }
					is_subject = no
					NOT = { tag = ROOT }
				}
			}
			set_global_flag = sengoku_jidai
		}
	}
	after = {
		clr_global_flag = two_shoguns
	}
}

# If the supporter of the usurper is defeated, then the situation is aborted, but shogun remains a puppet.
country_event = {
	id = japan.19
	title = "japan.19.t"
	desc = "japan.19.d"
	picture = SHOGUNATE_eventPicture
	
	major = yes
	is_triggered_only = yes
	
	trigger = {
		culture_group = japanese_g
		has_global_flag = two_shoguns
		FROM = { has_country_flag = kyoto_kanrei }
	}
	
	option = {
		name = "japan.19a"
		event_target:japanese_shogun = {
			set_ruler = deposed_shogun
			if = {
				limit = {
					has_reform = shogunate
					#is_key_equal = { lhs = Pol_Privileges value = 4 }
				}
				add_government_reform = Pol_Privileges1
			}
		}
		hidden_effect = {
			event_target:japanese_shogun = { 
				set_key = { lhs = Vassal_Type value = 10 }	
			}
		}
		create_subject = { subject_type = daimyo_vassal who = event_target:japanese_shogun }
		clr_global_flag = two_shoguns
	}
}

# Inviting Emperor to [Root.Capital.GetName]
country_event = { # Event fired from decision invite_tenno
	id = japan.20
	title = "japan.20.t"
	desc = "japan.20.d"
	picture = SHOGUNATE_eventPicture
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					num_of_cities = 15
				}
				change_variable = { which = emperor_moves_capital value = 2 }
			}
			if = {
				limit = {
					capital_scope = {
						has_province_modifier = preeminent_continent_city
					}
				}
				change_variable = { which = emperor_moves_capital value = 3 }
			}
			else_if = {
				limit = {
					capital_scope = {
						has_province_modifier = preeminent_sub_continent_city
					}
				}
				change_variable = { which = emperor_moves_capital value = 2 }
			}
			else_if = {
				limit = {
					capital_scope = {
						has_province_modifier = preeminent_region_city
					}
				}
				change_variable = { which = emperor_moves_capital value = 1 }
			}
			else = {
				change_variable = { which = emperor_moves_capital value = -1 }
			}
			if = {
				limit = {
					capital_scope = {
						has_province_modifier = dominant_center_of_trade
					}
				}
				change_variable = { which = emperor_moves_capital value = 2 }
			}
			else_if = {
				limit = {
					capital_scope = {
						has_province_modifier = major_center_of_trade
					}
				}
				change_variable = { which = emperor_moves_capital value = 1 }
			}
			else = {
				change_variable = { which = emperor_moves_capital value = -1 }
			}
			if = {
				limit = {
					capital_scope = {
						has_province_modifier = important_center_of_art
					}
				}
				change_variable = { which = emperor_moves_capital value = 2 }
			}
			else_if = {
				limit = {
					capital_scope = {
						has_province_modifier = median_center_of_art
					}
				}
				change_variable = { which = emperor_moves_capital value = 1 }
			}
			else = {
				change_variable = { which = emperor_moves_capital value = -1 }
			}
			if = {
				limit = {
					capital_scope = {
						has_province_modifier = dominant_center_of_production
					}
				}
				change_variable = { which = emperor_moves_capital value = 2 }
			}
			else_if = {
				limit = {
					capital_scope = {
						has_province_modifier = major_center_of_production
					}
				}
				change_variable = { which = emperor_moves_capital value = 1 }
			}
			else = {
				change_variable = { which = emperor_moves_capital value = -1 }
			}
		}
	}
				
	
	option = {
		name = "japan.20a" #Emperor ponders
		hidden_effect = {
			country_event = { id = japan.21 days = 30 random = 10 }
		}
	}
}

# Emperor's response
country_event = { #
	id = japan.21
	title = "japan.21.t"
	desc = {
		trigger = {
			check_variable = { which = emperor_moves_capital value = 5 }
			capital_scope = {
				OR = {
					region = west_japan_region
					area = west_kansai_area
					NOT = { province_id = 2281 }
				}
			}
		}
		desc = japan.21.da
	}
	desc = {
		trigger = {
			check_variable = { which = emperor_moves_capital value = 5 }
			capital_scope = {
				OR = {
					region = east_japan_region
					area = chubu_area
					province_id = 3958
				}
			}
		}
		desc = japan.21.db
	}
	desc = {
		trigger = {
			check_variable = { which = emperor_moves_capital value = 5 }
			capital_scope = {
				OR = {
					province_id = 2280
					province_id = 3959
					province_id = 3973
					province_id = 2281
				}
			}
		}
		desc = japan.21.dc
	}
	desc = {
		trigger = {
			check_variable = { which = emperor_moves_capital value = 5 }
			capital_scope = {
				OR = {
					province_id = 2796
					area = hokuriku_area
				}
			}
		}
		desc = japan.21.dd
	}
	desc = {
		trigger = {
			NOT = { check_variable = { which = emperor_moves_capital value = 5 } }
		}
		desc = japan.21.de
	}
		
	picture = SHOGUNATE_eventPicture
	
	major = yes
	is_triggered_only = yes
				
	option = {
		name = "japan.21a" #Emperor agrees
		trigger = {
			check_variable = { which = emperor_moves_capital value = 5 }
		}
		add_legitimacy = 30
		add_prestige = 30
		random_province = {
			limit = {
				has_province_modifier = emperors_palace
			}
			remove_province_modifier = emperors_palace
		}
		clear_global_event_target = imperial_capital
		capital_scope = {
			add_permanent_province_modifier = {
				name = emperors_palace
				duration = -1
			}
			save_global_event_target_as = imperial_capital
			if = {
				limit = {
					owner = {
						NOT = { capital = 2283 }
					}
				}
				if = {
					limit = {
						OR = {
							region = west_japan_region
							area = west_kansai_area
							NOT = { province_id = 2281 }
						}
					}
					rename_capital = "Saikyau"
				}
				if = {
					limit = {
						OR = {
							region = east_japan_region
							area = chubu_area
							province_id = 3958
						}
					}
					rename_capital = "Toukyau"
				}
				if = {
					limit = {
						OR = {
							province_id = 2280
							province_id = 3959
							province_id = 3973
							province_id = 2281
						}
					}
					rename_capital = "Nankyau"
				}
				if = {
					limit = {
						OR = {
							province_id = 2796
							area = hokuriku_area
						}
					}
					rename_capital = "Hokukyau"
				}
			}
		}
			
	}
	
	option = {
		name = "japan.21b" #Emperor disagrees
		trigger = {
			NOT = { check_variable = { which = emperor_moves_capital value = 5 } }
		}
		clr_country_flag = inviting_emperor
	}
	
	after = {
		set_variable = { which = emperor_moves_capital value = 0 }
	}
}

# Adopting the local name
country_event = { # Event fired from on_monarch_death
	id = japan.24
	title = "japan.24.t"
	desc = "japan.24.d"
	picture = SHOGUNATE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		OR = {
			AND = {
				tag = AKG
				NOT = { dynasty = "Ashikaga" }
			}
			AND = {
				tag = AKM
				NOT = { dynasty = "Akamatsu" }
			}
			AND = {
				tag = AKW
				NOT = { dynasty = "Arakawa" }
			}
			AND = {
				tag = ANG
				NOT = { dynasty = "Amago" }
			}
			AND = {
				tag = ANO
				NOT = { dynasty = "Andô" }
			}
			AND = {
				tag = ASA
				NOT = { dynasty = "Asakura" }
			}
			AND = {
				tag = CHB
				NOT = { dynasty = "Chiba" }
			}
			AND = {
				tag = CSK
				NOT = { dynasty = "Chôsokabe" }
			}
			AND = {
				tag = DTE
				NOT = { dynasty = "Date" }
			}
			AND = {
				tag = HJO
				NOT = { dynasty = "Hôjô" }
			}
			AND = {
				tag = HKW
				NOT = { dynasty = "Hosokawa" }
			}
			AND = {
				tag = HKY
				NOT = { dynasty = "Hatakeyama" }
			}
			AND = {
				tag = HNM
				NOT = { dynasty = "Honma" }
			}
			AND = {
				tag = IGW
				NOT = { dynasty = "Imagawa" }
			}
			AND = {
				tag = INO
				NOT = { dynasty = "Inoue" }
			}
			AND = {
				tag = ISK
				NOT = { dynasty = "Isshiki" }
			}
			AND = {
				tag = KKC
				NOT = { dynasty = "Kikuchi" }
			}
			AND = {
				tag = KKZ
				NOT = { dynasty = "Kakizaki" }
			}
			AND = {
				tag = KOO
				NOT = { dynasty = "Kôno" }
			}
			AND = {
				tag = KTK
				NOT = { dynasty = "Kitabatake" }
			}
			AND = {
				tag = KTO
				NOT = { dynasty = "Kotô" }
			}
			AND = {
				tag = KWG
				NOT = { dynasty = "Kawagoe" }
			}
			AND = {
				tag = KYO
				NOT = { dynasty = "Kyôgoku" }
			}
			AND = {
				tag = MIY
				NOT = { dynasty = "Miyoshi" }
			}
			AND = {
				tag = MRI
				NOT = { dynasty = "Môri" }
			}
			AND = {
				tag = NIK
				NOT = { dynasty = "Nikki" }
			}
			AND = {
				tag = NNB
				NOT = { dynasty = "Nanbu" }
			}
			AND = {
				tag = ODA
				NOT = { dynasty = "Oda" }
			}
			AND = {
				tag = OGA
				NOT = { dynasty = "Ogasawara" }
			}
			AND = {
				tag = OTM
				NOT = { dynasty = "Ôtomo" }
			}
			AND = {
				tag = OUC
				NOT = { dynasty = "Ôuchi" }
			}
			AND = {
				tag = RZJ
				NOT = { dynasty = "Ryuzôji" }
			}
			AND = {
				tag = SBA
				NOT = { dynasty = "Shiba" }
			}
			AND = {
				tag = SKW
				NOT = { dynasty = "Shibukawa" }
			}
			AND = {
				tag = SHN
				NOT = { dynasty = "Shôni" }
			}
			AND = {
				tag = SMZ
				NOT = { dynasty = "Shimazu" }
			}
			AND = {
				tag = STK
				NOT = { dynasty = "Satake" }
			}
			AND = {
				tag = SOO
				NOT = { dynasty = "Sô" }
			}
			AND = {
				tag = STO
				NOT = { dynasty = "Saitô" }
			}
			AND = {
				tag = SUW
				NOT = { dynasty = "Suwa" }
			}
			AND = {
				tag = TKD
				NOT = { dynasty = "Takeda" }
			}
			AND = {
				tag = TGS
				NOT = { dynasty = "Togashi" }
			}
			AND = {
				tag = TGW
				NOT = { dynasty = "Tokugawa" }
			}
			AND = {
				tag = TKI
				NOT = { dynasty = "Toki" }
			}
			AND = {
				tag = UKI
				NOT = { dynasty = "Ukita" }
			}
			AND = {
				tag = USG
				NOT = { dynasty = "Uesugi" }
			}
			AND = {
				tag = UTN
				NOT = { dynasty = "Utsunomiya" }
			}
			AND = {
				tag = YSM
				NOT = { dynasty = "Yoshimi" }
			}
			AND = {
				tag = YMN
				NOT = { dynasty = "Yamana" }
			}
			AND = {
				tag = YUK
				NOT = { dynasty = "Yûki" }
			}
		}
	}
	option = {
		name = "japan.24a" #Accept this
		hidden_effect = {
			trigger_switch = {
				on_trigger = tag
				AKG = {
					set_dynasty = "Ashikaga"
				}
				AKM = {
					set_dynasty = "Akamatsu"
				}
				AKW = {
					set_dynasty = "Arakawa"
				}
				ANG = {
					set_dynasty = "Amago"
				}
				ANO = {
					set_dynasty = "Andô"
				}
				ASA = {
					set_dynasty = "Asakura"
				}
				CHB = {
					set_dynasty = "Chiba"
				}
				CSK = {
					set_dynasty = "Chôsokabe"
				}
				DTE = {
					set_dynasty = "Date"
				}
				HJO = {
					set_dynasty = "Hôjô"
				}
				HKW = {
					set_dynasty = "Hosokawa"
				}
				HKY = {
					set_dynasty = "Hatakeyama"
				}
				HNM = {
					set_dynasty = "Honma"
				}
				IGW = {
					set_dynasty = "Imagawa"
				}
				INO = {
					set_dynasty = "Inoue"
				}
				ISK = {
					set_dynasty = "Isshiki"
				}
				KKC = {
					set_dynasty = "Kikuchi"
				}
				KKZ = {
					set_dynasty = "Kakizaki"
				}
				KOO = {
					set_dynasty = "Kôno"
				}
				KTK = {
					set_dynasty = "Kitabatake"
				}
				KTO = {
					set_dynasty = "Kotô"
				}
				KWG = {
					set_dynasty = "Kawagoe"
				}
				KYO = {
					set_dynasty = "Kyôgoku"
				}
				MIY = {
					set_dynasty = "Miyoshi"
				}
				MRI = {
					set_dynasty = "Môri"
				}
				NIK = {
					set_dynasty = "Nikki"
				}
				NNB = {
					set_dynasty = "Nanbu"
				}
				ODA = {
					set_dynasty = "Oda"
				}
				OGA = {
					set_dynasty = "Ogasawara"
				}
				OTM = {
					set_dynasty = "Ôtomo"
				}
				OUC = {
					set_dynasty = "Ôuchi"
				}
				RZJ = {
					set_dynasty = "Ryuzôji"
				}
				SBA = {
					set_dynasty = "Shiba"
				}
				SKW = {
					set_dynasty = "Shibukawa"
				}
				SHN = {
					set_dynasty = "Shôni"
				}
				SMZ = {
					set_dynasty = "Shimazu"
				}
				STK = {
					set_dynasty = "Satake"
				}
				SOO = {
					set_dynasty = "Sô"
				}
				STO = {
					set_dynasty = "Saitô"
				}
				SUW = {
					set_dynasty = "Suwa"
				}
				TKD = {
					set_dynasty = "Takeda"
				}
				TGS = {
					set_dynasty = "Togashi"
				}
				TGW = {
					set_dynasty = "Tokugawa"
				}
				TKI = {
					set_dynasty = "Toki"
				}
				UKI = {
					set_dynasty = "Ukita"
				}
				USG = {
					set_dynasty = "Uesugi"
				}
				UTN = {
					set_dynasty = "Utsunomiya"
				}
				YSM = {
					set_dynasty = "Yoshimi"
				}
				YMN = {
					set_dynasty = "Yamana"
				}
				YUK = {
					set_dynasty = "Yûki"
				}
			}
		}
	}
}

# Kyoto Kanrei position passes to other subject
country_event = { # Event fired from on_monarch_death
	id = japan.25
	title = "japan.25.t"
	desc = "japan.25.d"
	picture = SHOGUNATE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_global_flag = two_shoguns }
		has_country_flag = kyoto_kanrei
		any_known_country = {
			has_country_flag = kanrei_appointement
			NOT = { tag = ROOT }
		}
	}
	
	option = {
		name = "japan.30a" #Accept this
		clr_country_flag = kyoto_kanrei
		if = {
			limit = {
				NOT = { has_country_flag = kyushu_tandai }
				NOT = { has_country_flag = chugoku_tandai }
				NOT = { has_country_flag = shikoku_tandai }
				NOT = { has_country_flag = uo_tandai }
			}
			change_title_2 = yes
		}
		hidden_effect = {
			random_known_country = {
				limit = {
					has_country_flag = kanrei_appointement
				}
				country_event = { id = japan.26 days = 30 random = 10 }
			}
		}
	}
}

# Being granted Kanrei position
country_event = {
	id = japan.26
	title = "japan.26.t"
	desc = "japan.26.d"
	picture = SHOGUNATE_eventPicture
	
	major = yes
	is_triggered_only = yes
	
	option = {
		name = "japan.26a" #Accept this
		set_country_flag = kyoto_kanrei
		if = {
			limit = {
				NOT = { has_country_modifier = title_3 }
			}
			change_title_3 = yes
		}
		add_legitimacy = 10
		hidden_effect = {
			overlord = {
				country_event = { id = japan.27 days = 30 random = 10 }
				every_subject_country = {
					country_event = { id = japan.27 days = 30 random = 10 }
				}
			}
		}
	}
}

# A new Kanrei appointed
country_event = {
	id = japan.27
	title = "japan.27.t"
	desc = {
		trigger = {
			overlord_of = FROM
		}
		desc = japan.27.da
	}
	desc = {
		trigger = {
			is_subject = yes
		}
		desc = japan.27.db
	}
	picture = SHOGUNATE_eventPicture
	

	is_triggered_only = yes
	
	option = {
		name = "japan.27a" #Accept this
		ai_chance = {
			factor = 50
			
			modifier = {
				factor = 0
				army_strength = { who = FROM value = 2 }
			}
		}
	}
	option = {
		name = "japan.27b" #Start a war
		trigger = {
			has_country_flag = kanrei_appointement
		}
		ai_chance = {
			factor = 50
			
			modifier = {
				factor = 0
				NOT = { army_strength = { who = FROM value = 2 } }
			}
		}
		add_casus_belli = {
			target = FROM
			months = 24
			type = cb_japanese_civil_war
		}
	}
}

# A new Kanrei appointed through war
country_event = {
	id = japan.28
	title = "japan.28.t"
	desc = "japan.28.d"
	picture = SHOGUNATE_eventPicture
	
	major = yes
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_country_flag = kyoto_kanrei
		}
		has_country_flag = kanrei_appointement
	}
	
	option = {
		name = "japan.28a" #Accept this
		set_country_flag = kyoto_kanrei
		if = {
			limit = {
				NOT = { has_country_modifier = title_3 }
			}
			change_title_3 = yes
		}
		FROM = {
			clr_country_flag = kyoto_kanrei
			clr_country_flag = kanrei_appointement
			if = {
				limit = {
					NOT = {
						has_country_flag = kyushu_tandai
						has_country_flag = chugoku_tandai
						has_country_flag = shikoku_tandai
						has_country_flag = uo_tandai
					}
				}
				change_title_2 = yes
			}
		}
		overlord = {
			country_event = { id = japan.29 days = 30 random = 10 }
			every_subject_country = {
				country_event = { id = japan.29 days = 30 random = 10 }
			}
		}
	}
}

# A new Kanrei appointed
country_event = {
	id = japan.29
	title = "japan.29.t"
	desc = {
		trigger = {
			overlord_of = FROM
		}
		desc = japan.29.da
	}
	desc = {
		trigger = {
			is_subject = yes
		}
		desc = japan.29.db
	}
	picture = SHOGUNATE_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = "japan.29a" #Accept this
		if = {
			limit = {
				is_subject = yes
			}
			add_liberty_desire = 100
		}
		set_global_flag = sengoku_jidai
	}
}

# Empire adopts Nationalism ideas
country_event = { # Event fired from decision form_japan
	id = japan.30
	title = "japan.30.t"
	desc = "japan.30.d"
	picture = SHOGUNATE_eventPicture
	
	major = yes
	is_triggered_only = yes
	
	option = {
		name = "japan.30a" #Accept this
		ai_chance = {
			factor = 50
			
			modifier = {
				factor = 0
				army_strength = { who = FROM value = 2 }
			}
		}
		FROM = {
			country_event = { id = japan.31 days = 30 random = 15 }
		}
	}
	
	option = {
		name = "japan.30a" #Never!
		ai_chance = {
			factor = 50
			
			modifier = {
				factor = 0
				NOT = { army_strength = { who = FROM value = 2 } }
			}
		}
		overlord = {
			country_event = { id = japan.32 days = 30 random = 15 }
			free_vassal = PREV
		}
	}
}

# Overlord receives notification about acceptance
country_event = { #
	id = japan.31
	title = "japan.31.t"
	desc = "japan.31.d"
	picture = SHOGUNATE_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = "japan.37a"
		inherit = FROM
	}
}
# Overlord receives notification about rebellion
country_event = { #
	id = japan.32
	title = "japan.32.t"
	desc = "japan.32.d"
	picture = SHOGUNATE_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = "japan.37a"
	}
}

# Overlord receives notification
country_event = { # Event fired from decision denounce_shogunate
	id = japan.35
	title = "japan.35.t"
	desc = "japan.35.d"
	picture = SHOGUNATE_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = "japan.35a" #Information on how systems work
		FROM = {
			every_owned_province = {
				add_claim = ROOT
			}
		}
	}
}

# Japan undergoes centralisation
country_event = { # Event fired from diplomatic action subject_subjugation
	id = japan.36
	title = "japan.36.t"
	desc = "japan.36.d"
	picture = SHOGUNATE_eventPicture
	
	major = yes
	is_triggered_only = yes
	
	#option = {
	#	name = "japan.30a" #Accept this
	#	ai_chance = {
	#		factor = 50
	#		
	#		modifier = {
	#			factor = 0
	#			army_strength = { who = FROM value = 2 }
	#		}
	#	}
	#	FROM = {
	#		create_subject = {
	#			who = ROOT
	#			subject_type = decentralized_vassal
	#		}
	#		country_event = { id = japan.37 days = 30 random = 15 }
	#	}
	#}
	
	option = {
		name = "japan.30a" #Never!
		ai_chance = {
			factor = 50
			
			modifier = {
				factor = 0
				NOT = { army_strength = { who = FROM value = 2 } }
			}
		}
		overlord = {
			free_vassal = ROOT
			country_event = { id = japan.38 days = 30 random = 15 }
		}
		dependency_lost_color_effect = yes
	}
}

# Overlord receives notification about acceptance
#country_event = { #
#	id = japan.37
#	title = "japan.37.t"
#	desc = "japan.37.d"
#	picture = SHOGUNATE_eventPicture
#	
#	is_triggered_only = yes
#	
#	option = {
#		name = "japan.37a"
#	}
#}
# Overlord receives notification about rebellion
country_event = { #
	id = japan.38
	title = "japan.38.t"
	desc = "japan.38.d"
	picture = SHOGUNATE_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = "japan.38a"
	}
}

## Resurgent Southern Court
# The Emperor dies, in a breach of the treaty an Emperor from the Northern Line is appointed
country_event = {
	id = japan.40
	title = "japan.40.t"
	desc = {
		trigger = {
			has_country_flag = meitoku_treaty
			NOT = { has_global_flag = nanbokucho }
			NOT = { has_global_flag = sengoku_jidai }
			NOT = { has_global_flag = two_shoguns }
		}
		desc = japan.40.da
	}
	desc = {
		trigger = {
			NOT = { has_country_flag = meitoku_treaty }
		}
		desc = japan.40.db
	}
		
	picture = SHOGUNATE_eventPicture

	trigger = {
		NOT = { exists = JAP }
		any_owned_province = {
			has_province_modifier = emperors_palace
		}
	}
	
	mean_time_to_happen = {
		years = 30
	}
	
	option = {
		name = "japan.40a" #Ok
		trigger = {
			NOT = { has_country_flag = meitoku_treaty }
		}
		every_known_country = {
			limit = {
				culture_group = japanese_g
				NOT = { tag = ROOT }
				ai = no
			}
			country_event = { id = japan.41 days = 30 random = 15 }
		}
	}
	option = {
		name = "japan.40b" #Break the treaty
		trigger = {
			has_country_flag = meitoku_treaty
			NOT = { has_global_flag = nanbokucho }
			NOT = { has_global_flag = sengoku_jidai }
			NOT = { has_global_flag = two_shoguns }
		}
		clr_country_flag = meitoku_treaty
		3973 = {
			cede_province = JAP
		}
		JAP = {
			define_ruler = {
				dynasty = "Yamato"
			}
			every_neighbor_country = {
				add_truce_with = PREV
			}
			if = {
				limit = {
					is_subject = yes
				}
				overlord = {
					free_vassal = ROOT
				}
			}
			dependency_lost_color_effect = yes
		}
		set_global_flag = nanbokucho
		every_known_country = {
			limit = {
				culture_group = japanese_g
				is_subject_of_type = daimyo_vassal
				NOT = { tag = ROOT }
				ai = no
			}
			country_event = { id = japan.42 days = 30 random = 15 }
		}
	}
	option = {
		name = "japan.40c" #Keep the treaty
		trigger = {
			has_country_flag = meitoku_treaty
			NOT = { has_global_flag = nanbokucho }
			NOT = { has_global_flag = sengoku_jidai }
			NOT = { has_global_flag = two_shoguns }
		}
		ai_chance = {
			factor = 0
		}
	}
}

# A new Emperor - notification for all
country_event = {
	id = japan.41
	title = "japan.41.t"
	desc = "japan.41.d"
	picture = SHOGUNATE_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = "japan.41a" #Ok
	}
}

# A new Emperor - notification for all
country_event = {
	id = japan.42
	title = "japan.42.t"
	desc = "japan.42.d"
	picture = SHOGUNATE_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = "japan.42a" #Ok
	}
	option = {
		name = "japan.42b" #Ok
	}
}

# Emperor limits the power of Shugo
country_event = {
	id = japan.43
	title = "japan.43.t"
	desc = "japan.43.d"
	picture = SHOGUNATE_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = "japan.43a" #Ok
		add_liberty_desire = 20
		add_opinion = {
			who = FROM
			modifier = opinion_limiting_power
		}
	}
}

# Shugo lose power in the province
province_event = {
	id = japan.44
	title = "japan.44.t"
	desc = "japan.44.d"
	picture = SHOGUNATE_eventPicture
	
	trigger = {
		owner = {
			culture_group = japanese_g
			#NOT = { has_country_flag = kami }
			OR = {
				is_subject_of_type = vassal
				is_subject_of_type = daimyo_vassal
				is_subject_of_type = decentralized_vassal
			}
			overlord = {
				has_country_flag = limiting_shugo_power
			}
		}
		NOT = { has_province_modifier = martial_law }
		local_autonomy = 60
	}
	
	mean_time_to_happen = {
		years = 100
		
		modifier = {
			factor = 0.562	# sqrt(sqrt(0.1))
			local_autonomy = 65
		}
		modifier = {
			factor = 0.562	# sqrt(sqrt(0.1))
			local_autonomy = 70
		}
		modifier = {
			factor = 0.562	# sqrt(sqrt(0.1))
			local_autonomy = 75
		}
		modifier = {
			factor = 0.562	# sqrt(sqrt(0.1))
			local_autonomy = 80
		}
		modifier = {
			factor = 0.562	# sqrt(sqrt(0.1))
			local_autonomy = 85
		}
		modifier = {
			factor = 0.562	# sqrt(sqrt(0.1))
			local_autonomy = 90
		}
		modifier = {
			factor = 0.562	# sqrt(sqrt(0.1))
			local_autonomy = 95
		}
		modifier = {
			factor = 0.562	# sqrt(sqrt(0.1))
			local_autonomy = 100
		}
	}
	
	option = {
		name = "japan.44a" #Contest it
		set_province_flag = imperial_edict_target
		add_core = JAP
		owner = {
			every_known_country = {
				limit = {
					OR = {
						tag = JAP
						#has_country_flag = kami
					}
				}
				add_casus_belli = {
					target = PREV
					months = 24
					type = cb_japanese_pacify
				}
			}
		}
		ai_chance = {
			factor = 25
		}
	}
	option = {
		name = "japan.44b" #Live with it
		remove_province_modifier = has_shugo_ce
		if = {
			limit = {
				OR = {
					japan_region_trigger = yes
					is_core = owner
				}
			}
			add_core = JAP
		}
		remove_core = owner
		cede_province = JAP
		ai_chance = {
			factor = 75
		}
	}
}

# Empire adopts Enlightnement ideas
#country_event = { # Event fired from estate action SEEK_VALIDATION_OF_CONQUEST
#	id = japan.50
#	title = "japan.50.t"
#	desc = "japan.50.d"
#	picture = SHOGUNATE_eventPicture
#	
#	is_triggered_only = yes
#	
#	immediate = {
#		random_neighbor_country = {
#			random_owned_province = {
#				limit = {
#					any_neighbor_province = {
#						is_owned_by = ROOT
#					}
#				}
#				set_province_flag = doom@ROOT
#			}
#		}
#	}
#	
#	option = {
#		name = "japan.50a" #Information on how systems work
#		overlord = {
#			country_event = { id = japan.51 }
#		}
#	}
#	
#	option = {
#		name = "japan.40b" #Leave menu
#	}
#}

# Overlord is asked
#country_event = {
#	id = japan.51
#	title = "japan.51.t"
#	desc = "japan.51.d"
#	picture = SHOGUNATE_eventPicture
#	
#	is_triggered_only = yes
#	
#	option = {
#		name = "japan.51b" #Yes
#		FROM = {
#			country_event = { id = japan.52 }
#		}
#	}
#	
#	option = {
#		name = "japan.51b" #No
#		FROM = {
#			country_event = { id = japan.53 }
#		}
#	}
#}

# Overlord is asked
#country_event = {
#	id = japan.51
#	title = "japan.51.t"
#	desc = "japan.51.d"
#	picture = SHOGUNATE_eventPicture
#	
#	is_triggered_only = yes
#	
#	option = {
#		name = "japan.51b" #Yes
#		random_province = {
#			limit = {
#				has_province_flag = doom@ROOT
#			}
#			clr_province_flag = doom@ROOT
#			add_claim = Root
#		}
#	}
#	
#	option = {
#		name = "japan.51b" #No
#		every_province = {
#			limit = {
#				has_province_flag = doom@ROOT
#			}
#			clr_province_flag = doom@ROOT
#		}
#	}
#}

# Kakizaki are pushed out into Hokkaido
country_event = {
	id = japan.60
	title = "japan.60.t"
	desc = "japan.60.d"
	picture = SHOGUNATE_eventPicture
	
	is_triggered_only = yes
	
	immediate = {
		2299 = {
			add_core = KKZ
			cede_province = KKZ
		}
		#KKZ = { set_dynasty = "Kakizaki" }
		if = {
			limit = { overlord = { has_country_flag = centralised_japan } }
			overlord = { create_subject = { subject_type = decentralized_vassal who = KKZ } }
			
			hidden_effect = {
				KKZ = { 
					set_key = { lhs = Vassal_Type value = 11 }	
				}
			}
		}
		else = {
			overlord = { create_subject = { subject_type = daimyo_vassal who = KKZ } }
			
			hidden_effect = {
				KKZ = { 
					set_key = { lhs = Vassal_Type value = 10 }	
				}
			}
		}
	}
	
	option = { #
		name = "japan.60a" #ok
	}
	option = { #
		name = "japan.60a" #Play as Kakizaki
		trigger = {
			ai = no
		}
		switch_tag = KKZ
	}
}

# Fallen clan settles in Hokkaido
country_event = {
	id = japan.61
	title = "japan.61.t"
	desc = "japan.61.d"
	picture = SHOGUNATE_eventPicture
	
	fire_only_once = yes
	
	trigger = {
		owns = 2297
		2299 = { is_empty = yes }
		exists = KKZ
	}
	
	mean_time_to_happen = {
		years = 5
	}
	
	immediate = {
		2299 = { save_event_target_as = daimyo_province }
		choose_daimyo_target = yes
	}
	
	option = { #
		name = "japan.60a" #ok
	}
}

# Selecting the target of subjugation - triggered by subjugate_other_islands - RASE - Japan
country_event = {
	id = japan.70
	title = "japan.70.t"
	desc = "japan.70.d"
	picture = SHOGUNATE_eventPicture
	
	is_triggered_only = yes
	
	option = { #Sachishima
		name = "japan.70a" #Yes
		trigger = {
			1012 = { is_empty = yes } #Sachishima
		}
		1012 = { save_global_event_target_as = ryukyu_target }
		custom_tooltip = ryukyu_selecting_target1.tt
		hidden_effect = {
			country_event = { id = japan.71 }
		}
	}
	
	option = { #Amami
		name = "japan.70b"
		trigger = {
			1014 = { is_empty = yes } #Amami
		}
		1014 = { save_global_event_target_as = ryukyu_target }
		custom_tooltip = ryukyu_selecting_target2.tt
		hidden_effect = {
			country_event = { id = japan.71 }
		}
	}
	option = { #Abort
		name = "japan.70c"
		clr_global_flag = subjugating_ryukyu
		add_adm_power = 200
		ai_chance = {
			factor = 0
		}
	}
}

# Subjugation - decide whether military or diplomatic action
country_event = {
	id = japan.71
	title = "japan.71.t"
	desc = "japan.71.d"
	
	picture = SHOGUNATE_eventPicture
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					1014 = { is_empty = yes } #Amami
				}
				1014 = { save_global_event_target_as = ryukyu_target }
			}
			else = {
				1012 = { save_global_event_target_as = ryukyu_target }
			}
			set_variable = { which = nobles_loyalty_removed_a 		value = 5 }
			set_variable = { which = burghers_loyalty_added_a 		value = 5 }
		}
	}
	
	option = {
		name = "japan.71a" #Military
		trigger = {
			mil_power = 200
		}
		custom_tooltip = ryukyu_military.tt
		add_yearly_manpower = -2.0
		add_mil_power = -200
		set_country_flag = ryukyu_military
		hidden_effect = {
			capital_scope = {
				# modifier handles random outcome, since randomization in events originating from decisions does not work
				add_province_triggered_modifier = ryukyu_island_subjugation
			}
		}
	}
	
	option = {
		name = "japan.71b" #Diplomatic
		trigger = {
			dip_power = 200
		}
		custom_tooltip = ryukyu_diplomatic.tt
		#reduce_estate_all_nobles_loyalty_effect = { id=a }
		#add_estate_burghers_loyalty_effect = { id=a }
		add_dip_power = -200
		set_country_flag = ryukyu_diplomatic
		hidden_effect = {
			capital_scope = {
				# modifier handles random outcome, since randomization in events originating from decisions does not work
				add_province_triggered_modifier = ryukyu_island_subjugation
			}
		}
	}
	option = { #Abort
		name = "japan.70c"
		clr_global_flag = subjugating_ryukyu
		clear_global_event_target = ryukyu_target
		add_adm_power = 200
		ai_chance = {
			factor = 0
		}
	}
}

# The Effect of Subjugation
country_event = {
	id = japan.72
	title = "japan.72.t"
	desc = {
		trigger = {
			has_country_flag = ryukyu_military
			has_country_flag = very_succesful_subjugation
		}
		desc = japan.72.da
	}
	desc = {
		trigger = {
			has_country_flag = ryukyu_military
			has_country_flag = succesful_subjugation
		}
		desc = japan.72.db
	}
	desc = {
		trigger = {
			has_country_flag = ryukyu_military
			has_country_flag = pyrrhic_subjugation
		}
		desc = japan.72.dc
	}
	desc = {
		trigger = {
			has_country_flag = ryukyu_military
			has_country_flag = failed_subjugation
		}
		desc = japan.72.dd
	}
	desc = {
		trigger = {
			has_country_flag = ryukyu_military
			has_country_flag = horribly_failed_subjugation
		}
		desc = japan.72.de
	}
	desc = {
		trigger = {
			has_country_flag = ryukyu_diplomatic
			has_country_flag = very_succesful_subjugation
		}
		desc = japan.72.df
	}
	desc = {
		trigger = {
			has_country_flag = ryukyu_diplomatic
			has_country_flag = succesful_subjugation
		}
		desc = japan.72.dg
	}
	desc = {
		trigger = {
			has_country_flag = ryukyu_diplomatic
			has_country_flag = failed_subjugation
		}
		desc = japan.72.dh
	}
	picture = SHOGUNATE_eventPicture
	
	is_triggered_only = yes
	
	option = { #Success
		name = "japan.72a" #Yes
		trigger = {
			OR = {
				has_country_flag = very_succesful_subjugation
				has_country_flag = succesful_subjugation
				has_country_flag = pyrrhic_subjugation
			}
		}
		if = {
			limit = {
				has_country_flag = ryukyu_military
			}
			if = {
				limit = {
					has_country_flag = pyrrhic_subjugation
				}
				add_yearly_manpower = 0.1
				#capital_scope = {
				#	add_unrest = 5
				#}
				add_war_exhaustion = 6
			}
			else_if = {
				limit = {
					has_country_flag = succesful_subjugation
				}
				add_yearly_manpower = 0.3
				#capital_scope = {
				#	add_unrest = 2
				#}
				add_war_exhaustion = 3
			}
			else = {
				add_yearly_manpower = 0.4
			}
		}
		else = {
			if = {
				limit = {
					has_country_flag = succesful_subjugation
				}
				add_prestige = 10
			}
			else = {
				add_prestige = 20
			}
		}
		event_target:ryukyu_target = {
			cede_province = FROM
			add_core = FROM
		}
		if = {
			limit = {
				has_country_flag = ryukyu_diplomatic
			}
			if = {
				limit = {
					has_country_flag = succesful_subjugation
				}
				event_target:ryukyu_target = {
					add_province_modifier = {
						name = autonomous_aji
						duration = 1825
					}
				}
			}
			else = {
				event_target:ryukyu_target = {
					add_province_modifier = {
						name = autonomous_aji
						duration = 3650
					}
				}
			}
		}
	}
	
	option = { #Failure
		name = "japan.72b"
		trigger = {
			OR = {
				has_country_flag = failed_subjugation
				has_country_flag = horribly_failed_subjugation
			}
		}
		if = {
			limit = {
				has_country_flag = ryukyu_military
			}
			if = {
				limit = {
					has_country_flag = horribly_failed_subjugation
				}
				add_yearly_manpower = 0.1
				#capital_scope = {
				#	add_unrest = 8
				#}
				add_war_exhaustion = 6
			}
			else = {
				add_yearly_manpower = 0.3
				#capital_scope = {
				#	add_unrest = 4
				#}
				add_war_exhaustion = 3
			}
		}
		else = {
			add_prestige = -10
		}
	}
	
	after = {
		clr_country_flag = ryukyu_diplomatic
		clr_country_flag = ryukyu_military
		clr_country_flag = very_succesful_subjugation
		clr_country_flag = succesful_subjugation
		clr_country_flag = pyrrhic_subjugation
		clr_country_flag = failed_subjugation
		clr_country_flag = horribly_failed_subjugation
		clr_global_flag = subjugating_ryukyu
		
		clear_global_event_target = ryukyu_target
	}
}
