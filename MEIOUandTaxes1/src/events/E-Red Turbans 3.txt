### Map dependent Red Turban events, moved to a file to allow better submod compatibility
# Submods can override this code to change the surrender
country_event = {
	id = red_turban.6
	title = "red_turban.6.t"
	picture = SIEGE_eventPicture
	
	desc = {
		trigger = {
			tag = YUA
			NOT = { is_year = 1400 }
		}
		desc = red_turban.6.da
	}
	desc = {
		trigger = {
			always = yes
		}
		desc = red_turban.6.db
	}	
	
	fire_only_once = yes
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				NOT = { exists = MXI }
			}
			MXI = { clr_country_flag = POP_Init }
		}
	}
	
	trigger = {
		OR = {
			culture_group = altaic
			culture_group = tungusic
		}
		OR = {
			has_country_flag = China_Claim
			has_country_flag = former_dynasty_china
		}
		any_owned_province = {
			superregion = eastern_steppe_superregion
			isValidProv = yes
		}
		OR = {
			NOT = { check_variable = { which = "Demesne_in_the_Mandate_of_Heaven" value = 50 } }
			capital_scope = { NOT = { controlled_by = ROOT } }
		}
		is_at_war = no
	}
	
	option = {
		name = "red_turban.3a"
		log = "FE-Red Turbans:[GetYear]:[Root.GetName]:Administration dissolved:red_turban.6"

		steppe_effect = yes
		change_religion = tengri_pagan
		force_converted = yes
		if = {
			limit = {
				culture_group = altaic
				capital_scope = {
					chinese_region_trigger = yes
				}
				owns = 3273
			}
			Effect_set_capital = { target=3273 }
		}
		else_if = {
			limit = {
				capital_scope = {
					chinese_region_trigger = yes
				}
			}
			random_owned_province = {
				limit = {
					NOT = { chinese_region_trigger = yes }
					has_owner_culture = yes
					isValidProv = yes
				}
				ROOT = { Effect_set_capital = { target=PREV } }
			}
		}
		yua_degeneration = yes
		
		every_subject_country = {
			limit = {
				is_subject_of_type = warlord
				isValidCountry = yes
			}
			grant_independence_effect = yes
			log = "FE-Red Turbans:[GetYear]:[Root.GetName]:granted independence to warlord [This.GetName]:red_turban.6"
		}
		if = {
			limit = {
				tag = YUA
				NOT = { is_year = 1400 }
				NOT = { exists = MXI }
				any_owned_province = {
					OR = {
						culture_group = jurchen_group
						culture_group = altaic
						culture_group = chinese_group
						province_id = 730
						province_id = 732
					}
					OR = {
						region = korea_region
						region = east_manchuria_region
						region = west_manchuria_region
					}
					OR = {
						NOT = { 
							area = xinhai_area 
							area = nen_area 
						}
						province_id = 3260
						province_id = 3259
					}
					NOT = { is_core = MXI }
					isValidProv = yes
				}
			}
			every_owned_province = {
				limit = {
					OR = {
						culture_group = jurchen_group
						culture_group = altaic
						culture_group = chinese_group
						province_id = 730
						province_id = 732
					}
					OR = {
						region = korea_region
						region = east_manchuria_region
						region = west_manchuria_region
					}
					OR = {
						NOT = { 
							area = xinhai_area 
							area = nen_area 
						}
						province_id = 3260
						province_id = 3259
					}
					NOT = { is_core = MXI }
					isValidProv = yes
				}
				add_core = MXI
			}
			hidden_effect = {
				every_owned_province = {
					limit = {
						isValidProv = yes
						is_core = MXI
					}
					cede_province = MXI
				}
			}
			create_subject = {
				who = MXI
				subject_type = warlord
			}
			log = "FE-Red Turbans:[GetYear]:[Root.GetName]:released Urianqad as warlord:red_turban.6"
			MXI = {
				hidden_effect = { steppe_effect = yes }
				define_ruler = {
					name = "Naghacu"
					dynasty = "Jalayirid"
					culture = uriankhai
					mil = 4
					adm = 2
					dip = 3
					age = 55
				}
				hidden_effect = {
					change_primary_culture = uriankhai
					if = {
						limit = {
							NOT = { has_country_flag = POP_Init }
						}
						country_event = { id = Init.1 }
					}
				}
				Effect_set_capital = { target=3259 }
				hidden_effect = {
					if = {
						limit = {
							exists = MJZ
							MJZ = { ai = yes }
						}
						add_truce_with = MJZ
					}
					if = {
						limit = {
							exists = MWK
							MWK = { ai = yes }
						}
						add_truce_with = MWK
					}
					if = {
						limit = {
							exists = MHR
							MHR = { ai = yes }
						}
						add_truce_with = MHR
					}
					if = {
						limit = {
							exists = MUD
							MUD = { ai = yes }
						}
						add_truce_with = MUD
					}
					if = {
						limit = {
							exists = MNA
							MNA = { ai = yes }
						}
						add_truce_with = MNA
					}
					if = {
						limit = {
							exists = MHX
							MHX = { ai = yes }
						}
						add_truce_with = MHX
					}
				}
			}
			if = {
				limit = {
					CSE = { is_subject_of = YUA }
				}
				CSE = { country_event = { id = red_turban.15 } }
			}
		}
	}
}

country_event = {
	id = red_turban.42
	title = "red_turban.7.t"
	desc = "red_turban.7.d"
	picture = SIEGE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		tag = YUA
		NOT = { num_of_cities = 50 }
		OR = {
			MXI = {
				exists = yes
				NOT = { is_subject_of = YUA }
			}
			NOT = { owns = 3273 } # Kharkhorum
			is_subject = yes
		}
		OR = {
			is_subject = no
			overlord = {
				NOT = { tag = CHG }
				NOT = { tag = MGH }
				NOT = { tag = WHI }
				NOT = { tag = BLU }
				NOT = { tag = GOL }
				NOT = { tag = CHU }
				NOT = { tag = TIM }
				NOT = { tag = GGK }
			}
		}
		NOT = { war_with = TIM }
		NOT = { war_with = GGK }
	}
	
	immediate = {
		hidden_effect = {
			set_global_flag = YUA_Cleanup
			every_province = {
				limit = {
					isValidProv = yes
					is_core = YUA
				}
				remove_core = YUA
			}
			every_province = {
				limit = {
					isValidProv = yes
					province_group = khalka_group
					culture = mongol
				}
				change_culture = khalka
				add_core = KHA
			}
			every_province = {
				limit = {
					isValidProv = yes
					province_group = tumed_group
					culture = mongol
				}
				change_culture = tumed
				add_core = TMD
			}
			3274 = {
				change_culture = tumed
			}
			every_province = {
				limit = {
					isValidProv = yes
					province_group = chakhar_group
					culture = mongol
				}
				change_culture = chahar
				add_core = CHH
			}
			every_province = {
				limit = {
					isValidProv = yes
					OR = {
						culture = buryat
						culture = khamnigan
					}
				}
				add_core = BRT
			}
			MYR = {
				every_owned_province = {
					limit = {
						isValidProv = yes
						culture = mongol
					}
					change_culture = daur
					add_core = MYR
				}
			}
			every_province = {
				limit = {
					isValidProv = yes
					culture = mongol
					OR = {
						area = xinhai_area 
						area = nen_area
						owned_by = MXI
					}
				}
				change_culture = uriankhai
				add_core = MXI
			}
			random_list = {
				34 = {
					715 = {
						add_core = KHA
						change_culture = khalka
					}
					3272 = {
						add_core = KHA
						change_culture = khalka
					}
				}
				33 = {
					715 = {
						add_core = OIR
						change_culture = oirats
					}
					3272 = {
						add_core = OIR
						change_culture = oirats
					}
				}
				33 = {
					715 = {
						add_core = TMD
						change_culture = tumed
					}
					3272 = {
						add_core = TMD
						change_culture = tumed
					}
				}
			}
			2743 = {
				add_core = HMI
			}
			2119 = {
				add_core = HMI
			}
			3213 = {
				add_core = HMI
			}
			every_owned_province = {
				limit = {
					isValidProv = yes
					culture_group = chinese_group
				}
				random_country = {
					limit = {
						isValidCountry = yes
						any_owned_province = {
							isValidProv = yes
							region = hebei_region
						}
						culture_group = chinese_group
					}
					PREV = { cede_province = PREV }
				}
			}
		}
	}
	
	option = {
		name = "red_turban.7a"
		log = "FE-Red Turbans:[GetYear]:[Root.GetName]:Empire dissolved, hide among the Khalkha:red_turban.7"
		release = TMD
		hidden_effect = { TMD = { steppe_effect = yes } }
		release = CHH
		hidden_effect = { CHH = { steppe_effect = yes } }
		if = {
			limit = {
				NOT = { exists = BRT }
			}
			release = BRT
			hidden_effect = {
				BRT = {
					steppe_effect = yes
					Reset_Religion_to_Capital = yes
					clr_country_flag = POP_Init
				}
			}
		}
		else = {
			every_owned_province = {
				limit = {
					isValidProv = yes
					is_core = BRT
				}
				cede_province = BRT
			}
		}
		if = {
			limit = {
				NOT = { exists = OIR }
			}
			release = OIR
			hidden_effect = {
				OIR = {
					steppe_effect = yes
					Reset_Religion_to_Capital = yes
					clr_country_flag = POP_Init
				}
			}
		}
		else = {
			every_owned_province = {
				limit = {
					isValidProv = yes
					is_core = OIR
				}
				cede_province = OIR
			}
		}
		if = {
			limit = {
				NOT = { exists = MXI }
			}
			release = MXI
			hidden_effect = { MXI = { steppe_effect = yes } }
			hidden_effect = {
				MXI = {
					if = {
						limit = {
							exists = MJZ
							MJZ = { ai = yes }
						}
						add_truce_with = MJZ
					}
					if = {
						limit = {
							exists = MWK
							MWK = { ai = yes }
						}
						add_truce_with = MWK
					}
					if = {
						limit = {
							exists = MHR
							MHR = { ai = yes }
						}
						add_truce_with = MHR
					}
					if = {
						limit = {
							exists = MUD
							MUD = { ai = yes }
						}
						add_truce_with = MUD
					}
					if = {
						limit = {
							exists = MNA
							MNA = { ai = yes }
						}
						add_truce_with = MNA
					}
					if = {
						limit = {
							exists = MHX
							MHX = { ai = yes }
						}
						add_truce_with = MHX
					}
					Reset_Religion_to_Capital = yes
					clr_country_flag = POP_Init
				}
			}
		}
		else = {
			every_owned_province = {
				limit = {
					isValidProv = yes
					is_core = MXI
				}
				cede_province = MXI
			}
		}
		if = {
			limit = {
				NOT = { exists = HMI }
			}
			release = HMI
			hidden_effect = {
				HMI = {
					steppe_effect = yes
					Reset_Religion_to_Capital = yes
					clr_country_flag = POP_Init
				}
			}
		}
		log = "FE-Red Turbans:[GetYear]:[Root.GetName]:changed into [KHA.GetName]:red_turban.7"
		ChangeTagEffect = { scope=KHA }
		change_primary_culture = khalka
		release_all_subjects = yes
		every_owned_province = {
			limit = {
				isValidProv = yes
				culture = mongol
			}
			change_culture = khalka
		}
		ai_chance = { 
			factor = 10
		}
	}
	option = {
		name = "red_turban.7b"
		log = "FE-Red Turbans:[GetYear]:[Root.GetName]:Empire dissolved, hide among the Chakhar:red_turban.7"
		release = TMD
		hidden_effect = { TMD = { steppe_effect = yes } }
		release = KHA
		hidden_effect = { KHA = { steppe_effect = yes } }
		if = {
			limit = {
				NOT = { exists = BRT }
			}
			release = BRT
			hidden_effect = {
				BRT = {
					steppe_effect = yes
					Reset_Religion_to_Capital = yes
					clr_country_flag = POP_Init
				}
			}
		}
		else = {
			every_owned_province = {
				limit = {
					isValidProv = yes
					is_core = BRT
				}
				cede_province = BRT
			}
		}
		if = {
			limit = {
				NOT = { exists = OIR }
			}
			release = OIR
			hidden_effect = {
				OIR = {
					steppe_effect = yes
					Reset_Religion_to_Capital = yes
					clr_country_flag = POP_Init
				}
			}
		}
		else = {
			every_owned_province = {
				limit = {
					isValidProv = yes
					is_core = OIR
				}
				cede_province = OIR
			}
		}
		if = {
			limit = {
				NOT = { exists = MXI }
			}
			release = MXI
			hidden_effect = { MXI = { steppe_effect = yes } }
			hidden_effect = {
				MXI = {
					if = {
						limit = {
							exists = MJZ
							MJZ = { ai = yes }
						}
						add_truce_with = MJZ
					}
					if = {
						limit = {
							exists = MWK
							MWK = { ai = yes }
						}
						add_truce_with = MWK
					}
					if = {
						limit = {
							exists = MHR
							MHR = { ai = yes }
						}
						add_truce_with = MHR
					}
					if = {
						limit = {
							exists = MUD
							MUD = { ai = yes }
						}
						add_truce_with = MUD
					}
					if = {
						limit = {
							exists = MNA
							MNA = { ai = yes }
						}
						add_truce_with = MNA
					}
					if = {
						limit = {
							exists = MHX
							MHX = { ai = yes }
						}
						add_truce_with = MHX
					}
					Reset_Religion_to_Capital = yes
					clr_country_flag = POP_Init
				}
			}
		}
		else = {
			every_owned_province = {
				limit = {
					isValidProv = yes
					is_core = MXI
				}
				cede_province = MXI
			}
		}
		if = {
			limit = {
				NOT = { exists = HMI }
			}
			release = HMI
			hidden_effect = {
				HMI = {
					steppe_effect = yes
					Reset_Religion_to_Capital = yes
					clr_country_flag = POP_Init
				}
			}
		}
		log = "FE-Red Turbans:[GetYear]:[Root.GetName]:changed into [CHH.GetName]:red_turban.7"
		ChangeTagEffect = { scope=CHH }
		change_primary_culture = chahar
		release_all_subjects = yes
		every_owned_province = {
			limit = {
				isValidProv = yes
				culture = mongol
			}
			change_culture = chahar
		}
		ai_chance = { 
			factor = 10
		}
	}
	option = {
		name = "red_turban.7c"
		log = "FE-Red Turbans:[GetYear]:[Root.GetName]:Empire dissolved, hide among the Tumed:red_turban.7"
		release = KHA
		hidden_effect = { KHA = { steppe_effect = yes } }
		release = CHH
		hidden_effect = { CHH = { steppe_effect = yes } }
		if = {
			limit = {
				NOT = { exists = BRT }
			}
			release = BRT
			hidden_effect = {
				BRT = {
					steppe_effect = yes
					Reset_Religion_to_Capital = yes
					clr_country_flag = POP_Init
				}
			}
		}
		else = {
			every_owned_province = {
				limit = {
					isValidProv = yes
					is_core = BRT
				}
				cede_province = BRT
			}
		}
		if = {
			limit = {
				NOT = { exists = OIR }
			}
			release = OIR
			hidden_effect = {
				OIR = {
					steppe_effect = yes
					Reset_Religion_to_Capital = yes
					clr_country_flag = POP_Init
				}
			}
		}
		else = {
			every_owned_province = {
				limit = {
					isValidProv = yes
					is_core = OIR
				}
				cede_province = OIR
			}
		}
		if = {
			limit = {
				NOT = { exists = MXI }
			}
			release = MXI
			hidden_effect = { MXI = { steppe_effect = yes } }
			hidden_effect = {
				MXI = {
					if = {
						limit = {
							exists = MJZ
							MJZ = { ai = yes }
						}
						add_truce_with = MJZ
					}
					if = {
						limit = {
							exists = MWK
							MWK = { ai = yes }
						}
						add_truce_with = MWK
					}
					if = {
						limit = {
							exists = MHR
							MHR = { ai = yes }
						}
						add_truce_with = MHR
					}
					if = {
						limit = {
							exists = MUD
							MUD = { ai = yes }
						}
						add_truce_with = MUD
					}
					if = {
						limit = {
							exists = MNA
							MNA = { ai = yes }
						}
						add_truce_with = MNA
					}
					if = {
						limit = {
							exists = MHX
							MHX = { ai = yes }
						}
						add_truce_with = MHX
					}
					Reset_Religion_to_Capital = yes
					clr_country_flag = POP_Init
				}
			}
		}
		else = {
			every_owned_province = {
				limit = {
					isValidProv = yes
					is_core = MXI
				}
				cede_province = MXI
			}
		}
		if = {
			limit = {
				NOT = { exists = HMI }
			}
			release = HMI
			hidden_effect = {
				HMI = {
					steppe_effect = yes
					Reset_Religion_to_Capital = yes
					clr_country_flag = POP_Init
				}
			}
		}
		log = "FE-Red Turbans:[GetYear]:[Root.GetName]:changed into [TMD.GetName]:red_turban.7"
		ChangeTagEffect = { scope=TMD }
		change_primary_culture = tumed
		release_all_subjects = yes
		every_owned_province = {
			limit = {
				isValidProv = yes
				culture = mongol
			}
			change_culture = tumed
		}
		ai_chance = { 
			factor = 10
		}
	}
	option = {
		name = "red_turban.7d"
		log = "FE-Red Turbans:[GetYear]:[Root.GetName]:Empire dissolved, hide among the Oirad:red_turban.7"
		trigger = {
			NOT = { exists = OIR }
		}
		release = KHA
		hidden_effect = { KHA = { steppe_effect = yes } }
		release = CHH
		hidden_effect = { CHH = { steppe_effect = yes } }
		release = TMD
		hidden_effect = { TMD = { steppe_effect = yes } }
		if = {
			limit = {
				NOT = { exists = BRT }
			}
			release = BRT
			hidden_effect = {
				BRT = {
					steppe_effect = yes
					Reset_Religion_to_Capital = yes
					clr_country_flag = POP_Init
				}
			}
		}
		else = {
			every_owned_province = {
				limit = {
					isValidProv = yes
					is_core = BRT
				}
				cede_province = BRT
			}
		}
		if = {
			limit = {
				NOT = { exists = MXI }
			}
			release = MXI
			hidden_effect = { MXI = { steppe_effect = yes } }
			hidden_effect = {
				MXI = {
					if = {
						limit = {
							exists = MJZ
							MJZ = { ai = yes }
						}
						add_truce_with = MJZ
					}
					if = {
						limit = {
							exists = MWK
							MWK = { ai = yes }
						}
						add_truce_with = MWK
					}
					if = {
						limit = {
							exists = MHR
							MHR = { ai = yes }
						}
						add_truce_with = MHR
					}
					if = {
						limit = {
							exists = MUD
							MUD = { ai = yes }
						}
						add_truce_with = MUD
					}
					if = {
						limit = {
							exists = MNA
							MNA = { ai = yes }
						}
						add_truce_with = MNA
					}
					if = {
						limit = {
							exists = MHX
							MHX = { ai = yes }
						}
						add_truce_with = MHX
					}
					Reset_Religion_to_Capital = yes
					clr_country_flag = POP_Init
				}
			}
		}
		else = {
			every_owned_province = {
				limit = {
					isValidProv = yes
					is_core = MXI
				}
				cede_province = MXI
			}
		}
		log = "FE-Red Turbans:[GetYear]:[Root.GetName]:changed into [OIR.GetName]:red_turban.7"
		ChangeTagEffect = { scope=OIR }
		change_primary_culture = oirats
		release_all_subjects = yes
		every_owned_province = {
			limit = {
				isValidProv = yes
				culture = mongol
			}
			change_culture = oirats
		}
		ai_chance = { 
			factor = 10
		}
	}
	option = {
		name = "red_turban.7e"
		log = "FE-Red Turbans:[GetYear]:[Root.GetName]:Empire dissolved, hide among the Buryaad:red_turban.7"
		trigger = {
			NOT = { exists = BRT }
		}
		release = KHA
		hidden_effect = { KHA = { steppe_effect = yes } }
		release = CHH
		hidden_effect = { CHH = { steppe_effect = yes } }
		release = TMD
		hidden_effect = { TMD = { steppe_effect = yes } }
		if = {
			limit = {
				NOT = { exists = OIR }
			}
			release = OIR
			hidden_effect = {
				OIR = {
					steppe_effect = yes
					Reset_Religion_to_Capital = yes
					clr_country_flag = POP_Init
				}
			}
		}
		else = {
			every_owned_province = {
				limit = {
					isValidProv = yes
					is_core = OIR
				}
				cede_province = OIR
			}
		}
		if = {
			limit = {
				NOT = { exists = MXI }
			}
			release = MXI
			hidden_effect = { MXI = { steppe_effect = yes } }
			hidden_effect = {
				MXI = {
					if = {
						limit = {
							exists = MJZ
							MJZ = { ai = yes }
						}
						add_truce_with = MJZ
					}
					if = {
						limit = {
							exists = MWK
							MWK = { ai = yes }
						}
						add_truce_with = MWK
					}
					if = {
						limit = {
							exists = MHR
							MHR = { ai = yes }
						}
						add_truce_with = MHR
					}
					if = {
						limit = {
							exists = MUD
							MUD = { ai = yes }
						}
						add_truce_with = MUD
					}
					if = {
						limit = {
							exists = MNA
							MNA = { ai = yes }
						}
						add_truce_with = MNA
					}
					if = {
						limit = {
							exists = MHX
							MHX = { ai = yes }
						}
						add_truce_with = MHX
					}
					Reset_Religion_to_Capital = yes
					clr_country_flag = POP_Init
				}
			}
		}
		else = {
			every_owned_province = {
				limit = {
					isValidProv = yes
					is_core = MXI
				}
				cede_province = MXI
			}
		}
		if = {
			limit = {
				NOT = { exists = HMI }
			}
			release = HMI
			hidden_effect = {
				HMI = {
					steppe_effect = yes
					Reset_Religion_to_Capital = yes
					clr_country_flag = POP_Init
				}
			}
		}
		log = "FE-Red Turbans:[GetYear]:[Root.GetName]:changed into [BRT.GetName]:red_turban.7"
		ChangeTagEffect = { scope=BRT }
		change_primary_culture = buryat
		release_all_subjects = yes
		ai_chance = { 
			factor = 10
		}
	}
	option = {
		name = "red_turban.7f"
		log = "FE-Red Turbans:[GetYear]:[Root.GetName]:Empire dissolved, hide among the Uriankhad:red_turban.7"
		trigger = {
			NOT = { exists = MXI }
		}
		release = KHA
		hidden_effect = { KHA = { steppe_effect = yes } }
		release = CHH
		hidden_effect = { CHH = { steppe_effect = yes } }
		release = TMD
		hidden_effect = { TMD = { steppe_effect = yes } }
		if = {
			limit = {
				NOT = { exists = OIR }
			}
			release = OIR
			hidden_effect = {
				OIR = {
					steppe_effect = yes
					Reset_Religion_to_Capital = yes
					clr_country_flag = POP_Init
				}
			}
		}
		else = {
			every_owned_province = {
				limit = {
					isValidProv = yes
					is_core = OIR
				}
				cede_province = OIR
			}
		}
		if = {
			limit = {
				NOT = { exists = BRT }
			}
			release = BRT
			hidden_effect = {
				BRT = {
					steppe_effect = yes
					Reset_Religion_to_Capital = yes
					clr_country_flag = POP_Init
				}
			}
		}
		else = {
			every_owned_province = {
				limit = {
					isValidProv = yes
					is_core = BRT
				}
				cede_province = BRT
			}
		}
		if = {
			limit = {
				NOT = { exists = HMI }
			}
			release = HMI
			hidden_effect = {
				HMI = {
					steppe_effect = yes
					Reset_Religion_to_Capital = yes
					clr_country_flag = POP_Init
				}
			}
		}
		log = "FE-Red Turbans:[GetYear]:[Root.GetName]:changed into [MXI.GetName]:red_turban.7"
		ChangeTagEffect = { scope=MXI }
		change_primary_culture = uriankhai
		release_all_subjects = yes
		ai_chance = { 
			factor = 10
		}
	}
	option = {
		name = "red_turban.7g"
		log = "FE-Red Turbans:[GetYear]:[Root.GetName]:Empire dissolved, hide in Kara Del:red_turban.7"
		trigger = {
			NOT = { exists = HMI }
		}
		release = KHA
		hidden_effect = { KHA = { steppe_effect = yes } }
		release = CHH
		hidden_effect = { CHH = { steppe_effect = yes } }
		release = TMD
		hidden_effect = { TMD = { steppe_effect = yes } }
		if = {
			limit = {
				NOT = { exists = OIR }
			}
			release = OIR
			hidden_effect = {
				OIR = {
					steppe_effect = yes
					Reset_Religion_to_Capital = yes
					clr_country_flag = POP_Init
				}
			}
		}
		else = {
			every_owned_province = {
				limit = {
					isValidProv = yes
					is_core = OIR
				}
				cede_province = OIR
			}
		}
		if = {
			limit = {
				NOT = { exists = BRT }
			}
			release = BRT
			hidden_effect = {
				BRT = {
					steppe_effect = yes
					Reset_Religion_to_Capital = yes
					clr_country_flag = POP_Init
				}
			}
		}
		else = {
			every_owned_province = {
				limit = {
					isValidProv = yes
					is_core = BRT
				}
				cede_province = BRT
			}
		}
		if = {
			limit = {
				NOT = { exists = MXI }
			}
			release = MXI
			hidden_effect = { MXI = { steppe_effect = yes } }
			hidden_effect = {
				MXI = {
					if = {
						limit = {
							exists = MJZ
							MJZ = { ai = yes }
						}
						add_truce_with = MJZ
					}
					if = {
						limit = {
							exists = MWK
							MWK = { ai = yes }
						}
						add_truce_with = MWK
					}
					if = {
						limit = {
							exists = MHR
							MHR = { ai = yes }
						}
						add_truce_with = MHR
					}
					if = {
						limit = {
							exists = MUD
							MUD = { ai = yes }
						}
						add_truce_with = MUD
					}
					if = {
						limit = {
							exists = MNA
							MNA = { ai = yes }
						}
						add_truce_with = MNA
					}
					if = {
						limit = {
							exists = MHX
							MHX = { ai = yes }
						}
						add_truce_with = MHX
					}
					Reset_Religion_to_Capital = yes
					clr_country_flag = POP_Init
				}
			}
		}
		else = {
			every_owned_province = {
				limit = {
					isValidProv = yes
					is_core = MXI
				}
				cede_province = MXI
			}
		}
		log = "FE-Red Turbans:[GetYear]:[Root.GetName]:changed into [HMI.GetName]:red_turban.7"
		ChangeTagEffect = { scope=HMI }
		change_primary_culture = chaghatai
		release_all_subjects = yes
		ai_chance = { 
			factor = 0
		}
	}
}
### Uriankhai surrender
country_event = {
	id = red_turban.16
	title = "red_turban.16.t"
	desc = "red_turban.16.d"
	picture = SIEGE_eventPicture
	
	fire_only_once = yes
	is_triggered_only = yes
	
	option = { #Make them our client state
		name = "red_turban.16a"
		hidden_effect = {
			white_peace = MXI
		}
		create_subject = {
			who = MXI
			subject_type = close_tributary_state
		}
		MXI = { country_event = { id = red_turban.17 } }
		every_country = {
			limit = {
				isValidCountry = yes
				war_with = MXI
			}
			white_peace = MXI
		}
		ai_chance = {
			factor = 10
		}
	}
	option = { #Continue fight
		name = "red_turban.16b"
		add_war_exhaustion = 5
		ai_chance = {
			factor = 0
		}
	}
	option = { #Create three guards and allow Jurchen settlement
		name = "red_turban.16c"
		hidden_effect = {
			white_peace = MXI
		}
		create_subject = {
			who = MXI
			subject_type = close_tributary_state
		}
		if = {
			limit = {
				OR = {
					liaoning_area = {
						owned_by = PREV
					}
					3241 = {
						owned_by = PREV
					}
					4031 = {
						owned_by = PREV
					}
					3258 = {
						owned_by = PREV
					}
					4038 = {
						owned_by = PREV
					}
					2248 = {
						owned_by = PREV
					}
					3240 = {
						owned_by = PREV
					}
					706 = {
						owned_by = PREV
					}
				}
			}
			liaoning_area = {
				hidden_effect = {
					if = {
						limit = {
							NOT = { is_core = ROOT }
						}
						add_core = ROOT
					}
					if = {
						limit = {
							culture = uriankhai
						}
						change_culture = jurcen
					}
				}
				if = {
					limit = {
						owned_by = MXI
					}
					cede_province = ROOT
				}
			}
		}
		else_if = {
			limit = {
				any_known_country = {
					OR = {
						liaoning_area = {
							owned_by = PREV
						}
						706 = {
							owned_by = PREV
						}
					}
				}
			}
			random_known_country = {
				limit = {
					OR = {
						liaoning_area = {
							owned_by = PREV
						}
						706 = {
							owned_by = PREV
						}
					}
				}
				liaoning_area = {
					hidden_effect = {
						if = {
							limit = {
								NOT = { is_core = PREV }
							}
							add_core = PREV
						}
						if = {
							limit = {
								culture = uriankhai
							}
							change_culture = jurcen
						}
					}
					if = {
						limit = {
							owned_by = MXI
						}
						cede_province = PREV
					}
				}
			}
		}
		else = {
			liaoning_area = {
				hidden_effect = {
					if = {
						limit = {
							NOT = { is_core = ROOT }
						}
						add_core = ROOT
					}
					if = {
						limit = {
							culture = uriankhai
						}
						change_culture = jurcen
					}
				}
				if = {
					limit = {
						owned_by = MXI
					}
					cede_province = ROOT
				}
			}
		}
		if = {
			limit = {
				OR = {
					MXI = {
						war_with = KOR
					}
					primary_culture = korean
				}
			}
			MXI = {
				every_owned_province = {
					limit = {
						isValidProv = yes
						region = korea_region
					}
					cede_province = ROOT
				}
			}
		}
		hidden_effect = {
			donggye_area = {
				limit = {
					culture = uriankhai
				}
				change_culture = jurcen
			}
			korea_region = {
				remove_core = MXI
			}
			every_province = {
				limit = {
					isValidProv = yes
					culture = mongol
					OR = {
						area = xinhai_area
						 area = nen_area
						owned_by = MXI
					}
				}
				change_culture = uriankhai
				add_core = MXI
			}
		}
		if = {
			limit = {
				NOT = {
					calc_true_if = {
						all_country = {
							exists = yes
							culture_group = jurchen_group
						}
						amount = 6
					}
				}
			}
			if = {
				limit = {
					NOT = { exists = MJZ }
				}
				hidden_effect = {
					east_manchuria_region = {
						remove_core = MJZ
					}
					west_manchuria_region = {
						remove_core = MJZ
					}
				}
				MXI = {
					jianzhou_group = {
						limit = {
							owned_by = PREV
						}
						remove_core = MXI
						add_core = MJZ
						cede_province = MJZ
					}
				}
				MJZ = {
					change_primary_culture = jurcen
				}
				create_subject = {
					subject_type = close_tributary_state
					subject = MJZ
				}
			}
			else_if = {
				limit = {
					NOT = { exists = MWK }
				}
				hidden_effect = {
					east_manchuria_region = {
						remove_core = MWK
					}
					west_manchuria_region = {
						remove_core = MWK
					}
				}
				MXI = {
					jianzhou_group = {
						limit = {
							owned_by = PREV
						}
						remove_core = MXI
						add_core = MWK
						cede_province = MWK
					}
				}
				MWK = {
					change_primary_culture = jurcen
				}
				create_subject = {
					subject_type = close_tributary_state
					subject = MWK
				}
			}
			else_if = {
				limit = {
					NOT = { exists = MHR }
				}
				hidden_effect = {
					east_manchuria_region = {
						remove_core = MHR
					}
					west_manchuria_region = {
						remove_core = MHR
					}
				}
				MXI = {
					jianzhou_group = {
						limit = {
							owned_by = PREV
						}
						remove_core = MXI
						add_core = MHR
						cede_province = MHR
					}
				}
				MHR = {
					change_primary_culture = jurcen
				}
				create_subject = {
					subject_type = close_tributary_state
					subject = MHR
				}
			}
			else_if = {
				limit = {
					NOT = { exists = MUD }
				}
				hidden_effect = {
					east_manchuria_region = {
						remove_core = MUD
					}
					west_manchuria_region = {
						remove_core = MUD
					}
				}
				MXI = {
					jianzhou_group = {
						limit = {
							owned_by = PREV
						}
						remove_core = MXI
						add_core = MUD
						cede_province = MUD
					}
				}
				MUD = {
					change_primary_culture = jurcen
				}
				create_subject = {
					subject_type = close_tributary_state
					subject = MUD
				}
			}
			else_if = {
				limit = {
					NOT = { exists = MNA }
				}
				hidden_effect = {
					east_manchuria_region = {
						remove_core = MNA
					}
					west_manchuria_region = {
						remove_core = MNA
					}
				}
				MXI = {
					jianzhou_group = {
						limit = {
							owned_by = PREV
						}
						remove_core = MXI
						add_core = MNA
						cede_province = MNA
					}
				}
				MNA = {
					change_primary_culture = jurcen
				}
				create_subject = {
					subject_type = close_tributary_state
					subject = MNA
				}
			}
			else_if = {
				limit = {
					NOT = { exists = MHX }
				}
				hidden_effect = {
					east_manchuria_region = {
						remove_core = MHX
					}
					west_manchuria_region = {
						remove_core = MHX
					}
				}
				MXI = {
					jianzhou_group = {
						limit = {
							owned_by = PREV
						}
						remove_core = MXI
						add_core = MHX
						cede_province = MHX
					}
				}
				MHX = {
					change_primary_culture = jurcen
				}
				create_subject = {
					subject_type = close_tributary_state
					subject = MHX
				}
			}
			if = {
				limit = {
					NOT = {
						calc_true_if = {
							all_country = {
								exists = yes
								culture_group = jurchen_group
							}
							amount = 6
						}
					}
				}
				if = {
					limit = {
						NOT = { exists = MJZ }
					}
					hidden_effect = {
						east_manchuria_region = {
							remove_core = MJZ
						}
						west_manchuria_region = {
							remove_core = MJZ
						}
					}
					MXI = {
						haixi_group = {
							limit = {
								owned_by = PREV
							}
							remove_core = MXI
							add_core = MJZ
							cede_province = MJZ
						}
					}
					MJZ = {
						change_primary_culture = hulun
					}
					create_subject = {
						subject_type = close_tributary_state
						subject = MJZ
					}
				}
				else_if = {
					limit = {
						NOT = { exists = MWK }
					}
					hidden_effect = {
						east_manchuria_region = {
							remove_core = MWK
						}
						west_manchuria_region = {
							remove_core = MWK
						}
					}
					MXI = {
						haixi_group = {
							limit = {
								owned_by = PREV
							}
							remove_core = MXI
							add_core = MWK
							cede_province = MWK
						}
					}
					MWK = {
						change_primary_culture = hulun
					}
					create_subject = {
						subject_type = close_tributary_state
						subject = MWK
					}
				}
				else_if = {
					limit = {
						NOT = { exists = MHR }
					}
					hidden_effect = {
						east_manchuria_region = {
							remove_core = MHR
						}
						west_manchuria_region = {
							remove_core = MHR
						}
					}
					MXI = {
						haixi_group = {
							limit = {
								owned_by = PREV
							}
							remove_core = MXI
							add_core = MHR
							cede_province = MHR
						}
					}
					MHR = {
						change_primary_culture = hulun
					}
					create_subject = {
						subject_type = close_tributary_state
						subject = MHR
					}
				}
				else_if = {
					limit = {
						NOT = { exists = MUD }
					}
					hidden_effect = {
						east_manchuria_region = {
							remove_core = MUD
						}
						west_manchuria_region = {
							remove_core = MUD
						}
					}
					MXI = {
						haixi_group = {
							limit = {
								owned_by = PREV
							}
							remove_core = MXI
							add_core = MUD
							cede_province = MUD
						}
					}
					MUD = {
						change_primary_culture = hulun
					}
					create_subject = {
						subject_type = close_tributary_state
						subject = MUD
					}
				}
				else_if = {
					limit = {
						NOT = { exists = MNA }
					}
					hidden_effect = {
						east_manchuria_region = {
							remove_core = MNA
						}
						west_manchuria_region = {
							remove_core = MNA
						}
					}
					MXI = {
						haixi_group = {
							limit = {
								owned_by = PREV
							}
							remove_core = MXI
							add_core = MNA
							cede_province = MNA
						}
					}
					MNA = {
						change_primary_culture = hulun
					}
					create_subject = {
						subject_type = close_tributary_state
						subject = MNA
					}
				}
				else_if = {
					limit = {
						NOT = { exists = MHX }
					}
					hidden_effect = {
						east_manchuria_region = {
							remove_core = MHX
						}
						west_manchuria_region = {
							remove_core = MHX
						}
					}
					MXI = {
						haixi_group = {
							limit = {
								owned_by = PREV
							}
							remove_core = MXI
							add_core = MHX
							cede_province = MHX
						}
					}
					MHX = {
						change_primary_culture = hulun
					}
					create_subject = {
						subject_type = close_tributary_state
						subject = MHX
					}
				}
			}
			else = {
				random_country = {
					limit = {
						isValidCountry = yes
						culture_group = jurchen_group
						NOT = { capital_scope = { province_group = jianzhou_group } }
					}
					country_event = { id = red_turban.18 }
				}
			}
		}
		else = {
			random_country = {
				limit = {
					isValidCountry = yes
					culture_group = jurchen_group
				}
				country_event = { id = red_turban.18 }
			}
		}
		every_known_country = {
			limit = {
				isValidCountry = yes
				accepted_culture = uriankhai
				NOT = {
					any_owned_province = {
						isValidProv = yes
						culture = uriankhai
					}
				}
			}
			remove_accepted_culture = uriankhai
			add_accepted_culture = jurcen
		}
		every_country = {
			limit = {
				isValidCountry = yes
				war_with = MXI
			}
			white_peace = MXI
		}
		ai_chance = {
			factor = 90
		}
	}
	after = {
	}
}

### Possibility of settlement
country_event = {
	id = red_turban.18
	title = "red_turban.18.t"
	desc = "red_turban.18.d"
	picture = SIEGE_eventPicture
	
	is_triggered_only = yes
	
	option = { #Jianzhou
		name = "red_turban.18a"
		trigger = {
			jianzhou_group = {
				owned_by = MXI
			}
		}
		MXI = {
			jianzhou_group = {
				limit = {
					owned_by = PREV
					isValidProv = yes
				}
				remove_core = MXI
				add_core = ROOT
				cede_province = ROOT
			}
		}
		change_primary_culture = jurcen
		hidden_effect = {
			east_manchuria_region = {
				limit = {
					NOT = { province_group = jianzhou_group }
				}
				remove_core = ROOT
			}
			west_manchuria_region = {
				limit = {
					NOT = { province_group = jianzhou_group }
				}
				remove_core = ROOT
			}
		}
		every_owned_province = {
			limit = {
				isValidProv = yes
				OR = {
					province_id = 3256 # Saghalien Ula
					culture = daur
				}
			}
			cede_province = MYR
			change_culture = daur
			add_core = MYR
		}
		random_owned_province = {
			limit = {
				isValidProv = yes
				NOT = { province_group = jianzhou_group }
				any_neighbor_province = {
					isValidProv = yes
					NOT = { owned_by = ROOT }
					owner = { culture_group = jurchen_group }
				}
			}
			random_neighbor_province = {
				limit = {
					isValidProv = yes
					NOT = { owned_by = ROOT }
					owner = { culture_group = jurchen_group NOT = { capital_scope = { province_group = haixi_group } } }
				}
				owner = { 
					every_province = {
						limit = {
							isValidProv = yes
							owned_by = ROOT
							NOT = { is_core = ROOT }
						}
						add_core = PREV
						cede_province = PREV
					}
				}
			}
		}
		hidden_effect = {
			if = {
				limit = {
					haixi_group = {
						owned_by = MXI
					}
				}
				random_country = {
					limit = {
						isValidCountry = yes
						NOT = { tag = ROOT }
						culture_group = jurchen_group
					}
					country_event = { id = red_turban.19 }
				}
			}
		}
		random_country = {
			limit = {
				exists = yes
				is_emperor_of_china = yes
			}
			ROOT = { 
				if = {
					limit = {
						is_subject = yes
					}
					grant_independence_effect = yes
				}
			}
			create_subject = {
				subject_type = close_tributary_state
				subject = ROOT
			}
		}
		ai_chance = {
			factor = 100
		}
	}
	option = { #Haixi
		name = "red_turban.18b"
		trigger = {
			haixi_group = {
				owned_by = MXI
			}
		}
		MXI = {
			haixi_group = {
				limit = {
					owned_by = PREV
					isValidProv = yes
				}
				remove_core = MXI
				add_core = ROOT
				cede_province = ROOT
			}
		}
		change_primary_culture = hulun
		hidden_effect = {
			east_manchuria_region = {
				limit = {
					NOT = { province_group = haixi_group }
				}
				remove_core = ROOT
			}
			west_manchuria_region = {
				limit = {
					NOT = { province_group = haixi_group }
				}
				remove_core = ROOT
			}
		}
		every_owned_province = {
			limit = {
				isValidProv = yes
				OR = {
					province_id = 3256 # Saghalien Ula
					culture = daur
				}
			}
			cede_province = MYR
			change_culture = daur
			add_core = MYR
		}
		random_owned_province = {
			limit = {
				isValidProv = yes
				NOT = { province_group = haixi_group }
				any_neighbor_province = {
					isValidProv = yes
					NOT = { owned_by = ROOT }
					owner = { culture_group = jurchen_group }
				}
			}
			random_neighbor_province = {
				limit = {
					isValidProv = yes
					NOT = { owned_by = ROOT }
					owner = { culture_group = jurchen_group NOT = { capital_scope = { province_group = jianzhou_group } } }
				}
				owner = { 
					every_province = {
						limit = {
							isValidProv = yes
							owned_by = ROOT
							NOT = { is_core = ROOT }
						}
						add_core= PREV
						cede_province = PREV
					}
				}
			}
		}
		hidden_effect = {
			if = {
				limit = {
					jianzhou_group = {
						owned_by = MXI
					}
				}
				random_country = {
					limit = {
						isValidCountry = yes
						NOT = { tag = ROOT }
						culture_group = jurchen_group
					}
					country_event = { id = red_turban.19 }
				}
			}
		}
		random_country = {
			limit = {
				exists = yes
				is_emperor_of_china = yes
			}
			ROOT = { 
				if = {
					limit = {
						is_subject = yes
					}
					grant_independence_effect = yes
				}
			}
			create_subject = {
				subject_type = close_tributary_state
				subject = ROOT
			}
		}
		ai_chance = {
			factor = 100
		}
	}
	option = { #No thanks
		name = "red_turban.18c"
		trigger = {
			NOT = { ai = yes }
		}
		hidden_effect = {
			random_country = {
				limit = {
					isValidCountry = yes
					NOT = { tag = ROOT }
					culture_group = jurchen_group
				}
				country_event = { id = red_turban.19 }
			}
		}
	}
}
### Copy of above
country_event = {
	id = red_turban.19
	title = "red_turban.18.t"
	desc = "red_turban.18.d"
	picture = SIEGE_eventPicture
	
	is_triggered_only = yes
	
	option = { #Jianzhou
		name = "red_turban.18a"
		trigger = {
			jianzhou_group = {
				owned_by = MXI
			}
		}
		MXI = {
			jianzhou_group = {
				limit = {
					owned_by = PREV
					isValidProv = yes
				}
				remove_core = MXI
				add_core = ROOT
				cede_province = ROOT
			}
		}
		change_primary_culture = jurcen
		hidden_effect = {
			east_manchuria_region = {
				limit = {
					NOT = { province_group = jianzhou_group }
				}
				remove_core = ROOT
			}
			west_manchuria_region = {
				limit = {
					NOT = { province_group = jianzhou_group }
				}
				remove_core = ROOT
			}
		}
		every_owned_province = {
			limit = {
				isValidProv = yes
				OR = {
					province_id = 3256 # Saghalien Ula
					culture = daur
				}
			}
			cede_province = MYR
			change_culture = daur
			add_core = MYR
		}
		random_owned_province = {
			limit = {
				isValidProv = yes
				NOT = { province_group = jianzhou_group }
				any_neighbor_province = {
					isValidProv = yes
					NOT = { owned_by = ROOT }
					owner = { culture_group = jurchen_group }
				}
			}
			random_neighbor_province = {
				limit = {
					isValidProv = yes
					NOT = { owned_by = ROOT }
					owner = { culture_group = jurchen_group NOT = { capital_scope = { province_group = haixi_group } } }
				}
				owner = { 
					every_province = {
						limit = {
							isValidProv = yes
							owned_by = ROOT
							NOT = { is_core = ROOT }
						}
						add_core= PREV
						cede_province = PREV
					}
				}
			}
		}
		hidden_effect = {
			if = {
				limit = {
					haixi_group = {
						owned_by = MXI
					}
				}
				random_country = {
					limit = {
						isValidCountry = yes
						NOT = { tag = ROOT }
						culture_group = jurchen_group
					}
					country_event = { id = red_turban.19 }
				}
			}
		}
		random_country = {
			limit = {
				exists = yes
				is_emperor_of_china = yes
			}
			ROOT = { 
				if = {
					limit = {
						is_subject = yes
					}
					grant_independence_effect = yes
				}
			}
			create_subject = {
				subject_type = close_tributary_state
				subject = ROOT
			}
		}
		ai_chance = {
			factor = 100
		}
	}
	option = { #Haixi
		name = "red_turban.18b"
		trigger = {
			haixi_group = {
				owned_by = MXI
			}
		}
		MXI = {
			haixi_group = {
				limit = {
					owned_by = PREV
					isValidProv = yes
				}
				remove_core = MXI
				add_core = ROOT
				cede_province = ROOT
			}
		}
		change_primary_culture = hulun
		hidden_effect = {
			east_manchuria_region = {
				limit = {
					NOT = { province_group = haixi_group }
				}
				remove_core = ROOT
			}
			west_manchuria_region = {
				limit = {
					NOT = { province_group = haixi_group }
				}
				remove_core = ROOT
			}
		}
		every_owned_province = {
			limit = {
				isValidProv = yes
				OR = {
					province_id = 3256 # Saghalien Ula
					culture = daur
				}
			}
			cede_province = MYR
			change_culture = daur
			add_core = MYR
		}
		random_owned_province = {
			limit = {
				isValidProv = yes
				NOT = { province_group = haixi_group }
				any_neighbor_province = {
					isValidProv = yes
					NOT = { owned_by = ROOT }
					owner = { culture_group = jurchen_group }
				}
			}
			random_neighbor_province = {
				limit = {
					isValidProv = yes
					NOT = { owned_by = ROOT }
					owner = { culture_group = jurchen_group NOT = { capital_scope = { province_group = jianzhou_group } } }
				}
				owner = { 
					every_province = {
						limit = {
							isValidProv = yes
							owned_by = ROOT
							NOT = { is_core = ROOT }
						}
						add_core = PREV
						cede_province = PREV
					}
				}
			}
		}
		hidden_effect = {
			if = {
				limit = {
					jianzhou_group = {
						owned_by = MXI
					}
				}
				random_country = {
					limit = {
						isValidCountry = yes
						NOT = { tag = ROOT }
						culture_group = jurchen_group
					}
					country_event = { id = red_turban.19 }
				}
			}
		}
		random_country = {
			limit = {
				exists = yes
				is_emperor_of_china = yes
			}
			ROOT = { 
				if = {
					limit = {
						is_subject = yes
					}
					grant_independence_effect = yes
				}
			}
			create_subject = {
				subject_type = close_tributary_state
				subject = ROOT
			}
		}
		ai_chance = {
			factor = 100
		}
	}
	option = { #No thanks
		name = "red_turban.18c"
		trigger = {
			NOT = { ai = yes }
		}
		hidden_effect = {
			random_country = {
				limit = {
					isValidCountry = yes
					NOT = { tag = ROOT }
					culture_group = jurchen_group
				}
				country_event = { id = red_turban.18 }
			}
		}
	}
}