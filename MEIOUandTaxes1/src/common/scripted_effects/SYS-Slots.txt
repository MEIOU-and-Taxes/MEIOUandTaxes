# By Shiro

SlotsSystem = {
    # Open slots loop - score best province for opening slot
    tradenode_centers = {
        if = {
            limit = {
                isValidProv = yes
                development = 5
                OR = {
                    has_province_flag = TN_COT_M
                    has_province_flag = TN_COT
                }
                #OR = {
                #    owner = { is_colonial_nation = yes }
                #    Legalism = 100
                #}
                owner = { ai = yes }
                OR = {
                   NOT = { has_province_flag = Prod_S0 }
                   NOT = { has_province_flag = Prod_S1 }
                   NOT = { has_province_flag = Prod_S2 }
                   NOT = { has_province_flag = Prod_S3 }
                   NOT = { has_province_flag = Prod_S4 }
                   NOT = { has_province_flag = Prod_S5 }
                   NOT = { has_province_flag = Prod_S6 }
                   NOT = { has_province_flag = Prod_S7 }
                   NOT = { has_province_flag = Prod_S8 }
                   NOT = { has_province_flag = Prod_S9 }
                   NOT = { has_province_flag = Prod_S10 }
                   NOT = { has_province_flag = Prod_S11 }
                   NOT = { has_province_flag = Prod_S12 }
                   NOT = { has_province_flag = Prod_S13 }
                   NOT = { has_province_flag = Prod_S14 }
                   NOT = { has_province_flag = Prod_S15 }
                }
            }
            set_province_flag = open_candidate
        }
        every_trade_node_member_province = {
            limit = {
                isValidProv = yes
                development = 5
                OR = {
                    has_province_flag = TN_COT_M
                    has_province_flag = TN_COT
                }
                #OR = {
                #    owner = { is_colonial_nation = yes }
                #    Legalism = 100
                #}
                owner = { ai = yes }
                OR = {
                   NOT = { has_province_flag = Prod_S0 }
                   NOT = { has_province_flag = Prod_S1 }
                   NOT = { has_province_flag = Prod_S2 }
                   NOT = { has_province_flag = Prod_S3 }
                   NOT = { has_province_flag = Prod_S4 }
                   NOT = { has_province_flag = Prod_S5 }
                   NOT = { has_province_flag = Prod_S6 }
                   NOT = { has_province_flag = Prod_S7 }
                   NOT = { has_province_flag = Prod_S8 }
                   NOT = { has_province_flag = Prod_S9 }
                   NOT = { has_province_flag = Prod_S10 }
                   NOT = { has_province_flag = Prod_S11 }
                   NOT = { has_province_flag = Prod_S12 }
                   NOT = { has_province_flag = Prod_S13 }
                   NOT = { has_province_flag = Prod_S14 }
                   NOT = { has_province_flag = Prod_S15 }
                }
            }
            set_province_flag = open_candidate 
        }
    }
    
    # Find highest valued prov per node and try to open a slot. 
    # If the target prov can't open or won't open it will fetch for another up until 6 times. 
    # If after 6 attempts it didn't find any then it will stop.
    tradenode_centers = {
        if = {
            limit = {
                has_province_flag = open_candidate
            }
            export_to_key = { lhs = Tmp_5 value = development }
            export_to_key = { lhs = Tmp_2 value = province_trade_power }
            trigger_switch = {
                on_trigger = has_province_flag
                
                TN_COT_M = { multiply_key = { lhs = Tmp_5 value = 3 } }
                TN_COT = { multiply_key = { lhs = Tmp_5 value = 1.5 } }
            }
            change_key = { lhs = Tmp_5 which = Tmp_2 }
            save_event_target_as = Plague
        }
        else = { set_key = { lhs = Tmp_5 value = 0 } }
        
        set_key = { lhs = Plague_Tmp0 value = 0 } 
        while = {
            limit = {
                NOT = { 
                    check_key = { lhs = Plague_Tmp0 value = 6 } # 6 attempts 
                    has_province_flag = opened_tradenode
                }
            }
            if = {
                limit = {
                    has_province_flag = open_candidate
                }
                save_event_target_as = Plague
            }
            change_key = { lhs = Plague_Tmp0 value = 1 } # 6 attempts
            set_key = { lhs = Tmp_0 value = 0 }            
            
            every_trade_node_member_province = {
                limit = {
                    has_province_flag = open_candidate
                }
                export_to_key = { lhs = Tmp_1 value = development }
                export_to_key = { lhs = Tmp_2 value = province_trade_power }
                trigger_switch = {
                    on_trigger = has_province_flag
                    
                    TN_COT_M = { multiply_key = { lhs = Tmp_1 value = 3 } }
                    TN_COT = { multiply_key = { lhs = Tmp_1 value = 1.5 } }
                }                
                change_key = { lhs = Tmp_1 which = Tmp_2 }
                
                PREV = {
                    set_key = { lhs = Tmp_1 which = PREV }
                    if = {
                        limit = {
                            check_key = { lhs = Tmp_1 which = Tmp_0 }
                            check_key = { lhs = Tmp_1 which = Tmp_5 }
                        }
                        PREV = { save_event_target_as = Plague }
                        set_key = { lhs = Tmp_0 which = Tmp_1 } # save score for next check
                    }
                        
                    #if = { # This is special check for trade node center province aka: PREV original value is higher or lower than the province it's checking against: every_trade_node_member_province
                    #    limit = { 
                    #        has_province_flag = open_candidate
                    #        check_key = { lhs = Tmp_5 value = 0.001 }
                    #        check_key = { lhs = Tmp_5 which = Tmp_1 }
                    #    }
                    #    
                    #    save_event_target_as = Plague
                    #}
                }
            }
            event_target:Plague = {
                if = {
                    limit = { 
                        has_province_flag = open_candidate
                    }
                    Calculate_Labor = yes 
                    SlotsOpeningMain = yes
                }
                clr_province_flag = open_candidate
            }
        }
        every_trade_node_member_province = {
            clr_province_flag = open_candidate
        }
        clr_province_flag = open_candidate
        clr_province_flag = opened_tradenode
    }
}
# Tmp_0 = Industry ID
SlotsOpeningMain = {
    set_key = { lhs = Public_Tmp7 which = Building_ExtractionMax }
    subtract_key = { lhs = Public_Tmp7 which = Building_Extraction }
    if = {
        limit = {
            check_key = { lhs = Public_Tmp7 value = 25 }
        }
        if = {
            limit = { # Gold
                Prod_Can_17 = yes
                Prod_NotHasProd = { Prod = 17 }
            }
            set_key = { lhs = Tmp_0 value = 17 }
            set_province_flag = wants_to_open_slot
            set_province_flag = open_gold
        }
        else_if = {
            limit = { # Silver
                Prod_Can_18 = yes
                Prod_NotHasProd = { Prod = 18 }
            }
           set_key = { lhs = Tmp_0 value = 18 }
           set_province_flag = wants_to_open_slot
           set_province_flag = open_silver
        }             
        else_if = {
            limit = { # Marble
                Prod_Can_41 = yes
                Prod_NotHasProd = { Prod = 41 }
            }
            set_key = { lhs = Tmp_0 value = 41 }
            set_province_flag = wants_to_open_slot
            set_province_flag = open_marble
        }
        if = {
            limit = {
                OR = {
                    has_province_flag = open_gold
                    has_province_flag = open_silver
                    has_province_flag = open_marble
                }
            }
            OpenProdEffect = yes
        }
    }
    if = {
        limit = {
            NOT = { has_province_flag = rec_new_slot }
        }
        
        OpenSlotsHelper = yes
    
        # Try to open a slot
    
        if = {
            limit = {
                has_province_flag = wants_to_open
            }
            set_key = { lhs = Public_Tmp8 value = 0 }
            clr_province_flag = wants_to_open
            while = {
                limit = {
                    
                    NOT = {
                        has_province_flag = rec_new_slot
                        check_key = { lhs = Public_Tmp8 value = 4 }
                    }
                    
                    OR = {
                        has_province_flag = wants_to_open_exotics
                        has_province_flag = wants_to_open_fibre
                        has_province_flag = wants_to_open_food
                        has_province_flag = wants_to_open_fuel
                        has_province_flag = wants_to_open_timber
                        has_province_flag = wants_to_open_knowledge
                        has_province_flag = wants_to_open_luxury
                        has_province_flag = wants_to_open_consumer
                        has_province_flag = wants_to_open_military
                        has_province_flag = wants_to_open_naval
                        has_province_flag = wants_to_open_industrial
                        has_province_flag = wants_to_open_raw
                        has_province_flag = wants_to_open_salt
                    }
                }
                change_key = { lhs = Public_Tmp8 value = 1 }
                
                    # Re calculate slots after 2nd loop. First time used OpenSlotsHelper = yes
                if = { 
                    limit = {
                        check_key = { lhs = Public_Tmp8 value = 1.1 }
                    }
                    OpenSlotsHelper2 = yes
                }
               
                if = { # Exotics
                    limit = {
                        has_province_flag = wants_to_open_exotics
                        check_key = { lhs = Tmp_5 which = Tmp_1 }
                        check_key = { lhs = Tmp_5 which = Tmp_2 }
                        check_key = { lhs = Tmp_5 which = Tmp_3 }
                        check_key = { lhs = Tmp_5 which = Tmp_4 }
                        check_key = { lhs = Tmp_5 which = Tmp_6 }
                        check_key = { lhs = Tmp_5 which = Tmp_7 }
                        check_key = { lhs = Tmp_5 which = Tmp_8 }
                        check_key = { lhs = Tmp_5 which = Tmp_9 }
                        check_key = { lhs = Tmp_5 which = Public_Tmp1 }
                        check_key = { lhs = Tmp_5 which = Public_Tmp2 }
                        check_key = { lhs = Tmp_5 which = Public_Tmp3 }
						check_key = { lhs = Tmp_5 which = Public_Tmp4 }
                    }
                    set_province_flag = open_exotics
                    clr_province_flag = wants_to_open_exotics
                }
                else_if = { # Knowledge
                    limit = {
                        has_province_flag = wants_to_open_knowledge
                        check_key = { lhs = Public_Tmp2 which = Tmp_1 }
                        check_key = { lhs = Public_Tmp2 which = Tmp_2 }
                        check_key = { lhs = Public_Tmp2 which = Tmp_3 }
                        check_key = { lhs = Public_Tmp2 which = Tmp_4 }
                        check_key = { lhs = Public_Tmp2 which = Tmp_6 }
                        check_key = { lhs = Public_Tmp2 which = Tmp_7 }
                        check_key = { lhs = Public_Tmp2 which = Tmp_8 }
                        check_key = { lhs = Public_Tmp2 which = Tmp_9 }
                        check_key = { lhs = Public_Tmp2 which = Public_Tmp1 }
                        check_key = { lhs = Public_Tmp2 which = Public_Tmp3 }
						check_key = { lhs = Public_Tmp2 which = Public_Tmp4 }
                    }
                    set_province_flag = open_knowledge
                    clr_province_flag = wants_to_open_knowledge
                }
                else_if = { # Luxury
                    limit = {
                        has_province_flag = wants_to_open_luxury
                        check_key = { lhs = Public_Tmp1 which = Tmp_1 }
                        check_key = { lhs = Public_Tmp1 which = Tmp_2 }
                        check_key = { lhs = Public_Tmp1 which = Tmp_3 }
                        check_key = { lhs = Public_Tmp1 which = Tmp_4 }
                        check_key = { lhs = Public_Tmp1 which = Tmp_6 }
                        check_key = { lhs = Public_Tmp1 which = Tmp_7 }
                        check_key = { lhs = Public_Tmp1 which = Tmp_8 }
                        check_key = { lhs = Public_Tmp1 which = Tmp_9 }
                        check_key = { lhs = Public_Tmp1 which = Public_Tmp3 }
						check_key = { lhs = Public_Tmp1 which = Public_Tmp4 }
                    }
                    set_province_flag = open_luxury
                    clr_province_flag = wants_to_open_luxury
                }
                else_if = { # Salt
                    limit = {
                        has_province_flag = wants_to_open_salt
                        check_key = { lhs = Tmp_2 which = Tmp_1 }
                        check_key = { lhs = Tmp_2 which = Tmp_3 }
                        check_key = { lhs = Tmp_2 which = Tmp_4 }
                        check_key = { lhs = Tmp_2 which = Tmp_6 }
                        check_key = { lhs = Tmp_2 which = Tmp_7 }
                        check_key = { lhs = Tmp_2 which = Tmp_8 }
                        check_key = { lhs = Tmp_2 which = Tmp_9 }
                        check_key = { lhs = Tmp_2 which = Public_Tmp3 }
						check_key = { lhs = Tmp_2 which = Public_Tmp4 }
                    }
                    set_province_flag = open_salt
                    clr_province_flag = wants_to_open_salt
                }
                else_if = { # Fuel
                    limit = {
                        has_province_flag = wants_to_open_fuel
                        check_key = { lhs = Tmp_3 which = Tmp_1 }
                        check_key = { lhs = Tmp_3 which = Tmp_4 }
                        check_key = { lhs = Tmp_3 which = Tmp_6 }
                        check_key = { lhs = Tmp_3 which = Tmp_7 }
                        check_key = { lhs = Tmp_3 which = Tmp_8 }
                        check_key = { lhs = Tmp_3 which = Tmp_9 }
                        check_key = { lhs = Tmp_3 which = Public_Tmp3 }
						check_key = { lhs = Tmp_3 which = Public_Tmp4 }
                    }
                    set_province_flag = open_fuel
                    clr_province_flag = wants_to_open_fuel
                }
                else_if = { # Fibre
                    limit = {
                        has_province_flag = wants_to_open_fibre
                        check_key = { lhs = Public_Tmp3 which = Tmp_1 }
                        check_key = { lhs = Public_Tmp3 which = Tmp_4 }
                        check_key = { lhs = Public_Tmp3 which = Tmp_6 }
                        check_key = { lhs = Public_Tmp3 which = Tmp_7 }
                        check_key = { lhs = Public_Tmp3 which = Tmp_8 }
                        check_key = { lhs = Public_Tmp3 which = Tmp_9 }
						check_key = { lhs = Public_Tmp3 which = Public_Tmp4 }
                    }   
                    set_province_flag = open_fibre
                    clr_province_flag = wants_to_open_fibre
                }
                else_if = { # Raw 
                    limit = {
                        has_province_flag = wants_to_open_raw
                        check_key = { lhs = Tmp_4 which = Tmp_1 }
                        check_key = { lhs = Tmp_4 which = Tmp_6 }
                        check_key = { lhs = Tmp_4 which = Tmp_7 }
                        check_key = { lhs = Tmp_4 which = Tmp_8 }
                        check_key = { lhs = Tmp_4 which = Tmp_9 }
						check_key = { lhs = Tmp_4 which = Public_Tmp4 }
                    }
                    set_province_flag = open_raw
                    clr_province_flag = wants_to_open_raw
                }
                else_if = { # Consumer
                    limit = {
                        has_province_flag = wants_to_open_consumer
                        check_key = { lhs = Tmp_6 which = Tmp_1 }
                        check_key = { lhs = Tmp_6 which = Tmp_7 }
                        check_key = { lhs = Tmp_6 which = Tmp_8 }
                        check_key = { lhs = Tmp_6 which = Tmp_9 }
						check_key = { lhs = Tmp_6 which = Public_Tmp4 }
                    }
                    set_province_flag = open_consumer
                    clr_province_flag = wants_to_open_consumer
                }
                else_if = { # Military
                    limit = {
                        has_province_flag = wants_to_open_military
                        check_key = { lhs = Tmp_7 which = Tmp_1 }
                        check_key = { lhs = Tmp_7 which = Tmp_8 }
                        check_key = { lhs = Tmp_7 which = Tmp_9 }
						check_key = { lhs = Tmp_7 which = Public_Tmp4 }
                    }
                    set_province_flag = open_military
                    clr_province_flag = wants_to_open_military
                }
                else_if = { # Naval
                    limit = {
                        has_province_flag = wants_to_open_naval
                        check_key = { lhs = Tmp_8 which = Tmp_1 }
                        check_key = { lhs = Tmp_8 which = Tmp_9 }
						check_key = { lhs = Tmp_8 which = Public_Tmp4 }
                    }
                    set_province_flag = open_naval
                    clr_province_flag = wants_to_open_naval
                }
                else_if = { # Food
                    limit = {
                        has_province_flag = wants_to_open_food
                        check_key = { lhs = Tmp_1 which = Tmp_9 }
						check_key = { lhs = Tmp_1 which = Public_Tmp4 }
                    }
                    set_province_flag = open_food
                    clr_province_flag = wants_to_open_food
                }
                else_if = { # Industrial
                    limit = {
                        has_province_flag = wants_to_open_industrial
						check_key = { lhs = Tmp_9 which = Public_Tmp4 }
                    }
                    set_province_flag = open_industrial
                    clr_province_flag = wants_to_open_industrial
                }
                else_if = { # Timber
                    limit = {
                        has_province_flag = wants_to_open_timber
                    }
                    set_province_flag = open_timber
                    clr_province_flag = wants_to_open_timber
                }
                else = { set_province_flag = you_suck }
                
                OpenSlotsEffect = yes
            }
            clr_province_flag = wants_to_open_consumer
            clr_province_flag = wants_to_open_exotics
            clr_province_flag = wants_to_open_fibre
            clr_province_flag = wants_to_open_food
            clr_province_flag = wants_to_open_fuel
            clr_province_flag = wants_to_open_industrial
            clr_province_flag = wants_to_open_knowledge
            clr_province_flag = wants_to_open_luxury
            clr_province_flag = wants_to_open_military
            clr_province_flag = wants_to_open_naval
            clr_province_flag = wants_to_open_raw
            clr_province_flag = wants_to_open_salt
            clr_province_flag = wants_to_open_timber
            
            clr_province_flag = open_consumer
            clr_province_flag = open_exotics
            clr_province_flag = open_fibre
            clr_province_flag = open_food
            clr_province_flag = open_fuel
            clr_province_flag = open_industrial
            clr_province_flag = open_knowledge
            clr_province_flag = open_luxury
            clr_province_flag = open_military
            clr_province_flag = open_naval
            clr_province_flag = open_raw
            clr_province_flag = open_salt
            clr_province_flag = open_timber
        }
    }
    if = {
        limit = {
            has_province_flag = rec_new_slot #--> flags that is set when a province opens a slot
        }
        clr_province_flag = rec_new_slot
        PREV = { set_province_flag = opened_tradenode } #--> this flags the province tradenode center and stops the entire loop. It tells him that something has been opened.
    }
}
# This one calculates most profitable trade good to be opened based on necessity.
OpenSlotsHelper = {
    set_key = { lhs = Tmp_1 value = 0 }
    set_key = { lhs = Tmp_2 value = 0 }
    set_key = { lhs = Tmp_3 value = 0 }
    set_key = { lhs = Tmp_4 value = 0 }
    set_key = { lhs = Tmp_5 value = 0 }
    set_key = { lhs = Tmp_6 value = 0 }
    set_key = { lhs = Tmp_7 value = 0 }
    set_key = { lhs = Tmp_8 value = 0 }
    set_key = { lhs = Tmp_9 value = 0 }
    set_key = { lhs = Public_Tmp1 value = 0 }
    set_key = { lhs = Public_Tmp2 value = 0 }
    set_key = { lhs = Public_Tmp3 value = 0 }
    set_key = { lhs = Public_Tmp4 value = 0 }
    
    if = {
        limit = {
            NOT = { has_province_flag = TN_SectorCent }
        }
        every_trade_node_member_province = {
            limit = {
                has_province_flag = TN_SectorCent

                owned_by = PREV
            }
            PREV = {
                set_key = { lhs = TN_SectorSply1 which = PREV }
                set_key = { lhs = TN_SectorSply2 which = PREV }
                set_key = { lhs = TN_SectorSply4 which = PREV }
                set_key = { lhs = TN_SectorSply5 which = PREV }
                set_key = { lhs = TN_SectorSply6 which = PREV }
                set_key = { lhs = TN_SectorSply9 which = PREV }
                set_key = { lhs = TN_SectorSply10 which = PREV }
                set_key = { lhs = TN_SectorSply21 which = PREV }
                set_key = { lhs = TN_SectorSply22 which = PREV }
                set_key = { lhs = TN_SectorSply23 which = PREV }
                set_key = { lhs = TN_SectorSply24 which = PREV }
                set_key = { lhs = TN_SectorSply25 which = PREV }
                set_key = { lhs = TN_SectorSply41 which = PREV }
                
                set_key = { lhs = TN_SectorDmnd1 which = PREV }
                set_key = { lhs = TN_SectorDmnd2 which = PREV }
                set_key = { lhs = TN_SectorDmnd4 which = PREV }
                set_key = { lhs = TN_SectorDmnd5 which = PREV }
                set_key = { lhs = TN_SectorDmnd6 which = PREV }
                set_key = { lhs = TN_SectorDmnd9 which = PREV }
                set_key = { lhs = TN_SectorDmnd10 which = PREV }
                set_key = { lhs = TN_SectorDmnd21 which = PREV }
                set_key = { lhs = TN_SectorDmnd22 which = PREV }
                set_key = { lhs = TN_SectorDmnd23 which = PREV }
                set_key = { lhs = TN_SectorDmnd24 which = PREV }
                set_key = { lhs = TN_SectorDmnd25 which = PREV }
                set_key = { lhs = TN_SectorDmnd41 which = PREV }
            }
        }
    }
       
        # If sector demand > sply, calculate the price difference.
    
    if = { # Food
        limit = {
            check_key = { lhs = TN_SectorDmnd1 which = TN_SectorSply1 }
            OR = { 
                AND = {
                    Prod_Can_1 = yes 
                    Prod_NotHasProd = { Prod = 1 }
                }
                AND = {
                    Prod_Can_6 = yes 
                    Prod_NotHasProd = { Prod = 6 }
                }
                AND = {
                    Prod_Can_21 = yes 
                    Prod_NotHasProd = { Prod = 21 }
                }
            }                    
        }
        set_key = { lhs = Tmp_1 which = TN_SectorDmnd1 }
        subtract_key = { lhs = Tmp_1 which = TN_SectorSply1 }
        
        if = {
            limit = {
                check_key = { lhs = Tmp_1 value = 0.001 }
            }
            multiply_key = { lhs = Tmp_1 which = TN_ProvPrc1 }
            set_province_flag = wants_to_open
            set_province_flag = wants_to_open_food
        }
    }
       
    if = { # Salt
        limit = {
            check_key = { lhs = TN_SectorDmnd2 which = TN_SectorSply2 }
            OR = {
                AND = {
                    Prod_Can_10 = yes
                    Prod_NotHasProd = { Prod = 10 }
                }
                AND = {
                    Prod_Can_9 = yes
                    Prod_NotHasProd = { Prod = 9 }
                }
            }  
        }
        set_key = { lhs = Tmp_2 which = TN_SectorDmnd2 }
        subtract_key = { lhs = Tmp_2 which = TN_SectorSply2 }
        
        if = {
            limit = {
                check_key = { lhs = Tmp_2 value = 0.001 }
            }
            multiply_key = { lhs = Tmp_2 which = TN_ProvPrc2 }
            set_province_flag = wants_to_open
            set_province_flag = wants_to_open_salt
        }
    }
       
    if = { # Fuel
        limit = {
            check_key = { lhs = TN_SectorDmnd5 which = TN_SectorSply5 }
            OR = {
                AND = {
                    Prod_Can_13 = yes
                    Prod_NotHasProd = { Prod = 13 }
                }
                AND = {
                    Prod_Can_14 = yes
                    Prod_NotHasProd = { Prod = 14 }
                }
            }  
        }
        set_key = { lhs = Tmp_3 which = TN_SectorDmnd5 }
        subtract_key = { lhs = Tmp_3 which = TN_SectorSply5 }
        
        if = {
            limit = {
                check_key = { lhs = Tmp_3 value = 0.001 }
            }
            multiply_key = { lhs = Tmp_3 which = TN_ProvPrc5 }
            set_province_flag = wants_to_open
            set_province_flag = wants_to_open_fuel
        }
    }
       
    if = {
        limit = { # Raw
            check_key = { lhs = TN_SectorDmnd6 which = TN_SectorSply6 }
            AND = {
                Prod_Can_15 = yes
                Prod_NotHasProd = { Prod = 15 }
            }
        }
        set_key = { lhs = Tmp_4 which = TN_SectorDmnd6 }
        subtract_key = { lhs = Tmp_4 which = TN_SectorSply6 }
       
        if = {
            limit = {
                check_key = { lhs = Tmp_4 value = 0.001 }
            }
            multiply_key = { lhs = Tmp_4 which = TN_ProvPrc6 }
            set_province_flag = wants_to_open
            set_province_flag = wants_to_open_raw
        }
    }
       
    if = {
        limit = { # Exotics
            check_key = { lhs = TN_SectorDmnd9 which = TN_SectorSply9 }
            OR = {
                AND = {
                    Prod_Can_19 = yes
                    Prod_NotHasProd = { Prod = 19 }
                }
                AND = {
                    Prod_Can_20 = yes
                    Prod_NotHasProd = { Prod = 20 }
                }
                AND = {
                    Prod_Can_16 = yes
                    Prod_NotHasProd = { Prod = 16 }
                }
                AND = {
                    Prod_Can_21 = yes
                    Prod_NotHasProd = { Prod = 21 }
                }
            }
        }
        set_key = { lhs = Tmp_5 which = TN_SectorDmnd9 }
        subtract_key = { lhs = Tmp_5 which = TN_SectorSply9 }
        
        if = {
            limit = {
                check_key = { lhs = Tmp_5 value = 0.001 }
            }
            multiply_key = { lhs = Tmp_5 which = TN_ProvPrc9 }
            set_province_flag = wants_to_open
            set_province_flag = wants_to_open_exotics
        }
    }

    if = {      
        limit = {       #Timber
            check_key = { lhs = TN_SectorDmnd10 which = TN_SectorSply10 }
            AND = {
                Prod_Can_13 = yes
                Prod_NotHasProd = { Prod = 13 }
            }
        }
        set_key = { lhs = Public_Tmp4 which = TN_SectorDmnd10 }
        subtract_key = { lhs = Public_Tmp4 which = TN_SectorSply10 }

        if = {
            limit = {
                check_key = { lhs = Public_Tmp4 value = 0.001 }
            }
            multiply_key = { lhs = Public_Tmp4 which = TN_ProvPrc10 }
            set_province_flag = wants_to_open
            set_province_flag = wants_to_open_timber
        }
    }
       
    if = {
        limit = { # Consumer
            check_key = { lhs = TN_SectorDmnd21 which = TN_SectorSply21 }
            OR = {
                AND = {
                    Prod_Can_24 = yes
                    Prod_NotHasProd = { Prod = 24 }
                }
                AND = {
                    Prod_Can_25 = yes
                    Prod_NotHasProd = { Prod = 25 }
                }
                AND = {
                    Prod_Can_38 = yes
                    Prod_NotHasProd = { Prod = 38 }
                }
            }  
        }
        set_key = { lhs = Tmp_6 which = TN_SectorDmnd21 }
        subtract_key = { lhs = Tmp_6 which = TN_SectorSply21 }
        
        if = {
            limit = {
                check_key = { lhs = Tmp_6 value = 0.001 }
            }
            multiply_key = { lhs = Tmp_6 which = TN_ProvPrc21 }
            set_province_flag = wants_to_open
            set_province_flag = wants_to_open_consumer
        }
    }
    
    if = {
        limit = { # Military
            check_key = { lhs = TN_SectorDmnd22 which = TN_SectorSply22 }
            AND = {
                Prod_Can_26 = yes
                Prod_NotHasProd = { Prod = 26 }
            }
        }
        set_key = { lhs = Tmp_7 which = TN_SectorDmnd22 }
        subtract_key = { lhs = Tmp_7 which = TN_SectorSply22 }
        
        if = {
            limit = {
                check_key = { lhs = Tmp_7 value = 0.001 }
            }
            multiply_key = { lhs = Tmp_7 which = TN_ProvPrc22 }
            set_province_flag = wants_to_open
            set_province_flag = wants_to_open_military
        }
    }
       
    if = {
        limit = { # Naval
            check_key = { lhs = TN_SectorDmnd23 which = TN_SectorSply23 }
            AND = {
                Prod_Can_27 = yes
                Prod_NotHasProd = { Prod = 27 }
            }
        }
        set_key = { lhs = Tmp_8 which = TN_SectorDmnd23 }
        subtract_key = { lhs = Tmp_8 which = TN_SectorSply23 }
        
        if = {
            limit = {
                check_key = { lhs = Tmp_8 value = 0.001 }
            }
            multiply_key = { lhs = Tmp_8 which = TN_ProvPrc23 }
            set_province_flag = wants_to_open
            set_province_flag = wants_to_open_naval
        }
    }
    
    if = {
        limit = { # Industrial
            check_key = { lhs = TN_SectorDmnd24 which = TN_SectorSply24 }
            AND = {
                Prod_Can_28 = yes
                Prod_NotHasProd = { Prod = 28 }
            }
        }
        set_key = { lhs = Tmp_9 which = TN_SectorDmnd24 }
        subtract_key = { lhs = Tmp_9 which = TN_SectorSply24 }
        
        if = {
            limit = {
                check_key = { lhs = Tmp_9 value = 0.001 }
            }
            multiply_key = { lhs = Tmp_9 which = TN_ProvPrc24 }
            set_province_flag = wants_to_open
            set_province_flag = wants_to_open_industrial
        }
    }
    
    if = {
        limit = { # Luxury
            check_key = { lhs = TN_SectorDmnd25 which = TN_SectorSply25 }
            OR = {
                AND = {
                    Prod_Can_33 = yes
                    Prod_NotHasProd = { Prod = 33 }
                }
                AND = {
                    Prod_Can_34 = yes
                    Prod_NotHasProd = { Prod = 35 }
                }
                AND = {
                    Prod_Can_39 = yes
                    Prod_NotHasProd = { Prod = 39 }
                }
            } 
        }
        set_key = { lhs = Public_Tmp1 which = TN_SectorDmnd25 }
        subtract_key = { lhs = Public_Tmp1 which = TN_SectorSply25 }
        
        if = {
            limit = {
                check_key = { lhs = Public_Tmp1 value = 0.001 }
            }
            multiply_key = { lhs = Public_Tmp1 which = TN_ProvPrc25 }
            set_province_flag = wants_to_open
            set_province_flag = wants_to_open_luxury
        }
    }
    
    if = {
        limit = { # Knowledge
            check_key = { lhs = TN_SectorDmnd41 which = TN_SectorSply41 }
            OR = {
                AND = {
                    Prod_Can_29 = yes
                    Prod_NotHasProd = { Prod = 29 }
                }
                AND = {
                    Prod_Can_30 = yes
                    Prod_NotHasProd = { Prod = 30 }
                }
            }
        }
        set_key = { lhs = Public_Tmp2 which = TN_SectorDmnd41 }
        subtract_key = { lhs = Public_Tmp2 which = TN_SectorSply41 }
        
        if = {
            limit = {
                check_key = { lhs = Public_Tmp2 value = 0.001 }
            }
            multiply_key = { lhs = Public_Tmp2 which = TN_ProvPrc41 }
            set_province_flag = wants_to_open
            set_province_flag = wants_to_open_knowledge
        }
    }
    
    if = {
        limit = { # Fibre
            check_key = { lhs = TN_SectorDmnd4 which = TN_SectorSply4 }
            OR = {
                AND = {
                    Prod_Can_11 = yes
                    Prod_NotHasProd = { Prod = 11 }
                }
                AND = {
                    Prod_Can_12 = yes
                    Prod_NotHasProd = { Prod = 12 }
                }
				AND = {
                    Prod_Can_7 = yes
                    Prod_NotHasProd = { Prod = 7 }
                }
				AND = {
                    Prod_Can_42 = yes
                    Prod_NotHasProd = { Prod = 42 }
                }
				
            }  
        }
        set_key = { lhs = Public_Tmp3 which = TN_SectorDmnd4 }
        subtract_key = { lhs = Public_Tmp3 which = TN_SectorSply4 }
        
        if = {
            limit = {
                check_key = { lhs = Public_Tmp3 value = 0.001 }
            }
            multiply_key = { lhs = Public_Tmp3 which = TN_ProvPrc4 }
            set_province_flag = wants_to_open
            set_province_flag = wants_to_open_fibre
        }
    }
}
OpenSlotsHelper2 = {
    set_key = { lhs = Tmp_1 value = 0 }
    set_key = { lhs = Tmp_2 value = 0 }
    set_key = { lhs = Tmp_3 value = 0 }
    set_key = { lhs = Tmp_4 value = 0 }
    set_key = { lhs = Tmp_5 value = 0 }
    set_key = { lhs = Tmp_6 value = 0 }
    set_key = { lhs = Tmp_7 value = 0 }
    set_key = { lhs = Tmp_8 value = 0 }
    set_key = { lhs = Tmp_9 value = 0 }
    set_key = { lhs = Public_Tmp1 value = 0 }
    set_key = { lhs = Public_Tmp2 value = 0 }
    set_key = { lhs = Public_Tmp3 value = 0 }
    set_key = { lhs = Public_Tmp4 value = 0 }
    
        # If sector demand > sply, calculate the price difference.
    
    if = { # Food
        limit = {
            has_province_flag = wants_to_open_food
        }
        set_key = { lhs = Tmp_1 which = TN_SectorDmnd1 }
        subtract_key = { lhs = Tmp_1 which = TN_SectorSply1 }
        multiply_key = { lhs = Tmp_1 which = TN_ProvPrc1 }
    }
       
    if = { # Salt
        limit = {
            has_province_flag = wants_to_open_salt
        }
        set_key = { lhs = Tmp_2 which = TN_SectorDmnd2 }
        subtract_key = { lhs = Tmp_2 which = TN_SectorSply2 }
        multiply_key = { lhs = Tmp_2 which = TN_ProvPrc2 }
    }
       
    if = { # Fuel
        limit = {
            has_province_flag = wants_to_open_fuel
        }
        set_key = { lhs = Tmp_3 which = TN_SectorDmnd5 }
        subtract_key = { lhs = Tmp_3 which = TN_SectorSply5 }
        multiply_key = { lhs = Tmp_3 which = TN_ProvPrc5 }
    }
       
    if = {
        limit = { # Raw
            has_province_flag = wants_to_open_raw
        }
        set_key = { lhs = Tmp_4 which = TN_SectorDmnd6 }
        subtract_key = { lhs = Tmp_4 which = TN_SectorSply6 }
        multiply_key = { lhs = Tmp_4 which = TN_ProvPrc6 }
    }
       
    if = {
        limit = { # Exotics
            has_province_flag = wants_to_open_exotics
        }
        set_key = { lhs = Tmp_5 which = TN_SectorDmnd9 }
        subtract_key = { lhs = Tmp_5 which = TN_SectorSply9 }
        multiply_key = { lhs = Tmp_5 which = TN_ProvPrc9 }
    }
       
    if = {
        limit = { # Consumer
            has_province_flag = wants_to_open_consumer
        }
        set_key = { lhs = Tmp_6 which = TN_SectorDmnd21 }
        subtract_key = { lhs = Tmp_6 which = TN_SectorSply21 }
        multiply_key = { lhs = Tmp_6 which = TN_ProvPrc21 }
    }
    
    if = {
        limit = { # Military
            has_province_flag = wants_to_open_military
        }
        set_key = { lhs = Tmp_7 which = TN_SectorDmnd22 }
        subtract_key = { lhs = Tmp_7 which = TN_SectorSply22 }
        multiply_key = { lhs = Tmp_7 which = TN_ProvPrc22 }
    }
       
    if = {
        limit = { # Naval
            has_province_flag = wants_to_open_naval
        }
        set_key = { lhs = Tmp_8 which = TN_SectorDmnd23 }
        subtract_key = { lhs = Tmp_8 which = TN_SectorSply23 }
        multiply_key = { lhs = Tmp_8 which = TN_ProvPrc23 }
    }
    
    if = {
        limit = { # Industrial
            has_province_flag = wants_to_open_industrial
        }
        set_key = { lhs = Tmp_9 which = TN_SectorDmnd24 }
        subtract_key = { lhs = Tmp_9 which = TN_SectorSply24 }
        multiply_key = { lhs = Tmp_9 which = TN_ProvPrc24 }
    }
    
    if = {
        limit = { # Luxury
            has_province_flag = wants_to_open_luxury
        }
        set_key = { lhs = Public_Tmp1 which = TN_SectorDmnd25 }
        subtract_key = { lhs = Public_Tmp1 which = TN_SectorSply25 }
        multiply_key = { lhs = Public_Tmp1 which = TN_ProvPrc25 }
    }
    
    if = {
        limit = { # Knowledge
            has_province_flag = wants_to_open_knowledge
        }
        set_key = { lhs = Public_Tmp2 which = TN_SectorDmnd41 }
        subtract_key = { lhs = Public_Tmp2 which = TN_SectorSply41 }
        multiply_key = { lhs = Public_Tmp2 which = TN_ProvPrc41 }
    }
    
    if = {
        limit = { # Fibre
            has_province_flag = wants_to_open_fibre
        }
        set_key = { lhs = Public_Tmp3 which = TN_SectorDmnd4 }
        subtract_key = { lhs = Public_Tmp3 which = TN_SectorSply4 }
        multiply_key = { lhs = Public_Tmp3 which = TN_ProvPrc4 }
    }
    if = {
        limit = { # Timber
            has_province_flag = wants_to_open_timber
        }
        set_key = { lhs = Public_Tmp4 which = TN_SectorDmnd10 }
        subtract_key = { lhs = Public_Tmp4 which = TN_SectorSply10 }
        multiply_key = { lhs = Public_Tmp4 which = TN_ProvPrc10 }
    }
}
#

# What happens here is: When a province wants to open a trade good it evaluates all possible industries. Each industry that is possible to open
# gets assigned a unique Temporary variable that calculates how much 1 size outputs and multiplites by price. Then it calculates how much the labour and the inputs cost.
# It also includes already existing industries as it only checks Prod_Can_1 = yes for example. Then, the most profitable industry, as long as it's not opened already, will open.
# So for example, a province wants to open food. Let's assume it has rice and can open wheat. It will calculate the profitability of rice and wheat. If rice is better than wheat, it won't open wheat
# becuase it already has a better industry.
OpenSlotsEffect = {
    trigger_switch = {
        on_trigger = has_province_flag
        
        open_food = {
            set_key = { lhs = Public_Tmp5 which = Building_AgricultureMax }
            subtract_key = { lhs = Public_Tmp5 which = Building_Agriculture }
            set_key = { lhs = Public_Tmp4 which = Building_FisheryMax }
            subtract_key = { lhs = Public_Tmp4 which = Building_Fishery }
            set_key = { lhs = Public_Tmp6 which = Building_ForestryMax }
            subtract_key = { lhs = Public_Tmp6 which = Building_Forestry }
            if = {
                limit = { 
                    check_key = { lhs = WK_SFNet value = 3 }
                }
                if = {
                    limit = { # Wheat
                        check_key = { lhs = Land_CropOutput value = 1 }
                        check_key = { lhs = Public_Tmp5 value = 75 }
                    }
                    set_key = { lhs = Tmp_0 which = TN_ProvPrc1 }
                    multiply_key = { lhs = Tmp_0 which = Land_CropOutput }
                    
                        # Labour
                    set_key = { lhs = Public_Tmp9 which = Class_PR }
                    multiply_key = { lhs = Public_Tmp9 which = Land_CropLabour }
                    
                    subtract_key = { lhs = Tmp_0 which = Public_Tmp9 }
                }
                else = { set_key = { lhs = Tmp_0 value = 0 } }
                if = { # Fishery
                    limit = {
                        Prod_Can_6 = yes
                        check_key = { lhs = Public_Tmp4 value = 30 }
                    }
                    set_key = { lhs = Tmp_5 which = TN_ProvPrc1 }
                    multiply_key = { lhs = Tmp_5 value = 1.5 }
                    set_key = { lhs = Tmp_4 which = TN_ProvPrc2 }
                    multiply_key = { lhs = Tmp_4 value = 0.05 }
                    change_key = { lhs = Tmp_5 which = Tmp_4 }
                       
                         # Labour
                    set_key = { lhs = Public_Tmp9 which = Class_PR }
                    multiply_key = { lhs = Public_Tmp9 value = 0.7 }
					
					subtract_key = { lhs = Tmp_5 which Public_Tmp9 }
					
                }
                else = { set_key = { lhs = Tmp_5 value = 0 } }
                if = { # Settled Pasture
                    limit = {
                        Prod_Can_7 = yes
                        check_key = { lhs = Public_Tmp5 value = 75 }
                    }
                    set_key = { lhs = Tmp_6 which = TN_ProvPrc4 }
                    multiply_key = { lhs = Tmp_6 value = 0.75 }
					set_key = { lhs = Tmp_4 which = TN_ProvPrc1 }
                    multiply_key = { lhs = Tmp_4 value = 1.25 }
                    change_key = { lhs = Tmp_6 which = Tmp_4 }
                       
                        # Labour
                    set_key = { lhs = Public_Tmp9 which = Class_PR }
                    multiply_key = { lhs = Public_Tmp9 value = 1 }
                       
                    subtract_key = { lhs = Tmp_6 which = Public_Tmp9 }
                }
                else = { set_key = { lhs = Tmp_6 value = 0 } }
                if = { # Game/Furs
                    limit = {
                        Prod_Can_21 = yes
                        check_key = { lhs = Public_Tmp6 value = 75 }
                    }
                    set_key = { lhs = Tmp_7 which = TN_ProvPrc9 }
                    set_key = { lhs = Tmp_8 which = TN_ProvPrc1 }
                    set_key = { lhs = Tmp_9 which = TN_ProvPrc2 }
                    set_key = { lhs = Public_Tmp1 which = TN_ProvPrc4 }
                    set_key = { lhs = Public_Tmp2 which = TN_ProvPrc5 }
                    if = {
                        limit = {
							OR = {
								has_province_flag = Prod_Fur
								has_province_flag = westafrican_ivory
								has_province_flag = asian_ivory
								has_province_flag = ivory
							}
                        }
                        multiply_key = { lhs = Tmp_7 value = 0.2 }
                    }
                    else = {
                        multiply_key = { lhs = Tmp_7 value = 0.075 }
                    }
                    multiply_key = { lhs = Tmp_8 value = 0.5 }
                    multiply_key = { lhs = Tmp_9 value = 0.15 }
                    multiply_key = { lhs = Public_Tmp1 value = 0.1 }
                    multiply_key = { lhs = Public_Tmp2 value = 0.1 }
                    
                    change_key = { lhs = Tmp_7 which = Tmp_8 }
                    change_key = { lhs = Tmp_7 which = Tmp_9 }
                    change_key = { lhs = Tmp_7 which = Public_Tmp1 }
                    change_key = { lhs = Tmp_7 which = Public_Tmp2 }
                    
                        # Labour
                    set_key = { lhs = Public_Tmp9 which = Class_PR }
                    multiply_key = { lhs = Public_Tmp9 value = 1 }
                    
                    subtract_key = { lhs = Tmp_7 which = Public_Tmp9 }             
                }
                else = { set_key = { lhs = Tmp_7 value = 0 } }
                if = {
                    limit = { # Wheat most profitable
                        check_key = { lhs = Tmp_0 value = 0.001 }              
                        check_key = { lhs = Tmp_0 which = Tmp_5 }
                        check_key = { lhs = Tmp_0 which = Tmp_6 }
                        check_key = { lhs = Tmp_0 which = Tmp_7 }
                        Prod_NotHasProd = { Prod = 1  }
                    }
                    set_province_flag = wants_to_open_slot
                    set_province_flag = will_open_food
                    set_key = { lhs = Tmp_0 value = 1 }
                }
                else_if = {
                    limit = { # Fishery
                        check_key = { lhs = Tmp_5 value = 0.001 }
                        check_key = { lhs = Tmp_5 which = Tmp_0 }  
                        check_key = { lhs = Tmp_5 which = Tmp_6 }
                        check_key = { lhs = Tmp_5 which = Tmp_7 }
                        Prod_NotHasProd = { Prod = 6 }
                    }
                    set_province_flag = wants_to_open_slot
                    set_province_flag = will_open_food
                    set_key = { lhs = Tmp_0 value = 6 }
                }
                else_if = {
                    limit = { # Settled Pasture
                        check_key = { lhs = Tmp_6 value = 0.001 }
                        check_key = { lhs = Tmp_6 which = Tmp_0 } 
                        check_key = { lhs = Tmp_6 which = Tmp_5 }
                        check_key = { lhs = Tmp_6 which = Tmp_7 }
                        Prod_NotHasProd = { Prod = 7 }
                    }
                    set_province_flag = wants_to_open_slot
                    set_province_flag = will_open_food
                    set_key = { lhs = Tmp_0 value = 7 }
                }
                else_if = {
                    limit = { # Game/Furs
                        check_key = { lhs = Tmp_7 value = 0.001 }
                        check_key = { lhs = Tmp_7 which = Tmp_0 }                    
                        check_key = { lhs = Tmp_7 which = Tmp_5 }
                        check_key = { lhs = Tmp_7 which = Tmp_6 }
                        Prod_NotHasProd = { Prod = 21 }
                    }
                    set_province_flag = wants_to_open_slot
                    set_province_flag = will_open_food
                    set_key = { lhs = Tmp_0 value = 21 }
                }
            }
            clr_province_flag = open_food
        }      
        open_salt = {
            set_key = { lhs = Public_Tmp7 which = Building_ExtractionMax }
            subtract_key = { lhs = Public_Tmp7 which = Building_Extraction }
            if = {
                limit = {
                    check_key = { lhs = WK_SFNet value = 3 }
                }
                if = {
                    limit = { # Sea Salt
                        Prod_Can_9 = yes
                        check_key = { lhs = Public_Tmp7 value = 50 }
                    }
                    set_key = { lhs = Tmp_0 which = TN_ProvPrc2 }
                    multiply_key = { lhs = Tmp_0 value = 1.15 }
                        
                        # Labour
                    set_key = { lhs = Public_Tmp9 which = Class_PR }
                    multiply_key = { lhs = Public_Tmp9 value = 0.45 }
                    
                    subtract_key = { lhs = Tmp_0 which = Public_Tmp9 }                    
                }
                else = { set_key = { lhs = Tmp_0 value = 0 } }
                if = {
                    limit = { # Rock Salt
                        Prod_Can_10 = yes
                        check_key = { lhs = Public_Tmp7 value = 75 }
                    }
                    set_key = { lhs = Tmp_1 which = TN_ProvPrc2 }
                    multiply_key = { lhs = Tmp_1 value = 1.4 }
                        
                        # Labour
                    set_key = { lhs = Public_Tmp9 which = Class_PR }
                    multiply_key = { lhs = Public_Tmp9 value = 0.45 }
                    
                    subtract_key = { lhs = Tmp_1 which = Public_Tmp9 }                 
                }
                else = { set_key = { lhs = Tmp_1 value = 0 } }
                if = {
                    limit = { # Sea Salt
                        check_key = { lhs = Tmp_0 value = 0.001 }
                        check_key = { lhs = Tmp_0 which = Tmp_1 } 
                        Prod_NotHasProd = { Prod = 9 }
                    }
                    set_province_flag = wants_to_open_slot
                    set_province_flag = will_open_salt
                    set_key = { lhs = Tmp_0 value = 9 }
                }
                else_if = {
                    limit = { # Rock Salt
                        check_key = { lhs = Tmp_1 value = 0.001 }
                        check_key = { lhs = Tmp_1 which = Tmp_0 } 
                        Prod_NotHasProd = { Prod = 10 }
                    }
                    set_province_flag = wants_to_open_slot
                    set_province_flag = will_open_salt
                    set_key = { lhs = Tmp_0 value = 10 }
                }
            }
            clr_province_flag = open_salt
        }
        open_fuel = {
            set_key = { lhs = Public_Tmp6 which = Building_ForestryMax }
            subtract_key = { lhs = Public_Tmp6 which = Building_Forestry }
            set_key = { lhs = Public_Tmp7 which = Building_ExtractionMax }
            subtract_key = { lhs = Public_Tmp7 which = Building_Extraction }
            if = {
                limit = {
                    check_key = { lhs = WK_SFNet value = 3 }
                }
                if = {
                    limit = { # Timber  
                        Prod_Can_13 = yes 
                        check_key = { lhs = Public_Tmp6 value = 50 }
                    }
                    set_key = { lhs = Tmp_0 which = TN_ProvPrc5 }
                    if = {
						limit = {
							OR = {
								has_terrain = jungle_hills
								has_terrain = jungle_flats
								has_terrain = marsh
							}
						}
						multiply_key = { lhs = Tmp_0 value = 2.25 }
					}
					else_if = {
						limit = {
							has_terrain = taiga
						}
						multiply_key = { lhs = Tmp_0 value = 2 }
					}
					else = {
						multiply_key = { lhs = Tmp_0 value = 1.0 }
					}
					
                    set_key = { lhs = Tmp_1 which = TN_ProvPrc10 }
                    multiply_key = { lhs = Tmp_1 value = 0.15 }
                    
                    change_key = { lhs = Tmp_0 which = Tmp_1 }
					
                    # Labour
                    set_key = { lhs = Public_Tmp9 which = Class_PR }
                    multiply_key = { lhs = Public_Tmp9 value = 1 }
                    
                    subtract_key = { lhs = Tmp_0 which = Public_Tmp9 }
                }
                else = { set_key = { lhs = Tmp_0 value = 0 } }
                if = {
                    limit = { # Coal
                        Prod_Can_14 = yes
                        check_key = { lhs = Public_Tmp7 value = 100 }
                    }
                    set_key = { lhs = Tmp_1 which = TN_ProvPrc5 }
                    multiply_key = { lhs = Tmp_1 value = 3 }
					#input
					set_key = { lhs = Tmp_2 which = TN_ProvPrc10 } 
                    multiply_key = { lhs = Tmp_2 value = 0.5 }
					
                    # Labour
                    set_key = { lhs = Public_Tmp9 which = Class_PR }
                    multiply_key = { lhs = Public_Tmp9 value = 0.6 }
                    
					subtract_key = { lhs = Tmp_1 which Tmp_2 } 
                    subtract_key = { lhs = Tmp_1 which = Public_Tmp9 }
                }
                else = { set_key = { lhs = Tmp_1 value = 0 } }
                if = {
                    limit = { # Timber
                        check_key = { lhs = Tmp_0 value = 0.001 }
                        check_key = { lhs = Tmp_0 which = Tmp_1 } 
                        Prod_NotHasProd = { Prod = 13 }
                    }
                    set_province_flag = wants_to_open_slot
                    set_province_flag = will_open_fuel
                    set_key = { lhs = Tmp_0 value = 13 }
                }
                else_if = {
                    limit = { # Coal
                        check_key = { lhs = Tmp_1 value = 0.001 }
                        Prod_NotHasProd = { Prod = 14 }
                    }
                    set_province_flag = wants_to_open_slot
                    set_province_flag = will_open_fuel
                    set_key = { lhs = Tmp_0 value = 14 }
                }
            }
            clr_province_flag = open_fuel
        }
        open_raw = {
            if = {
                limit = {
                    check_key = { lhs = WK_SFNet value = 3 }
                }
                set_key = { lhs = Public_Tmp7 which = Building_ExtractionMax }
                subtract_key = { lhs = Public_Tmp7 which = Building_Extraction }
                if = {
                    limit = { # Metals
                        check_key = { lhs = Public_Tmp7 value = 50 }
                        Prod_Can_15 = yes 
                    }
                    set_key = { lhs = Tmp_1 which = TN_ProvPrc6 }
                    multiply_key = { lhs = Tmp_1 value = 3.0 }
					#input
					set_key = { lhs = Tmp_2 which = TN_ProvPrc10 } 
                    multiply_key = { lhs = Tmp_2 value = 0.75 }
                    
                        # Labour
                    set_key = { lhs = Public_Tmp9 which = Class_PR }
                    multiply_key = { lhs = Public_Tmp9 value = 0.45 }
                    
					subtract_key = { lhs = Tmp_1 which = Tmp_2 }
                    subtract_key = { lhs = Tmp_1 which = Public_Tmp9 }
                }
                else = { set_key = { lhs = Tmp_1 value = 0 } }
                if = {
                    limit = { # Metals
                        check_key = { lhs = Tmp_1 value = 0.001 }
                        Prod_NotHasProd = { Prod = 15 } 
                    }
                    set_province_flag = wants_to_open_slot
                    set_province_flag = will_open_raw
                    set_key = { lhs = Tmp_0 value = 15 }
                }
            }
            clr_province_flag = open_raw
        } 
        open_exotics = {
            if = { 
                limit = {
                    check_key = { lhs = WK_SFNet value = 3 }
                }
                set_key = { lhs = Public_Tmp6 which = Building_ForestryMax }
                subtract_key = { lhs = Public_Tmp6 which = Building_Forestry }
                set_key = { lhs = Public_Tmp5 which = Building_AgricultureMax }
                subtract_key = { lhs = Public_Tmp5 which = Building_Agriculture }
                set_key = { lhs = Public_Tmp4 which = Building_FisheryMax }
                subtract_key = { lhs = Public_Tmp4 which = Building_Fishery }
                set_key = { lhs = Public_Tmp7 which = Building_ExtractionMax }
                subtract_key = { lhs = Public_Tmp7 which = Building_Extraction }
                if = {
                    limit = {
                        Prod_Can_16 = yes # Rare Metals
                        check_key = { lhs = Public_Tmp7 value = 25 }
                    }
                    set_key = { lhs = Tmp_0 which = TN_ProvPrc9 }
					set_key = { lhs = Tmp_1 which = TN_ProvPrc25 }

                    multiply_key = { lhs = Tmp_0 value = 0.65 }
					multiply_key = { lhs = Tmp_1 value = 0.1 }
					change_key = { lhs = Tmp_0 value Tmp_1 }
					
					#input
					set_key = { lhs = Tmp_2 which = TN_ProvPrc10 } 
                    multiply_key = { lhs = Tmp_2 value = 0.5 }
                
                    # Labour
                    set_key = { lhs = Public_Tmp1 which = Class_PR }
                    multiply_key = { lhs = Public_Tmp1 value = 0.3 }
                    
                    subtract_key = { lhs = Tmp_0 which = Public_Tmp1 }
					subtract_key = { lhs = Tmp_0 which = Tmp_2 }
                }
                else = { set_key = { lhs = Tmp_0 value = 0 } }
                if = {
                    limit = {
                        Prod_Can_20 = yes # Spices
                        check_key = { lhs = Public_Tmp5 value = 100 }
                    }
                    set_key = { lhs = Tmp_3 which = TN_ProvPrc9 }
                    if = {
                        limit = {
                            OR = {
                                continent = indian_continent
                                continent = asia
                                continent = southeast_asia
                            }
                        }
                        multiply_key = { lhs = Tmp_3 value = 0.4 }
                    }
                    else = {
                        multiply_key = { lhs = Tmp_3 value = 0.25 }
                    }
                        # Labour
                    set_key = { lhs = Public_Tmp1 which = Class_PR }
                    multiply_key = { lhs = Public_Tmp1 value = 0.5 }
                    
                    subtract_key = { lhs = Tmp_3 which = Public_Tmp1 }                   
                }
                else = { set_key = { lhs = Tmp_3 value = 0 } }
                if = {
                    limit = {
                        OR = {
                            has_terrain = taiga
                            has_province_flag = Prod_Fur 
                        }
                        Prod_Can_21 = yes # Game/Furs
                        check_key = { lhs = Public_Tmp6 value = 75 }
                    }
                    set_key = { lhs = Tmp_4 which = TN_ProvPrc9 }
                    set_key = { lhs = Tmp_8 which = TN_ProvPrc1 }
                    set_key = { lhs = Tmp_9 which = TN_ProvPrc2 }
                    set_key = { lhs = Public_Tmp1 which = TN_ProvPrc4 }
                    set_key = { lhs = Public_Tmp2 which = TN_ProvPrc5 }
                    if = {
                        limit = {
							OR = {
								has_province_flag = Prod_Fur
								has_province_flag = westafrican_ivory
								has_province_flag = asian_ivory
								has_province_flag = ivory
							}
                        }
                        multiply_key = { lhs = Tmp_4 value = 0.2 }
                    }
                    else = {
                        multiply_key = { lhs = Tmp_4 value = 0.075 }
                    }
                    multiply_key = { lhs = Tmp_8 value = 0.5 }
                    multiply_key = { lhs = Tmp_9 value = 0.15 }
                    multiply_key = { lhs = Public_Tmp1 value = 0.1 }
                    multiply_key = { lhs = Public_Tmp2 value = 0.1 }
                    
                    change_key = { lhs = Tmp_4 which = Tmp_8 }
                    change_key = { lhs = Tmp_4 which = Tmp_9 }
                    change_key = { lhs = Tmp_4 which = Public_Tmp1 }
                    change_key = { lhs = Tmp_4 which = Public_Tmp2 }
                    
                        # Labour
                    set_key = { lhs = Public_Tmp1 which = Class_PR }
                    multiply_key = { lhs = Public_Tmp1 value = 1 }
                    
                    subtract_key = { lhs = Tmp_4 which = Public_Tmp1 }               
                }
                else = { set_key = { lhs = Tmp_4 value = 0 } }
				if = {
                    limit = {
                        Prod_Can_19 = yes # Cashcrop
                        check_key = { lhs = Public_Tmp5 value = 100 }
                    }
                    set_key = { lhs = Tmp_5 which = TN_ProvPrc9 }
                    multiply_key = { lhs = Tmp_5 value = 1.75 }
					
					#input
					set_key = { lhs = Tmp_6 which = TN_ProvPrc6 } 
                    multiply_key = { lhs = Tmp_6 value = 0.5 }
					set_key = { lhs = Tmp_7 which = TN_ProvPrc10 } 
                    multiply_key = { lhs = Tmp_7 value = 0.2 }
                    # Labour
                    set_key = { lhs = Public_Tmp1 which = Class_PR }
                    multiply_key = { lhs = Public_Tmp1 value = 0.6 }
                    
                    subtract_key = { lhs = Tmp_5 which = Public_Tmp1 }
					subtract_key = { lhs = Tmp_5 which = Tmp_6 }
					subtract_key = { lhs = Tmp_5 which = Tmp_7 }
					
                }
                else = { set_key = { lhs = Tmp_5 value = 0 } }
                if = {
                    limit = { # Rare Metals most profitable
                        check_key = { lhs = Tmp_0 value = 0.001 }
                        check_key = { lhs = Tmp_0 which = Tmp_1 } 
                        check_key = { lhs = Tmp_0 which = Tmp_2 } 
                        check_key = { lhs = Tmp_0 which = Tmp_3 } 
                        check_key = { lhs = Tmp_0 which = Tmp_4 }
						check_key = { lhs = Tmp_0 which = Tmp_5 }
                        Prod_NotHasProd = { Prod = 16  }
                    }
                    set_province_flag = wants_to_open_slot
                    set_province_flag = will_open_exotics
                    set_key = { lhs = Tmp_0 value = 16 }
                }
                else_if = {
                    limit = { # Spices
                        check_key = { lhs = Tmp_3 value = 0.001 }
                        check_key = { lhs = Tmp_3 which = Tmp_0 } 
                        check_key = { lhs = Tmp_3 which = Tmp_1 } 
                        check_key = { lhs = Tmp_3 which = Tmp_2 } 
                        check_key = { lhs = Tmp_3 which = Tmp_4 }
						check_key = { lhs = Tmp_3 which = Tmp_5 }						
                        Prod_NotHasProd = { Prod = 20 }
                    }
                    set_province_flag = wants_to_open_slot
                    set_province_flag = will_open_exotics
                    set_key = { lhs = Tmp_0 value = 20 }
                }
                else_if = {
                    limit = { # Game/Furs
                        check_key = { lhs = Tmp_4 value = 0.001 }
                        check_key = { lhs = Tmp_4 which = Tmp_0 } 
                        check_key = { lhs = Tmp_4 which = Tmp_1 } 
                        check_key = { lhs = Tmp_4 which = Tmp_2 } 
                        check_key = { lhs = Tmp_4 which = Tmp_3 }
						check_key = { lhs = Tmp_4 which = Tmp_5 }						
                        Prod_NotHasProd = { Prod = 21 }
                    }
                    set_province_flag = wants_to_open_slot
                    set_province_flag = will_open_exotics
                    set_key = { lhs = Tmp_0 value = 21 }
                }
				else_if = {
                    limit = { # Cashcrops
                        check_key = { lhs = Tmp_5 value = 0.001 }
                        check_key = { lhs = Tmp_5 which = Tmp_0 } 
                        check_key = { lhs = Tmp_5 which = Tmp_1 } 
                        check_key = { lhs = Tmp_5 which = Tmp_2 } 
                        check_key = { lhs = Tmp_5 which = Tmp_3 }
						check_key = { lhs = Tmp_5 which = Tmp_4 }						
                        Prod_NotHasProd = { Prod = 19 }
                    }
                    set_province_flag = wants_to_open_slot
                    set_province_flag = will_open_exotics
                    set_key = { lhs = Tmp_0 value = 19 }
                }
            }
            clr_province_flag = open_exotics
        }
        open_consumer = {
            if = {
                limit = {
                    check_key = { lhs = WK_RENet value = 1 }
                }
                if = {
                    limit = {
                        Prod_Can_24 = yes # Houseware
                    }
                    set_key = { lhs = Tmp_0 which = TN_ProvPrc21 }
                    multiply_key = { lhs = Tmp_0 value = 2 }
                    
                    set_key = { lhs = Tmp_1 which = TN_ProvPrc25 }
                    multiply_key = { lhs = Tmp_1 value = 0.1 }
                    
                    change_key = { lhs = Tmp_0 which = Tmp_1 }
                    
                        # Inputs
                    set_key = { lhs = Tmp_2 which = TN_ProvPrc5 }
                    multiply_key = { lhs = Tmp_2 value = 0.25 }
                    
                    set_key = { lhs = Tmp_3 which = TN_ProvPrc6 }
                    multiply_key = { lhs = Tmp_3 value = 0.25 }
					
					set_key = { lhs = Tmp_4 which = TN_ProvPrc10 }
                    multiply_key = { lhs = Tmp_4 value = 1.0 }
					
                    
                        # Labour
                    set_key = { lhs = Public_Tmp9 which = Class_PUL }
                    
                    subtract_key = { lhs = Tmp_0 which = Tmp_2 }
                    subtract_key = { lhs = Tmp_0 which = Tmp_3 }
					subtract_key = { lhs = Tmp_0 which = Tmp_4 }
                    subtract_key = { lhs = Tmp_0 which = Public_Tmp9 }                 
                }
                else = { set_key = { lhs = Tmp_0 value = 0 } }
                if = {
                    limit = {
                        Prod_Can_25 = yes # Textile
                    }
                    set_key = { lhs = Tmp_1 which = TN_ProvPrc21 }
                    multiply_key = { lhs = Tmp_1 value = 2 }
                    
                    set_key = { lhs = Tmp_2 which = TN_ProvPrc25 }
                    multiply_key = { lhs = Tmp_2 value = 0.1 }
                    
                    change_key = { lhs = Tmp_1 which = Tmp_2 }
                    
                        # Inputs
                    set_key = { lhs = Tmp_3 which = TN_ProvPrc4 }
                    multiply_key = { lhs = Tmp_3 value = 1.8 }
                    
                        # Labour
                    set_key = { lhs = Public_Tmp9 which = Class_PUL }
                    
                    subtract_key = { lhs = Tmp_1 which = Tmp_3 }
                    subtract_key = { lhs = Tmp_1 which = Public_Tmp9 }
                }
                else = { set_key = { lhs = Tmp_1 value = 0 } }
                if = {
                    limit = {
                        Prod_Can_38 = yes # Cottage Industry
                    }
                    set_key = { lhs = Tmp_2 which = TN_ProvPrc1 }
                    multiply_key = { lhs = Tmp_2 value = 0.05 }

                    set_key = { lhs = Tmp_3 which = TN_ProvPrc21 }
                    multiply_key = { lhs = Tmp_3 value = 1.14 }
                    
                    set_key = { lhs = Tmp_4 which = TN_ProvPrc22 }
                    multiply_key = { lhs = Tmp_4 value = 1.14 }
                    
                    set_key = { lhs = Tmp_5 which = TN_ProvPrc24 }
                    multiply_key = { lhs = Tmp_5 value = 1.14 }
                    
                    # set_key = { lhs = Tmp_5 which = TN_ProvPrc25 }
                    # multiply_key = { lhs = Tmp_5 value = 0.03 }
                    
                    change_key = { lhs = Tmp_2 which = Tmp_3 }
                    change_key = { lhs = Tmp_2 which = Tmp_4 }
                    change_key = { lhs = Tmp_2 which = Tmp_5 }
                       
                        # Inputs
                    set_key = { lhs = Tmp_4 which = TN_ProvPrc4 }
                    multiply_key = { lhs = Tmp_4 value = 0.25 }
                    
                    set_key = { lhs = Tmp_5 which = TN_ProvPrc5 }
                    multiply_key = { lhs = Tmp_5 value = 0.25 }
                    
                    set_key = { lhs = Tmp_6 which = TN_ProvPrc6 }
                    multiply_key = { lhs = Tmp_6 value = 0.25 }
					
					set_key = { lhs = Tmp_7 which = TN_ProvPrc10 }
                    multiply_key = { lhs = Tmp_7 value = 0.6 }
                    
                        # Labour
                    set_key = { lhs = Public_Tmp9 which = Class_PR }
                    
                    subtract_key = { lhs = Tmp_2 which = Tmp_4 }
                    subtract_key = { lhs = Tmp_2 which = Tmp_5 }
                    subtract_key = { lhs = Tmp_2 which = Tmp_6 }
					subtract_key = { lhs = Tmp_2 which = Tmp_7 }
                    subtract_key = { lhs = Tmp_2 which = Public_Tmp9 }                   
                }
                else = { set_key = { lhs = Tmp_2 value = 0 } }
                if = {
                    limit = { # Houseware
                        check_key = { lhs = Tmp_0 value = 0.001 }
                        check_key = { lhs = Tmp_0 which = Tmp_1 } 
                        check_key = { lhs = Tmp_0 which = Tmp_2 } 
                        Prod_NotHasProd = { Prod = 24 }
                    }
                    set_province_flag = wants_to_open_slot
                    set_province_flag = will_open_consumer
                    set_key = { lhs = Tmp_0 value = 24 }
                }
                else_if = {
                    limit = { # Textile
                        check_key = { lhs = Tmp_1 value = 0.001 }
                        check_key = { lhs = Tmp_1 which = Tmp_0 } 
                        check_key = { lhs = Tmp_1 which = Tmp_2 } 
                        Prod_NotHasProd = { Prod = 25 }
                    }
                    set_province_flag = wants_to_open_slot
                    set_province_flag = will_open_consumer
                    set_key = { lhs = Tmp_0 value = 25 }
                }
                else_if = {
                    limit = { # Cottage
                        check_key = { lhs = Tmp_2 value = 0.001 }
                        check_key = { lhs = Tmp_2 which = Tmp_0 } 
                        check_key = { lhs = Tmp_2 which = Tmp_1 } 
                        Prod_NotHasProd = { Prod = 38 }
                    }
                    set_province_flag = wants_to_open_slot
                    set_province_flag = will_open_consumer
                    set_key = { lhs = Tmp_0 value = 38 }
                }
            }
            clr_province_flag = open_consumer
        }
        open_military = {
            if = {
                limit = {
                    Prod_Can_26 = yes # Military
                    Prod_NotHasProd = { Prod = 26 }
                    check_key = { lhs = WK_RENet value = 1 }
                }
                set_key = { lhs = Tmp_0 which = TN_ProvPrc22 }
                multiply_key = { lhs = Tmp_0 value = 1.85 }
                
                set_key = { lhs = Tmp_1 which = TN_ProvPrc25 }
                multiply_key = { lhs = Tmp_1 value = 0.05 }
                
                change_key = { lhs = Tmp_0 which = Tmp_1 }
                
                    # Inputs
                set_key = { lhs = Tmp_2 which = TN_ProvPrc5 }
                multiply_key = { lhs = Tmp_2 value = 0.4 }
                
                set_key = { lhs = Tmp_3 which = TN_ProvPrc6 }
                multiply_key = { lhs = Tmp_3 value = 1.5 }
				
				set_key = { lhs = Tmp_4 which = TN_ProvPrc10 }
                multiply_key = { lhs = Tmp_4 value = 0.25 }
				
				set_key = { lhs = Tmp_5 which = TN_ProvPrc24 }
                multiply_key = { lhs = Tmp_5 value = 0.1 }
                
                    # Labour
                set_key = { lhs = Public_Tmp9 which = Class_PUL }
                
                subtract_key = { lhs = Tmp_0 which = Tmp_2 }
                subtract_key = { lhs = Tmp_0 which = Tmp_3 }
				subtract_key = { lhs = Tmp_0 which = Tmp_4 }
				subtract_key = { lhs = Tmp_0 which = Tmp_5 }
                subtract_key = { lhs = Tmp_0 which = Public_Tmp9 }
            }
            else = { set_key = { lhs = Tmp_0 value = 0 } }
            if = {
                limit = { #Steel
                    Prod_Can_40 = yes
                    Prod_NotHasProd = { Prod = 40 }
                    check_key = { lhs = WK_RENet value = 1 }
                }
                set_key = { lhs = Tmp_1 which = TN_ProvPrc22 }
                multiply_key = { lhs = Tmp_1 value = 2.5 }
                set_key = { lhs = Tmp_2 which = TN_ProvPrc21 }
                multiply_key = { lhs = Tmp_2 value = 0.25 }
                change_key = { lhs = Tmp_1 which = Tmp_2 }
                set_key = { lhs = Tmp_2 which = TN_ProvPrc25 }
                multiply_key = { lhs = Tmp_2 value = 0.15 }
                change_key = { lhs = Tmp_1 which = Tmp_2 }

                # Inputs
                set_key = { lhs = Tmp_2 which = TN_ProvPrc5 }
                multiply_key = { lhs = Tmp_2 value = 0.9 }
                
                set_key = { lhs = Tmp_3 which = TN_ProvPrc6 }
                multiply_key = { lhs = Tmp_3 value = 1.8 }
				
				set_key = { lhs = Tmp_4 which = TN_ProvPrc24 }
                multiply_key = { lhs = Tmp_4 value = 0.45 }

                # Labour
                set_key = { lhs = Public_Tmp9 which = Class_PUL }

                subtract_key = { lhs = Tmp_1 which = Tmp_2 }
                subtract_key = { lhs = Tmp_1 which = Tmp_3 }
				subtract_key = { lhs = Tmp_1 which = Tmp_4 }
                subtract_key = { lhs = Tmp_1 which = Public_Tmp9 }
            }
            else = { set_key = { lhs = Tmp_1 value = 0 } }
            if = { # Armaments
                limit = {
                    check_key = { lhs = Tmp_0 value = 0.001 }
                    check_key = { lhs = Tmp_0 which = Tmp_1 }
                }
                set_province_flag = will_open_military
                set_province_flag = wants_to_open_slot
                set_key = { lhs = Tmp_0 value = 26 }
            }
            else_if = { # Steel
                limit = {
                    check_key = { lhs = Tmp_1 value = 0.001 }
                    check_key = { lhs = Tmp_1 which = Tmp_0 }
                }
                set_province_flag = will_open_military
                set_province_flag = wants_to_open_slot
                set_key = { lhs = Tmp_0 value = 40 }
            }           
            clr_province_flag = open_military
        }
        open_naval = {
            if = {
                limit = {
                    Prod_Can_27 = yes # Ship
                    Prod_NotHasProd = { Prod = 27 }
                    check_key = { lhs = WK_RENet value = 1 }
                }
                set_key = { lhs = Tmp_0 which = TN_ProvPrc23 }
                multiply_key = { lhs = Tmp_0 value = 2 }
                
                    # Inputs
                set_key = { lhs = Tmp_2 which = TN_ProvPrc4 }
                multiply_key = { lhs = Tmp_2 value = 0.2 }
                
                set_key = { lhs = Tmp_3 which = TN_ProvPrc6 }
                multiply_key = { lhs = Tmp_3 value = 0.3 }
                
                set_key = { lhs = Tmp_4 which = TN_ProvPrc10 }
                multiply_key = { lhs = Tmp_4 value = 1.1 }
                
                    # Labour
                set_key = { lhs = Public_Tmp9 which = Class_PUL }
                
                subtract_key = { lhs = Tmp_0 which = Tmp_2 }
                subtract_key = { lhs = Tmp_0 which = Tmp_3 }
                subtract_key = { lhs = Tmp_0 which = Tmp_4 }
                subtract_key = { lhs = Tmp_0 which = Public_Tmp9 }
                if = {
                    limit = {
                        check_key = { lhs = Tmp_0 value = 0.001 }
                    }
                    set_province_flag = wants_to_open_slot
                    set_province_flag = will_open_naval
                    set_key = { lhs = Tmp_0 value = 27 }
                }
            }
            clr_province_flag = open_naval
        }
        open_industrial = {
            if = {
                limit = {
                    Prod_Can_28 = yes # Processed Material
                    Prod_NotHasProd = { Prod = 28 }
                    check_key = { lhs = WK_RENet value = 1 }
                }
                set_key = { lhs = Tmp_0 which = TN_ProvPrc24 }
                multiply_key = { lhs = Tmp_0 value = 1.8 }
                
                    # Inputs
                set_key = { lhs = Tmp_2 which = TN_ProvPrc5 }
                multiply_key = { lhs = Tmp_2 value = 0.4 }
                
                set_key = { lhs = Tmp_3 which = TN_ProvPrc6 }
                multiply_key = { lhs = Tmp_3 value = 0.4 }
				
				set_key = { lhs = Tmp_4 which = TN_ProvPrc10 }
                multiply_key = { lhs = Tmp_4 value = 1.2 }
                    
                    # Labour
                set_key = { lhs = Public_Tmp9 which = Class_PUL }
                
                subtract_key = { lhs = Tmp_0 which = Tmp_2 }
                subtract_key = { lhs = Tmp_0 which = Tmp_3 }
				subtract_key = { lhs = Tmp_0 which = Tmp_4 }
                subtract_key = { lhs = Tmp_0 which = Public_Tmp9 }
  
                if = {
                    limit = {
                        check_key = { lhs = Tmp_0 value = 0.001 }
                    }
                    set_province_flag = wants_to_open_slot
                    set_province_flag = will_open_industrial
                    set_key = { lhs = Tmp_0 value = 28 }
                }
            }
            clr_province_flag = open_industrial
        }
        open_luxury = {
            if = {
                limit = {
                    check_key = { lhs = WK_RENet value = 1 }
                }
                if = {
                    limit = {
                        Prod_Can_33 = yes # Silk
                    }
                    set_key = { lhs = Tmp_0 which = TN_ProvPrc25 }
					multiply_key = { lhs = Tmp_0 value = 1.6 }
                    set_key = { lhs = Tmp_2 which = TN_ProvPrc21 }
                    multiply_key = { lhs = Tmp_2 value = 0.1 }
                    change_key = { lhs = Tmp_0 which = Tmp_2 }
                        # Inputs
                    set_key = { lhs = Tmp_1 which = TN_ProvPrc4 }
                    multiply_key = { lhs = Tmp_1 value = 4 }
					
					set_key = { lhs = Tmp_3 which = TN_ProvPrc24 }
                    multiply_key = { lhs = Tmp_3 value = 1.5 }
                    
                        # Labour
                    set_key = { lhs =  Public_Tmp9 which = Class_PUL }
                    
                    subtract_key = { lhs = Tmp_0 which = Tmp_1 }
					subtract_key = { lhs = Tmp_0 which = Tmp_3 }
                    subtract_key = { lhs = Tmp_0 which = Public_Tmp9 }                   
                }
                else = { set_key = { lhs = Tmp_0 value = 0 } }
                if = {
                    limit = {
                        Prod_Can_34 = yes # Chinaware
                    }
                    set_key = { lhs = Tmp_1 which = TN_ProvPrc25 }
					multiply_key = { lhs = Tmp_1 value = 1.8 }
                    set_key = { lhs = Tmp_2 which = TN_ProvPrc21 }
                    multiply_key = { lhs = Tmp_2 value = 0.1 }
                    change_key = { lhs = Tmp_1 which = Tmp_2 }
                    
                        # Inputs
                    set_key = { lhs = Tmp_2 which = TN_ProvPrc5 }
                    multiply_key = { lhs = Tmp_2 value = 1.6 }
                    
                    set_key = { lhs = Tmp_3 which = TN_ProvPrc6 }
                    multiply_key = { lhs = Tmp_3 value = 6.4 }
					
					set_key = { lhs = Tmp_4 which = TN_ProvPrc24 }
                    multiply_key = { lhs = Tmp_4 value = 1.5 }
                    
                        # Labour
                    set_key = { lhs = Public_Tmp9 which = Class_PUL }
                    
                    subtract_key = { lhs = Tmp_1 which = Tmp_2 }
                    subtract_key = { lhs = Tmp_1 which = Tmp_3 }
					subtract_key = { lhs = Tmp_1 which = Tmp_4 }
                    subtract_key = { lhs = Tmp_1 which = Public_Tmp9 }           
                   
                }
                else = { set_key = { lhs = Tmp_1 value = 0 } }
                if = {
                    limit = {
                        Prod_Can_35 = yes # Carpet
                    }
                    set_key = { lhs = Tmp_2 which = TN_ProvPrc25 }
                    multiply_key = { lhs = Tmp_2 value = 1.5 }
					
					set_key = { lhs = Tmp_3 which = TN_ProvPrc21 }
                    multiply_key = { lhs = Tmp_3 value = 0.1 }
					change_key = { lhs = Tmp_2 which = Tmp_3 }
                    
                        # Inputs
                    set_key = { lhs = Tmp_4 which = TN_ProvPrc4 }
                    multiply_key = { lhs = Tmp_4 value = 8 }
					
					set_key = { lhs = Tmp_5 which = TN_ProvPrc24 }
                    multiply_key = { lhs = Tmp_5 value = 1.5 }
                      
                        # Labour
                    set_key = { lhs =  Public_Tmp9 which = Class_PUL }
                    
                    subtract_key = { lhs = Tmp_2 which = Tmp_4 }
					subtract_key = { lhs = Tmp_2 which = Tmp_5 }
                    subtract_key = { lhs = Tmp_2 which = Public_Tmp9 }
                }
                else = { set_key = { lhs = Tmp_2 value = 0 } }
                if = {
                    limit = {
                        Prod_Can_39 = yes # Luxury Cloth
                    }
                    set_key = { lhs = Tmp_3 which = TN_ProvPrc25 }
                    multiply_key = { lhs = Tmp_3 value = 1.3 }
                    set_key = { lhs = Tmp_4 which = TN_ProvPrc21 }
                    multiply_key = { lhs = Tmp_4 value = 0.1 }
                    change_key = { lhs = Tmp_3 which = Tmp_4 }
                        # Inputs
                    set_key = { lhs = Tmp_4 which = TN_ProvPrc4 }
                    multiply_key = { lhs = Tmp_4 value = 8 }
					
					set_key = { lhs = Tmp_5 which = TN_ProvPrc24 }
                    multiply_key = { lhs = Tmp_5 value = 1.5 }					
                      
                        # Labour
                    set_key = { lhs =  Public_Tmp9 which = Class_PUL }
                    
                    subtract_key = { lhs = Tmp_3 which = Tmp_4 }
					subtract_key = { lhs = Tmp_3 which = Tmp_5 }
                    subtract_key = { lhs = Tmp_3 which = Public_Tmp9 }
                }
                else = { set_key = { lhs = Tmp_3 value = 0 } }
                if = {
                    limit = {
                        Prod_Can_36 = yes # Glass
                    }
                    set_key = { lhs = Tmp_4 which = TN_ProvPrc25 }
                    multiply_key = { lhs = Tmp_4 value = 1.4 }
                    set_key = { lhs = Tmp_5 which = TN_ProvPrc21 }
                    multiply_key = { lhs = Tmp_5 value = 0.1 }
                    change_key = { lhs = Tmp_4 which = Tmp_5 }
                        # Inputs
                    set_key = { lhs = Tmp_5 which = TN_ProvPrc5 }
                    multiply_key = { lhs = Tmp_5 value = 2.4 }
                    
                    set_key = { lhs = Tmp_6 which = TN_ProvPrc6 }
                    multiply_key = { lhs = Tmp_6 value = 6.4 }
					
					set_key = { lhs = Tmp_7 which = TN_ProvPrc24 }
                    multiply_key = { lhs = Tmp_7 value = 1.5 }
                        # Labour
                    set_key = { lhs = Public_Tmp9 which = Class_PUL }
                    
                    subtract_key = { lhs = Tmp_4 which = Tmp_5 }
                    subtract_key = { lhs = Tmp_4 which = Tmp_6 }
					subtract_key = { lhs = Tmp_4 which = Tmp_7 }
					subtract_key = { lhs = Tmp_4 which = Public_Tmp9 }
                }
                else = { set_key = { lhs = Tmp_4 value = 0 } }
                if = {
                    limit = { # Silk
                        check_key = { lhs = Tmp_0 value = 0.001 }
                        check_key = { lhs = Tmp_0 which = Tmp_1 } 
                        check_key = { lhs = Tmp_0 which = Tmp_2 } 
                        check_key = { lhs = Tmp_0 which = Tmp_3 }
                        check_key = { lhs = Tmp_0 which = Tmp_4 } 
                        Prod_NotHasProd = { Prod = 33 }
                    }
                   set_province_flag = wants_to_open_slot
                   set_province_flag = will_open_luxury
                   set_key = { lhs = Tmp_0 value = 33 }
                }
                else_if = {
                    limit = { # Chinaware
                        check_key = { lhs = Tmp_1 value = 0.001 }
                        check_key = { lhs = Tmp_1 which = Tmp_0 } 
                        check_key = { lhs = Tmp_1 which = Tmp_2 } 
                        check_key = { lhs = Tmp_1 which = Tmp_3 }
                        check_key = { lhs = Tmp_1 which = Tmp_4 } 
                        Prod_NotHasProd = { Prod = 34 }
                    }
                    set_province_flag = wants_to_open_slot
                    set_province_flag = will_open_luxury
                    set_key = { lhs = Tmp_0 value = 34 }
                }
                else_if = {
                    limit = { # Carpet
                        check_key = { lhs = Tmp_2 value = 0.001 }
                        check_key = { lhs = Tmp_2 which = Tmp_0 } 
                        check_key = { lhs = Tmp_2 which = Tmp_1 } 
                        check_key = { lhs = Tmp_2 which = Tmp_3 }
                        check_key = { lhs = Tmp_2 which = Tmp_4 } 
                        Prod_NotHasProd = { Prod = 35 }
                    }
                    set_province_flag = wants_to_open_slot
                    set_province_flag = will_open_luxury
                    set_key = { lhs = Tmp_0 value = 35 }
                }
                else_if = {
                    limit = { # Luxury Cloth
                        check_key = { lhs = Tmp_3 value = 0.001 }
                        check_key = { lhs = Tmp_3 which = Tmp_0 } 
                        check_key = { lhs = Tmp_3 which = Tmp_1 } 
                        check_key = { lhs = Tmp_3 which = Tmp_2 }
                        check_key = { lhs = Tmp_3 which = Tmp_4 }
                        Prod_NotHasProd = { Prod = 39 }
                        
                    }
                    set_province_flag = wants_to_open_slot
                    set_province_flag = will_open_luxury
                    set_key = { lhs = Tmp_0 value = 39 }
                }
                else_if = {
                    limit = { # Glass
                        check_key = { lhs = Tmp_4 value = 0.001 }
                        check_key = { lhs = Tmp_4 which = Tmp_0 } 
                        check_key = { lhs = Tmp_4 which = Tmp_1 } 
                        check_key = { lhs = Tmp_4 which = Tmp_2 }
                        check_key = { lhs = Tmp_4 which = Tmp_3 }
                        Prod_NotHasProd = { Prod = 36 }
                        
                    }
                    set_province_flag = wants_to_open_slot
                    set_province_flag = will_open_luxury
                    set_key = { lhs = Tmp_0 value = 36 }
                }
            }
            clr_province_flag = open_luxury
        }
        open_knowledge = {
            if = {
                limit = {
                    Prod_Can_29 = yes # Religious Knowledge
                    check_key = { lhs = WK_CLNet value = 1 }
                }
                set_key = { lhs = Tmp_0 which = TN_ProvPrc41 }
                multiply_key = { lhs = Tmp_0 value = 0.65 }
				
                    # Labour
                set_key = { lhs = Public_Tmp9 which = Class_PCL }
                multiply_key = { lhs = Public_Tmp9 value = 2 }
                
                subtract_key = { lhs = Tmp_0 which = Public_Tmp9 }
            }
            else = { set_key = { lhs = Tmp_0 value = 0 } }      
            if = {
                limit = {
                    Prod_Can_30 = yes # Higher Learning
                }
                set_key = { lhs = Tmp_1 which = TN_ProvPrc41 }
                multiply_key = { lhs = Tmp_1 value = 1.25 }
				
					# inputs
                set_key = { lhs = Tmp_2 which = TN_ProvPrc21 }
                multiply_key = { lhs = Tmp_2 value = 0.5 }

				set_key = { lhs = Tmp_3 which = TN_ProvPrc24 }
                multiply_key = { lhs = Tmp_3 value = 0.25 }
                    # Labour
                set_key = { lhs = Public_Tmp9 which = Class_PLT }
                           
				subtract_key = { lhs = Tmp_1 which = Tmp_2 }
				subtract_key = { lhs = Tmp_1 which = Tmp_3 }
                subtract_key = { lhs = Tmp_1 which = Public_Tmp9 }
            }
            else = { set_key = { lhs = Tmp_1 value = 0 } }                           
            if = {
                limit = {  # Religious Knowledge
                    check_key = { lhs = Tmp_0 value = 0.001 }
                    check_key = { lhs = Tmp_0 which = Tmp_1 } 
                    Prod_NotHasProd = { Prod = 29 }
                }
                set_province_flag = wants_to_open_slot
                set_province_flag = will_open_knowledge
                set_key = { lhs = Tmp_0 value = 29 }
            }
            else_if = {
                limit = { # Higher Learning
                    check_key = { lhs = Tmp_1 value = 0.001 }
                    check_key = { lhs = Tmp_1 which = Tmp_0 } 
                    Prod_NotHasProd = { Prod = 30 }
                }
                set_province_flag = wants_to_open_slot
                set_province_flag = will_open_knowledge
                set_key = { lhs = Tmp_0 value = 30 }
            }
            clr_province_flag = open_knowledge
        }
        open_fibre = { 
            set_key = { lhs = Public_Tmp5 which = Building_AgricultureMax }
            set_key = { lhs = Public_Tmp5 which = Building_Agriculture }
            if = {
                limit = {
                    check_key = { lhs = WK_SFNet value = 1 }
                    check_key = { lhs = Public_Tmp5 value = 50 }
                }
                if = {
                    limit = {
                        Prod_Can_11 = yes # Plant Fibre
                    }
                    set_key = { lhs = Tmp_0 which = TN_ProvPrc4 }
                    multiply_key = { lhs = Tmp_0 value = 1.9 }
                    
                        # Labour
                    set_key = { lhs = Public_Tmp9 which = Class_PR }
                    multiply_key = { lhs = Public_Tmp9 value = 1 }
                    
                    subtract_key = { lhs = Tmp_0 which = Public_Tmp9 }
                }
                else = { set_key = { lhs = Tmp_0 value = 0 } }      
                if = {
                    limit = {
                        Prod_Can_12 = yes # Dyes
                    }
                    set_key = { lhs = Tmp_1 which = TN_ProvPrc4 }
                    multiply_key = { lhs = Tmp_1 value = 1 }
                    set_key = { lhs = Tmp_2 which = TN_ProvPrc25 }
                    multiply_key = { lhs = Tmp_2 value = 0.2 }
                    change_key = { lhs = Tmp_1 which = Tmp_2 }

						# inputs
					set_key = { lhs = Tmp_3 which = TN_ProvPrc24 }
					multiply_key = { lhs = Tmp_3 value = 0.2 }

                        # Labour
                    set_key = { lhs = Public_Tmp9 which = Class_PR }
                    multiply_key = { lhs = Public_Tmp9 value = 1 }
                    
					subtract_key = { lhs = Tmp_1 which = Tmp_3 }
                    subtract_key = { lhs = Tmp_1 which = Public_Tmp9 }
                }
                else = { set_key = { lhs = Tmp_1 value = 0 } }     
                if = {
                    limit = {
                        Prod_Can_7 = yes # Settled Pasture
                    }
                    set_key = { lhs = Tmp_2 which = TN_ProvPrc4 }
                    multiply_key = { lhs = Tmp_2 value = 0.75 }
                       
                        # Labour
                    set_key = { lhs = Public_Tmp9 which = Class_PR }
                    multiply_key = { lhs = Public_Tmp9 value = 1 }
                       
                    subtract_key = { lhs = Tmp_2 which = Public_Tmp9 }
                }
                else = { set_key = { lhs = Tmp_2 value = 0 } }      
                if = {
                    limit = {
                        Prod_Can_42 = yes # Sericulture
                    }
                    set_key = { lhs = Tmp_3 which = TN_ProvPrc4 }
                    multiply_key = { lhs = Tmp_3 value = 1.5 }
                    set_key = { lhs = Tmp_4 which = TN_ProvPrc9 }
                    multiply_key = { lhs = Tmp_4 value = 0.02 }
                    change_key = { lhs = Tmp_3 which = Tmp_4 }
                    set_key = { lhs = Tmp_4 which = TN_ProvPrc25 }
                    multiply_key = { lhs = Tmp_4 value = 0.02 }
                    change_key = { lhs = Tmp_3 which = Tmp_4 }                    
                        # Labour
                    set_key = { lhs = Public_Tmp9 which = Class_PR }
                       
                    subtract_key = { lhs = Tmp_3 which = Public_Tmp9 }
                }
                else = { set_key = { lhs = Tmp_3 value = 0 } }                                   
                if = {
                    limit = {  # Plant Fibre
                        check_key = { lhs = Tmp_0 value = 0.001 }
                        check_key = { lhs = Tmp_0 which = Tmp_1 } 
                        check_key = { lhs = Tmp_0 which = Tmp_2 } 
                        check_key = { lhs = Tmp_0 which = Tmp_3 }
                        Prod_NotHasProd = { Prod = 11 }
                    }
                    set_province_flag = wants_to_open_slot
                    set_province_flag = will_open_fibre
                    set_key = { lhs = Tmp_0 value = 11 }
                }
                else_if = {
                    limit = { # Dyes
                        check_key = { lhs = Tmp_1 value = 0.001 }
                        check_key = { lhs = Tmp_1 which = Tmp_0 } 
                        check_key = { lhs = Tmp_1 which = Tmp_2 } 
                        check_key = { lhs = Tmp_1 which = Tmp_3 } 
                        Prod_NotHasProd = { Prod = 12 }
                    }
                    set_province_flag = wants_to_open_slot
                    set_province_flag = will_open_fibre
                    set_key = { lhs = Tmp_0 value = 12 }
                }
                else_if = {
                    limit = { # Settled Pasture
                        check_key = { lhs = Tmp_2 value = 0.001 }
                        check_key = { lhs = Tmp_2 which = Tmp_0 } 
                        check_key = { lhs = Tmp_2 which = Tmp_1 } 
                        check_key = { lhs = Tmp_2 which = Tmp_3 } 
                        Prod_NotHasProd = { Prod = 7 }
                    }
                    set_province_flag = wants_to_open_slot
                    set_province_flag = will_open_fibre
                    set_key = { lhs = Tmp_0 value = 7 }
                }
                else_if = {
                    limit = { # Sericulture
                        check_key = { lhs = Tmp_3 value = 0.001 }
                        check_key = { lhs = Tmp_3 which = Tmp_0 } 
                        check_key = { lhs = Tmp_3 which = Tmp_1 } 
                        check_key = { lhs = Tmp_3 which = Tmp_2 } 
                        Prod_NotHasProd = { Prod = 42 }
                    }
                    set_province_flag = wants_to_open_slot
                    set_province_flag = will_open_fibre
                    set_key = { lhs = Tmp_0 value = 42 }
                }
            }
            clr_province_flag = open_fibre  
        }
        open_timber = {
            set_key = { lhs = Public_Tmp1 which = Building_ForestryMax }
            subtract_key = { lhs = Public_Tmp1 which = Building_Forestry }
            if = {
                limit = { # Timber
                    Prod_Can_13 = yes  
                    check_key = { lhs = Public_Tmp1 value = 35 }
                    check_key = { lhs = WK_SFNet value = 3 }
                }
                set_key = { lhs = Tmp_0 which = TN_ProvPrc10 }
                multiply_key = { lhs = Tmp_0 value = 1 }
				if = {
					limit = {
						has_terrain = taiga
					}
					multiply_key = { lhs = Tmp_0 value = 2 }
				}
				set_key = { lhs = Tmp_1 which = TN_ProvPrc5 }
                multiply_key = { lhs = Tmp_1 value = 1 }
				change_key = { lhs = Tmp_0 which Tmp_1 }
                
                    # Labour
                set_key = { lhs = Public_Tmp9 which = Class_PR }
                multiply_key = { lhs = Public_Tmp9 value = 1 }
                
                subtract_key = { lhs = Tmp_0 which = Public_Tmp9 }
            }
            else = { set_key = { lhs = Tmp_0 value = 0 } }
            if = {
                limit = { # Timber
                    check_key = { lhs = Tmp_0 value = 0.001 } 
                    Prod_NotHasProd = { Prod = 13 } 
                }
                set_province_flag = wants_to_open_slot
                set_province_flag = will_open_timber
                set_key = { lhs = Tmp_0 value = 13 }
            }
			clr_province_flag = open_timber 
        }
    }
    OpenProdEffect = yes
}
IndustrySizeHelper = {
    set_key = { lhs = Tmp_9 value = 5 } #Based industry size.
    if = {
        limit = {
            OR = { 
                has_province_flag = will_open_industrial
                has_province_flag = will_open_military
                has_province_flag = will_open_naval
                has_province_flag = will_open_consumer
                has_province_flag = will_open_luxury
            }
        }
        set_key = { lhs = Tmp_5 which = WK_RENet }
        set_key = { lhs = Tmp_2 which = WK_RENet }
        multiply_key = { lhs = Tmp_5 value = 0.35 }
        multiply_key = { lhs = Tmp_2 value = 0.75 }
        
            #Increase size based on labour capacity
        change_key = { lhs = Tmp_9 which = Tmp_5 }
        
            # Add size based on year passed
        AAA = { 
            set_key = { lhs = Tmp_1 which = Current_Year }
            PREV = { set_key = { lhs = Tmp_1 which = PREV } }
        }
        change_key = { lhs = Tmp_9 which = Tmp_1 }
        
            # Size can't be bigger than 75% of workforce capacity.
        if = {
            limit = {
                check_key = { lhs = Tmp_9 which = Tmp_2 }
            }
            set_key = { lhs = Tmp_9 which = Tmp_2 }
        } 
		Infra_AddPrp = { Type=Industrial Amount=2 }
        clr_province_flag = will_open_industrial
        clr_province_flag = will_open_military
        clr_province_flag = will_open_naval
        clr_province_flag = will_open_consumer
        clr_province_flag = will_open_luxury            
    }
    else_if = {
        limit = {
            has_province_flag = will_open_knowledge
        }
        if = {
            limit = { # Religious knowledge
                is_key_equal = { lhs = Tmp_0 value = 29 }
            }
            set_key = { lhs = Tmp_5 which = WK_CLNet }
            set_key = { lhs = Tmp_2 which = WK_CLNet }
            multiply_key = { lhs = Tmp_5 value = 0.35 }
            multiply_key = { lhs = Tmp_2 value = 0.75 }
            
            change_key = { lhs = Tmp_9 which = Tmp_5 }
            
                # Add size based on year passed
            AAA = { 
                set_key = { lhs = Tmp_1 which = Current_Year }
                PREV = { set_key = { lhs = Tmp_1 which = PREV } }
            }
        
            change_key = { lhs = Tmp_9 which = Tmp_1 }
            
                # Size can't be bigger than 75% of workforce capacity.
            if = {
                limit = {
                    check_key = { lhs = Tmp_9 which = Tmp_2 }
                }
                set_key = { lhs = Tmp_9 which = Tmp_2 }
            } 
        }
        else = { # Higher learning
            set_key = { lhs = Tmp_5 which = WK_LTNet }
            set_key = { lhs = Tmp_2 which = WK_LTNet }
            multiply_key = { lhs = Tmp_5 value = 0.35 }
            multiply_key = { lhs = Tmp_2 value = 0.75 }
                #Increase size based on labour capacity
            change_key = { lhs = Tmp_9 which = Tmp_5 }
            
                # Add size based on year passed
            AAA = { 
                set_key = { lhs = Tmp_1 which = Current_Year }
                PREV = { set_key = { lhs = Tmp_1 which = PREV } }
            }
            
            change_key = { lhs = Tmp_9 which = Tmp_1 }
            
                # Size can't be bigger than 75% of workforce capacity.
            if = {
                limit = {
                    check_key = { lhs = Tmp_9 which = Tmp_2 }
                }
                set_key = { lhs = Tmp_9 which = Tmp_2 }
            } 
        } 
		Infra_AddPrp = { Type=Academic Amount=2 }
        clr_province_flag = will_open_knowledge
    }
    else_if = {
        limit = {
            OR = {
                has_province_flag = will_open_gold
                has_province_flag = will_open_silver
                has_province_flag = will_open_salt
                has_province_flag = will_open_marble
                
                AND = { 
                    has_province_flag = will_open_fuel
                    is_key_equal = { lhs = Tmp_0 value = 14 } # Coal uses extraction
                }
                
                AND = {
                    has_province_flag = will_open_raw
                    is_key_equal = { lhs = Tmp_0 value = 15 } # Metals uses extraction
                }
                
                AND = { 
                    has_province_flag = will_open_exotics
                    is_key_equal = { lhs = Tmp_0 value = 16 } # Rare Metals uses extraction
                }
            }
        }
        set_key = { lhs = Tmp_5 which = WK_SFNet }
        set_key = { lhs = Tmp_2 which = WK_SFNet }
        multiply_key = { lhs = Tmp_5 value = 0.35 }
        multiply_key = { lhs = Tmp_2 value = 0.75 }
            #Increase size based on labour capacity
        change_key = { lhs = Tmp_9 which = Tmp_5 }
            # Add size based on year passed
        AAA = { 
            set_key = { lhs = Tmp_1 which = Current_Year }
            PREV = { set_key = { lhs = Tmp_1 which = PREV } }
        }
        change_key = { lhs = Tmp_9 which = Tmp_1 }
        
        if = { # Check that size isn't higher than amount left of extraction capacity
            limit = {
                check_key = { lhs = Tmp_9 which = Public_Tmp7 }
            }
            multiply_key = { lhs = Public_Tmp7 value = 0.75 }
            set_key = { lhs = Tmp_9 which = Public_Tmp7 }
        }
            # Size can't be bigger than 75% of workforce capacity.
        if = {
            limit = {
                check_key = { lhs = Tmp_9 which = Tmp_2 }
            }
            set_key = { lhs = Tmp_9 which = Tmp_2 }
        } 
		Infra_AddPrp = { Type=Extraction Amount=2 Cap=yes }
        clr_province_flag = will_open_gold
        clr_province_flag = will_open_silver
        clr_province_flag = will_open_salt
        clr_province_flag = will_open_marble
        clr_province_flag = will_open_fuel
        clr_province_flag = will_open_raw
        clr_province_flag = will_open_exotics
    }
    else_if = {
        limit = {
            OR = {
                has_province_flag = will_open_fuel
                has_province_flag = will_open_raw
                AND = { 
                    is_key_equal = { lhs = Tmp_0 value = 21 } # Game/Furs uses Forestry
                    OR = {
                        has_province_flag = will_open_exotics
                        has_province_flag = will_open_food 
                    }
                }
            }
        }
        
        set_key = { lhs = Tmp_5 which = WK_SFNet }
        set_key = { lhs = Tmp_2 which = WK_SFNet }
        multiply_key = { lhs = Tmp_5 value = 0.35 }
        multiply_key = { lhs = Tmp_2 value = 0.7 }
            #Increase size based on labour capacity
        change_key = { lhs = Tmp_9 which = Tmp_5 }
            # Add size based on year passed
        AAA = { 
            set_key = { lhs = Tmp_1 which = Current_Year }
            PREV = { set_key = { lhs = Tmp_1 which = PREV } }
        }
        change_key = { lhs = Tmp_9 which = Tmp_1 }
        
        if = { # Check that size isn't higher than amount left of Forestry capacity
            limit = {
                check_key = { lhs = Tmp_9 which = Public_Tmp6 }
            }
            multiply_key = { lhs = Public_Tmp7 value = 0.75 }
            set_key = { lhs = Tmp_9 which = Public_Tmp6 }
        }
        if = {
            limit = {
                check_key = { lhs = Tmp_9 which = Tmp_2 }
            }
            set_key = { lhs = Tmp_9 which = Tmp_2 }
        } 
		Infra_AddPrp = { Type=Forestry Amount=2 Cap=yes }
    }
    else_if = {
        limit = {
            AND = { 
                has_province_flag = will_open_food
                is_key_equal = { lhs = Tmp_0 value = 6 } # Fishery uses Fishery XD
            }
        }
        
        set_key = { lhs = Tmp_5 which = WK_SFNet }
        set_key = { lhs = Tmp_2 which = WK_SFNet }
        multiply_key = { lhs = Tmp_5 value = 0.35 }
        multiply_key = { lhs = Tmp_2 value = 0.7 }
            # Increase size based on labour capacity
        change_key = { lhs = Tmp_9 which = Tmp_5 }
            # Add size based on year passed
        AAA = { 
            set_key = { lhs = Tmp_1 which = Current_Year }
            PREV = { set_key = { lhs = Tmp_1 which = PREV } }
        }
        change_key = { lhs = Tmp_9 which = Tmp_1 }
        
        if = { # Check that size isn't higher than amount left of Fishery capacity
            limit = {
                check_key = { lhs = Tmp_9 which = Public_Tmp4 }
            }
            multiply_key = { lhs = Public_Tmp7 value = 0.75 }
            set_key = { lhs = Tmp_9 which = Public_Tmp4 }
        }
        if = {
            limit = {
                check_key = { lhs = Tmp_9 which = Tmp_2 }
            }
            set_key = { lhs = Tmp_9 which = Tmp_2 }
        } 
		Infra_AddPrp = { Type=Fishery Amount=2 Cap=yes }
        clr_province_flag = will_open_food
        clr_province_flag = will_open_exotics
    }
    else_if = {
        limit = {
            OR = {
                has_province_flag = will_open_food
                has_province_flag = will_open_fibre
                has_province_flag = will_open_exotics
            }
        }
        
        set_key = { lhs = Tmp_5 which = WK_SFNet }
        set_key = { lhs = Tmp_2 which = WK_SFNet }
        multiply_key = { lhs = Tmp_5 value = 0.35 }
        multiply_key = { lhs = Tmp_2 value = 0.7 }
            # Increase size based on labour capacity
        change_key = { lhs = Tmp_9 which = Tmp_5 }
            # Add size based on year passed
        AAA = { 
            set_key = { lhs = Tmp_1 which = Current_Year }
            PREV = { set_key = { lhs = Tmp_1 which = PREV } }
        }
        change_key = { lhs = Tmp_9 which = Tmp_1 }
        
        if = { # Check that size isn't higher than amount left of Agriculture capacity
            limit = {
                check_key = { lhs = Tmp_9 which = Public_Tmp5 }
            }
            multiply_key = { lhs = Public_Tmp7 value = 0.75 }
            set_key = { lhs = Tmp_9 which = Public_Tmp5 }
        }
            # Size can't be bigger than 75% of workforce capacity.
        if = {
            limit = {
                check_key = { lhs = Tmp_9 which = Tmp_2 }
            }
            set_key = { lhs = Tmp_9 which = Tmp_2 }
        }
		Infra_AddPrp = { Type=Agriculture Amount=2 Cap=yes }
        clr_province_flag = will_open_food
        clr_province_flag = will_open_fibre
        clr_province_flag = will_open_exotics
    }
}
OpenProdEffect = {
    if = {
        limit = {
            has_province_flag = wants_to_open_slot 
        }
        set_province_flag = rec_new_slot
        IndustrySizeHelper = yes
            # At least 5 size
        if = {
            limit = {
                NOT = { check_key = { lhs = Tmp_9 value = 5 } }
            }
            set_key = { lhs = Tmp_9 value = 5 }
        }
        #province_event = { id = new_world.91 }
        Public_AddProduceVar_2 = { prod = Tmp_0 size = Tmp_9 soph = 50 wealth = 0 }
    }
}